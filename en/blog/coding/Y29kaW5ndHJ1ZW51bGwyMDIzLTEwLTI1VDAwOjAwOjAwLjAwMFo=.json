{"html":"<p>Just last week I posted about <a href=\"/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/\">how to create upload reels to Instagram using Node.js</a>, and in the code it was possible to upload a cover image for the video too, but I didn’t explain how to create this cover image.</p>\n<p>I mean, of course you can go to <a href=\"https://www.photopea.com/\" target=\"_blank\" rel=\"noreferrer\">Photopea</a> and create a cover image for your video, but what if you want to automate this process? What if you want to create a cover image for all your videos automatically?</p>\n<p>Well, that’s what I’m going to show you today.</p>\n<p></p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdklEQVQozxXQu27TUACA4RPbcXx8ObaPj+9O7DiXNiRNUqcpzQXVtEFtgBZISUsZ6JWFAaR2oEUVEoKyMQALQkgIgZB4AAYkZgpvgMTEBhti7QDqv3/LDzJyTlOxJkhIwgwvMgJKESNFdK1ey9QaaKIjFcdhJqsJrqd4rkZUETEMTVMnAdkPHC9r6cSUtRTkoJOG/bly3F3vnFmNop34fK/Y5KImKtctwyI2EXgOQi7FJk+wK+YDbcTHPuZlybGMVie8Opg+1azLwXRQXa1EIs3xVoEMh07UUlSDRwqEMEFRAAAQ4BFH8TCUpSSHwtC4NH86OxH5uYtxayxXmBqvtJsNjPJm7zKOY8XIknToYEfhcZJlgeNWMG9CSpQoQRovkelOGYdPb20cf3/769vL4x/vv757OOpNpsbG8EzbhJjnOchBHvI8zwPbCV3X1kQNcaLcLHNxA7BMvzKIq93Pzw9uLsz368u+kgOjWXu2l04XdFOj6QSgAM3QILRyGYOwKTYBgJDzxZV+M2rcXdvffnz45+j1kxeHd+4/W47OWutLdq2mY8siro5MldWSVBIUUclNZpBiasTl83lpZeHKcOPD7Z1/vz9+ebD/9+jNz0+vds+tlW4MFN/VdUMUDVkwECtTgAIuDhRT51VMVMUqBnh+1tvf6PbOHizObcUze4ML16e6+c1luz1t2CWVOFDioAQTicTJbZR1FN3UkYNVJBGN1CfNa4tgb8mz9dnqaMv3wUwV3Vs3i/WQ8wuGZxNTEmU2xdJJBmRRwU55FrKwqqgKQpYRxl3t0ZbT7gMARMHUdjfR9tAOqg7x1EA3DWJgRUEiQzP/AerQaSbt1hVqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Illustration\" title=\"Illustration\" src=\"/static/f8272dae5fedf81e3304107e04988bdb/42a19/instagram-reels-thumbnail-illustration.png\" srcset=\"/static/f8272dae5fedf81e3304107e04988bdb/e3135/instagram-reels-thumbnail-illustration.png 256w,\n/static/f8272dae5fedf81e3304107e04988bdb/06341/instagram-reels-thumbnail-illustration.png 512w,\n/static/f8272dae5fedf81e3304107e04988bdb/42a19/instagram-reels-thumbnail-illustration.png 1024w,\n/static/f8272dae5fedf81e3304107e04988bdb/e8464/instagram-reels-thumbnail-illustration.png 1536w,\n/static/f8272dae5fedf81e3304107e04988bdb/445c6/instagram-reels-thumbnail-illustration.png 1792w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Illustration</figcaption>\n  </figure><p></p>\n<h2 id=\"finding-the-right-package\" style=\"position:relative;\"><a href=\"#finding-the-right-package\" aria-label=\"finding the right package permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Finding the right package</h2>\n<p>As a frontend developer, the only thing I know about image manipulation is by using canvas, and luckly there’s a Node.js library that allows us to do that, it’s called <a href=\"https://www.npmjs.com/package/canvas\" target=\"_blank\" rel=\"noreferrer\">node-canvas</a>.</p>\n<p>With it, we can create a canvas, draw images, text, shapes, etc. It’s pretty cool, check out the example below:</p>\n<div class=\"copy-code-block\"><button tabindex=\"0\" type=\"button\" class=\"MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary copy-code-button\"><span class=\"MuiButton-label\">Copy</span></button><div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas<span class=\"token punctuation\">,</span> loadImage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> writeFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">'30px Impact'</span><span class=\"token punctuation\">;</span>\nctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'#000'</span><span class=\"token punctuation\">;</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image/png'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> buffer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./hello-world.png'</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div></div>\n<h2 id=\"coming-up-with-a-design\" style=\"position:relative;\"><a href=\"#coming-up-with-a-design\" aria-label=\"coming up with a design permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coming up with a design</h2>\n<p>I’m not a designer, so I’m not going to teach you how to create a good design, but I can show you how I came up with the design for my thumbnails.</p>\n<p>I started by creating a new file on Photopea with the same size as the Instagram Reels video, which is 1080x1920px. Then I added a background image and a text with the title of the video, and also a background color for the text with some opacity.</p>\n<p>And for the cherry on top, I added a foreground image with a transparent background with an image of myself in pixel art style.</p>\n<p></p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 177.734375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsTAAALEwEAmpwYAAAHoUlEQVRIxy1VWXAbWRXtYRbHlmTtliNLvbz3elN3q6VudavV2ndZtuU940kcT8ngCZnYhGBnw3bisZ0EkUwcJeCkTIVMUYGESg0MpCiYqQxkUixf+aKKml9++OCTgiq+MMjk1P295713zz3vYIackwWFZWmEIElRBEHRLOAkmKlFcqOh1AhnVrncOB8v02ZWTeaEwohQmRFqb0fKmWEsGxsaTE2lTKUxGq9UlGJBicUigsADEgASUGSHS4jQsoZiuqxGQ0lTzKYjmiJFZBkDIIhDnEIUx9GKIqRSUipjplJKY0QfqseKpVhUDLMQcCKNEAUAIHFAUEGaBgwLsSwZrhORvKAgDuFEECdIAACEkGFoUWBimiixIUVhEjUmOcSl6kyixGcSJZnXBC6MTY6bmVg4CyKqqAucyLIMQhDRAEIKQEBRACKAEIIA0TTiBaQYfFLLFfWJQXMGy+clSWYliBJSJqs00tF6NGQwkOeQiACNECBJAsdxgjgonAgM4AOBw4Hg4UBwADt82OtyWZ2enq6u151dFp9jIOBBPgfutfv9bsrttPv6Lf4Bp91ut1gsXV1dVqvVYrHarDaXy4VZrbZmc35zc+vWrfbS4tLW5pWTC0vL3zy/vra+tnbp5s2b165tX7x4ttVqnThx4sKFC5VKZWJiolAoWK1WzGazzc8319fXd3Z2isXi1NTUwnsLW9ubc3NzU1OTd+7cabdvNxqjzWZzeXl5dXV1Y2Pj3Llzuq5bLBbM6XRGIpFarRaPxzOZzMhIIx6PFwoFTdO0mFapVHK5XD6f0w/AcRxJkt3d3b29vW63G7Pb7StnVz755OcvXrzY3d29d+9eq9VaWlra29t7+PDhy5cvnz179vTp00ePHu3u7rbb7Uq12tXV5fV6O2+22+2yHJYkyTAMnuc5jpMkCcdxCGE6nVYURT1AOBw2TbNarYZCIfcBOs2BYHBza/uHDx589NGDlZXlvb0f7Oy079+/v7q2un1l+8mTJ3fv3m2321evXn38+NHW1mar1Tp16tSrazMDvqwRmxwbnZgYy2RizeZMs/nO+Hgjm83NzMzMz88fP358enp6cnJydnZ2cHBQ0zTTNB0Ox8HJ3v7lxZNrZ791aXX93MoFTY1tbFwEkLQ7HG6Pu7un+1D3IYulp6enp7u722az2e12q9XqOgDmc+EXz6+1b7dv3r5+fad1+szizZ0PxZAU6ANUgDnsC3g9Xq+3z+V2ut0uj8fjdrs9Hs+rZr+/P+AjPHbXgNNO9XsA7QsiJ4n6SSIACJwMUAEf5feQA33A4/Q5HU63y9NrtzocdrvDjtE0wcnBaCguUzHOCxQksSHW5/cFAv0A+Bk2EIvRERmqsigLLAgGBKgpbIoiAMBZrKxPGtG0GS1n1aFktJRN1FRaChN8iA/TNKJpmuOYSCQUj4dyxXAqGQ1LIVMz40qqbExhRX3MiOTSsXpcNDSVyYzxiSKdUHRTLSYSGscjkiQo6sCbEDAdoJDAJORSxZjCSvHxRKSQ04aL6aISY+PxqJkVy4WhIXPWUHIxyZBEmWFomoYdnx8UhBAhwDAsVtTHzUgpqw7n05l8XolLUZ1OlONHDMFMs7GcMVpM1SJymKRwiCiEII0g3QFCCGD1aCEeN3J6PZsxjXRUZHkJqVl1JCcmUoxQTI0V1NGMWgnzihxSOl8KAhQgKEBACDBTTuo5AUVZq83WbbNDVTUbQ1RYIfyEIcWKxnhBayTkvCHn8kZDo1idjmhyNhyK0jTCjHCp34ljX3nztdffwjCsy+mJpFN8OkPrGs8ZBWU0rwzHRDMZLSejZZ2gDU6rJo42CsfSySQm0DKGYXGy/5dnj1yeTA/0WrA3et7wBelE0gMZyIgZo6hFzLw2YsQSPAQyG87FRsv5mixLmCqkXBarGuz73unR/b/cfd6a/86JkY9Pj2YE2sNLRIjXTVkQOUACnuU7ciEKQDIUCrEsg3n6+jh3b5EOvHWo6yffnt7//Mq/Pt18fuvEtSO5N3usfgo3S0x+kjfyIVnhOAEiiCDszAwhiC3XjfdzyvUbLac/kCN8q8MG4Xe/hmGM1+GyHqLogFnlM+NMuirnh5TCNJ8oMrquKWK803ypEP340rvPP/3ZqfeO//1HK1sz5V4cLR4dl929vX12zeTTDa74Np+tRUsN1awzehFWCvWxzHxaLWPHTPmLu4v7f77z7y/a+3/Y+fIX312/1rp3dW1MwtnObiMhQseydKqgpob4whE+Ueaq2ZGiNqFJSczu9t5bnfvN979xZqK0OVb752fX9r/88a+2mhslZS4dHSApBCBFAAgQLyLFZLQ0V0mN14yZuJzBhvXQh18fv3xmdne9+f5cY2/jq//49QcLw+nb09m0SAdInKEhwxyk1SsWyLFcRNC0cApbrBo33q3dOX90qdn46Vbz5MJ0rl5GRPCdY5FUKaGKSYQQCXAS4uiAhaZfTRsACvvs8uxfH5392+Nzf2o1f3/jawujGau7D0IAGEpT1ZI+NmjOpNWqKhqoE5wEgB2R/u8NbP/z7f/87sr+b6/88WqzxpGLpojwAOrkLKQoigI4y7JRUc+qdU01dDmjigbT8RT4n1T/BXdR/JE3X+zEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Reels thumbnail\" title=\"Reels thumbnail\" src=\"/static/352db45cb6eb4b617148e7cfaf35c1dd/42a19/instagram-reels-thumbnail.png\" srcset=\"/static/352db45cb6eb4b617148e7cfaf35c1dd/e3135/instagram-reels-thumbnail.png 256w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/06341/instagram-reels-thumbnail.png 512w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/42a19/instagram-reels-thumbnail.png 1024w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/b4ad3/instagram-reels-thumbnail.png 1080w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Reels thumbnail</figcaption>\n  </figure><p></p>\n<h2 id=\"creating-the-thumbnail\" style=\"position:relative;\"><a href=\"#creating-the-thumbnail\" aria-label=\"creating the thumbnail permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating the thumbnail</h2>\n<p>Now that we have the design, we can start coding. First, we need to create a function that will create the thumbnail for us, and it will receive a background image, a foreground image, a title and the path to save the thumbnail as parameters.</p>\n<div class=\"copy-code-block\"><button tabindex=\"1\" type=\"button\" class=\"MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary copy-code-button\"><span class=\"MuiButton-label\">Copy</span></button><div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateImageForPost</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">backgroundImagePath<span class=\"token punctuation\">,</span>\n  foregroundImagePath<span class=\"token punctuation\">,</span>\n  title<span class=\"token punctuation\">,</span>\n  outputPath</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> backgroundImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadImage</span><span class=\"token punctuation\">(</span>backgroundImagePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> foregroundImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadImage</span><span class=\"token punctuation\">(</span>foregroundImagePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span>backgroundImage<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> backgroundImage<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>foregroundImage<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// TODO add text</span>\n  <span class=\"token comment\">// addCenteredTextWithBackground(ctx, title, canvas.width, canvas.height);</span>\n\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> out <span class=\"token operator\">=</span> <span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span>outputPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">createPNGStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    stream<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    out<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finish'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The PNG file was created.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    out<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div></div>\n<p>This code will load the background and foreground images, create a canvas with the same size as the background image, draw the foreground image on the canvas, and save the canvas as a PNG file. That was the easy part, now we need to add the text.</p>\n<p>The challenge here is to add the text in the center of the canvas, and make sure it won’t overflow the canvas. Let’s take a look how we can do that.</p>\n<h2 id=\"adding-the-text\" style=\"position:relative;\"><a href=\"#adding-the-text\" aria-label=\"adding the text permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding the text</h2>\n<p>First, we need to create a function that will add the text in the center of the canvas, and it will receive the text and the canvas as parameters. We’re going to do that in the <code class=\"language-text\">addCenteredTextWithBackground</code> function.</p>\n<div class=\"copy-code-block\"><button tabindex=\"2\" type=\"button\" class=\"MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary copy-code-button\"><span class=\"MuiButton-label\">Copy</span></button><div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">addCenteredTextWithBackground</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span>\n  text<span class=\"token punctuation\">,</span>\n  canvasWidth<span class=\"token punctuation\">,</span>\n  canvasHeight</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> fontSize <span class=\"token operator\">=</span> <span class=\"token number\">150</span><span class=\"token punctuation\">;</span>\n  ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fontSize<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px Impact</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> textHeight <span class=\"token operator\">=</span> fontSize <span class=\"token operator\">*</span> lines<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rectWidth <span class=\"token operator\">=</span> canvasWidth<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rectHeight <span class=\"token operator\">=</span> textHeight <span class=\"token operator\">+</span> <span class=\"token number\">60</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> rectX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvasWidth <span class=\"token operator\">-</span> rectWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rectY <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">;</span>\n\n  ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'rgba(0, 0, 0, 0.5)'</span><span class=\"token punctuation\">;</span>\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>rectX<span class=\"token punctuation\">,</span> rectY<span class=\"token punctuation\">,</span> rectWidth<span class=\"token punctuation\">,</span> rectHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> lines<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> textX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvasWidth <span class=\"token operator\">-</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">measureText</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> textY <span class=\"token operator\">=</span> rectY <span class=\"token operator\">+</span> fontSize <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span> textX<span class=\"token punctuation\">,</span> textY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div></div>\n<p>This function will calculate the size of the rectangle that will be the background of the text, and then it will draw the rectangle and the text on the canvas. Unfortunately, just doing <code class=\"language-text\">text.split(' ');</code> won’t do the job, because splitting the text by spaces will simply make the text’s height bigger, but it won’t necessarely make the text fit in the canvas.</p>\n<p>So let’s create a function called <code class=\"language-text\">breakTextToFitCanvas</code> that will receive the text, a canvas context and a maximum width as parameters, and it will return an array of strings with the text broken into lines that will fit in the canvas.</p>\n<div class=\"copy-code-block\"><button tabindex=\"3\" type=\"button\" class=\"MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary copy-code-button\"><span class=\"MuiButton-label\">Copy</span></button><div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">breakTextToFitCanvas</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">,</span> maxWidth</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> words <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> currentLine <span class=\"token operator\">=</span> words<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> words<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> word <span class=\"token operator\">=</span> words<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> width <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">measureText</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>currentLine<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>word<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>width <span class=\"token operator\">&lt;</span> maxWidth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      currentLine <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>word<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      lines<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>currentLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      currentLine <span class=\"token operator\">=</span> word<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  lines<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>currentLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> lines<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div></div>\n<h2 id=\"putting-it-all-together\" style=\"position:relative;\"><a href=\"#putting-it-all-together\" aria-label=\"putting it all together permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Putting it all together</h2>\n<p>Now that we have all the functions we need, we can put it all together and create the thumbnail. Let’s create a function called <code class=\"language-text\">generateThumbnail</code> that will receive the title of the video and the path to save the thumbnail as parameters.</p>\n<div class=\"copy-code-block\"><button tabindex=\"4\" type=\"button\" class=\"MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary copy-code-button\"><span class=\"MuiButton-label\">Copy</span></button><div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateThumbnail</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> outputPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> backgroundImagePath <span class=\"token operator\">=</span> <span class=\"token string\">'./background.png'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> foregroundImagePath <span class=\"token operator\">=</span> <span class=\"token string\">'./foreground.png'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">await</span> <span class=\"token function\">generateImageForPost</span><span class=\"token punctuation\">(</span>\n    backgroundImagePath<span class=\"token punctuation\">,</span>\n    foregroundImagePath<span class=\"token punctuation\">,</span>\n    title<span class=\"token punctuation\">,</span>\n    outputPath\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div></div>\n<p>And now we can call this function and create the thumbnail.</p>\n<div class=\"copy-code-block\"><button tabindex=\"5\" type=\"button\" class=\"MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary copy-code-button\"><span class=\"MuiButton-label\">Copy</span></button><div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">generateThumbnail</span><span class=\"token punctuation\">(</span><span class=\"token string\">'How to create thumbnails for your videos with Node.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./thumbnail.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>And that’s it! Now you can create thumbnails for your videos automatically. I hope you enjoyed this post, and  don’t forget to check how to <a href=\"/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/\">upload Instagram Reels using Node.js</a>.</p>\n<p>See you next time!</p>","path":"/en/blog/coding/how-to-automatically-create-thumbnails-for-your-videos-with-nodejs/","title":"How to automatically create thumbnails for your videos with Node.js","language":"en","postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEwLTI1VDAwOjAwOjAwLjAwMFo=","comments":[],"relatedPosts":[{"path":"/en/blog/coding/creating-instagram-reels-coding-tutorials-automatically-with-openais-gpt/","postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEyLTIwVDAwOjAwOjAwLjAwMFo=","title":"Creating Instagram Reels coding tutorials automatically with OpenAI's GPT","date":"2023-12-20T00:00:00.000Z"},{"path":"/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/","postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEwLTE0VDAwOjAwOjAwLjAwMFo=","title":"Posting Instagram Reels using Node.js and the art of overcoming limitations","date":"2023-10-14T00:00:00.000Z"},{"path":"/en/blog/coding/using-google-fitness-api-to-calculate-my-tdee-and-more/","postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTA4LTAyVDAwOjAwOjAwLjAwMFo=","title":"Using Google Fitness API to calculate my TDEE and more","date":"2023-08-02T00:00:00.000Z"},{"path":"/en/blog/coding/adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way/","postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA1LTA1VDAwOjAwOjAwLjAwMFo=","title":"Adding a copy button to code snippets on Gatsby: The lazy way","date":"2022-05-05T00:00:00.000Z"},{"path":"/en/blog/coding/how-webpack-handles-dynamic-imports-with-variable-paths/","postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA0LTExVDAwOjAwOjAwLjAwMFo=","title":"How Webpack handles dynamic imports with variable paths","date":"2022-04-11T00:00:00.000Z"},{"path":"/en/blog/coding/create-videos-from-code-snippets-with-this-nodejs-script/","postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTAxLTA0VDAwOjAwOjAwLjAwMFo=","title":"Create videos from code snippets with this Node.js script","date":"2022-01-04T00:00:00.000Z"},{"path":"/en/blog/games/automatically-update-the-embedded-tileset-for-all-your-tiled-game-with-a-nodejs-script/","postHashId":"Z2FtZXN0cnVlbnVsbDIwMjEtMTAtMDJUMDA6MDA6MDAuMDAwWg==","title":"Automatically update the embedded Tileset for all your Tiled maps a Node.js script","date":"2021-10-02T00:00:00.000Z"},{"path":"/en/blog/games/automatically-generate-sprite-sheet-atlas-files-for-your-phaser-js-game-with-a-nodejs-script/","postHashId":"Z2FtZXN0cnVlbnVsbDIwMjEtMDYtMjJUMDA6MDA6MDAuMDAwWg==","title":"Automatically generate sprite sheet atlas files for your Phaser JS game with a Node.js script","date":"2021-06-22T00:00:00.000Z"},{"path":"/en/blog/general/godammit-telegram/","postHashId":"Z2VuZXJhbHRydWVudWxsMjAyMS0wMS0zMVQwMDowMDowMC4wMDBa","title":"Godammit Telegram!","date":"2021-01-31T00:00:00.000Z"},{"path":"/en/blog/coding/tracking-my-working-hours-on-personal-projects-ssing-nodejs/","postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTA2LTE2VDAwOjAwOjAwLjAwMFo=","title":"Tracking my working hours on personal projects using Node.js","date":"2024-06-16T00:00:00.000Z"}]}