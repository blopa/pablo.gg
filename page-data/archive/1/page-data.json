{
    "componentChunkName": "component---src-templates-archive-jsx",
    "path": "/archive/1",
    "result": {"data":{"site":{"siteMetadata":{"siteUrl":"https://pablo.gg"}},"allMarkdownRemark":{"edges":[{"node":{"excerpt":"I often have friends asking me, “Pablo, how do you manage to…","fields":{"slug":"/2024/2024-10-25-sharing-encrypted-laravel-cookies-with-next-js.en/","path":"/blog/coding/sharing-encrypted-laravel-cookies-with-next-js/","locale":"en"},"readingTime":{"minutes":8.525},"frontmatter":{"date":"2024-10-25T00:00:00.000Z","title":"Sharing encrypted Laravel cookies with Next.js","hideExcerpt":false}}},{"node":{"excerpt":"I constantly have that feeling of ”You become the very thing…","fields":{"slug":"/2024/2024-09-21-musclog-leveraging-my-reactjs-experience-to-build-a-react-native-app.en/","path":"/blog/coding/musclog-leveraging-my-reactjs-experience-to-build-a-react-native-app/","locale":"en"},"readingTime":{"minutes":17.685},"frontmatter":{"date":"2024-09-21T00:00:00.000Z","title":"Musclog: Leveraging my React.js experience to build a React Native App","hideExcerpt":false}}},{"node":{"excerpt":"As a developer fully committed (pun intended, and not the…","fields":{"slug":"/2024/2024-06-16-tracking-my-working-hours-on-personal-projects-ssing-nodejs.en/","path":"/blog/coding/tracking-my-working-hours-on-personal-projects-ssing-nodejs/","locale":"en"},"readingTime":{"minutes":5.265},"frontmatter":{"date":"2024-06-16T00:00:00.000Z","title":"Tracking my working hours on personal projects using Node.js","hideExcerpt":false}}},{"node":{"excerpt":"Navigating the intricacies of manga as a Western reader can…","fields":{"slug":"/2024/2024-05-01-transforming-manga-pages-for-western-readers.en/","path":"/blog/coding/transforming-manga-pages-for-western-readers/","locale":"en"},"readingTime":{"minutes":7.605},"frontmatter":{"date":"2024-05-01T00:00:00.000Z","title":"Transforming manga pages for lazy western readers","hideExcerpt":false}}},{"node":{"excerpt":"After creating a Node.js script to automatically post…","fields":{"slug":"/2023/2023-12-20-creating-instagram-reels-coding-tutorials-automatically-with-openais-gpt.en/","path":"/blog/coding/creating-instagram-reels-coding-tutorials-automatically-with-openais-gpt/","locale":"en"},"readingTime":{"minutes":6.64},"frontmatter":{"date":"2023-12-20T00:00:00.000Z","title":"Creating Instagram Reels coding tutorials automatically with OpenAI's GPT","hideExcerpt":false}}},{"node":{"excerpt":"Just last week I posted about how to create upload reels to…","fields":{"slug":"/2023/2023-10-25-how-to-automatically-create-thumbnails-for-your-videos-with-nodejs.en/","path":"/blog/coding/how-to-automatically-create-thumbnails-for-your-videos-with-nodejs/","locale":"en"},"readingTime":{"minutes":4.74},"frontmatter":{"date":"2023-10-25T00:00:00.000Z","title":"How to automatically create thumbnails for your videos with Node.js","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys! It’s hard to be a geek these days, so many events…","fields":{"slug":"/2023/2023-10-14-posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations.en/","path":"/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/","locale":"en"},"readingTime":{"minutes":7.485},"frontmatter":{"date":"2023-10-14T00:00:00.000Z","title":"Posting Instagram Reels using Node.js and the art of overcoming limitations","hideExcerpt":false}}},{"node":{"excerpt":"In a world dominated by social media platforms, where…","fields":{"slug":"/2023/2023-09-04-my-blog-now-has-stories-and-im-not-sure-why.en/","path":"/blog/coding/my-blog-now-has-stories-and-im-not-sure-why/","locale":"en"},"readingTime":{"minutes":9},"frontmatter":{"date":"2023-09-04T00:00:00.000Z","title":"My blog now has Stories, and I'm not sure why","hideExcerpt":false}}},{"node":{"excerpt":"Looking to achieve your fitness goals, such as losing some…","fields":{"slug":"/2023/2023-08-02-using-google-fitness-api-to-calculate-my-tdee-and-more.en/","path":"/blog/coding/using-google-fitness-api-to-calculate-my-tdee-and-more/","locale":"en"},"readingTime":{"minutes":16.2},"frontmatter":{"date":"2023-08-02T00:00:00.000Z","title":"Using Google Fitness API to calculate my TDEE and more","hideExcerpt":false}}},{"node":{"excerpt":"Gatsby is a popular static site generator that is built on…","fields":{"slug":"/2023/2023-01-22-creating-rest-api-endpoints-to-my-gatsby-blog.en/","path":"/blog/coding/creating-rest-api-endpoints-to-my-gatsby-blog/","locale":"en"},"readingTime":{"minutes":2.57},"frontmatter":{"date":"2023-01-22T00:00:00.000Z","title":"Creating Rest API endpoints to my Gatsby blog","hideExcerpt":false}}},{"node":{"excerpt":"Last year, I wrote a blog post about where to find the best…","fields":{"slug":"/2022/2022-12-28-a-guide-to-cliff-diving-in-amsterdam.en/","path":"/blog/general/a-guide-to-cliff-diving-in-amsterdam/","locale":"en"},"readingTime":{"minutes":3.325},"frontmatter":{"date":"2022-12-28T00:00:00.000Z","title":"A guide to \"cliff\" diving in Amsterdam","hideExcerpt":false}}},{"node":{"excerpt":"It’s happening, it’s finally happening - After 3 years of…","fields":{"slug":"/2022/2022-09-27-e3-2023-dates-revealed.en/","path":"/blog/games/e3-2023-dates-revealed/","locale":"en"},"readingTime":{"minutes":1.345},"frontmatter":{"date":"2022-09-27T00:00:00.000Z","title":"E3 2023 dates revealed","hideExcerpt":false}}},{"node":{"excerpt":"The housing market in Amsterdam is crazy, so crazy that…","fields":{"slug":"/2022/2022-09-13-creating-a-startup-with-github-actions-and-google-forms.en/","path":"/blog/coding/creating-a-startup-with-github-actions-and-google-forms/","locale":"en"},"readingTime":{"minutes":7.87},"frontmatter":{"date":"2022-09-13T00:00:00.000Z","title":"Creating a Startup with GitHub Actions and Google Forms","hideExcerpt":false}}},{"node":{"excerpt":"A few months ago, I published a blog post discussing the…","fields":{"slug":"/2022/2022-08-21-how-to-get-the-redux-state-from-a-react-18-production-build-via-the-browsers-console.en/","path":"/blog/coding/how-to-get-the-redux-state-from-a-react-18-production-build-via-the-browsers-console/","locale":"en"},"readingTime":{"minutes":2.995},"frontmatter":{"date":"2022-08-21T00:00:00.000Z","title":"How to get the Redux State in a React 18 production build via the browser's console","hideExcerpt":false}}},{"node":{"excerpt":"I still remember the first time I planned to go to E3 with…","fields":{"slug":"/2022/2022-06-01-10-years-anniversary-of-my-first-e3.en/","path":"/blog/games/10-years-anniversary-of-my-first-e3/","locale":"en"},"readingTime":{"minutes":17.19},"frontmatter":{"date":"2022-06-01T00:00:00.000Z","title":"10 years anniversary of my first E3","hideExcerpt":false}}},{"node":{"excerpt":"I constantly write about code and share code snippets in my…","fields":{"slug":"/2022/2022-05-05-adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way.en/","path":"/blog/coding/adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way/","locale":"en"},"readingTime":{"minutes":2.41},"frontmatter":{"date":"2022-05-05T00:00:00.000Z","title":"Adding a copy button to code snippets on Gatsby: The lazy way","hideExcerpt":false}}},{"node":{"excerpt":"Webpack is the most popular module bundler for JavaScript…","fields":{"slug":"/2022/2022-04-11-how-webpack-handles-dynamic-imports-with-variable-paths.en/","path":"/blog/coding/how-webpack-handles-dynamic-imports-with-variable-paths/","locale":"en"},"readingTime":{"minutes":3.025},"frontmatter":{"date":"2022-04-11T00:00:00.000Z","title":"How Webpack handles dynamic imports with variable paths","hideExcerpt":false}}},{"node":{"excerpt":"If you want to rent or buy a house in the Netherlands, you…","fields":{"slug":"/2022/2022-03-12-using-nodejs-and-github-action-to-find-a-house-on-fundanl.en/","path":"/blog/coding/using-nodejs-and-github-action-to-find-a-house-on-fundanl/","locale":"en"},"readingTime":{"minutes":3.645},"frontmatter":{"date":"2022-03-12T00:00:00.000Z","title":"Using Node.js and GitHub Action to find a house on Funda.nl","hideExcerpt":false}}},{"node":{"excerpt":"EDIT: This only works for React 17 or lower, for React 1…","fields":{"slug":"/2022/2022-02-20-how-to-get-the-redux-state-from-a-production-build-via-the-browsers-console.en/","path":"/blog/coding/how-to-get-the-redux-state-from-a-production-build-via-the-browsers-console/","locale":"en"},"readingTime":{"minutes":1.21},"frontmatter":{"date":"2022-02-20T00:00:00.000Z","title":"How to get the Redux State in production via the browser's console","hideExcerpt":false}}},{"node":{"excerpt":"When I was working on my Game Devlog videos, I wondered if…","fields":{"slug":"/2022/2022-01-04-create-videos-from-code-snippets-with-this-nodejs-script.en/","path":"/blog/coding/create-videos-from-code-snippets-with-this-nodejs-script/","locale":"en"},"readingTime":{"minutes":6.475},"frontmatter":{"date":"2022-01-04T00:00:00.000Z","title":"Create videos from code snippets with this Node.js script","hideExcerpt":false}}},{"node":{"excerpt":"On Phaser 3 you can pre-load your assets in a function…","fields":{"slug":"/2021/2021-11-18-how-to-load-assets-asynchronously-with-phaser-3.en/","path":"/blog/games/how-to-load-assets-asynchronously-with-phaser-3/","locale":"en"},"readingTime":{"minutes":1.435},"frontmatter":{"date":"2021-11-18T00:00:00.000Z","title":"How to load assets asynchronously with Phaser 3","hideExcerpt":false}}},{"node":{"excerpt":"After all these years of anticipation, rumors, and even some…","fields":{"slug":"/2021/2021-11-07-buy-metroid-dread.en/","path":"/blog/games/buy-metroid-dread/","locale":"en"},"readingTime":{"minutes":9.45},"frontmatter":{"date":"2021-11-07T00:00:00.000Z","title":"Buy Metroid Dread","hideExcerpt":false}}},{"node":{"excerpt":"Medium is a great platform to share your blog posts with a…","fields":{"slug":"/2021/2021-10-24-how-to-import-gatsby-posts-into-medium-with-gist-code-snippets.en/","path":"/blog/coding/how-to-import-gatsby-posts-into-medium-with-gist-code-snippets/","locale":"en"},"readingTime":{"minutes":4.65},"frontmatter":{"date":"2021-10-24T00:00:00.000Z","title":"How to import Gatsby posts into Medium with Gist code snippets","hideExcerpt":false}}},{"node":{"excerpt":"Yes, that’s right, there is now a game version of this…","fields":{"slug":"/2021/2021-10-12-i-made-a-top-down-game-version-of-my-blog-with-phaser-and-react.en/","path":"/blog/coding/i-made-a-top-down-game-version-of-my-blog-with-phaser-and-react/","locale":"en"},"readingTime":{"minutes":8.995},"frontmatter":{"date":"2021-10-12T00:00:00.000Z","title":"I made a top-down game version of my blog with Phaser and React","hideExcerpt":null}}},{"node":{"excerpt":"My first experience in “programming” started in 2002, when I…","fields":{"slug":"/2021/2021-10-08-how-to-create-a-top-down-rpg-maker-like-game-with-phaser-js-and-react.en/","path":"/blog/coding/how-to-create-a-top-down-rpg-maker-like-game-with-phaser-js-and-react/","locale":"en"},"readingTime":{"minutes":15.69},"frontmatter":{"date":"2021-10-08T00:00:00.000Z","title":"How to create a top-down RPG Maker like game with Phaser JS and React","hideExcerpt":null}}},{"node":{"excerpt":"Phaser works by rendering pixels inside a  element in the…","fields":{"slug":"/2021/2021-10-06-creating-a-dialog-box-with-react-for-a-phaser-game.en/","path":"/blog/coding/creating-a-dialog-box-with-react-for-a-phaser-game/","locale":"en"},"readingTime":{"minutes":3.945},"frontmatter":{"date":"2021-10-06T00:00:00.000Z","title":"Creating a dialog box with React for a Phaser game","hideExcerpt":null}}},{"node":{"excerpt":"Creating maps with Tiled is great, and you can use them in…","fields":{"slug":"/2021/2021-10-02-automatically-update-the-embedded-tileset-for-all-your-tiled-game-with-a-nodejs-script.en/","path":"/blog/games/automatically-update-the-embedded-tileset-for-all-your-tiled-game-with-a-nodejs-script/","locale":"en"},"readingTime":{"minutes":2.78},"frontmatter":{"date":"2021-10-02T00:00:00.000Z","title":"Automatically update the embedded Tileset for all your Tiled maps a Node.js script","hideExcerpt":null}}},{"node":{"excerpt":"To celebrate the release of the Matrix 4 trailer, I want to…","fields":{"slug":"/2021/2021-09-16-creating-a-matrix-source-code-effect-background-for-my-website-with-react.en/","path":"/blog/coding/creating-a-matrix-source-code-effect-background-for-my-website-with-react/","locale":"en"},"readingTime":{"minutes":2.07},"frontmatter":{"date":"2021-09-16T00:00:00.000Z","title":"Creating a Matrix Source-Code effect background for my website with React","hideExcerpt":false}}},{"node":{"excerpt":"Hey everyone, here we are again with another game devlog for…","fields":{"slug":"/2021/2021-09-09-creating-a-mobile-build-of-my-phaser-js-game-game-devlog-23.en/","path":"/blog/games/creating-a-mobile-build-of-my-phaser-js-game-game-devlog-23/","locale":"en"},"readingTime":{"minutes":5.05},"frontmatter":{"date":"2021-09-09T00:00:00.000Z","title":"Creating a mobile build of my Phaser JS game - Game Devlog #23","hideExcerpt":false}}},{"node":{"excerpt":"Last month I traveled to the region of Algarve in Portugal…","fields":{"slug":"/2021/2021-09-02-a-guide-to-cliff-diving-in-benagil.en/","path":"/blog/general/a-guide-to-cliff-diving-in-benagil/","locale":"en"},"readingTime":{"minutes":4.115},"frontmatter":{"date":"2021-09-02T00:00:00.000Z","title":"A guide to cliff diving in Benagil","hideExcerpt":false}}},{"node":{"excerpt":"Hello everyone, welcome to another game devlog for my game…","fields":{"slug":"/2021/2021-08-28-creating-moving-platforms-for-my-phaser-js-game-game-devlog-22.en/","path":"/blog/games/creating-moving-platforms-for-my-phaser-js-game-game-devlog-22/","locale":"en"},"readingTime":{"minutes":10.3},"frontmatter":{"date":"2021-08-28T00:00:00.000Z","title":"Creating moving platforms for my Phaser JS game - Game Devlog #22","hideExcerpt":false}}},{"node":{"excerpt":"This year marks the 35th anniversary of The Legend of Zelda…","fields":{"slug":"/2021/2021-07-14-creating-my-dream-skyward-sword-hd-switch-accessories.en/","path":"/blog/games/creating-my-dream-skyward-sword-hd-switch-accessories/","locale":"en"},"readingTime":{"minutes":2.95},"frontmatter":{"date":"2021-07-14T00:00:00.000Z","title":"Creating my dream Skyward Sword HD Switch accessories","hideExcerpt":null}}},{"node":{"excerpt":"For those of you that don’t know, Metroidvania is probably…","fields":{"slug":"/2021/2021-07-06-hiding-parts-of-the-map-on-phaser-js-game-devlog-21.en/","path":"/blog/games/hiding-parts-of-the-map-on-phaser-js-game-devlog-21/","locale":"en"},"readingTime":{"minutes":2.985},"frontmatter":{"date":"2021-07-06T00:00:00.000Z","title":"Hiding parts of the map on Phaser JS - Game Devlog #21","hideExcerpt":null}}},{"node":{"excerpt":"Hey everyone! Today I’m finally back with another game…","fields":{"slug":"/2021/2021-06-28-creating-falling-spikes-with-phaser-js-game-devlog-20.en/","path":"/blog/games/creating-falling-spikes-with-phaser-js-game-devlog-20/","locale":"en"},"readingTime":{"minutes":3.895},"frontmatter":{"date":"2021-06-28T00:00:00.000Z","title":"Creating falling spikes with Phaser JS - Game Devlog #20","hideExcerpt":null}}},{"node":{"excerpt":"In one of my first game devlogs, I explained how to automate…","fields":{"slug":"/2021/2021-06-22-automatically-generate-sprite-sheet-atlas-files-for-your-phaser-js-game-with-a-nodejs-script.en/","path":"/blog/games/automatically-generate-sprite-sheet-atlas-files-for-your-phaser-js-game-with-a-nodejs-script/","locale":"en"},"readingTime":{"minutes":2.495},"frontmatter":{"date":"2021-06-22T00:00:00.000Z","title":"Automatically generate sprite sheet atlas files for your Phaser JS game with a Node.js script","hideExcerpt":null}}},{"node":{"excerpt":"Hey everyone, today’s devlog will be very similar to the…","fields":{"slug":"/2021/2021-06-19-hanging-on-a-monkey-bar-on-phaser-js-game-devlog-19.en/","path":"/blog/games/hanging-on-a-monkey-bar-on-phaser-js-game-devlog-19/","locale":"en"},"readingTime":{"minutes":1.71},"frontmatter":{"date":"2021-06-19T00:00:00.000Z","title":"Hanging on a monkey bar Phaser JS - Game Devlog #19","hideExcerpt":null}}},{"node":{"excerpt":"6785 days, that’s how long ago Metroid 4 (aka Metroid Fusion…","fields":{"slug":"/2021/2021-06-16-metroid-5-is-finally-announced-19-years-later.en/","path":"/blog/games/metroid-5-is-finally-announced-19-years-later/","locale":"en"},"readingTime":{"minutes":1.715},"frontmatter":{"date":"2021-06-16T00:00:00.000Z","title":"Metroid 5 is finally announced, 19 years later","hideExcerpt":null}}},{"node":{"excerpt":"Hey everyone, I’m back with another devlog for Super Ollie…","fields":{"slug":"/2021/2021-06-05-creating-ladders-for-platformer-with-phaser-js-game-devlog-18.en/","path":"/blog/games/creating-ladders-for-platformer-with-phaser-js-game-devlog-18/","locale":"en"},"readingTime":{"minutes":1.9},"frontmatter":{"date":"2021-06-05T00:00:00.000Z","title":"Creating ladders for platformer with Phaser JS - Game Devlog #18","hideExcerpt":false}}},{"node":{"excerpt":"When making a JAMStack website, some compromises need to be…","fields":{"slug":"/2021/2021-05-29-how-to-create-an-offline-search-page-with-gatsby.en/","path":"/blog/coding/how-to-create-an-offline-search-page-with-gatsby/","locale":"en"},"readingTime":{"minutes":3.285},"frontmatter":{"date":"2021-05-29T00:00:00.000Z","title":"How to create an offline search page with Gatsby","hideExcerpt":false}}},{"node":{"excerpt":"Around 2 months ago, Gatsby v3 was released, and I was…","fields":{"slug":"/2021/2021-05-21-building-a-dynamic-form-from-a-json-schema.en/","path":"/blog/coding/building-a-dynamic-form-from-a-json-schema/","locale":"en"},"readingTime":{"minutes":4.84},"frontmatter":{"date":"2021-05-21T00:00:00.000Z","title":"Building a dynamic form from a JSON schema","hideExcerpt":false}}},{"node":{"excerpt":"Today I decided to deploy my blog to my GitHub Pages address…","fields":{"slug":"/2021/2021-05-15-using-github-actions-to-deploy-my-blog-into-different-domains.en/","path":"/blog/coding/using-github-actions-to-deploy-my-blog-into-different-domains/","locale":"en"},"readingTime":{"minutes":1.395},"frontmatter":{"date":"2021-05-15T00:00:00.000Z","title":"Using GitHub Actions to deploy my blog into different domains","hideExcerpt":false}}},{"node":{"excerpt":"Today I needed to know the accumulated inflation of the last…","fields":{"slug":"/2021/2021-05-13-how-to-calculate-brazils-annual-inflation-using-javascript.en/","path":"/blog/coding/how-to-calculate-brazils-annual-inflation-using-javascript/","locale":"en"},"readingTime":{"minutes":1.875},"frontmatter":{"date":"2021-05-13T00:00:00.000Z","title":"How to calculate the annual inflation in Brazil using JavaScript","hideExcerpt":false}}},{"node":{"excerpt":"This week I was working on my project Resume Builder and I…","fields":{"slug":"/2021/2021-05-09-how-to-create-a-json-download-link-using-html-only.en/","path":"/blog/coding/how-to-create-a-json-download-link-using-html-only/","locale":"en"},"readingTime":{"minutes":1.675},"frontmatter":{"date":"2021-05-09T00:00:00.000Z","title":"How to create a JSON download link using HTML only","hideExcerpt":false}}},{"node":{"excerpt":"Get in contact with your local nutritionist. GG EZ.","fields":{"slug":"/2021/2021-05-02-i-lost-14kg-this-year-here-is-how-you-can-too.en/","path":"/blog/general/i-lost-14kg-this-year-here-is-how-you-can-too/","locale":"en"},"readingTime":{"minutes":0.045},"frontmatter":{"date":"2021-05-02T00:00:00.000Z","title":"I lost 14kg this year, here is how you can too","hideExcerpt":true}}},{"node":{"excerpt":"Well, this is awkward… It’s been four months since my last…","fields":{"slug":"/2021/2021-04-24-creating-a-pogo-attack-with-phaser-js-game-devlog-17.en/","path":"/blog/games/creating-a-pogo-attack-with-phaser-js-game-devlog-17/","locale":"en"},"readingTime":{"minutes":0.925},"frontmatter":{"date":"2021-04-24T00:00:00.000Z","title":"Creating a pogo-attack with Phaser JS - Game Devlog #17","hideExcerpt":false}}},{"node":{"excerpt":"When I was in college, web development wasn’t a major part…","fields":{"slug":"/2021/2021-04-17-i-pay-0-in-hosting-for-this-website.en/","path":"/blog/coding/i-pay-0-in-hosting-for-this-website/","locale":"en"},"readingTime":{"minutes":10.57},"frontmatter":{"date":"2021-04-17T00:00:00.000Z","title":"I pay $0.00 in hosting for this website","hideExcerpt":false}}},{"node":{"excerpt":"Happy #quarantineversary! Oh yeah, it’s been one year, one…","fields":{"slug":"/2021/2021-03-12-one-year-of-working-from-home.en/","path":"/blog/general/one-year-of-working-from-home/","locale":"en"},"readingTime":{"minutes":0.755},"frontmatter":{"date":"2021-03-12T00:00:00.000Z","title":"One year of working from home","hideExcerpt":false}}},{"node":{"excerpt":"Well isn’t that something? Less than 7 days after failing to…","fields":{"slug":"/2021/2021-01-31-godammit-telegram.en/","path":"/blog/general/godammit-telegram/","locale":"en"},"readingTime":{"minutes":2.305},"frontmatter":{"date":"2021-01-31T00:00:00.000Z","title":"Godammit Telegram!","hideExcerpt":false}}},{"node":{"excerpt":"Whatsapp was in all news outlets recently due to its new…","fields":{"slug":"/2021/2021-01-24-godammit-whatsapp.en/","path":"/blog/general/godammit-whatsapp/","locale":"en"},"readingTime":{"minutes":4.325},"frontmatter":{"date":"2021-01-24T00:00:00.000Z","title":"Godammit Whatsapp!","hideExcerpt":false}}},{"node":{"excerpt":"Wassup everyone, I’m once again late with my “weekly” devlog…","fields":{"slug":"/2020/2020-29-12-adding-transition-when-entering-a-stage-on-phaser-js-skate-platformer-game-devlog-16.en/","path":"/blog/games/adding-transition-when-entering-a-stage-on-phaser-js-skate-platformer-game-devlog-16/","locale":"en"},"readingTime":{"minutes":0.975},"frontmatter":{"date":"2020-12-29T00:00:00.000Z","title":"Adding transition when entering a stage on Phaser JS - Game Devlog #16","hideExcerpt":false}}},{"node":{"excerpt":"Alright, get comfortable because today’s devlog is long, but…","fields":{"slug":"/2020/2020-15-12-creating-a-smarter-and-more-performing-ai-on-phaser-js-skate-platformer-game-devlog-15.en/","path":"/blog/games/creating-a-smarter-and-more-performing-ai-on-phaser-js-skate-platformer-game-devlog-15/","locale":"en"},"readingTime":{"minutes":4.495},"frontmatter":{"date":"2020-12-15T00:00:00.000Z","title":"Creating a smarter and more performing AI on Phaser JS - Game Devlog #15","hideExcerpt":false}}},{"node":{"excerpt":"Hey, y’all. This week I bring another tiny devlog due to…","fields":{"slug":"/2020/2020-09-12-creating-custom-weather-on-phaser-js-skate-platformer-game-devlog-14.en/","path":"/blog/games/creating-custom-weather-on-phaser-js-skate-platformer-game-devlog-14/","locale":"en"},"readingTime":{"minutes":1.025},"frontmatter":{"date":"2020-12-09T00:00:00.000Z","title":"Creating custom weather on Phaser JS - Skate Platformer Game Devlog #14","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys, in today’s game devlog I’ll add a loading screen…","fields":{"slug":"/2020/2020-29-11-creating-a-loading-screen-and-adding-translation-on-phaser-js-skate-platformer-game-devlog-13.en/","path":"/blog/games/creating-a-loading-screen-and-adding-translation-on-phaser-js-skate-platformer-game-devlog-13/","locale":"en"},"readingTime":{"minutes":1.395},"frontmatter":{"date":"2020-11-29T00:00:00.000Z","title":"Creating a loading screen and adding translation on Phaser JS - Skate Platformer Game Devlog #13","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys! In today’s video, I will show you how I created a…","fields":{"slug":"/2020/2020-19-11-saving-player-progress-with-checkpoints-with-phaser-js-skate-platformer-game-devlog-12.en/","path":"/blog/games/saving-player-progress-with-checkpoints-with-phaser-js-skate-platformer-game-devlog-12/","locale":"en"},"readingTime":{"minutes":1.04},"frontmatter":{"date":"2020-11-19T00:00:00.000Z","title":"Saving player progress with checkpoints with Phaser JS - Skate Platformer Game Devlog #12","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys, in today’s devlog I’m going to make something…","fields":{"slug":"/2020/2020-11-11-loading-user-created-tiled-stages-on-phaser-js-skate-platformer-game-devlog-11.en/","path":"/blog/games/loading-user-created-tiled-stages-on-phaser-js-skate-platformer-game-devlog-11/","locale":"en"},"readingTime":{"minutes":2.76},"frontmatter":{"date":"2020-11-11T00:00:00.000Z","title":"Loading user-created Tiled stages on Phaser JS - Skate Platformer Game Devlog #11","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys, in today’s game devlog I’ll show you how I did to…","fields":{"slug":"/2020/2020-05-11-creating-hero-hud-on-phaser-js-skate-platformer-game-devlog-10.en/","path":"/blog/games/creating-hero-hud-on-phaser-js-skate-platformer-game-devlog-10/","locale":"en"},"readingTime":{"minutes":2.8},"frontmatter":{"date":"2020-11-05T00:00:00.000Z","title":"Creating hero HUD on Phaser JS - Skate Platformer Game Devlog #10","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys! For today’s game devlog I’m going to show more…","fields":{"slug":"/2020/2020-30-10-creating-enemies-artificial-intelligence-on-phaser-js-skate-platformer-game-devlog-9.en/","path":"/blog/games/creating-enemies-artificial-intelligence-on-phaser-js-skate-platformer-game-devlog-9/","locale":"en"},"readingTime":{"minutes":1.975},"frontmatter":{"date":"2020-10-30T00:00:00.000Z","title":"Creating enemies artificial intelligence on Phaser JS - Skate Platformer Game Devlog #09","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys, I’m back with another game devlog, it took me a…","fields":{"slug":"/2020/2020-22-10-creating-enemies-and-collectable-items-on-phaser-js-skate-platformer-game-devlog-8.en/","path":"/blog/games/creating-enemies-and-collectable-items-on-phaser-js-skate-platformer-game-devlog-8/","locale":"en"},"readingTime":{"minutes":2.78},"frontmatter":{"date":"2020-10-22T00:00:00.000Z","title":"Creating enemies and collectable items on Phaser JS - Skate Platformer Game Devlog #08","hideExcerpt":false}}},{"node":{"excerpt":"Loading external tileset files Tiled is a powerful open…","fields":{"slug":"/2020/2020-08-10-loading-external-tileset-file-on-phaser-js-using-webpack-skate-platformer-game-devlog-7.en/","path":"/blog/games/loading-external-tileset-file-on-phaser-js-using-webpack-skate-platformer-game-devlog-7/","locale":"en"},"readingTime":{"minutes":3.905},"frontmatter":{"date":"2020-10-08T00:00:00.000Z","title":"Loading external tileset file on Phaser JS using Webpack - Skate Platformer Game Devlog #07","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys! Today’s Game Devlog is a bit long, 15 minutes, but…","fields":{"slug":"/2020/2020-01-10-falling-off-platforms-with-arcade-physics-on-phaser-js-skate-platformer-game-devlog-6.en/","path":"/blog/games/falling-off-platforms-with-arcade-physics-on-phaser-js-skate-platformer-game-devlog-6/","locale":"en"},"readingTime":{"minutes":3.125},"frontmatter":{"date":"2020-10-01T00:00:00.000Z","title":"Falling off platforms with Arcade Physics on Phaser JS - Skate Platformer Game Devlog #06","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys, in this week’s Game Devlog I’ll show you how I…","fields":{"slug":"/2020/2020-26-09-using-a-button-to-run-with-phaser-js-skate-platformer-game-devlog-5.en/","path":"/blog/games/using-a-button-to-run-with-phaser-js-skate-platformer-game-devlog-5/","locale":"en"},"readingTime":{"minutes":0.73},"frontmatter":{"date":"2020-09-26T00:00:00.000Z","title":"Using a button to run with Phaser JS - Skate Platformer Game Devlog #05","hideExcerpt":false}}},{"node":{"excerpt":"As a software developer, it’s common to move around the…","fields":{"slug":"/2020/2020-23-09-how-an-open-source-project-landed-me-a-job-abroad.en/","path":"/blog/coding/how-an-open-source-project-landed-me-a-job-abroad/","locale":"en"},"readingTime":{"minutes":4.21},"frontmatter":{"date":"2020-09-23T00:00:00.000Z","title":"How an open source project landed me a job abroad","hideExcerpt":false}}},{"node":{"excerpt":"Hey, I’m back with another Game Devlog. In today’s devlog we…","fields":{"slug":"/2020/2020-21-09-skate-platformer-game-devlog-4.en/","path":"/blog/games/skate-platformer-game-devlog-4/","locale":"en"},"readingTime":{"minutes":0.96},"frontmatter":{"date":"2020-09-21T00:00:00.000Z","title":"Holding button to jump higher with Phaser JS - Skate Platformer Game Devlog #04","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys, another game devlog of skate platformer, this time…","fields":{"slug":"/2020/2020-17-09-third-game-devlog-of-skate-platformer.en/","path":"/blog/games/third-game-devlog-of-skate-platformer/","locale":"en"},"readingTime":{"minutes":1.405},"frontmatter":{"date":"2020-09-17T00:00:00.000Z","title":"Creating precise custom colliders for Arcade Physics on Phaser JS - Skate Platformer Game Devlog #03","hideExcerpt":false}}},{"node":{"excerpt":"So that’s me, standing in front of the grand opening of the…","fields":{"slug":"/2020/2020-14-09-me-san-francisco-and-metallica.en/","path":"/blog/events/me-san-francisco-and-metallica/","locale":"en"},"readingTime":{"minutes":6.245},"frontmatter":{"date":"2020-09-14T00:00:00.000Z","title":"Me, San Francisco and Metallica","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys, second post in less than a week, unbelievable.  In…","fields":{"slug":"/2020/2020-09-09-second-game-devlog-of-skate-platformer.en/","path":"/blog/games/second-game-devlog-of-skate-platformer/","locale":"en"},"readingTime":{"minutes":1.59},"frontmatter":{"date":"2020-09-09T00:00:00.000Z","title":"Improving sprite sheets generation for Phaser JS game with Webpack 4 - Skate Platformer Game Devlog #02","hideExcerpt":false}}},{"node":{"excerpt":"Hey guys, quite some time since I don’t post anything, right…","fields":{"slug":"/2020/2020-02-09-first-game-devlog-of-my-game.en/","path":"/blog/games/first-game-devlog-of-my-game/","locale":"en"},"readingTime":{"minutes":0.695},"frontmatter":{"date":"2020-09-02T00:00:00.000Z","title":"Trying out Phaser JS Arcade Physics - Skate Platformer Game Devlog #01","hideExcerpt":false}}},{"node":{"excerpt":"Word! Att.","fields":{"slug":"/2016/2016-02-16-an-open-letter-to-mark-manson.en/","path":"/blog/general/an-open-letter-to-mark-manson/","locale":"en"},"readingTime":{"minutes":0.01},"frontmatter":{"date":"2016-02-16T00:00:00.000Z","title":"An open letter to Mark Manson","hideExcerpt":false}}},{"node":{"excerpt":"Well, recently I found out that Google had created the…","fields":{"slug":"/2015/2015-05-31-google-flights-op.en/","path":"/blog/tips/google-flights-op/","locale":"en"},"readingTime":{"minutes":0.715},"frontmatter":{"date":"2015-05-31T00:00:00.000Z","title":"Google Flights OP","hideExcerpt":false}}},{"node":{"excerpt":"Another year I had the privilege to participate in the E…","fields":{"slug":"/2014/2014-08-08-trip-to-la-e3-2014.en/","path":"/blog/events/trip-to-la-e3-2014/","locale":"en"},"readingTime":{"minutes":0.14},"frontmatter":{"date":"2014-08-08T00:00:00.000Z","title":"Trip to LA - E3 2014","hideExcerpt":false}}},{"node":{"excerpt":"Lately I fell in love with Lego again, which was my favorite…","fields":{"slug":"/2013/2013-02-09-lego-love.en/","path":"/blog/toys/lego-love/","locale":"en"},"readingTime":{"minutes":0.435},"frontmatter":{"date":"2013-02-09T00:00:00.000Z","title":"Lego love","hideExcerpt":false}}},{"node":{"excerpt":"Fala galera! Beleza? Muitos leitores aqui no meu blog…","fields":{"slug":"/2013/2013-02-09-new-handheld-revo-k101-gba-clone.en/","path":"/blog/games/new-handheld-revo-k101-gba-clone/","locale":"en"},"readingTime":{"minutes":1.825},"frontmatter":{"date":"2013-02-09T00:00:00.000Z","title":"New handheld: Revo K101 (GBA clone)","hideExcerpt":false}}},{"node":{"excerpt":"Woohoooo!!! Completing 6 months of E3, and practically…","fields":{"slug":"/2012/2012-12-20-trip-to-e3-2012.en/","path":"/blog/events/trip-to-e3-2012/","locale":"en"},"readingTime":{"minutes":0.36},"frontmatter":{"date":"2012-12-20T00:00:00.000Z","title":"Trip to E3 2012","hideExcerpt":false}}},{"node":{"excerpt":"BACK FROM THE DEAD? Hardly. It just arrived at a time when I…","fields":{"slug":"/2012/2012-05-31-e3-2012-and-here-we-go.en/","path":"/blog/events/e3-2012-and-here-we-go/","locale":"en"},"readingTime":{"minutes":2.025},"frontmatter":{"date":"2012-05-31T00:00:00.000Z","title":"E3 2012 - And here we... Go","hideExcerpt":false}}},{"node":{"excerpt":"Well, it is been a few months since I decided to dedicate a…","fields":{"slug":"/2010/2010-07-03-zelda-timeline-and-skyward-sword-placement.en/","path":"/blog/games/zelda-timeline-and-skyward-sword-placement/","locale":"en"},"readingTime":{"minutes":13.77},"frontmatter":{"date":"2010-07-03T00:00:00.000Z","title":"Zelda timeline and Skyward Sword placement","hideExcerpt":false}}},{"node":{"excerpt":"I realized that there aren’t many videos about it, so I made…","fields":{"slug":"/2010/2010-04-07-unboxing-white-chocolate-easter-egg.en/","path":"/blog/tips/unboxing-white-chocolate-easter-egg/","locale":"en"},"readingTime":{"minutes":0.125},"frontmatter":{"date":"2010-04-07T00:00:00.000Z","title":"Unboxing white chocolate easter egg","hideExcerpt":false}}},{"node":{"excerpt":"Waking up early and being left with nothing to do is awesome…","fields":{"slug":"/2010/2010-03-23-having-fun-with-sony-vegas.en/","path":"/blog/funny/having-fun-with-sony-vegas/","locale":"en"},"readingTime":{"minutes":0.2},"frontmatter":{"date":"2010-03-23T00:00:00.000Z","title":"Having fun with Sony Vegas","hideExcerpt":false}}},{"node":{"excerpt":"As you may already know, a special Jirachi distribution…","fields":{"slug":"/2010/2010-03-22-jirachi-from-latamel-event.en/","path":"/blog/events/jirachi-from-latamel-event/","locale":"en"},"readingTime":{"minutes":1.36},"frontmatter":{"date":"2010-03-22T00:00:00.000Z","title":"Jirachi from Latamel event","hideExcerpt":false}}},{"node":{"excerpt":"MY POKEMON CARTRIDGE IS HERE! YAAAAAY!!! The Pokéwalker is…","fields":{"slug":"/2010/2010-03-21-pokemon-soul-silver-unboxing.en/","path":"/blog/games/pokemon-soul-silver-unboxing/","locale":"en"},"readingTime":{"minutes":0.195},"frontmatter":{"date":"2010-03-21T00:00:00.000Z","title":"Pokémon Soul Silver Unboxing","hideExcerpt":false}}},{"node":{"excerpt":"After a long wait, my Wii guitar arrived. I paid a measly R…","fields":{"slug":"/2010/2010-03-05-unboxing-the-wireless-guitar-for-wii.en/","path":"/blog/tips/unboxing-the-wireless-guitar-for-wii/","locale":"en"},"readingTime":{"minutes":0.14},"frontmatter":{"date":"2010-03-05T00:00:00.000Z","title":"Unboxing the Wireless Guitar for Wii","hideExcerpt":false}}},{"node":{"excerpt":"Can’t handle the will to be able to control Link in his new…","fields":{"slug":"/2010/2010-02-18-camy-hero-pack-for-those-who-cannot-wait-for-the-new-zelda.en/","path":"/blog/games/camy-hero-pack-for-those-who-cannot-wait-for-the-new-zelda/","locale":"en"},"readingTime":{"minutes":1.65},"frontmatter":{"date":"2010-02-18T00:00:00.000Z","title":"Camy Hero Pack - For those who cannot wait for the next Zelda","hideExcerpt":false}}},{"node":{"excerpt":"Go to http://www.planalto.gov.br/ccivil_03/leis/l9609.htm","fields":{"slug":"/2010/2010-01-24-softwares-law-in-brazil.en/","path":"/blog/tips/softwares-law-in-brazil/","locale":"en"},"readingTime":{"minutes":0.015},"frontmatter":{"date":"2010-01-24T00:00:00.000Z","title":"Softwares law in Brazil","hideExcerpt":false}}},{"node":{"excerpt":"2009 was a kick ass year! Several new games, cellphones and…","fields":{"slug":"/2009/2009-12-31-2010-is-coming.en/","path":"/blog/general/2010-is-coming/","locale":"en"},"readingTime":{"minutes":1.245},"frontmatter":{"date":"2009-12-31T00:00:00.000Z","title":"2010 is coming","hideExcerpt":false}}},{"node":{"excerpt":"Seriously, if you like pasta and want to spend part of your…","fields":{"slug":"/2009/2009-12-24-donatello-pasta-an-awesome-new-restaurant-in-buzios.en/","path":"/blog/tips/donatello-pasta-an-awesome-new-restaurant-in-buzios/","locale":"en"},"readingTime":{"minutes":0.475},"frontmatter":{"date":"2009-12-24T00:00:00.000Z","title":"Donatello Pasta - An awesome new restaurant in Búzios","hideExcerpt":false}}},{"node":{"excerpt":"Did you see this post’s title? Yes, I’m going to talk about…","fields":{"slug":"/2009/2009-09-15-zelda-timeline.en/","path":"/blog/games/zelda-timeline/","locale":"en"},"readingTime":{"minutes":6.165},"frontmatter":{"date":"2009-09-15T00:00:00.000Z","title":"Zelda timeline?","hideExcerpt":false}}},{"node":{"excerpt":"Sometimes I realize that I’m not just a useless information…","fields":{"slug":"/2009/2009-07-08-special-effects.en/","path":"/blog/general/special-effects/","locale":"en"},"readingTime":{"minutes":0.65},"frontmatter":{"date":"2009-07-08T00:00:00.000Z","title":"Special effects","hideExcerpt":false}}},{"node":{"excerpt":"Yesterday my beautiful Samsung SC-MX20B arrived, which a…","fields":{"slug":"/2009/2009-06-23-hands-on-samsung-scmx20b.en/","path":"/blog/gadgets/hands-on-samsung-scmx20b/","locale":"en"},"readingTime":{"minutes":0.785},"frontmatter":{"date":"2009-06-23T00:00:00.000Z","title":"Hands on Samsung SC-MX20B!","hideExcerpt":false}}},{"node":{"excerpt":"Since My Name is Earl was canceled in the EUA, lots of fans…","fields":{"slug":"/2009/2009-06-21-save-earl.en/","path":"/blog/general/save-earl/","locale":"en"},"readingTime":{"minutes":0.47},"frontmatter":{"date":"2009-06-21T00:00:00.000Z","title":"Save Earl","hideExcerpt":false}}},{"node":{"excerpt":"When I bought Zeemote I got surprised at first sight: The…","fields":{"slug":"/2009/2009-06-10-review-zeemote-js1.en/","path":"/blog/gadgets/review-zeemote-js1/","locale":"en"},"readingTime":{"minutes":3.795},"frontmatter":{"date":"2009-06-10T00:00:00.000Z","title":"Review: Zeemote JS1","hideExcerpt":false}}},{"node":{"excerpt":"These days I was at the market, choosing what to eat with…","fields":{"slug":"/2009/2009-06-01-review-hot-pocket-burger.en/","path":"/blog/tips/review-hot-pocket-burger/","locale":"en"},"readingTime":{"minutes":1.685},"frontmatter":{"date":"2009-06-01T00:00:00.000Z","title":"Review: Hot Pocket Burger","hideExcerpt":false}}},{"node":{"excerpt":"After several hours searching, I finally found a practical…","fields":{"slug":"/2009/2009-05-13-blog-in-english.en/","path":"/blog/general/blog-in-english/","locale":"en"},"readingTime":{"minutes":0.165},"frontmatter":{"date":"2009-05-13T00:00:00.000Z","title":"Blog in english","hideExcerpt":false}}},{"node":{"excerpt":"Today I found a really old video of some fingerboard tricks…","fields":{"slug":"/2009/2009-05-12-fingerboard-old-times.en/","path":"/blog/general/fingerboard-old-times/","locale":"en"},"readingTime":{"minutes":0.355},"frontmatter":{"date":"2009-05-12T00:00:00.000Z","title":"Fingerboard old times","hideExcerpt":false}}},{"node":{"excerpt":"Did you know that in every product you buy, you’re paying…","fields":{"slug":"/2009/2009-04-18-brazilian-taxes.en/","path":"/blog/general/brazilian-taxes/","locale":"en"},"readingTime":{"minutes":2.205},"frontmatter":{"date":"2009-04-18T00:00:00.000Z","title":"Brazilian taxes","hideExcerpt":false}}},{"node":{"excerpt":"After practically 4 years of wanting to watch this clip…","fields":{"slug":"/2008/2008-11-11-nada-by-los-pirata.en/","path":"/blog/funny/nada-by-los-pirata/","locale":"en"},"readingTime":{"minutes":0.325},"frontmatter":{"date":"2008-11-11T00:00:00.000Z","title":"Nada by Los Pirata","hideExcerpt":false}}},{"node":{"excerpt":"","fields":{"slug":"/2008/2008-10-02-idol-steve-oedekerk.en/","path":"/blog/funny/idol-steve-oedekerk/","locale":"en"},"readingTime":{"minutes":0.01},"frontmatter":{"date":"2008-10-02T00:00:00.000Z","title":"Idol: Steve Oedekerk","hideExcerpt":false}}},{"node":{"excerpt":"Well, I don’t really know how to have this blog thing, it…","fields":{"slug":"/2008/2008-09-28-first-post.en/","path":"/blog/general/first-post/","locale":"en"},"readingTime":{"minutes":0.34},"frontmatter":{"date":"2008-09-28T00:00:00.000Z","title":"First Post","hideExcerpt":false}}}]}},"pageContext":{"robots":"noindex, nofollow","currentPageNumber":1,"totalPageNumber":5,"pageType":"archive","posts":[{"node":{"excerpt":"Muitas vezes, amigos me perguntam: “Pablo, como você…","html":"<p>Muitas vezes, amigos me perguntam: “Pablo, como você consegue manter a calma e serenidade diante de desafios técnicos complexos?” Bem, a verdade é que eu não consigo. Eu apenas escrevo posts no blog sobre eles para parecer que eu consigo. Esta é uma dessas histórias.</p>\n<p>Recentemente, me vi precisando desvendar os valores dos cookies vindos de uma aplicação Laravel, lê-los, atualizá-los e, em seguida, remontá-los de uma forma que a aplicação Laravel nem percebesse. Parece o enredo de um filme do Missão Impossível, certo? Vamos seguir com essa ideia, e eu sou o Tom Cruise.</p>\n<h2 id=\"a-infame-migracao-para-o-nextjs\" style=\"position:relative;\"><a href=\"#a-infame-migracao-para-o-nextjs\" aria-label=\"a infame migracao para o nextjs permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A infame migração para o Next.js</h2>\n<p>Depois de migrar do <a href=\"https://medium.com/studocu-techblog/migrating-from-coffeescript-to-javascript-es6-ed73bcae851e\" target=\"_blank\" rel=\"noreferrer\">CoffeeScript para o ES6</a> e depois do <a href=\"https://medium.com/studocu-techblog/how-we-migrated-our-codebase-to-typescript-c7962f1b877a\" target=\"_blank\" rel=\"noreferrer\">ES6 para o TypeScript</a>, era hora de mais uma grande refatoração: <a href=\"https://medium.com/studocu-techblog/migrating-from-a-monolith-to-next-js-at-studocu-part-1-4b0baf3d5fe9\" target=\"_blank\" rel=\"noreferrer\">separar nosso frontend do Laravel em um app Next.js independente</a>.</p>\n<p>Para melhorar o desempenho, a experiência do desenvolvedor e a atratividade do empregador (merchan descarado, estamos contratando no <a href=\"https://jobs.studocu.com/job-postings\" target=\"_blank\" rel=\"noreferrer\">Studocu</a> <em>wink-wink</em>), precisávamos de um framework frontend robusto que pudesse lidar com nossa crescente base de usuários e conjunto de funcionalidades. O Next.js parecia a escolha perfeita.</p>\n<p>Teoricamente, isso nos ajudaria a parar de reinventar a roda - como escrever infinitas linhas de configurações do Webpack - e focar no que realmente importa: construir funcionalidades que nossos usuários amam. Então, o plano é que, em vez de ter um código espaguete gigante, teríamos dois menores, como fios de macarrão.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.109375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC2klEQVQozy2SV08aAQCA79c0afpgk/ah66EacVAirjiq1lkVsYjQoETREjc2NVpNIY5KVVC0FRcOhhbkuDvAosZto3DcnbdYmva1MfX1S76XLx9whTqvUCeDu3D/dpjaIVGQRu3XFMTgEE3A2KWDDDopDGTwW8ISUIRy4ygYoT0sAQME6oyS8E94+dPU8Pz8qGG0cUJdv2zWaZd0c9ODF6c2hkSo4J3M4K5pvbpLITEMd5MoCNAYCO+ZB9QftbLi5obyPmmaouGtuDa/9f0bgzLPNtMZON1kCJhEwSjjdVj1woK80sL87NTElYUxIER7rTZDn7RALs7rFfKVTWXy2uTytEdPHj1oLubMNeT4NrQhZofFob8Rn3ltqio1sbIgu6zo9apxDMAxeFopqM1IkL98mJX4gsuJS3t+jxP/rDL9cY0of6gx+wAyxEI7GyvjR3urYdKt1fS0SqqHv/QE/U4gcLo1UZMqi48T81Mk5QmSzPuykpTu+rx2abGoKk2hFCwZ1Rbz0snx0bbDen64HqG9/hMbexsPBigC+tEvlBTymkXZnWKO8RsviHDPkazepsyeUp5UUWtaH/fCpvXVRYfdFDjfjNHuGOOOUB4ag4DAhUOl7u0SZnW/y60TF0OWjEsPd0XPaf+QI6/OHRAleZ1T12EfvG24PLNeM96FeW1Xa9Oy7jNDQACFIZrZ8WZ5iUxc2iJKt37n67WvNB1PVZLk/oqkMVVV4NTKEEiEct+Ed+wWQ5u8wDbPVdbx15YmAZZA9vctM0bNYEuFUpDRUcmTNlUo2ouE8jrdUNvZ1iQbBCkcIlHwJuRdWdR1yDLXZ7j1ggzj7AhAoCAZdOG4+9hn8pj1v5ZH3Kavc1ajFVzALu0s6SFxiMJc//ci/M4hVUtdeVGfqsX/2w5QOETjME0gYXY3Gj2Ixg5jsYM/4d3rkI8lvTSOUNidTGOu8BVCE9DJ3hqFucIk8g/70eAbl2hLKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Código espaguete\"\n        title=\"Código espaguete\"\n        src=\"/static/63a275658d485cabf21527594c9d1a0d/42a19/spaghetti-code.png\"\n        srcset=\"/static/63a275658d485cabf21527594c9d1a0d/e3135/spaghetti-code.png 256w,\n/static/63a275658d485cabf21527594c9d1a0d/06341/spaghetti-code.png 512w,\n/static/63a275658d485cabf21527594c9d1a0d/42a19/spaghetti-code.png 1024w,\n/static/63a275658d485cabf21527594c9d1a0d/e8464/spaghetti-code.png 1536w,\n/static/63a275658d485cabf21527594c9d1a0d/16e03/spaghetti-code.png 1651w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Código espaguete</figcaption>\n  </figure></p>\n<h2 id=\"mas-por-que\" style=\"position:relative;\"><a href=\"#mas-por-que\" aria-label=\"mas por que permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mas por quê?</h2>\n<p>Como <a href=\"https://www.grammy.com/artists/ryan-reynolds/243495\" target=\"_blank\" rel=\"noreferrer\">o uma vez indicado ao Grammy, Ryan Reynolds</a> disse uma vez: Mas por quê?</p>\n<p><img src=\"/f1547924a1c5e48fc3d7132349267d59/but-why.gif\" alt=\"Filmagem real dos leitores deste post\"></p>\n<p>Boa pergunta! A questão é a seguinte: decidimos que a melhor maneira de implementar essa transição para o Next.js era mover uma página por vez. Isso significa que precisaríamos compartilhar cookies entre as aplicações Laravel e Next.js. Embora isso traga muitos benefícios, também apresenta alguns desafios únicos.</p>\n<p>O maior desafio é que Laravel e Next.js não falam exatamente a mesma linguagem quando se trata de criptografia de cookies. O Laravel usa seu próprio algoritmo de criptografia e, por padrão, criptografa todos os cookies usando uma chave privada. Sem essa chave, e sem reverter o algoritmo do Laravel, é impossível ler os dados no lado do Next.js.</p>\n<p>Por outro lado, o Next.js é bastante flexível sobre como você armazena seus cookies. Como estávamos criando uma nova aplicação Next.js do zero, essa foi uma oportunidade perfeita para alinhar sua criptografia ao método do Laravel, permitindo-nos descriptografar e criptografar os cookies do Laravel diretamente no Next.js sem o risco de quebrar nada.</p>\n<h2 id=\"mergulhando-na-criptografia-de-cookies-do-laravel\" style=\"position:relative;\"><a href=\"#mergulhando-na-criptografia-de-cookies-do-laravel\" aria-label=\"mergulhando na criptografia de cookies do laravel permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mergulhando na criptografia de cookies do Laravel</h2>\n<p>Antes de resolvermos esse problema, precisávamos entender como o Laravel criptografa seus cookies. Descobri que não há muitas informações sobre isso. Em uma época em que é difícil encontrar algo único para escrever em um post de blog, pensei que essa seria a oportunidade perfeita para compartilhar algumas ideias.</p>\n<p>Então, como descobrimos como o Laravel criptografa seus cookies? Explorando <a href=\"https://github.com/laravel/laravel\" target=\"_blank\" rel=\"noreferrer\">o código-fonte</a>, é claro! Felizmente, o código-fonte do Laravel é bastante legível e bem organizado, então não demorou muito para localizar as partes relevantes.</p>\n<h3 id=\"chave-da-aplicacao\" style=\"position:relative;\"><a href=\"#chave-da-aplicacao\" aria-label=\"chave da aplicacao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chave da Aplicação</h3>\n<p>O Laravel usa uma chave privada, conhecida como Chave da Aplicação (Application Key), para a criptografia, que pode ser gerada usando o comando <code class=\"language-text\">php artisan key:generate</code>. Ele emprega o cifrador <code class=\"language-text\">AES-256-CBC</code> para criptografia, que requer um Vetor de Inicialização (IV). Além disso, o Laravel usa um Código de Autenticação de Mensagem (MAC) para garantir a integridade dos dados criptografados.</p>\n<h3 id=\"vetor-de-inicializacao\" style=\"position:relative;\"><a href=\"#vetor-de-inicializacao\" aria-label=\"vetor de inicializacao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vetor de Inicialização</h3>\n<p>O IV é um valor aleatório usado para garantir que o mesmo texto simples não seja criptografado para o mesmo texto cifrado. O Laravel gera um IV aleatório para cada cookie e o armazena junto com o valor criptografado.</p>\n<h3 id=\"codigo-de-autenticacao-de-mensagem\" style=\"position:relative;\"><a href=\"#codigo-de-autenticacao-de-mensagem\" aria-label=\"codigo de autenticacao de mensagem permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Código de Autenticação de Mensagem</h3>\n<p>O MAC é uma soma de verificação criptográfica que garante a integridade dos dados criptografados. O Laravel gera um MAC usando o IV e o valor criptografado, que é então usado para verificar a integridade dos dados durante a descriptografia.</p>\n<h3 id=\"diagrama-do-processo\" style=\"position:relative;\"><a href=\"#diagrama-do-processo\" aria-label=\"diagrama do processo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Diagrama do processo</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125.78125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsTAAALEwEAmpwYAAADFElEQVQ4y32UaXLjNhCFdf87JZUcIDWxtVnyjCURXEDsK7ETKYoux47tdOFHE4UPeHjdxCbGTEl4G4R4Qjwl4fICz+cGAMpYIth3rcTIMRoJDoL7Wuda68ZNwdrgfHIueZ9jLCnNIWSlLCFccK2Vm2y8vAAprPfZ+aSVK6UssHdxzWqtpRRjHEIUY2aMu8/N6yHv4w35ALspHvftw8Nt+9i8/MLvgXmev4J9LLkoZaQ0IyJau/vSGkJMKdWv4gOcU1Fq6jqEEPc+rvpLKdZOKaW8pPO3cAz55xnt9+Bw6Eeoaq1aW4Q5hIRQiTCfJv81HEKS3FJi4MAxUpxZJScplkGJFMxIYZV0hAjBjVaOEMmZXh3Y1FpzLhgzOJChR1KZea4551LmEOJdc5nn2Vob43Kj+13yKmFjTXRTljIgpBi1xsTJJmOWsmO01Nm5bE3i3GoVrEmCT0r5Jbdxg5E9PeH9Dv79o9lt+90Wdq3Go3v4AX7/7a8//3jcbQdKPEaGUi94RKOh1AkeCbZLh8FBXC/4dsXXK75csNE+xtzcSHOjLeAA0JxLzmk1KaU03xM3hQWutQqhR8QI4c4tnzEmzvUICWNqRAyOrO9x32NCZIyvVi+wd6GUGY3qeh1bQJRya50ZNdcLBIAIbnPOzvkYUynzJzjPlxd8Orbn00CwXp0cOvF0bJ+OLRrVXcsr8x84xpgYVRhzgrkQ2loHIcWYjyOlVAlhKJXWTuumKaW14RY4+OhcGAZ2vfQAIIxkStm54H2kVN2usAWo78gImZuiMY4xuR6wwDEkzqfjoTsdu8MBPJ/gWye3Ddtvm/2uOezA40MzDlLrCWNOiZDKOnuXnXJmTGMsKFNK2fpNrC35QfYCp0yIbBo4QCrld/CrnBDeGRZ8tCY+n8fn5/F8hqDhn16OD/GF2+Mouo70HaFU/Q9ZSgkhrK/KK1xKkdIoZYXQQupwj6Ul8lyWxpxzLinGdT7ntzfrDn/lTWkBWUrw1G+3txbQz2sWmBEthRX833H/+yeMFGhoBxi4ETgIKezbsjXnVP8DzmSYeSssc+sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Fluxo de criptografia\"\n        title=\"Fluxo de criptografia\"\n        src=\"/static/983add2af1440049060bb0a9e7534d24/242a6/encryption-flow.png\"\n        srcset=\"/static/983add2af1440049060bb0a9e7534d24/e3135/encryption-flow.png 256w,\n/static/983add2af1440049060bb0a9e7534d24/06341/encryption-flow.png 512w,\n/static/983add2af1440049060bb0a9e7534d24/242a6/encryption-flow.png 720w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Fluxo de criptografia</figcaption>\n  </figure></p>\n<p>Tudo isso pode mudar dependendo da sua versão do Laravel ou de quanto você personalizou suas configurações de criptografia. Você pode verificar o arquivo <code class=\"language-text\">config/app.php</code> para ver como suas configurações de criptografia estão configuradas.</p>\n<p>Aqui está um resumo simplificado do processo:</p>\n<ol>\n<li><strong>Valor do Cookie</strong>: O valor do cookie é transformado em string e então <a href=\"https://github.com/illuminate/cookie/blob/v9.52.16/Middleware/EncryptCookies.php#L180\" target=\"_blank\" rel=\"noreferrer\">prefixado</a> com um <a href=\"https://github.com/illuminate/cookie/blob/v9.52.16/CookieValuePrefix.php#L14\" target=\"_blank\" rel=\"noreferrer\">hash <code class=\"language-text\">SHA-1</code></a> baseado no nome do cookie e em uma string de versão (<code class=\"language-text\">\"v2\"</code>).</li>\n<li><strong>Criptografia</strong>: O valor prefixado é <a href=\"https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L102\" target=\"_blank\" rel=\"noreferrer\">criptografado usando <code class=\"language-text\">AES-256-CBC</code></a>.</li>\n<li><strong>Geração do MAC</strong>: Um MAC é <a href=\"https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L116\" target=\"_blank\" rel=\"noreferrer\">gerado usando <code class=\"language-text\">HMAC-SHA256</code></a> sobre o IV e o valor criptografado.</li>\n<li><strong>Montagem do Payload</strong>: O valor criptografado, o IV, o MAC e uma tag são <a href=\"https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L118\" target=\"_blank\" rel=\"noreferrer\">montados em um objeto JSON</a>.</li>\n<li><strong>Codificação Base64</strong>: Este objeto JSON é <a href=\"https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L124\" target=\"_blank\" rel=\"noreferrer\">então codificado em base64</a> para formar o valor final do cookie.</li>\n</ol>\n<p>Um exemplo da estrutura do cookie criptografado é assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"encryptedValue\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"iv\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"base64-encoded-IV\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"mac\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hex-encoded-MAC\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"tag\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"base64-encoded-tag\"</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Entender essa estrutura foi crucial para replicar os processos de criptografia e descriptografia no Next.js.</p>\n<h2 id=\"recriando-a-criptografia-do-laravel-no-nextjs\" style=\"position:relative;\"><a href=\"#recriando-a-criptografia-do-laravel-no-nextjs\" aria-label=\"recriando a criptografia do laravel no nextjs permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recriando a criptografia do Laravel no Next.js</h2>\n<p>Para ler e atualizar os cookies criptografados do Laravel no Next.js, precisávamos replicar a lógica de criptografia do Laravel em nossa aplicação Next.js. Aqui está como abordamos isso.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.765625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3UlEQVQozxXL308ScQAA8Psr2npz/bJpreyH2q9hyx9wd0CSoHjC3XH3BQ6OAw+OXxmRlGmOQhIQ0APlN0pLg3KmM1ur9dJbaytb8ZJP/QO91Pq8fyC5xq0c8dzUelSjHg3uR4d9Y0woOJ9TYZ6z7YMRmE4N4EtSIgPjqX6wJDUUEaKEGCoyuioHUOPz/vb+z90fzb1m893Br616WqGiDh3uVo0KnR2aKAxEmMjAhCgjS8OyZYU6D1PVQWLNrM2Y+qHNL1+397/vfNt/f3BQ/7Bbs593ciw9EbN6w51n1TEUZBGyIDeIUpBRn8wOSrJ9TEmnWZ9DM8I1KFGrxyrrydWNaOWF6EJqVEtjFvv4qTEdFzvPDCfkdBbV5VCQ6pO/nXT8rs7UMUVFi72K3ix4eiAEpbvOKSWXhs533ArqYJGXRTzE8zgXTiQvX8TmUUNed2OLvb7KSKqT5NpDU21cvqbXvo6rVwO9kFzBtLUOtB7raT0JL5glz6zt8Vyp+fdPafdNd8dQQgEKSqI0hBVUIK5S7fhPbwZubExpn02rF6yXIRlCt7T0oNbolatDM+q2qP5i8j4XiK2TlqleCZVGiDJKFlFDVmps0PAH34kNn+Tl/GjU1D2Ln4OkSueRo73I+KJWKguaDSO28j2gIZg4xRctwsptespvnHGzMS9mWdYdLzMXyncG9xLqNNcVxk9BmFXsRd1tHViYlPi9c6RvMyqACd8T4HtucucId55058ZcxfS4gjcLSU7pdYUioYmIQ/mA6odwm0jyVZM99tBpM/AFgq94nVMBG4c78hQvElyK5JIYK5ZcCMs9mrVhd3mf1lGx+gtWfxHCuQzO5Yy2GMM9NTiLtLMAhIrRuUI5lnFuUc+m9OyC1rL4xI5ZmeAjjgzZLaNcluaXgLAC0f9DHrirwFMzCkWju2QUysBVofkcaU/r2aSeW9SRoYCZALbHDDttYmf1bIp0pCln9h8Xf01Zd5UGBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Mesmos cookies\"\n        title=\"Mesmos cookies\"\n        src=\"/static/ff0e8bf793eed9722337c7730b832247/42a19/same-cookies.png\"\n        srcset=\"/static/ff0e8bf793eed9722337c7730b832247/e3135/same-cookies.png 256w,\n/static/ff0e8bf793eed9722337c7730b832247/06341/same-cookies.png 512w,\n/static/ff0e8bf793eed9722337c7730b832247/42a19/same-cookies.png 1024w,\n/static/ff0e8bf793eed9722337c7730b832247/e8464/same-cookies.png 1536w,\n/static/ff0e8bf793eed9722337c7730b832247/2eb59/same-cookies.png 2048w,\n/static/ff0e8bf793eed9722337c7730b832247/5cc60/same-cookies.png 2444w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Mesmos cookies</figcaption>\n  </figure></p>\n<h3 id=\"descriptografando-cookies\" style=\"position:relative;\"><a href=\"#descriptografando-cookies\" aria-label=\"descriptografando cookies permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Descriptografando cookies</h3>\n<p>Criamos uma função <code class=\"language-text\">decryptCookieValue</code> que espelha o processo de descriptografia do Laravel. Aqui está uma versão simplificada:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">decryptCookieValue</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">encryptedCookieValue</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> publicKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">APP_KEY</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> decoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Decodificar e analisar o cookie</span>\r\n  <span class=\"token keyword\">const</span> decodedResult <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>encryptedCookieValue<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> parsedResult <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>decodedResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> iv<span class=\"token punctuation\">,</span> mac<span class=\"token punctuation\">,</span> value <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> parsedResult<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Verificar o MAC</span>\r\n  <span class=\"token keyword\">const</span> macPayload <span class=\"token operator\">=</span> iv <span class=\"token operator\">+</span> value<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> keyMaterial <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>publicKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> hmacKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> keyMaterial<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token string\">'SHA-256'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'verify'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> isMacValid <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">verify</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> hmacKey<span class=\"token punctuation\">,</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>mac<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>macPayload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isMacValid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Falha na validação do MAC'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token comment\">// Descriptografar o valor</span>\r\n  <span class=\"token keyword\">const</span> ivArray <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>iv<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encryptedData <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> cryptoKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> keyMaterial<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'AES-CBC'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'decrypt'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> decryptedData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'AES-CBC'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">iv</span><span class=\"token operator\">:</span> ivArray <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> cryptoKey<span class=\"token punctuation\">,</span> encryptedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> decryptedString <span class=\"token operator\">=</span> decoder<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>decryptedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Remover o prefixo do cookie do Laravel</span>\r\n  <span class=\"token keyword\">return</span> decryptedString<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">41</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Essa função descriptografa o valor do cookie, verifica o MAC e retorna a string descriptografada. Também tivemos que remover o prefixo do cookie do Laravel com um <code class=\"language-text\">slice</code> - exatamente como é feito no <a href=\"https://github.com/illuminate/cookie/blob/v9.52.16/CookieValuePrefix.php#L27\" target=\"_blank\" rel=\"noreferrer\">código original</a> - para obter o valor original do cookie.</p>\n<h3 id=\"criptografando-cookies\" style=\"position:relative;\"><a href=\"#criptografando-cookies\" aria-label=\"criptografando cookies permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Criptografando cookies</h3>\n<p>Também precisávamos criptografar cookies no Next.js para que o Laravel pudesse entender. Aqui está a função <code class=\"language-text\">encryptCookieValue</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">encryptCookieValue</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">cookieName<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> publicKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">APP_KEY</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Criar o prefixo do cookie do Laravel</span>\r\n  <span class=\"token keyword\">const</span> cookiePrefix <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createLaravelCookiePrefix</span><span class=\"token punctuation\">(</span>cookieName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> prefixedValue <span class=\"token operator\">=</span> cookiePrefix <span class=\"token operator\">+</span> value<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Gerar um IV aleatório</span>\r\n  <span class=\"token keyword\">const</span> iv <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">getRandomValues</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> keyMaterial <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>publicKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Criptografar o valor</span>\r\n  <span class=\"token keyword\">const</span> cryptoKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> keyMaterial<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'AES-CBC'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'encrypt'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encryptedData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'AES-CBC'</span><span class=\"token punctuation\">,</span> iv <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> cryptoKey<span class=\"token punctuation\">,</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>prefixedValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Gerar o MAC</span>\r\n  <span class=\"token keyword\">const</span> encryptedBase64 <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>encryptedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> ivBase64 <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>iv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> macPayload <span class=\"token operator\">=</span> ivBase64 <span class=\"token operator\">+</span> encryptedBase64<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> hmacKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> keyMaterial<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token string\">'SHA-256'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sign'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> macData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> hmacKey<span class=\"token punctuation\">,</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>macPayload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> macHex <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>macData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Montar o payload</span>\r\n  <span class=\"token keyword\">return</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">iv</span><span class=\"token operator\">:</span> ivBase64<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">mac</span><span class=\"token operator\">:</span> macHex<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> encryptedBase64<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Essa função criptografa o valor do cookie, gera um MAC e monta o payload do cookie criptografado.</p>\n<p>E aqui está a função auxiliar para criar o prefixo do cookie do Laravel:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createLaravelCookiePrefix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">cookieName</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> publicKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">APP_KEY</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cookieName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">v2</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>publicKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> cryptoKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token string\">'SHA-1'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sign'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> signature <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> cryptoKey<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> hexSignature <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>signature<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>hexSignature<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">|</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Essas funções garantem que os cookies criptografados no Next.js possam ser descriptografados pelo Laravel, permitindo uma integração perfeita entre frameworks.</p>\n<h2 id=\"desafios-e-consideracoes-de-seguranca\" style=\"position:relative;\"><a href=\"#desafios-e-consideracoes-de-seguranca\" aria-label=\"desafios e consideracoes de seguranca permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Desafios e considerações de segurança</h2>\n<p>Claro, esse processo não foi sem obstáculos:</p>\n<ul>\n<li><strong>Compatibilidade criptográfica</strong>: Igualar a criptografia do Laravel no Node.js exige um tratamento cuidadoso de codificação, tipos de dados e funções criptográficas.</li>\n<li><strong>Restrições de ambiente</strong>: Tivemos que garantir que essas funções rodassem apenas no lado do servidor, pois dependem de variáveis de ambiente do servidor e APIs de criptografia.</li>\n<li><strong>Considerações de segurança</strong>: Tivemos um cuidado especial para garantir que a <code class=\"language-text\">APP_KEY</code> permanecesse segura e nunca fosse exposta ao lado do cliente. O tratamento de erros, a verificação do MAC e garantir que o IV fosse único para cada criptografia foram fundamentais para evitar vulnerabilidades de segurança.</li>\n<li><strong>Testes e depuração</strong>: Verificar se nossa criptografia e descriptografia combinavam com a do Laravel exigiu muito teste e erro, além de um entendimento profundo de ambos os frameworks.</li>\n<li><strong>Decidir quais cookies criptografar</strong>: Nem todos os cookies precisavam ser criptografados, então selecionamos cuidadosamente apenas aqueles que manipulam dados sensíveis.</li>\n</ul>\n<p>Também vale ressaltar que esta solução é específica para o nosso caso de uso e pode não ser adequada para todos os cenários. É essencial entender as implicações de segurança ao replicar mecanismos de criptografia e garantir que sua implementação seja segura e esteja em conformidade com as melhores práticas.</p>\n<h2 id=\"a-recompensa-uma-experiencia-de-usuario-perfeita\" style=\"position:relative;\"><a href=\"#a-recompensa-uma-experiencia-de-usuario-perfeita\" aria-label=\"a recompensa uma experiencia de usuario perfeita permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A recompensa: Uma experiência de usuário perfeita</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9ADcgLDslMUArOEA3RUhdcniitnKZrD1FVzgtPDUiMTEXJjsnM0AyP0Y/S0NJWUNQYT88SkU2QkQwOz0lMgA+JzRBLTpDPkxObIKEuc2isrGXrLJdh6I8T2NAR1g6NEM/PEpETFxMZHdrmbCHvtRnkalNW2xMQUxCLzoAPy06RTxIS2F0V3WLdIyZqrq3u8W1sLCOV2lzSm6IP0xdQldqTW2DZZCokMDSeIyQgJ6pYYeeT1ZkUVppAEE0QURFU1d7kVxwhDEcK2NXVZ2GZIJpU2h/ik53lGCIn22fuWSOpm6NoYCVmyoiH0dGRIiuvG+dtGiVrQBCPElFUGFZfZRecIM9PFBKQ0xtXVtkYGeFmZiIr7trmrNTdY5ka26glna10cijv8SNp6x4g4iCp7ZcZnMAPjtJRFdpRlVqMh0uMR8vU0pMgo2NjbbCi5WMiIRvPF96NEtlWVlcpb64qdzquuHerrGVRS0xUj9EPicyADw5SD1IWTtPZEhJVXaAgqbNzanPzJWimHyPkENddEpZZH+LhZC5xIe2xIOYml1aXV9SSTwkLT4sOkQwPAAxHitDQ09xkJuQwM6Wx9ODk5NvdXVZbX5OZHiFkoiuxbanwbysv6+KhnZ6ipBZdIksK0Q2ITFGOEVBLToAUl1sgq27fqm5cYuXXmBnXGh1UWR2aXFyk6Wfqs/MosG8gHVjeHd0aYibYIqjUG2CPDxONSAuPCo4OiU0AGySpllrek9TX09VZVFcblhganV8fJe+xIy4xHBycHFrZGyDkWmTq1Z4jk1qgURXazUxQjEYKDchMDUeLQBGRFRHRVVTYXI5NUdHVGVzlqZqkaZXa31LSFNdbHlcdYpUcIRJYHVIW3BBUGQ7P1E0JzcsECEwFiYuEiHJohHl9BsUMQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Totalmente integrado\"\n        title=\"Totalmente integrado\"\n        src=\"/static/b78488b37ae488bb5c43e5ec64293b2c/42a19/fully-integrated.png\"\n        srcset=\"/static/b78488b37ae488bb5c43e5ec64293b2c/e3135/fully-integrated.png 256w,\n/static/b78488b37ae488bb5c43e5ec64293b2c/06341/fully-integrated.png 512w,\n/static/b78488b37ae488bb5c43e5ec64293b2c/42a19/fully-integrated.png 1024w,\n/static/b78488b37ae488bb5c43e5ec64293b2c/e8464/fully-integrated.png 1536w,\n/static/b78488b37ae488bb5c43e5ec64293b2c/445c6/fully-integrated.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Totalmente integrado</figcaption>\n  </figure></p>\n<p>Ao replicar os mecanismos de criptografia do Laravel no Next.js, alcançamos uma experiência de usuário perfeita. Os usuários podem navegar entre as páginas do Laravel e Next.js sem qualquer interrupção, e seus dados de sessão permanecem consistentes. Honestamente, é impressionante como o fluxo todo funciona sem que os usuários percebam a transição entre os dois frameworks.</p>\n<p>Essa solução também abre novas possibilidades para integrar outras plataformas com o Laravel, desde que consigam replicar o processo de criptografia do Laravel. É um testemunho do poder de entender e adaptar sistemas complexos para alcançar a interoperabilidade.</p>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p><img src=\"/1f382bda4eb7e36eb31460d035a5a8d3/cookie-crumbles.gif\" alt=\"Assim o cookie se desmancha\"></p>\n<p>Integrar cookies entre dois frameworks e linguagens de programação diferentes não é exatamente uma caminhada no parque - a menos que o parque seja o Central Park, e você seja <a href=\"https://www.youtube.com/watch?v=vm-471akcQU\" target=\"_blank\" rel=\"noreferrer\">John Wick logo após ser excomungado</a>. Mas, com uma imersão profunda em como cada framework lida com criptografia e um pouco de perseverança (e talvez um pouco de mate), é definitivamente possível.</p>\n<p>Espero que esta explicação ilumine como enfrentar esse tipo de desafio. Se você acha esse tipo de solução de problemas empolgante, talvez queira se juntar a nós. Estamos sempre à procura de pessoas talentosas - confira nossas <a href=\"https://jobs.studocu.com/job-postings\" target=\"_blank\" rel=\"noreferrer\">vagas de emprego</a>. Sei que pode ter parecido um pesadelo, mas confie em mim, é o tipo divertido!</p>\n<p>Happy coding!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTEwLTI1VDAwOjAwOjAwLjAwMFo=","slug":"/2024/2024-10-25-compartilhando-cookies-encriptados-do-laravel-com-next-js.pt-br/","path":"/blog/coding/compartilhando-cookies-encriptados-do-laravel-com-next-js/","locale":"pt-br"},"rawMarkdownBody":"Muitas vezes, amigos me perguntam: \"Pablo, como você consegue manter a calma e serenidade diante de desafios técnicos complexos?\" Bem, a verdade é que eu não consigo. Eu apenas escrevo posts no blog sobre eles para parecer que eu consigo. Esta é uma dessas histórias.\r\n\r\nRecentemente, me vi precisando desvendar os valores dos cookies vindos de uma aplicação Laravel, lê-los, atualizá-los e, em seguida, remontá-los de uma forma que a aplicação Laravel nem percebesse. Parece o enredo de um filme do Missão Impossível, certo? Vamos seguir com essa ideia, e eu sou o Tom Cruise.\r\n\r\n## A infame migração para o Next.js\r\nDepois de migrar do [CoffeeScript para o ES6](https://medium.com/studocu-techblog/migrating-from-coffeescript-to-javascript-es6-ed73bcae851e) e depois do [ES6 para o TypeScript](https://medium.com/studocu-techblog/how-we-migrated-our-codebase-to-typescript-c7962f1b877a), era hora de mais uma grande refatoração: [separar nosso frontend do Laravel em um app Next.js independente](https://medium.com/studocu-techblog/migrating-from-a-monolith-to-next-js-at-studocu-part-1-4b0baf3d5fe9).\r\n\r\nPara melhorar o desempenho, a experiência do desenvolvedor e a atratividade do empregador (merchan descarado, estamos contratando no [Studocu](https://jobs.studocu.com/job-postings) *wink-wink*), precisávamos de um framework frontend robusto que pudesse lidar com nossa crescente base de usuários e conjunto de funcionalidades. O Next.js parecia a escolha perfeita.\r\n\r\nTeoricamente, isso nos ajudaria a parar de reinventar a roda - como escrever infinitas linhas de configurações do Webpack - e focar no que realmente importa: construir funcionalidades que nossos usuários amam. Então, o plano é que, em vez de ter um código espaguete gigante, teríamos dois menores, como fios de macarrão.\r\n\r\n![Código espaguete](../../uploads/blog/2024/10/spaghetti-code.png)\r\n\r\n## Mas por quê?\r\nComo [o uma vez indicado ao Grammy, Ryan Reynolds](https://www.grammy.com/artists/ryan-reynolds/243495) disse uma vez: Mas por quê?\r\n\r\n![Filmagem real dos leitores deste post](../../uploads/blog/2024/10/but-why.gif)\r\n\r\nBoa pergunta! A questão é a seguinte: decidimos que a melhor maneira de implementar essa transição para o Next.js era mover uma página por vez. Isso significa que precisaríamos compartilhar cookies entre as aplicações Laravel e Next.js. Embora isso traga muitos benefícios, também apresenta alguns desafios únicos.\r\n\r\nO maior desafio é que Laravel e Next.js não falam exatamente a mesma linguagem quando se trata de criptografia de cookies. O Laravel usa seu próprio algoritmo de criptografia e, por padrão, criptografa todos os cookies usando uma chave privada. Sem essa chave, e sem reverter o algoritmo do Laravel, é impossível ler os dados no lado do Next.js.\r\n\r\nPor outro lado, o Next.js é bastante flexível sobre como você armazena seus cookies. Como estávamos criando uma nova aplicação Next.js do zero, essa foi uma oportunidade perfeita para alinhar sua criptografia ao método do Laravel, permitindo-nos descriptografar e criptografar os cookies do Laravel diretamente no Next.js sem o risco de quebrar nada.\r\n\r\n## Mergulhando na criptografia de cookies do Laravel\r\nAntes de resolvermos esse problema, precisávamos entender como o Laravel criptografa seus cookies. Descobri que não há muitas informações sobre isso. Em uma época em que é difícil encontrar algo único para escrever em um post de blog, pensei que essa seria a oportunidade perfeita para compartilhar algumas ideias.\r\n\r\nEntão, como descobrimos como o Laravel criptografa seus cookies? Explorando [o código-fonte](https://github.com/laravel/laravel), é claro! Felizmente, o código-fonte do Laravel é bastante legível e bem organizado, então não demorou muito para localizar as partes relevantes.\r\n\r\n### Chave da Aplicação\r\nO Laravel usa uma chave privada, conhecida como Chave da Aplicação (Application Key), para a criptografia, que pode ser gerada usando o comando `php artisan key:generate`. Ele emprega o cifrador `AES-256-CBC` para criptografia, que requer um Vetor de Inicialização (IV). Além disso, o Laravel usa um Código de Autenticação de Mensagem (MAC) para garantir a integridade dos dados criptografados.\r\n\r\n### Vetor de Inicialização\r\nO IV é um valor aleatório usado para garantir que o mesmo texto simples não seja criptografado para o mesmo texto cifrado. O Laravel gera um IV aleatório para cada cookie e o armazena junto com o valor criptografado.\r\n\r\n### Código de Autenticação de Mensagem\r\nO MAC é uma soma de verificação criptográfica que garante a integridade dos dados criptografados. O Laravel gera um MAC usando o IV e o valor criptografado, que é então usado para verificar a integridade dos dados durante a descriptografia.\r\n\r\n### Diagrama do processo\r\n![Fluxo de criptografia](../../uploads/blog/2024/10/encryption-flow.png)\r\n\r\nTudo isso pode mudar dependendo da sua versão do Laravel ou de quanto você personalizou suas configurações de criptografia. Você pode verificar o arquivo `config/app.php` para ver como suas configurações de criptografia estão configuradas.\r\n\r\nAqui está um resumo simplificado do processo:\r\n\r\n1. **Valor do Cookie**: O valor do cookie é transformado em string e então [prefixado](https://github.com/illuminate/cookie/blob/v9.52.16/Middleware/EncryptCookies.php#L180) com um [hash `SHA-1`](https://github.com/illuminate/cookie/blob/v9.52.16/CookieValuePrefix.php#L14) baseado no nome do cookie e em uma string de versão (`\"v2\"`).\r\n2. **Criptografia**: O valor prefixado é [criptografado usando `AES-256-CBC`](https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L102).\r\n3. **Geração do MAC**: Um MAC é [gerado usando `HMAC-SHA256`](https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L116) sobre o IV e o valor criptografado.\r\n4. **Montagem do Payload**: O valor criptografado, o IV, o MAC e uma tag são [montados em um objeto JSON](https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L118).\r\n5. **Codificação Base64**: Este objeto JSON é [então codificado em base64](https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L124) para formar o valor final do cookie.\r\n\r\nUm exemplo da estrutura do cookie criptografado é assim:\r\n\r\n```json\r\n{\r\n  \"value\": \"encryptedValue\",\r\n  \"iv\": \"base64-encoded-IV\",\r\n  \"mac\": \"hex-encoded-MAC\",\r\n  \"tag\": \"base64-encoded-tag\"\r\n}\r\n```\r\n\r\nEntender essa estrutura foi crucial para replicar os processos de criptografia e descriptografia no Next.js.\r\n\r\n## Recriando a criptografia do Laravel no Next.js\r\n\r\nPara ler e atualizar os cookies criptografados do Laravel no Next.js, precisávamos replicar a lógica de criptografia do Laravel em nossa aplicação Next.js. Aqui está como abordamos isso.\r\n\r\n![Mesmos cookies](../../uploads/blog/2024/10/same-cookies.png)\r\n\r\n### Descriptografando cookies\r\nCriamos uma função `decryptCookieValue` que espelha o processo de descriptografia do Laravel. Aqui está uma versão simplificada:\r\n\r\n```javascript\r\nexport const decryptCookieValue = async (encryptedCookieValue) => {\r\n  const publicKey = process.env.APP_KEY;\r\n  const encoder = new TextEncoder();\r\n  const decoder = new TextDecoder();\r\n\r\n  // Decodificar e analisar o cookie\r\n  const decodedResult = Buffer.from(encryptedCookieValue, 'base64').toString('utf-8');\r\n  const parsedResult = JSON.parse(decodedResult);\r\n\r\n  const { iv, mac, value } = parsedResult;\r\n\r\n  // Verificar o MAC\r\n  const macPayload = iv + value;\r\n  const keyMaterial = encoder.encode(publicKey);\r\n  const hmacKey = await crypto.subtle.importKey('raw', keyMaterial, { name: 'HMAC', hash: 'SHA-256' }, false, ['verify']);\r\n  const isMacValid = await crypto.subtle.verify('HMAC', hmacKey, Buffer.from(mac, 'hex'), encoder.encode(macPayload));\r\n\r\n  if (!isMacValid) {\r\n    throw new Error('Falha na validação do MAC');\r\n  }\r\n\r\n  // Descriptografar o valor\r\n  const ivArray = Buffer.from(iv, 'base64');\r\n  const encryptedData = Buffer.from(value, 'base64');\r\n  const cryptoKey = await crypto.subtle.importKey('raw', keyMaterial, { name: 'AES-CBC' }, false, ['decrypt']);\r\n  const decryptedData = await crypto.subtle.decrypt({ name: 'AES-CBC', iv: ivArray }, cryptoKey, encryptedData);\r\n\r\n  const decryptedString = decoder.decode(decryptedData);\r\n\r\n  // Remover o prefixo do cookie do Laravel\r\n  return decryptedString.slice(41);\r\n};\r\n```\r\n\r\nEssa função descriptografa o valor do cookie, verifica o MAC e retorna a string descriptografada. Também tivemos que remover o prefixo do cookie do Laravel com um `slice` - exatamente como é feito no [código original](https://github.com/illuminate/cookie/blob/v9.52.16/CookieValuePrefix.php#L27) - para obter o valor original do cookie.\r\n\r\n### Criptografando cookies\r\nTambém precisávamos criptografar cookies no Next.js para que o Laravel pudesse entender. Aqui está a função `encryptCookieValue`:\r\n\r\n```javascript\r\nexport const encryptCookieValue = async (cookieName, value) => {\r\n  const publicKey = process.env.APP_KEY;\r\n  const encoder = new TextEncoder();\r\n\r\n  // Criar o prefixo do cookie do Laravel\r\n  const cookiePrefix = await createLaravelCookiePrefix(cookieName);\r\n  const prefixedValue = cookiePrefix + value;\r\n\r\n  // Gerar um IV aleatório\r\n  const iv = crypto.getRandomValues(new Uint8Array(16));\r\n  const keyMaterial = encoder.encode(publicKey);\r\n\r\n  // Criptografar o valor\r\n  const cryptoKey = await crypto.subtle.importKey('raw', keyMaterial, { name: 'AES-CBC' }, false, ['encrypt']);\r\n  const encryptedData = await crypto.subtle.encrypt({ name: 'AES-CBC', iv }, cryptoKey, encoder.encode(prefixedValue));\r\n\r\n  // Gerar o MAC\r\n  const encryptedBase64 = Buffer.from(encryptedData).toString('base64');\r\n  const ivBase64 = Buffer.from(iv).toString('base64');\r\n  const macPayload = ivBase64 + encryptedBase64;\r\n  const hmacKey = await crypto.subtle.importKey('raw', keyMaterial, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']);\r\n  const macData = await crypto.subtle.sign('HMAC', hmacKey, encoder.encode(macPayload));\r\n  const macHex = Buffer.from(macData).toString('hex');\r\n\r\n  // Montar o payload\r\n  return Buffer.from(\r\n    JSON.stringify({\r\n      iv: ivBase64,\r\n      mac: macHex,\r\n      tag: '',\r\n      value: encryptedBase64,\r\n    })\r\n  ).toString('base64');\r\n};\r\n```\r\n\r\nEssa função criptografa o valor do cookie, gera um MAC e monta o payload do cookie criptografado.\r\n\r\nE aqui está a função auxiliar para criar o prefixo do cookie do Laravel:\r\n\r\n```javascript\r\nconst createLaravelCookiePrefix = async (cookieName) => {\r\n  const publicKey = process.env.APP_KEY;\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(`${cookieName}v2`);\r\n  const key = encoder.encode(publicKey);\r\n\r\n  const cryptoKey = await crypto.subtle.importKey('raw', key, { name: 'HMAC', hash: 'SHA-1' }, false, ['sign']);\r\n  const signature = await crypto.subtle.sign('HMAC', cryptoKey, data);\r\n  const hexSignature = Buffer.from(signature).toString('hex');\r\n\r\n  return `${hexSignature}|`;\r\n};\r\n```\r\n\r\nEssas funções garantem que os cookies criptografados no Next.js possam ser descriptografados pelo Laravel, permitindo uma integração perfeita entre frameworks.\r\n\r\n## Desafios e considerações de segurança\r\nClaro, esse processo não foi sem obstáculos:\r\n\r\n- **Compatibilidade criptográfica**: Igualar a criptografia do Laravel no Node.js exige um tratamento cuidadoso de codificação, tipos de dados e funções criptográficas.\r\n- **Restrições de ambiente**: Tivemos que garantir que essas funções rodassem apenas no lado do servidor, pois dependem de variáveis de ambiente do servidor e APIs de criptografia.\r\n- **Considerações de segurança**: Tivemos um cuidado especial para garantir que a `APP_KEY` permanecesse segura e nunca fosse exposta ao lado do cliente. O tratamento de erros, a verificação do MAC e garantir que o IV fosse único para cada criptografia foram fundamentais para evitar vulnerabilidades de segurança.\r\n- **Testes e depuração**: Verificar se nossa criptografia e descriptografia combinavam com a do Laravel exigiu muito teste e erro, além de um entendimento profundo de ambos os frameworks.\r\n- **Decidir quais cookies criptografar**: Nem todos os cookies precisavam ser criptografados, então selecionamos cuidadosamente apenas aqueles que manipulam dados sensíveis.\r\n\r\nTambém vale ressaltar que esta solução é específica para o nosso caso de uso e pode não ser adequada para todos os cenários. É essencial entender as implicações de segurança ao replicar mecanismos de criptografia e garantir que sua implementação seja segura e esteja em conformidade com as melhores práticas.\r\n\r\n## A recompensa: Uma experiência de usuário perfeita\r\n\r\n![Totalmente integrado](../../uploads/blog/2024/10/fully-integrated.png)\r\n\r\nAo replicar os mecanismos de criptografia do Laravel no Next.js, alcançamos uma experiência de usuário perfeita. Os usuários podem navegar entre as páginas do Laravel e Next.js sem qualquer interrupção, e seus dados de sessão permanecem consistentes. Honestamente, é impressionante como o fluxo todo funciona sem que os usuários percebam a transição entre os dois frameworks.\r\n\r\nEssa solução também abre novas possibilidades para integrar outras plataformas com o Laravel, desde que consigam replicar o processo de criptografia do Laravel. É um testemunho do poder de entender e adaptar sistemas complexos para alcançar a interoperabilidade.\r\n\r\n## Conclusão\r\n![Assim o cookie se desmancha](../../uploads/blog/2024/10/cookie-crumbles.gif)\r\n\r\nIntegrar cookies entre dois frameworks e linguagens de programação diferentes não é exatamente uma caminhada no parque - a menos que o parque seja o Central Park, e você seja [John Wick logo após ser excomungado](https://www.youtube.com/watch?v=vm-471akcQU). Mas, com uma imersão profunda em como cada framework lida com criptografia e um pouco de perseverança (e talvez um pouco de mate), é definitivamente possível.\r\n\r\nEspero que esta explicação ilumine como enfrentar esse tipo de desafio. Se você acha esse tipo de solução de problemas empolgante, talvez queira se juntar a nós. Estamos sempre à procura de pessoas talentosas - confira nossas [vagas de emprego](https://jobs.studocu.com/job-postings). Sei que pode ter parecido um pesadelo, mas confie em mim, é o tipo divertido!\r\n\r\nHappy coding!\r\n","frontmatter":{"tags":["laravel","next.js","cookies","encriptação","sincronização","desenvolvimento web","php","javascript"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2024-10-25T00:00:00.000Z","id":null,"path":"compartilhando-cookies-encriptados-do-laravel-com-next-js","show":true,"title":"Compartilhando cookies encriptados do Laravel com Next.js","hideExcerpt":false,"subtitle":"Conectando Laravel e Next.js: Como sincronizamos cookies encriptados entre dois frameworks diferentes."}}},{"node":{"excerpt":"I often have friends asking me, “Pablo, how do you manage to…","html":"<p>I often have friends asking me, “Pablo, how do you manage to stay so calm and collected in the face of complex technical challenges?” Well, the truth is, I don’t. I just write blog posts about them to make it seem like I do. This is one of those stories.</p>\n<p>I recently found myself needing to crack open the values of cookies coming from a Laravel application, read them, update them, and then patch them back up in a way the Laravel application wouldn’t even notice. Sounds like the plot of a Mission Impossible movie, right? Let’s roll with that, and I’m Tom Cruise.</p>\n<h2 id=\"the-infamous-nextjs-migration\" style=\"position:relative;\"><a href=\"#the-infamous-nextjs-migration\" aria-label=\"the infamous nextjs migration permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The infamous Next.js migration</h2>\n<p>After migrating from <a href=\"https://medium.com/studocu-techblog/migrating-from-coffeescript-to-javascript-es6-ed73bcae851e\" target=\"_blank\" rel=\"noreferrer\">CoffeeScript to ES6</a> and then from <a href=\"https://medium.com/studocu-techblog/how-we-migrated-our-codebase-to-typescript-c7962f1b877a\" target=\"_blank\" rel=\"noreferrer\">ES6 to TypeScript</a>, it was time for another major refactor: <a href=\"https://medium.com/studocu-techblog/migrating-from-a-monolith-to-next-js-at-studocu-part-1-4b0baf3d5fe9\" target=\"_blank\" rel=\"noreferrer\">detaching our frontend from Laravel into a separate Next.js app</a>.</p>\n<p>In order to improve performance, developer experience, and employer desirability (shameless plug, we’re hiring at <a href=\"https://jobs.studocu.com/job-postings\" target=\"_blank\" rel=\"noreferrer\">Studocu</a> <em>wink-wink</em>), we needed a robust frontend framework that could handle our growing user base and feature set. Next.js seemed like the perfect fit.</p>\n<p>This theoretically would help us stop reinventing the wheel - like writing endless lines of Webpack configurations - and focus on what really matters: building features that our users love. So the plan is that instead of having one spaghetti codebase, we would have two smaller, noodle-like codebases.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.109375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC2klEQVQozy2SV08aAQCA79c0afpgk/ah66EacVAirjiq1lkVsYjQoETREjc2NVpNIY5KVVC0FRcOhhbkuDvAosZto3DcnbdYmva1MfX1S76XLx9whTqvUCeDu3D/dpjaIVGQRu3XFMTgEE3A2KWDDDopDGTwW8ISUIRy4ygYoT0sAQME6oyS8E94+dPU8Pz8qGG0cUJdv2zWaZd0c9ODF6c2hkSo4J3M4K5pvbpLITEMd5MoCNAYCO+ZB9QftbLi5obyPmmaouGtuDa/9f0bgzLPNtMZON1kCJhEwSjjdVj1woK80sL87NTElYUxIER7rTZDn7RALs7rFfKVTWXy2uTytEdPHj1oLubMNeT4NrQhZofFob8Rn3ltqio1sbIgu6zo9apxDMAxeFopqM1IkL98mJX4gsuJS3t+jxP/rDL9cY0of6gx+wAyxEI7GyvjR3urYdKt1fS0SqqHv/QE/U4gcLo1UZMqi48T81Mk5QmSzPuykpTu+rx2abGoKk2hFCwZ1Rbz0snx0bbDen64HqG9/hMbexsPBigC+tEvlBTymkXZnWKO8RsviHDPkazepsyeUp5UUWtaH/fCpvXVRYfdFDjfjNHuGOOOUB4ag4DAhUOl7u0SZnW/y60TF0OWjEsPd0XPaf+QI6/OHRAleZ1T12EfvG24PLNeM96FeW1Xa9Oy7jNDQACFIZrZ8WZ5iUxc2iJKt37n67WvNB1PVZLk/oqkMVVV4NTKEEiEct+Ed+wWQ5u8wDbPVdbx15YmAZZA9vctM0bNYEuFUpDRUcmTNlUo2ouE8jrdUNvZ1iQbBCkcIlHwJuRdWdR1yDLXZ7j1ggzj7AhAoCAZdOG4+9hn8pj1v5ZH3Kavc1ajFVzALu0s6SFxiMJc//ci/M4hVUtdeVGfqsX/2w5QOETjME0gYXY3Gj2Ixg5jsYM/4d3rkI8lvTSOUNidTGOu8BVCE9DJ3hqFucIk8g/70eAbl2hLKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Spaghetti code\"\n        title=\"Spaghetti code\"\n        src=\"/static/63a275658d485cabf21527594c9d1a0d/42a19/spaghetti-code.png\"\n        srcset=\"/static/63a275658d485cabf21527594c9d1a0d/e3135/spaghetti-code.png 256w,\n/static/63a275658d485cabf21527594c9d1a0d/06341/spaghetti-code.png 512w,\n/static/63a275658d485cabf21527594c9d1a0d/42a19/spaghetti-code.png 1024w,\n/static/63a275658d485cabf21527594c9d1a0d/e8464/spaghetti-code.png 1536w,\n/static/63a275658d485cabf21527594c9d1a0d/16e03/spaghetti-code.png 1651w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Spaghetti code</figcaption>\n  </figure></p>\n<h2 id=\"but-why\" style=\"position:relative;\"><a href=\"#but-why\" aria-label=\"but why permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>But why?</h2>\n<p>As <a href=\"https://www.grammy.com/artists/ryan-reynolds/243495\" target=\"_blank\" rel=\"noreferrer\">one-time Grammy-nominated Ryan Reynolds</a> once said: But why?</p>\n<p><img src=\"/f1547924a1c5e48fc3d7132349267d59/but-why.gif\" alt=\"Actual footage of readers of this post\"></p>\n<p>Good question! Here’s the thing: we decided that the best way to implement this transition to Next.js was to move one page at a time. This means we would have to share cookies between the Laravel and Next.js applications. While this brings lots of benefits, it also presents some unique challenges.</p>\n<p>The biggest challenge is that Laravel and Next.js don’t exactly speak the same language when it comes to cookie encryption. Laravel uses its own encryption algorithm and, by default, encrypts every cookie using a private key. Without this key, and without reverse-engineering Laravel’s algorithm, it’s impossible to read the data on the Next.js side.</p>\n<p>On the other hand, Next.js is quite unopinionated about how you store your cookies. Since we were spinning up a new Next.js application from scratch, this was a perfect opportunity to align it with Laravel’s encryption method, allowing us to freely decrypt and encrypt Laravel’s cookies directly in Next.js without risking breaking anything.</p>\n<h2 id=\"diving-into-laravels-cookie-encryption\" style=\"position:relative;\"><a href=\"#diving-into-laravels-cookie-encryption\" aria-label=\"diving into laravels cookie encryption permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Diving into Laravel’s cookie encryption</h2>\n<p>Before we could solve this problem, we needed to understand how Laravel encrypts its cookies. Turns out, there isn’t a whole lot of information out there about this. In an age where it’s hard to find something unique to write a blog post about, I thought this would be the perfect opportunity to share some insights.</p>\n<p>So, how do we figure out how Laravel encrypts its cookies? By diving into <a href=\"https://github.com/laravel/laravel\" target=\"_blank\" rel=\"noreferrer\">the source code</a>, of course! Fortunately, Laravel’s source code is quite readable and well-organized, so it didn’t take long to track down the relevant parts.</p>\n<h3 id=\"application-key\" style=\"position:relative;\"><a href=\"#application-key\" aria-label=\"application key permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Application Key</h3>\n<p>Laravel uses a private key, known as the Application Key, for encryption, which can be generated using the <code class=\"language-text\">php artisan key:generate</code> command. It employs a <code class=\"language-text\">AES-256-CBC</code> cipher for encryption, which requires an Initialization Vector (IV). Additionally, Laravel uses a Message Authentication Code (MAC) to ensure the integrity of the encrypted data.</p>\n<h3 id=\"initialization-vector\" style=\"position:relative;\"><a href=\"#initialization-vector\" aria-label=\"initialization vector permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initialization Vector</h3>\n<p>The IV is a random value that’s used to ensure that the same plaintext doesn’t encrypt to the same ciphertext. Laravel generates a random IV for each cookie and stores it alongside the encrypted value.</p>\n<h3 id=\"message-authentication-code\" style=\"position:relative;\"><a href=\"#message-authentication-code\" aria-label=\"message authentication code permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Message Authentication Code</h3>\n<p>The MAC is a cryptographic checksum that ensures the integrity of the encrypted data. Laravel generates a MAC using the IV and the encrypted value, which is then used to verify the integrity of the data during decryption.</p>\n<h3 id=\"flow-chart\" style=\"position:relative;\"><a href=\"#flow-chart\" aria-label=\"flow chart permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Flow chart</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125.78125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAAsTAAALEwEAmpwYAAADFElEQVQ4y32UaXLjNhCFdf87JZUcIDWxtVnyjCURXEDsK7ETKYoux47tdOFHE4UPeHjdxCbGTEl4G4R4Qjwl4fICz+cGAMpYIth3rcTIMRoJDoL7Wuda68ZNwdrgfHIueZ9jLCnNIWSlLCFccK2Vm2y8vAAprPfZ+aSVK6UssHdxzWqtpRRjHEIUY2aMu8/N6yHv4w35ALspHvftw8Nt+9i8/MLvgXmev4J9LLkoZaQ0IyJau/vSGkJMKdWv4gOcU1Fq6jqEEPc+rvpLKdZOKaW8pPO3cAz55xnt9+Bw6Eeoaq1aW4Q5hIRQiTCfJv81HEKS3FJi4MAxUpxZJScplkGJFMxIYZV0hAjBjVaOEMmZXh3Y1FpzLhgzOJChR1KZea4551LmEOJdc5nn2Vob43Kj+13yKmFjTXRTljIgpBi1xsTJJmOWsmO01Nm5bE3i3GoVrEmCT0r5Jbdxg5E9PeH9Dv79o9lt+90Wdq3Go3v4AX7/7a8//3jcbQdKPEaGUi94RKOh1AkeCbZLh8FBXC/4dsXXK75csNE+xtzcSHOjLeAA0JxLzmk1KaU03xM3hQWutQqhR8QI4c4tnzEmzvUICWNqRAyOrO9x32NCZIyvVi+wd6GUGY3qeh1bQJRya50ZNdcLBIAIbnPOzvkYUynzJzjPlxd8Orbn00CwXp0cOvF0bJ+OLRrVXcsr8x84xpgYVRhzgrkQ2loHIcWYjyOlVAlhKJXWTuumKaW14RY4+OhcGAZ2vfQAIIxkStm54H2kVN2usAWo78gImZuiMY4xuR6wwDEkzqfjoTsdu8MBPJ/gWye3Ddtvm/2uOezA40MzDlLrCWNOiZDKOnuXnXJmTGMsKFNK2fpNrC35QfYCp0yIbBo4QCrld/CrnBDeGRZ8tCY+n8fn5/F8hqDhn16OD/GF2+Mouo70HaFU/Q9ZSgkhrK/KK1xKkdIoZYXQQupwj6Ul8lyWxpxzLinGdT7ntzfrDn/lTWkBWUrw1G+3txbQz2sWmBEthRX833H/+yeMFGhoBxi4ETgIKezbsjXnVP8DzmSYeSssc+sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Encryption flow\"\n        title=\"Encryption flow\"\n        src=\"/static/983add2af1440049060bb0a9e7534d24/242a6/encryption-flow.png\"\n        srcset=\"/static/983add2af1440049060bb0a9e7534d24/e3135/encryption-flow.png 256w,\n/static/983add2af1440049060bb0a9e7534d24/06341/encryption-flow.png 512w,\n/static/983add2af1440049060bb0a9e7534d24/242a6/encryption-flow.png 720w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Encryption flow</figcaption>\n  </figure></p>\n<p>All of this might change depending on your version of Laravel or how much you’ve customized your encryption settings. You can check your <code class=\"language-text\">config/app.php</code> file to see how your encryption settings are configured.</p>\n<p>Here’s a simplified breakdown of the process:</p>\n<ol>\n<li><strong>Cookie Value</strong>: The cookie value is stringified and then <a href=\"https://github.com/illuminate/cookie/blob/v9.52.16/Middleware/EncryptCookies.php#L180\" target=\"_blank\" rel=\"noreferrer\">prefixed</a> with <a href=\"https://github.com/illuminate/cookie/blob/v9.52.16/CookieValuePrefix.php#L14\" target=\"_blank\" rel=\"noreferrer\">a <code class=\"language-text\">SHA-1</code> hash</a> based on the cookie name and a version string (<code class=\"language-text\">\"v2\"</code>).</li>\n<li><strong>Encryption</strong>: The prefixed value is <a href=\"https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L102\" target=\"_blank\" rel=\"noreferrer\">encrypted using <code class=\"language-text\">AES-256-CBC</code></a>.</li>\n<li><strong>MAC Generation</strong>: A MAC is <a href=\"https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L116\" target=\"_blank\" rel=\"noreferrer\">generated using <code class=\"language-text\">HMAC-SHA256</code></a> over the IV and the encrypted value.</li>\n<li><strong>Payload Assembly</strong>: The encrypted value, IV, MAC, and a tag are <a href=\"https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L118\" target=\"_blank\" rel=\"noreferrer\">assembled into a JSON object</a>.</li>\n<li><strong>Base64 Encoding</strong>: This JSON object is <a href=\"https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L124\" target=\"_blank\" rel=\"noreferrer\">then base64-encoded</a> to form the final cookie value.</li>\n</ol>\n<p>An example of the encrypted cookie structure looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"encryptedValue\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"iv\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"base64-encoded-IV\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"mac\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hex-encoded-MAC\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"tag\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"base64-encoded-tag\"</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Understanding this structure was crucial for replicating the encryption and decryption processes in Next.js.</p>\n<h2 id=\"recreating-laravels-encryption-in-nextjs\" style=\"position:relative;\"><a href=\"#recreating-laravels-encryption-in-nextjs\" aria-label=\"recreating laravels encryption in nextjs permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recreating Laravel’s encryption in Next.js</h2>\n<p>To read and update Laravel’s encrypted cookies in Next.js, we needed to replicate Laravel’s encryption logic in our Next.js application. Here’s how we tackled it.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.765625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3UlEQVQozxXL308ScQAA8Psr2npz/bJpreyH2q9hyx9wd0CSoHjC3XH3BQ6OAw+OXxmRlGmOQhIQ0APlN0pLg3KmM1ur9dJbaytb8ZJP/QO91Pq8fyC5xq0c8dzUelSjHg3uR4d9Y0woOJ9TYZ6z7YMRmE4N4EtSIgPjqX6wJDUUEaKEGCoyuioHUOPz/vb+z90fzb1m893Br616WqGiDh3uVo0KnR2aKAxEmMjAhCgjS8OyZYU6D1PVQWLNrM2Y+qHNL1+397/vfNt/f3BQ/7Bbs593ciw9EbN6w51n1TEUZBGyIDeIUpBRn8wOSrJ9TEmnWZ9DM8I1KFGrxyrrydWNaOWF6EJqVEtjFvv4qTEdFzvPDCfkdBbV5VCQ6pO/nXT8rs7UMUVFi72K3ix4eiAEpbvOKSWXhs533ArqYJGXRTzE8zgXTiQvX8TmUUNed2OLvb7KSKqT5NpDU21cvqbXvo6rVwO9kFzBtLUOtB7raT0JL5glz6zt8Vyp+fdPafdNd8dQQgEKSqI0hBVUIK5S7fhPbwZubExpn02rF6yXIRlCt7T0oNbolatDM+q2qP5i8j4XiK2TlqleCZVGiDJKFlFDVmps0PAH34kNn+Tl/GjU1D2Ln4OkSueRo73I+KJWKguaDSO28j2gIZg4xRctwsptespvnHGzMS9mWdYdLzMXyncG9xLqNNcVxk9BmFXsRd1tHViYlPi9c6RvMyqACd8T4HtucucId55058ZcxfS4gjcLSU7pdYUioYmIQ/mA6odwm0jyVZM99tBpM/AFgq94nVMBG4c78hQvElyK5JIYK5ZcCMs9mrVhd3mf1lGx+gtWfxHCuQzO5Yy2GMM9NTiLtLMAhIrRuUI5lnFuUc+m9OyC1rL4xI5ZmeAjjgzZLaNcluaXgLAC0f9DHrirwFMzCkWju2QUysBVofkcaU/r2aSeW9SRoYCZALbHDDttYmf1bIp0pCln9h8Xf01Zd5UGBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Same cookies\"\n        title=\"Same cookies\"\n        src=\"/static/ff0e8bf793eed9722337c7730b832247/42a19/same-cookies.png\"\n        srcset=\"/static/ff0e8bf793eed9722337c7730b832247/e3135/same-cookies.png 256w,\n/static/ff0e8bf793eed9722337c7730b832247/06341/same-cookies.png 512w,\n/static/ff0e8bf793eed9722337c7730b832247/42a19/same-cookies.png 1024w,\n/static/ff0e8bf793eed9722337c7730b832247/e8464/same-cookies.png 1536w,\n/static/ff0e8bf793eed9722337c7730b832247/2eb59/same-cookies.png 2048w,\n/static/ff0e8bf793eed9722337c7730b832247/5cc60/same-cookies.png 2444w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Same cookies</figcaption>\n  </figure></p>\n<h3 id=\"decrypting-cookies\" style=\"position:relative;\"><a href=\"#decrypting-cookies\" aria-label=\"decrypting cookies permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Decrypting cookies</h3>\n<p>We created a function <code class=\"language-text\">decryptCookieValue</code> that mirrors Laravel’s decryption process. Here’s a simplified version:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">decryptCookieValue</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">encryptedCookieValue</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> publicKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">APP_KEY</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> decoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextDecoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Decode and parse the cookie</span>\r\n  <span class=\"token keyword\">const</span> decodedResult <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>encryptedCookieValue<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> parsedResult <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>decodedResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> iv<span class=\"token punctuation\">,</span> mac<span class=\"token punctuation\">,</span> value <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> parsedResult<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Verify the MAC</span>\r\n  <span class=\"token keyword\">const</span> macPayload <span class=\"token operator\">=</span> iv <span class=\"token operator\">+</span> value<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> keyMaterial <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>publicKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> hmacKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> keyMaterial<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token string\">'SHA-256'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'verify'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> isMacValid <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">verify</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> hmacKey<span class=\"token punctuation\">,</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>mac<span class=\"token punctuation\">,</span> <span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>macPayload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isMacValid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MAC validation failed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token comment\">// Decrypt the value</span>\r\n  <span class=\"token keyword\">const</span> ivArray <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>iv<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encryptedData <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> cryptoKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> keyMaterial<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'AES-CBC'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'decrypt'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> decryptedData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'AES-CBC'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">iv</span><span class=\"token operator\">:</span> ivArray <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> cryptoKey<span class=\"token punctuation\">,</span> encryptedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> decryptedString <span class=\"token operator\">=</span> decoder<span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>decryptedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Remove Laravel's cookie prefix</span>\r\n  <span class=\"token keyword\">return</span> decryptedString<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">41</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This function decrypts the cookie value, verifies the MAC, and returns the decrypted string. We also had to remove Laravel’s cookie prefix with a <code class=\"language-text\">slice</code> - pretty much how it’s done in the <a href=\"https://github.com/illuminate/cookie/blob/v9.52.16/CookieValuePrefix.php#L27\" target=\"_blank\" rel=\"noreferrer\">original code</a> - to get the original cookie value.</p>\n<h3 id=\"encrypting-cookies\" style=\"position:relative;\"><a href=\"#encrypting-cookies\" aria-label=\"encrypting cookies permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Encrypting cookies</h3>\n<p>We also needed to encrypt cookies in Next.js so that Laravel could understand. Here’s the <code class=\"language-text\">encryptCookieValue</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">encryptCookieValue</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">cookieName<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> publicKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">APP_KEY</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Create the Laravel cookie prefix</span>\r\n  <span class=\"token keyword\">const</span> cookiePrefix <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createLaravelCookiePrefix</span><span class=\"token punctuation\">(</span>cookieName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> prefixedValue <span class=\"token operator\">=</span> cookiePrefix <span class=\"token operator\">+</span> value<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Generate a random IV</span>\r\n  <span class=\"token keyword\">const</span> iv <span class=\"token operator\">=</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">getRandomValues</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> keyMaterial <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>publicKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Encrypt the value</span>\r\n  <span class=\"token keyword\">const</span> cryptoKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> keyMaterial<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'AES-CBC'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'encrypt'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encryptedData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'AES-CBC'</span><span class=\"token punctuation\">,</span> iv <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> cryptoKey<span class=\"token punctuation\">,</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>prefixedValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Generate the MAC</span>\r\n  <span class=\"token keyword\">const</span> encryptedBase64 <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>encryptedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> ivBase64 <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>iv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> macPayload <span class=\"token operator\">=</span> ivBase64 <span class=\"token operator\">+</span> encryptedBase64<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> hmacKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> keyMaterial<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token string\">'SHA-256'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sign'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> macData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> hmacKey<span class=\"token punctuation\">,</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>macPayload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> macHex <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>macData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// Assemble the payload</span>\r\n  <span class=\"token keyword\">return</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">iv</span><span class=\"token operator\">:</span> ivBase64<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">mac</span><span class=\"token operator\">:</span> macHex<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> encryptedBase64<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This function encrypts the cookie value, generates a MAC, and assembles the encrypted cookie payload.</p>\n<p>And here’s the helper function to create the Laravel cookie prefix:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createLaravelCookiePrefix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">cookieName</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> publicKey <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">APP_KEY</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> encoder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TextEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cookieName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">v2</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> encoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>publicKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> cryptoKey <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">importKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'raw'</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token string\">'SHA-1'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'sign'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> signature <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> crypto<span class=\"token punctuation\">.</span>subtle<span class=\"token punctuation\">.</span><span class=\"token function\">sign</span><span class=\"token punctuation\">(</span><span class=\"token string\">'HMAC'</span><span class=\"token punctuation\">,</span> cryptoKey<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> hexSignature <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>signature<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>hexSignature<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">|</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>These functions ensure that cookies encrypted in Next.js can be decrypted by Laravel, allowing for seamless cross-framework integration.</p>\n<h2 id=\"challenges-and-security-considerations\" style=\"position:relative;\"><a href=\"#challenges-and-security-considerations\" aria-label=\"challenges and security considerations permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Challenges and security considerations</h2>\n<p>Of course, this process wasn’t without its hurdles:</p>\n<ul>\n<li><strong>Cryptographic compatibility</strong>: Matching Laravel’s encryption in Node.js requires careful handling of encoding, data types, and cryptographic functions.</li>\n<li><strong>Environment constraints</strong>: We had to ensure that these functions only run on the server side, as they rely on server-side environment variables and cryptography APIs.</li>\n<li><strong>Security considerations</strong>: We took extra care to ensure that the <code class=\"language-text\">APP_KEY</code> remains secure and never exposed to the client side. Error handling, MAC verification, and ensuring the IV is unique for each encryption were key to preventing security vulnerabilities.</li>\n<li><strong>Testing and debugging</strong>: Verifying that our encryption and decryption matched Laravel’s required a lot of trial and error, and a deep understanding of both frameworks.</li>\n<li><strong>Deciding which cookies to encrypt</strong>: Not all cookies needed encryption, so we carefully selected only the ones that handle sensitive data.</li>\n</ul>\n<p>It’s also worth noting that this solution is specific to our use case and may not be suitable for all scenarios. It’s essential to understand the security implications of replicating encryption mechanisms and ensure that your implementation is secure and compliant with best practices.</p>\n<h2 id=\"the-payoff-a-seamless-user-experience\" style=\"position:relative;\"><a href=\"#the-payoff-a-seamless-user-experience\" aria-label=\"the payoff a seamless user experience permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The payoff: A seamless user experience</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9ADcgLDslMUArOEA3RUhdcniitnKZrD1FVzgtPDUiMTEXJjsnM0AyP0Y/S0NJWUNQYT88SkU2QkQwOz0lMgA+JzRBLTpDPkxObIKEuc2isrGXrLJdh6I8T2NAR1g6NEM/PEpETFxMZHdrmbCHvtRnkalNW2xMQUxCLzoAPy06RTxIS2F0V3WLdIyZqrq3u8W1sLCOV2lzSm6IP0xdQldqTW2DZZCokMDSeIyQgJ6pYYeeT1ZkUVppAEE0QURFU1d7kVxwhDEcK2NXVZ2GZIJpU2h/ik53lGCIn22fuWSOpm6NoYCVmyoiH0dGRIiuvG+dtGiVrQBCPElFUGFZfZRecIM9PFBKQ0xtXVtkYGeFmZiIr7trmrNTdY5ka26glna10cijv8SNp6x4g4iCp7ZcZnMAPjtJRFdpRlVqMh0uMR8vU0pMgo2NjbbCi5WMiIRvPF96NEtlWVlcpb64qdzquuHerrGVRS0xUj9EPicyADw5SD1IWTtPZEhJVXaAgqbNzanPzJWimHyPkENddEpZZH+LhZC5xIe2xIOYml1aXV9SSTwkLT4sOkQwPAAxHitDQ09xkJuQwM6Wx9ODk5NvdXVZbX5OZHiFkoiuxbanwbysv6+KhnZ6ipBZdIksK0Q2ITFGOEVBLToAUl1sgq27fqm5cYuXXmBnXGh1UWR2aXFyk6Wfqs/MosG8gHVjeHd0aYibYIqjUG2CPDxONSAuPCo4OiU0AGySpllrek9TX09VZVFcblhganV8fJe+xIy4xHBycHFrZGyDkWmTq1Z4jk1qgURXazUxQjEYKDchMDUeLQBGRFRHRVVTYXI5NUdHVGVzlqZqkaZXa31LSFNdbHlcdYpUcIRJYHVIW3BBUGQ7P1E0JzcsECEwFiYuEiHJohHl9BsUMQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Fully integrated\"\n        title=\"Fully integrated\"\n        src=\"/static/b78488b37ae488bb5c43e5ec64293b2c/42a19/fully-integrated.png\"\n        srcset=\"/static/b78488b37ae488bb5c43e5ec64293b2c/e3135/fully-integrated.png 256w,\n/static/b78488b37ae488bb5c43e5ec64293b2c/06341/fully-integrated.png 512w,\n/static/b78488b37ae488bb5c43e5ec64293b2c/42a19/fully-integrated.png 1024w,\n/static/b78488b37ae488bb5c43e5ec64293b2c/e8464/fully-integrated.png 1536w,\n/static/b78488b37ae488bb5c43e5ec64293b2c/445c6/fully-integrated.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Fully integrated</figcaption>\n  </figure></p>\n<p>By replicating Laravel’s encryption mechanisms in Next.js, we achieved a seamless user experience. Users can navigate between Laravel and Next.js pages without any hiccups, and their session data remains consistent throughout. Honestly, it’s quite impressive how seamlessly the whole flow works without users even noticing the transition between the two frameworks.</p>\n<p>This solution also opens up new possibilities for integrating other platforms with Laravel, as long as they can replicate Laravel’s encryption process. It’s a testament to the power of understanding and adapting complex systems to achieve interoperability.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p><img src=\"/1f382bda4eb7e36eb31460d035a5a8d3/cookie-crumbles.gif\" alt=\"That&#x27;s the way the cookie crumbles\"></p>\n<p>Integrating cookies between two different frameworks and programming languages isn’t exactly a walk in the park - unless the park is Central Park, and you’re <a href=\"https://www.youtube.com/watch?v=vm-471akcQU\" target=\"_blank\" rel=\"noreferrer\">John Wick right after being excommunicado</a>. But with a deep dive into how each framework handles encryption and a fair bit of perseverance (and maybe some <a href=\"https://en.wikipedia.org/wiki/Mate_(drink)\" target=\"_blank\" rel=\"noreferrer\">mate</a>), it’s definitely doable.</p>\n<p>I hope this explanation sheds some light on how to tackle such a challenge. If you find this kind of problem-solving exciting, maybe you’d like to join us. We’re always on the lookout for talented individuals - check out our <a href=\"https://jobs.studocu.com/job-postings\" target=\"_blank\" rel=\"noreferrer\">job openings</a>. I know I might have made it sound like a nightmare, but trust me, it’s the fun kind!</p>\n<p>Happy coding!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTEwLTI1VDAwOjAwOjAwLjAwMFo=","slug":"/2024/2024-10-25-sharing-encrypted-laravel-cookies-with-next-js.en/","path":"/blog/coding/sharing-encrypted-laravel-cookies-with-next-js/","locale":"en"},"rawMarkdownBody":"I often have friends asking me, \"Pablo, how do you manage to stay so calm and collected in the face of complex technical challenges?\" Well, the truth is, I don't. I just write blog posts about them to make it seem like I do. This is one of those stories.\r\n\r\nI recently found myself needing to crack open the values of cookies coming from a Laravel application, read them, update them, and then patch them back up in a way the Laravel application wouldn't even notice. Sounds like the plot of a Mission Impossible movie, right? Let's roll with that, and I'm Tom Cruise.\r\n\r\n## The infamous Next.js migration\r\nAfter migrating from [CoffeeScript to ES6](https://medium.com/studocu-techblog/migrating-from-coffeescript-to-javascript-es6-ed73bcae851e) and then from [ES6 to TypeScript](https://medium.com/studocu-techblog/how-we-migrated-our-codebase-to-typescript-c7962f1b877a), it was time for another major refactor: [detaching our frontend from Laravel into a separate Next.js app](https://medium.com/studocu-techblog/migrating-from-a-monolith-to-next-js-at-studocu-part-1-4b0baf3d5fe9).\r\n\r\nIn order to improve performance, developer experience, and employer desirability (shameless plug, we're hiring at [Studocu](https://jobs.studocu.com/job-postings) *wink-wink*), we needed a robust frontend framework that could handle our growing user base and feature set. Next.js seemed like the perfect fit.\r\n\r\nThis theoretically would help us stop reinventing the wheel - like writing endless lines of Webpack configurations - and focus on what really matters: building features that our users love. So the plan is that instead of having one spaghetti codebase, we would have two smaller, noodle-like codebases.\r\n\r\n![Spaghetti code](../../uploads/blog/2024/10/spaghetti-code.png)\r\n\r\n## But why?\r\nAs [one-time Grammy-nominated Ryan Reynolds](https://www.grammy.com/artists/ryan-reynolds/243495) once said: But why?\r\n\r\n![Actual footage of readers of this post](../../uploads/blog/2024/10/but-why.gif)\r\n\r\nGood question! Here's the thing: we decided that the best way to implement this transition to Next.js was to move one page at a time. This means we would have to share cookies between the Laravel and Next.js applications. While this brings lots of benefits, it also presents some unique challenges.\r\n\r\nThe biggest challenge is that Laravel and Next.js don’t exactly speak the same language when it comes to cookie encryption. Laravel uses its own encryption algorithm and, by default, encrypts every cookie using a private key. Without this key, and without reverse-engineering Laravel’s algorithm, it’s impossible to read the data on the Next.js side.\r\n\r\nOn the other hand, Next.js is quite unopinionated about how you store your cookies. Since we were spinning up a new Next.js application from scratch, this was a perfect opportunity to align it with Laravel’s encryption method, allowing us to freely decrypt and encrypt Laravel’s cookies directly in Next.js without risking breaking anything.\r\n\r\n## Diving into Laravel's cookie encryption\r\nBefore we could solve this problem, we needed to understand how Laravel encrypts its cookies. Turns out, there isn't a whole lot of information out there about this. In an age where it's hard to find something unique to write a blog post about, I thought this would be the perfect opportunity to share some insights.\r\n\r\nSo, how do we figure out how Laravel encrypts its cookies? By diving into [the source code](https://github.com/laravel/laravel), of course! Fortunately, Laravel’s source code is quite readable and well-organized, so it didn't take long to track down the relevant parts.\r\n\r\n### Application Key\r\nLaravel uses a private key, known as the Application Key, for encryption, which can be generated using the `php artisan key:generate` command. It employs a `AES-256-CBC` cipher for encryption, which requires an Initialization Vector (IV). Additionally, Laravel uses a Message Authentication Code (MAC) to ensure the integrity of the encrypted data.\r\n\r\n### Initialization Vector\r\nThe IV is a random value that's used to ensure that the same plaintext doesn't encrypt to the same ciphertext. Laravel generates a random IV for each cookie and stores it alongside the encrypted value.\r\n\r\n### Message Authentication Code\r\nThe MAC is a cryptographic checksum that ensures the integrity of the encrypted data. Laravel generates a MAC using the IV and the encrypted value, which is then used to verify the integrity of the data during decryption.\r\n\r\n### Flow chart\r\n![Encryption flow](../../uploads/blog/2024/10/encryption-flow.png)\r\n\r\nAll of this might change depending on your version of Laravel or how much you've customized your encryption settings. You can check your `config/app.php` file to see how your encryption settings are configured.\r\n\r\nHere's a simplified breakdown of the process:\r\n\r\n1. **Cookie Value**: The cookie value is stringified and then [prefixed](https://github.com/illuminate/cookie/blob/v9.52.16/Middleware/EncryptCookies.php#L180) with [a `SHA-1` hash](https://github.com/illuminate/cookie/blob/v9.52.16/CookieValuePrefix.php#L14) based on the cookie name and a version string (`\"v2\"`).\r\n2. **Encryption**: The prefixed value is [encrypted using `AES-256-CBC`](https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L102).\r\n3. **MAC Generation**: A MAC is [generated using `HMAC-SHA256`](https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L116) over the IV and the encrypted value.\r\n4. **Payload Assembly**: The encrypted value, IV, MAC, and a tag are [assembled into a JSON object](https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L118).\r\n5. **Base64 Encoding**: This JSON object is [then base64-encoded](https://github.com/illuminate/encryption/blob/v9.52.16/Encrypter.php#L124) to form the final cookie value.\r\n\r\nAn example of the encrypted cookie structure looks like this:\r\n\r\n```json\r\n{\r\n  \"value\": \"encryptedValue\",\r\n  \"iv\": \"base64-encoded-IV\",\r\n  \"mac\": \"hex-encoded-MAC\",\r\n  \"tag\": \"base64-encoded-tag\"\r\n}\r\n```\r\n\r\nUnderstanding this structure was crucial for replicating the encryption and decryption processes in Next.js.\r\n\r\n## Recreating Laravel's encryption in Next.js\r\n\r\nTo read and update Laravel's encrypted cookies in Next.js, we needed to replicate Laravel's encryption logic in our Next.js application. Here's how we tackled it.\r\n\r\n![Same cookies](../../uploads/blog/2024/10/same-cookies.png)\r\n\r\n### Decrypting cookies\r\nWe created a function `decryptCookieValue` that mirrors Laravel's decryption process. Here's a simplified version:\r\n\r\n```javascript\r\nexport const decryptCookieValue = async (encryptedCookieValue) => {\r\n  const publicKey = process.env.APP_KEY;\r\n  const encoder = new TextEncoder();\r\n  const decoder = new TextDecoder();\r\n\r\n  // Decode and parse the cookie\r\n  const decodedResult = Buffer.from(encryptedCookieValue, 'base64').toString('utf-8');\r\n  const parsedResult = JSON.parse(decodedResult);\r\n\r\n  const { iv, mac, value } = parsedResult;\r\n\r\n  // Verify the MAC\r\n  const macPayload = iv + value;\r\n  const keyMaterial = encoder.encode(publicKey);\r\n  const hmacKey = await crypto.subtle.importKey('raw', keyMaterial, { name: 'HMAC', hash: 'SHA-256' }, false, ['verify']);\r\n  const isMacValid = await crypto.subtle.verify('HMAC', hmacKey, Buffer.from(mac, 'hex'), encoder.encode(macPayload));\r\n\r\n  if (!isMacValid) {\r\n    throw new Error('MAC validation failed');\r\n  }\r\n\r\n  // Decrypt the value\r\n  const ivArray = Buffer.from(iv, 'base64');\r\n  const encryptedData = Buffer.from(value, 'base64');\r\n  const cryptoKey = await crypto.subtle.importKey('raw', keyMaterial, { name: 'AES-CBC' }, false, ['decrypt']);\r\n  const decryptedData = await crypto.subtle.decrypt({ name: 'AES-CBC', iv: ivArray }, cryptoKey, encryptedData);\r\n\r\n  const decryptedString = decoder.decode(decryptedData);\r\n\r\n  // Remove Laravel's cookie prefix\r\n  return decryptedString.slice(41);\r\n};\r\n```\r\n\r\nThis function decrypts the cookie value, verifies the MAC, and returns the decrypted string. We also had to remove Laravel's cookie prefix with a `slice` - pretty much how it's done in the [original code](https://github.com/illuminate/cookie/blob/v9.52.16/CookieValuePrefix.php#L27) - to get the original cookie value.\r\n\r\n### Encrypting cookies\r\nWe also needed to encrypt cookies in Next.js so that Laravel could understand. Here's the `encryptCookieValue` function:\r\n\r\n```javascript\r\nexport const encryptCookieValue = async (cookieName, value) => {\r\n  const publicKey = process.env.APP_KEY;\r\n  const encoder = new TextEncoder();\r\n\r\n  // Create the Laravel cookie prefix\r\n  const cookiePrefix = await createLaravelCookiePrefix(cookieName);\r\n  const prefixedValue = cookiePrefix + value;\r\n\r\n  // Generate a random IV\r\n  const iv = crypto.getRandomValues(new Uint8Array(16));\r\n  const keyMaterial = encoder.encode(publicKey);\r\n\r\n  // Encrypt the value\r\n  const cryptoKey = await crypto.subtle.importKey('raw', keyMaterial, { name: 'AES-CBC' }, false, ['encrypt']);\r\n  const encryptedData = await crypto.subtle.encrypt({ name: 'AES-CBC', iv }, cryptoKey, encoder.encode(prefixedValue));\r\n\r\n  // Generate the MAC\r\n  const encryptedBase64 = Buffer.from(encryptedData).toString('base64');\r\n  const ivBase64 = Buffer.from(iv).toString('base64');\r\n  const macPayload = ivBase64 + encryptedBase64;\r\n  const hmacKey = await crypto.subtle.importKey('raw', keyMaterial, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']);\r\n  const macData = await crypto.subtle.sign('HMAC', hmacKey, encoder.encode(macPayload));\r\n  const macHex = Buffer.from(macData).toString('hex');\r\n\r\n  // Assemble the payload\r\n  return Buffer.from(\r\n    JSON.stringify({\r\n      iv: ivBase64,\r\n      mac: macHex,\r\n      tag: '',\r\n      value: encryptedBase64,\r\n    })\r\n  ).toString('base64');\r\n};\r\n```\r\n\r\nThis function encrypts the cookie value, generates a MAC, and assembles the encrypted cookie payload.\r\n\r\nAnd here's the helper function to create the Laravel cookie prefix:\r\n\r\n```javascript\r\nconst createLaravelCookiePrefix = async (cookieName) => {\r\n  const publicKey = process.env.APP_KEY;\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(`${cookieName}v2`);\r\n  const key = encoder.encode(publicKey);\r\n\r\n  const cryptoKey = await crypto.subtle.importKey('raw', key, { name: 'HMAC', hash: 'SHA-1' }, false, ['sign']);\r\n  const signature = await crypto.subtle.sign('HMAC', cryptoKey, data);\r\n  const hexSignature = Buffer.from(signature).toString('hex');\r\n\r\n  return `${hexSignature}|`;\r\n};\r\n```\r\n\r\nThese functions ensure that cookies encrypted in Next.js can be decrypted by Laravel, allowing for seamless cross-framework integration.\r\n\r\n## Challenges and security considerations\r\nOf course, this process wasn't without its hurdles:\r\n\r\n- **Cryptographic compatibility**: Matching Laravel's encryption in Node.js requires careful handling of encoding, data types, and cryptographic functions.\r\n- **Environment constraints**: We had to ensure that these functions only run on the server side, as they rely on server-side environment variables and cryptography APIs.\r\n- **Security considerations**: We took extra care to ensure that the `APP_KEY` remains secure and never exposed to the client side. Error handling, MAC verification, and ensuring the IV is unique for each encryption were key to preventing security vulnerabilities.\r\n- **Testing and debugging**: Verifying that our encryption and decryption matched Laravel's required a lot of trial and error, and a deep understanding of both frameworks.\r\n- **Deciding which cookies to encrypt**: Not all cookies needed encryption, so we carefully selected only the ones that handle sensitive data.\r\n\r\nIt's also worth noting that this solution is specific to our use case and may not be suitable for all scenarios. It's essential to understand the security implications of replicating encryption mechanisms and ensure that your implementation is secure and compliant with best practices.\r\n\r\n## The payoff: A seamless user experience\r\n\r\n![Fully integrated](../../uploads/blog/2024/10/fully-integrated.png)\r\n\r\nBy replicating Laravel's encryption mechanisms in Next.js, we achieved a seamless user experience. Users can navigate between Laravel and Next.js pages without any hiccups, and their session data remains consistent throughout. Honestly, it's quite impressive how seamlessly the whole flow works without users even noticing the transition between the two frameworks.\r\n\r\nThis solution also opens up new possibilities for integrating other platforms with Laravel, as long as they can replicate Laravel's encryption process. It's a testament to the power of understanding and adapting complex systems to achieve interoperability.\r\n\r\n## Conclusion\r\n![That's the way the cookie crumbles](../../uploads/blog/2024/10/cookie-crumbles.gif)\r\n\r\nIntegrating cookies between two different frameworks and programming languages isn't exactly a walk in the park - unless the park is Central Park, and you're [John Wick right after being excommunicado](https://www.youtube.com/watch?v=vm-471akcQU). But with a deep dive into how each framework handles encryption and a fair bit of perseverance (and maybe some [mate](https://en.wikipedia.org/wiki/Mate_(drink))), it's definitely doable.\r\n\r\nI hope this explanation sheds some light on how to tackle such a challenge. If you find this kind of problem-solving exciting, maybe you'd like to join us. We're always on the lookout for talented individuals - check out our [job openings](https://jobs.studocu.com/job-postings). I know I might have made it sound like a nightmare, but trust me, it's the fun kind!\r\n\r\nHappy coding!\r\n","frontmatter":{"tags":["laravel","next.js","cookies","encryption","synchronization","web development","php","javascript"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2024-10-25T00:00:00.000Z","id":null,"path":"sharing-encrypted-laravel-cookies-with-next-js","show":true,"title":"Sharing encrypted Laravel cookies with Next.js","hideExcerpt":false,"subtitle":"Bridging Laravel and Next.js: How we synchronized encrypted cookies between two different frameworks."}}},{"node":{"excerpt":"Eu constantemente tenho aquela sensação de ”Você se torna…","html":"<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9ANp6W958WuB+XeaMatedgt6hgeR6Vd97WLqMfo6RmNuaeeeZc+WEXbiGdueGXeyEW+WBW++HW+N9Wdt3VwDkeFLreFCbdHFxdYGLhoZudoG4mIjj1729zMKZtrzT2MXP0L/Y1cDCs6OognyigHuwgnaZh4vtkGbji2cAv4d5yo97Y2FzKz1geGNoN0NqaH6WfIKHZYGXZ4ifVmh8V2+FQFx5jIqJnJ6fimxwpHVueGFt7ZJo6ZFqAMCVhMCZiJ5uZH5ZWoSBiX2GmX6Cj1hOWE1Zdjteh0NBV11ZZyMlQ2FYYfm6kOetied/Vt2Na+aGXuh+VQDvf1LMk3vPj3XxjGDJtKLJ1caljoNXV2lCV3hTVmtCR2FIUWwnLUppbXfew6npwqDTn4WvnpbniWDphV0A6IRc2o5ts5eM4Jl30b6m4eLIm5WQSE9vYX2UaHSEPFF/VX2qY564aYqfw7Oo5cKisb68xZF83ZBu54dfAOuEWsCairCgmoeEk2V+paqvsaaqppaEhYCNoYiXqmZkgICHmEhgg5mVleDLscfLvZCgsKualMiVgOuAVgDsgFSropyiuLyDeIAgNmWSh47ux6fHnIZ5b4doWXCxe2zSrZaZfHfFn4etwcNHfLlkhbKgm6DQiW7ufU8A5oJanp+j5HpU8HxRcWp0c6e8t8O+l5qYqIJ2dlxfvXhe7s6rwbqndJutgZytgoGTdH6SlqaqfMXcl7K4AJuwtWCPu2ViiYVeaHyHoIGNn3Kcs2CVsH2vwa2imtGmkLmFdqOWk1WOu2djeaBuY2tha4FXXHe82HHL6QByyuZvu9tZmsZajK5knMJrkq9tpMRmpcZeocVtnLiBssiHqbt+r8hgncRrka1umLNxm7VolrVyvt16xt6H9XdtMXZTwwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ilustração do Musclog\"\n        title=\"Ilustração do Musclog\"\n        src=\"/static/e09791c79da43db20131c45d78322136/42a19/musclog-illustration.png\"\n        srcset=\"/static/e09791c79da43db20131c45d78322136/e3135/musclog-illustration.png 256w,\n/static/e09791c79da43db20131c45d78322136/06341/musclog-illustration.png 512w,\n/static/e09791c79da43db20131c45d78322136/42a19/musclog-illustration.png 1024w,\n/static/e09791c79da43db20131c45d78322136/e8464/musclog-illustration.png 1536w,\n/static/e09791c79da43db20131c45d78322136/445c6/musclog-illustration.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Ilustração do Musclog</figcaption>\n  </figure></p>\n<p>Eu constantemente tenho aquela sensação de ”<a href=\"https://youtu.be/CqQRDZP3FnQ?si=gAuQhD_7PHF8PAv5&#x26;t=178\" target=\"_blank\" rel=\"noreferrer\">Você se torna aquilo que jurou destruir</a>” devido ao tempo que tenho dedicado ao bodybuilding nos últimos dois anos. Tenho acompanhado meus macros, meus treinos e até tirado fotos de “brogress”.</p>\n<p>Não que eu tivesse algo contra o bodybuilding no passado, mas já tentei malhar antes e nunca realmente me envolvi. Sempre senti que eu era um skatista de coração e que estava traindo meu verdadeiro eu levantando pesos. Eu sei, bobo.</p>\n<p>Enfim, tenho usado uma combinação de aplicativos e integrações para monitorar meu desempenho, incluindo um <a href=\"/pt-br/blog/coding/usando-google-fitness-api-para-calcular-meu-tdee-e-mais/\">script Node.js personalizado para calcular meu TDEE e calorias médias</a> usando a <a href=\"https://developers.google.com/fit\" target=\"_blank\" rel=\"noreferrer\">Google Fit API</a>, mas como o Google Fit será descontinuado em breve em favor do novo Health Connect, não pude adiar mais o desenvolvimento do meu próprio aplicativo. Afinal, eu <strong>“sai de casa e comi pra caralho!”</strong>, então agora vai!</p>\n<p>Mas como? Eu honestamente não tinha ideia de por onde começar, especialmente ao explorar integrações com a API de outro aplicativo. Eu nem sabia em qual formato esses dados estariam disponíveis. Qual é o padrão do mercado? JSON? XML? Binário? Eu não tinha ideia. Felizmente, descobri que algumas pessoas realmente inteligentes criaram <a href=\"https://github.com/matinzd/react-native-health-connect/\" target=\"_blank\" rel=\"noreferrer\">uma biblioteca para integrar a API do Health Connect com React Native</a>, e saber disso foi o ponto de virada para eu começar a desenvolver meu próprio aplicativo.</p>\n<h2 id=\"a-solucao-perfeita\" style=\"position:relative;\"><a href=\"#a-solucao-perfeita\" aria-label=\"a solucao perfeita permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A solução perfeita</h2>\n<p>Eu criei todos esses scripts e integrações para monitorar meus treinos e nutrição, porque uma coisa que descobri nesses últimos anos de bodybuilding é que o que realmente me ajuda a ser consistente é monitorar tudo. Eu sou um cara de dados, e se eu puder ver meu progresso nos números, isso me motiva a continuar. Até porque, a verdade é que se você não toma nenhum anabolizante, o progresso é lento, e eu, pelo menos, não vejo nenhuma diferença no espelho, então os números são tudo o que eu tenho.</p>\n<p>Eu já faço o rastreamento de tudo que como há dois anos, e também me peso com uma balança que mede meu percentual de gordura, então tenho muitos dados para analisar e identificar meus padrões de alimentação e treino. O que eu quero é algo que realmente é difícil de encontrar, porque a maioria dos apps ou sites que existem por aí não espera que alguém seja tão meticuloso a ponto de rastrear tudo todos os dias de forma obsessiva, mas eu amo fazer isso.</p>\n<p>Então, a primeira ideia era simplesmente obter os dados e continuar meus cálculos com meus scripts, e assim nasceu a ideia do meu primeiro MVP.</p>\n<h2 id=\"o-mvp\" style=\"position:relative;\"><a href=\"#o-mvp\" aria-label=\"o mvp permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O MVP</h2>\n<p>Como eu disse, tudo o que eu queria era acessar os dados do Health Connect e obter meus dados de nutrição e peso, para que eu pudesse continuar executando meu script Node.js, mesmo que eu tivesse que ter um aplicativo simples que obtivesse os dados em segundo plano e os enviasse para o meu servidor. Parece um plano, certo?</p>\n<p>Bem… parece que o Health Connect só permite que os desenvolvedores acessem <a href=\"https://developer.android.com/health-and-fitness/guides/health-connect/develop/frequently-asked-questions#time-range\" target=\"_blank\" rel=\"noreferrer\">dados dos últimos 30 dias devido a preocupações com a privacidade</a>. Ok… então isso significa que não posso obter meus dados históricos, e tudo o que está no Google Fit será perdido para sempre. Incrível!</p>\n<h2 id=\"o-verdadeiro-mvp\" style=\"position:relative;\"><a href=\"#o-verdadeiro-mvp\" aria-label=\"o verdadeiro mvp permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O <em>Verdadeiro</em> MVP</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAADoElEQVQ4y12U22/iRhTGHcDg+w1jjMEEaAIkKxJIuCQN6WartFWlvqzah3Zf+tqX/ssRhGS7AWMbe2xjz9iuyGUr9ad5mPNJ3+jMfEeDJUmSPpMkqWUGzmb7vN+JEMLz/lim2X67QxMiiTNnTW161JQYgSPYuixjX82+D5dLsHxywxC9KDGE49F31aI66LQlSvixod129avjFokzuT1C4YSd2QNb1/E8L1p+cVdLEPjQtnZHxDC6mf7QVLXx0WFLVn7v7n86P7h+13hXU0/q6qilYRDGyyewfHICH66W3trwfB8+PlgbO0QQ/np7c1QWrrr6ca18LEsdVb44rA5blUGjclpXsfSVBEJorDxzDeIYvdwlidHF2ahM091aNYuR+SyNZygyRxeyVAYryDSHhc9EUWSZ3v3cuJ8brhu8aNvAH52OahIxHVRkgdJKdLlIaQrZ0hmZY6uChDlvmObGXG9MY7NaWrvadW3LvDifKDzbaWgsSZcYtl4SVInnKFqguJoofm37lTCKjRVAME7TFEF4fTFVOHFfrWqM8FunflXXKqLMF1iBZCsc/585jlEUhb4PDQO4rr/LOYp+vpnqIt2ulntK6c9e64+T1r4k6oJY44Wa8Gb2vXC9dhFKttt4tQyDIEQIxTG6Gg0lAtflIofTPzW124NaieXIHEnkKJXl3sx+ZJlBkqS+j1YruN3C3ZvH6HI4FAhcLyk5jOLyLI0zFM4QWZrE6V3bSZIglDgb3zJd34+SJLFMYK4dCBGC0fVkUqSJhspLbEHmKYmlijwh8yRTYHVRwGzLXhubxS6k1efPa8tyHu6N+9nKXDtrwxj1z3ii0G2ouibJIlWR6eOmpBbZIs329BKWJHGa+s8riKIAITdN/STZlQiGw8GlQAmn7U4+J3zDF8eV8qTdYgpcBsvn9ggsTSMA5hDOwnBm2wsIZzC6A+BuGywQ9L4dv1cEZdA5rAryx079r2H7+25jv1yqF6VmqYiFoWlZiyB4cp0vtv0IwJNt/wPchW0/OpuHXz68P1CkSbd+Uq9OtfLf4+6nUbvf0k4blZ6uYAAsgDvb2HPXmTvOHIAHx7nf2DMA5pZ5d3E2EAtEr1HNYPkDXvzY2e/XNSpPZbA8niEwhABCLoReFAEYeRC6wJ2FoRWF9saajfsDDid6zXp2L0/mSTpPE7uQSSJLEjni/+P5PGrx608ShZfDiUgxh5pG4gVdJXWV1BSSxAkyR7EF5l8xwV6kEeY6GQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Perfeição\"\n        title=\"Perfeição\"\n        src=\"/static/c03a23e83744cf5f92d6e94b6426ecd8/42a19/musclog-mvp-perfection.png\"\n        srcset=\"/static/c03a23e83744cf5f92d6e94b6426ecd8/e3135/musclog-mvp-perfection.png 256w,\n/static/c03a23e83744cf5f92d6e94b6426ecd8/06341/musclog-mvp-perfection.png 512w,\n/static/c03a23e83744cf5f92d6e94b6426ecd8/42a19/musclog-mvp-perfection.png 1024w,\n/static/c03a23e83744cf5f92d6e94b6426ecd8/68141/musclog-mvp-perfection.png 1534w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Perfeição</figcaption>\n  </figure></p>\n<p>Legal, então nosso MVP morreu antes de chegar à costa; hora de pivotar: E se, em vez de ter um script Node.js que se conecta a diferentes APIs, eu pudesse ter um aplicativo React Native que fará a maioria das coisas, como rastreamento de treinos, insights de nutrição, cálculo de TDEE, gráficos, dicas, etc., e qualquer outro dado que possa estar faltando, eu obtenho da API do Health Connect? Eu poderia até adicionar uma opção para importar dados passados de um arquivo JSON. Dessa forma, se o Google Fit eventualmente permitir que eu exporte meus dados, posso importá-los para o meu aplicativo.</p>\n<p>Na verdade, já passei de aplicativo em aplicativo no passado, tentando encontrar a melhor maneira de monitorar meus treinos. Até tentei o Google Planilhas, mas a UX era horrível no celular, e eu gostaria de me concentrar no meu treino e não me estressar com tocar a célula errada na planilha.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.890625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACtElEQVQoz2WSS08TYRiF50+4ceOCDQtZAIZoaaRAEUQsCDWUSwiKAgZqwXBpuFuQUhBBEES8cOnMlE6n07l833wz7bSFliqligmGaiJijAti+icMFNHE5CzPk7znnBeTgCspr+gOb/ji8d0PsbfrfmCz2qrrTab2Po7GvaIbCa5T56kwyDmQQAkMsbkh+4NB2ecLRzY5lr+QVZp79VaWSt/VObCucCJP/YshgUK8ExMYO/DgwIMLjH0jIO7sROPxj1MTkxO2+UQisRnZbr3X4UO0JBwBkCUFBgceMunHgIeALAlYAnKkyJECY1cQPTv1dGx0dmWZej63PNA7Ih+dTUmAkoBT5B2QI48QD4FBljwWEfBxoQDaigQ+7cYgFOZe4AuLxJOZJSiv7+3tRMLKdjQUDqKgIsjABVhCYHBM5EjIOSRA+b085BzhDfng+34icVhYWJdf0ZqZVTY9bPn5Y//w1+HWuyDk1hSZ9Yq0yDkQoDAkOCVAIeBUJDYURLFo6OuXXbcYWHzjVKlulOYWme+32obHoZs++Pb5fTTk9/HJaWRIYycFQtqLGCRQLoaxvqR0LY+AErH2Dc52NizMWKhRXdftKoZHsWjYKzIypCVIH031p3qXgmiCsJf3zBd3PSt7MLnsBL3dg+JY0cpEu2TNL9NVXmufZjjeJ9Knm/+FA5LbOvtK3WDRmec0zVbSIzUOLQw1low3FYzcuVJTUZma32ybfx1A/8HHMejG9odpObXF5rk842O9cVhbZy4obzKW5+s1mhljcUebsd406kc0Av/BIk8ZGs3nUjTaJou2ZUxd0519sy2vqNZUou41qPoN2Y7+0vqWHsGzJh8HPoGRQPklZnV1KSOn6uyZ9JSUyxm5tRma6jSV/nyqts9Q1Hxd3a+/dFeTnnlRh+PLipT8Gddvn3/Y5TycJc0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Certo, eu vou fazer isso sozinho\"\n        title=\"Certo, eu vou fazer isso sozinho\"\n        src=\"/static/96bce10dcf9e8d007b3b5a85ede8aaed/42a19/fine-i-will-do-it-myself.png\"\n        srcset=\"/static/96bce10dcf9e8d007b3b5a85ede8aaed/e3135/fine-i-will-do-it-myself.png 256w,\n/static/96bce10dcf9e8d007b3b5a85ede8aaed/06341/fine-i-will-do-it-myself.png 512w,\n/static/96bce10dcf9e8d007b3b5a85ede8aaed/42a19/fine-i-will-do-it-myself.png 1024w,\n/static/96bce10dcf9e8d007b3b5a85ede8aaed/e8464/fine-i-will-do-it-myself.png 1536w,\n/static/96bce10dcf9e8d007b3b5a85ede8aaed/dc8ac/fine-i-will-do-it-myself.png 1572w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Certo, eu vou fazer isso sozinho</figcaption>\n  </figure></p>\n<h2 id=\"entao-react-native-hein\" style=\"position:relative;\"><a href=\"#entao-react-native-hein\" aria-label=\"entao react native hein permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Então, React Native, hein?</h2>\n<p>Claro, eu sabia que o React Native existia, mas como desenvolvedor React.js, nunca considerei realmente mergulhar nele, mas certamente não poderia ser tão difícil, certo? Quer dizer, eu já conhecia o React, então quão diferente poderia ser?</p>\n<p>Bem…</p>\n<p>Acontece que construir um aplicativo React Native quando sua única experiência é com React.js é como tentar mudar de um skate para uma prancha de surfe. Claro, os princípios são um pouco semelhantes—equilíbrio, navegação, manter a calma quando as coisas dão errado, mas o meio é totalmente diferente. Neste caso, o meio envolvia descobrir como lidar com todas as peculiaridades específicas do dispositivo enquanto mantinha o aplicativo funcional e responsivo.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACnklEQVQozzXL3U8SAQAA8PtremvrzSdfXFn5NZdr6rK0B3O5nMwNUaaiIDOUQCKEjI+Tu+OA45tLODhABIQUUDkQLD7vQIaurJYPPdV66Pf+AxgKrlMwQ0F0Bqqe7JTSYPkYrByDDAU18mgprS+ldJW09rps+doijwveMhO4avpKJQ9dwQEmi/zPcCOH/CiZGlm4WTCgOrlkYf7nF309o79u+qhGYoQrXdXoeSrdE9ba8JRgEzMDNIXUcwYmi9AZuHaGnRT3a+eOZh4+JdUyNl/jJy6qOHke7WFLb3VMdzxdahtaut3JahtevtM1A9BZI5MzMTkTTaH0mblXGR8U2S+LmCmAW1KZvs0gKlitxsFkdGdKsn2P8/7RuqGbp3m8gfQKdoAaZaCzKJ01Vim0kUfjhE7AEa2INW/X5Ycpt9ARslp0127JFaFwJxzDGtcUsjsgd7x2fZxUYUAlg9QySI0y1Ci0kvn3r4rmi7TeFfZ2CfHBWVU4YSvmbM0zi/sIZxHRRU/kJUTIyWD/CgQweax+jtF57KJgaRSwMmUqnhpbFee4JtA5Kpx4tUgGjM1WuNaMkJ9jc+QB2+qft/rGFPa7s1rgpuW7aZF/vgWqVV8+j/9i3L8vie+t0Au+tlr2biNIezfbZDMl60l+JM7zBLlWYkDm7OBoR8RmQBHdk8aiLioKp8LYyR5ViURSBB6w94zy5+bFH7bVb3gb0jXVwv6nJW9oGnJ18tGHy9D4O8szmQVwhCBXGMajaOIITh5qj+JaVC7ijHHteh2R8ttzB6LYQb8S71Pg/WLs/qLu+ZaVizpmDS6W1grEgkqPX42ToJsETX4YDNmU8QDP6JlROYdA4oFA37usHpMZeEaHgtjdCvmELpxjdE5soe2Tkr+lvLqPYoqGewAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Surfando com um skate\"\n        title=\"Surfando com um skate\"\n        src=\"/static/052058d9f01be0cb6aab7b65270e7f9e/42a19/surfing-with-skateboard.png\"\n        srcset=\"/static/052058d9f01be0cb6aab7b65270e7f9e/e3135/surfing-with-skateboard.png 256w,\n/static/052058d9f01be0cb6aab7b65270e7f9e/06341/surfing-with-skateboard.png 512w,\n/static/052058d9f01be0cb6aab7b65270e7f9e/42a19/surfing-with-skateboard.png 1024w,\n/static/052058d9f01be0cb6aab7b65270e7f9e/e8464/surfing-with-skateboard.png 1536w,\n/static/052058d9f01be0cb6aab7b65270e7f9e/445c6/surfing-with-skateboard.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Surfando com um skate</figcaption>\n  </figure></p>\n<p>Por exemplo, como desenvolvedor web, eu foco em manter um estado local no cliente e obter dados do servidor quando necessário, mas no React Native, quero ter um banco de dados local, como devo fazer isso? Bem, descobri o <a href=\"https://react-native-async-storage.github.io/async-storage/\" target=\"_blank\" rel=\"noreferrer\">AsyncStorage</a>, então por que não usá-lo por enquanto? (isso vai me morder mais tarde)</p>\n<p>Ainda assim, eu não tinha ideia de onde começar, mas após conversar com meus amigos <a href=\"https://barreto.jp/\" target=\"_blank\" rel=\"noreferrer\">Juampi</a> e <a href=\"https://www.pato.dev/\" target=\"_blank\" rel=\"noreferrer\">Raf</a> sobre minha ideia, eles sugeriram que eu usasse o <a href=\"https://expo.dev/\" target=\"_blank\" rel=\"noreferrer\">Expo</a>, um framework que permite construir aplicativos React Native sem ter que lidar com a parte nativa das coisas. Isso foi honestamente um divisor de águas para mim porque eu poderia simplesmente executar meu aplicativo no navegador a maior parte do tempo e usar meu telefone apenas para testar os recursos que exigem código nativo.</p>\n<h2 id=\"explorando-o-expo\" style=\"position:relative;\"><a href=\"#explorando-o-expo\" aria-label=\"explorando o expo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Explorando o Expo</h2>\n<p>Comecei criando um novo projeto Expo seguindo o tutorial ”<a href=\"https://docs.expo.dev/tutorial/create-your-first-app/\" target=\"_blank\" rel=\"noreferrer\">Crie seu primeiro aplicativo</a>”, e então criei uma nova tela com um botão simples que se conectaria à API do Health Connect e obteria meus dados de nutrição, e lá estava eu, já tinha meu primeiro MVP feito, mas como eu não gosto muito de testar no meu telefone, copiei basicamente a resposta JSON da API e a salvei em um arquivo, para que eu pudesse continuar desenvolvendo apenas no meu computador e navegador—isso vai me morder mais tarde².</p>\n<p>Depois de brincar com o Expo por um fim de semana, tive uma ideia vaga do que eu precisava para o meu aplicativo:</p>\n<ul>\n<li><a href=\"https://react-native-async-storage.github.io/async-storage/\" target=\"_blank\" rel=\"noreferrer\">AsyncStorage</a> para armazenamento</li>\n<li><a href=\"https://reactnativepaper.com/\" target=\"_blank\" rel=\"noreferrer\">react-native-paper</a> para a interface do usuário</li>\n<li><a href=\"https://www.i18next.com/\" target=\"_blank\" rel=\"noreferrer\">i18next</a> para traduções</li>\n<li><a href=\"https://github.com/wuxudong/react-native-charts-wrapper\" target=\"_blank\" rel=\"noreferrer\">react-native-charts-wrapper</a> para mostrar gráficos</li>\n<li><a href=\"https://github.com/Shopify/flash-list\" target=\"_blank\" rel=\"noreferrer\">@shopify/flash-list</a> para renderizar listas (basicamente só por causa <a href=\"https://www.youtube.com/watch?v=BrYxGrE9sW8\" target=\"_blank\" rel=\"noreferrer\">desta palestra</a> eu fui convencido)</li>\n</ul>\n<p>Hora de colocar as mãos calejadas para trabalhar!</p>\n<h2 id=\"a-alegria-e-dor-de-aprender-na-pratica\" style=\"position:relative;\"><a href=\"#a-alegria-e-dor-de-aprender-na-pratica\" aria-label=\"a alegria e dor de aprender na pratica permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A alegria (e dor) de aprender na prática</h2>\n<p>Conforme eu me aprofundava no mundo do React Native, percebi rapidamente que minha caixa de ferramentas confiável do universo React.js, bem, não era totalmente adequada para o trabalho. Para começar, meu esquema de banco de dados era muito complexo para o AsyncStorage, então, pensei, por que não mudar para IndexedDB? Spoiler: IndexedDB só funciona na web, não na versão móvel do aplicativo Expo. Oops.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACW0lEQVQozyXLa0/aUACA4f7QZfu2LNmSZTPuoskucU5FAbkWZ6EtFgqlpYXSc3o9bS2lLRYrlwFOPy2Zbv9iMSbPpzd5sbJo4aJVEswMC9MszLbUDAtTjJJqKEdNkGbBYUN5lGmpR02QbWtl0XqElbpmsWsWOtpBuVGkxVNOpQRdMn1RHxIcrLRAvW91gNtRvSoHC6SwV2kdcxouoYeZkN2WFWn+hXkeWI5XZYTFej2KZ1Ey1yyXk5Tpcj1wouBqqajIcn1Rcw8ZpfI4F7tOmrN3KSDp3kWSAB2tbm+AO1ZQYDgjESA0mgzs0I6ScTK1/AumZxUF84fsViSE7TeN7Sp8WxBwRu4A1wljO4i5ARqYfp2Hp82+6oSi6mpOoDrBeZSwfWuflGkYsFaMUTAgBv5OTaYFtY/Cy/nq95+7UZyUaXEr2/iYbeTJbk91Hvrd/f2/v8AJU5RMKkNaDbADBuzSyociz0NHRgHR0diBDe1ARaMCM/iGcyJ0gR3qbihqXs/wzySjJKCaMix3EbaFC6++117sEPWuHi+WTjzj0Xi+XKPRZONz7vnG3nAy6xuejHxO80Q7avbRlxL3Zp8sdgxsmwBP3uefbaZ59Xw8X4WzpRPPV9fX46tFqniWytPBZHr5cxUl88Wv2+n6BrrRy68nTzczOc7E3p3IhwwQVHsXb5eaymlHqwoGJaEqr7/+VNjcwY9JkezZBK8TvJEhxQNCOBEMyfD2ziBWVXwa+KI7ybX1koDwrlPXIkoL8239oCalqH6ehXU9omBQg6Nc28i1tJrsie6kqvj/Ady2xoYddCZ4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Vida de desenvolvedor solo\"\n        title=\"Vida de desenvolvedor solo\"\n        src=\"/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/42a19/life-of-solo-developer.png\"\n        srcset=\"/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/e3135/life-of-solo-developer.png 256w,\n/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/06341/life-of-solo-developer.png 512w,\n/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/42a19/life-of-solo-developer.png 1024w,\n/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/e8464/life-of-solo-developer.png 1536w,\n/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/445c6/life-of-solo-developer.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Vida de desenvolvedor solo</figcaption>\n  </figure></p>\n<p>Depois de algumas horas perdidas tentando implementar um polyfill para IndexedDB no React Native, simplesmente desisti e me vi no meio de uma grande refatoração. Decidi mudar para <code class=\"language-text\">expo-sqlite</code>, uma solução de banco de dados local adequada para dispositivos móveis. Mas aqui está o truque—eu ainda precisava do Dexie.js (uma camada para IndexedDB) para manter a versão web funcional enquanto eu desenvolvia o aplicativo, já que uso principalmente o navegador para isso.</p>\n<p>Felizmente, a equipe por trás do Expo realmente pensou em tudo: apresento os arquivos <code class=\"language-text\">.web</code> no Expo—essencialmente, o Expo permite criar arquivos específicos para a plataforma (como <code class=\"language-text\">database.ts</code> e <code class=\"language-text\">database.web.ts</code>) para que você possa ter diferentes implementações para web e dispositivos móveis. Isso foi uma salvação, e depois dessa descoberta, posso confirmar que refatorar código enquanto murmura “antes tarde do que nunca” é totalmente uma coisa.</p>\n<p>E não podemos esquecer os gráficos—porque o que é um aplicativo de fitness sem gráficos de progresso legais, certo? Bem, o <code class=\"language-text\">react-native-charts-wrapper</code> funciona muito bem no celular, mas não na web, então tive que trazer o <code class=\"language-text\">react-chartjs-2</code> para a versão web. Você pode ver aonde isso está indo: lidar com duas bibliotecas de gráficos diferentes, dependendo da plataforma, foi apenas mais uma parte da diversão.</p>\n<p>A essa altura, eu estava bem fundo nesse buraco de coelho, e para facilitar um pouco a vida, adicionei algumas ferramentas de desenvolvedor ao aplicativo, como funções de exportação e importação de banco de dados. Isso permitiu mover dados entre a web e o celular durante o desenvolvimento. Foi por volta dessa época que percebi por que as pessoas são tão apaixonadas pelo Firebase—talvez em uma versão futura, eu faça a troca, mas por enquanto, o Musclog é 100% offline.</p>\n<h2 id=\"novas-funcionalidades\" style=\"position:relative;\"><a href=\"#novas-funcionalidades\" aria-label=\"novas funcionalidades permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Novas funcionalidades</h2>\n<p>O desenvolvimento de software é muito parecido com o bodybuilding, você começa com um plano, mas depois descobre que tem genética ruim para os bíceps, e acaba pivotando e fazendo 28 séries para bíceps por semana (certo, pessoal?). Minha visão original era bem simples: apenas um lugar para registrar meus treinos e nutrição. <strong>Mas como o Bambam diria, “Tá saindo da jaula o monstro!”</strong>, e as funcionalidades começaram a crescer.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 222.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAIAAADqwg+aAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFkUlEQVRIx6WW61MTVxjG1wQ0bDbZLLu5LLMbhRCCXEIuJIEsEJRbghGxGDTjhYEwY+XiMMpNC/3QdopVnEKlgoBTudSAgoYkIHeZcRytCs7YOnW0M461X9oR5R8odJKUEANUrb95Puz7nvOcc/bszjkvsPQRAHa7fWhoyPG/AHg8XkhISEBAAIPB2PSBAARBCIVCLpfL+xC4blwzCwQCBEGC3xsEQXAcd5lJkgwPD4dhGEXR9zRzOBySJHEcBxAE4XA4wR8I4gYI/giA9Ub1rAjx4R1mBEEwDNNoErRaiqIopRuVSqVUKimK4vF4fkP4m/l8flhYGEEQIpFIKBSSJBkaGip0g2HYujOjKArDsFgs3rFjh0FvSEhIyMrK0ul0BoNBrzcYjUaxWOz3UfzfmQ3DEATx+XyJRBIWFioSicLDxTiOQxALhuF3bFi4SBQRIY6K2iqVSgmCjIqKiomJwfGQyMiIiAjx2mYURVksdnT01j7rRdv13t6ejp6eC2fONJSWlNTV1R3Yf+jg/gMdHS2xsTEQxPKufMUMQZBSKZ+csE1P2aenHDM3x4adtrExe2/vpeampks/dFgvX9KolUwmtLZZLo+7MTJwc9oxMjzY2dk2NeUcHbMNDFgPHixsbv722qBVoZBB0DpmhUI2Nnp9espZWVnd2Nj46NHd589/vX//9qmGUzbb4OiNofh4+X/NPD5um5x0NDR83d7e/vjx3K1bMz3dXbMP7jycu3Pvp1upuqSgIND7wX3NLLlcenNmtL29/fjxarU6NduQa9yZV119wumwOR3XpqduJFGJIMhc0wypVIrrtisnT35eXV1bW1tz9GjF4EDf3MPbTqejqOjT8+fPJadQIAhi2PKyPT89iqJMJiSTxTqHr50929Ta+v29e9OTk/ampsYLF1pGRob35hfU153UajUgyPT8yC4zhmECgYDH4/H5fJIklUqFRBIplUqTk6nt23XbtqVIJJEajSY6OlYmiyMIAsMwPp+P4ziGYYBQKKQoKjMzU+tGpVJrNAnx8UqZTCaVxsXFyVSqeLlcrlQqFQqFTqfLzMxMTU3VarVCodB1DGVkZFRUVKSnp5tMptzc3D179iQnJycmJnqG8z6o1erdu3cfPny4uLg4OzubIAjX6Wk0Gi0Wi8GNxk3COqjVaoVCkZaWlpGRQZIkINy8OS09XW8wpKWnZ+n1VFLSiii3fDJJSckUlaTTpabodJu3bAGCEYTDhmCIyWFBMIsZDLO9QjlwMAf2zXiEsFkIzHYdgKERkQU1XxbXn7bUnbLUnyqqW9ZnDYdqviio/WolsyxL/TcFNV+GRkQCVNbOq08Xrjx985aeLfQ/mf9uYrZ15uf+J/NXnvl3uPp0gcraCfAFuN5cuMtSllNY4qddRaW7ikrXyFvK9OZCvgAHUox5EwtLE2/8NTa/2P3wjx9/+XNs/u/J1R0WllKMeYAghMgpPJJfVmUqOWYqOe5Vfmnl3vKaveU1+aWVvnlTybH8sqqcwiOCEALQpOm7Zl90zf7uq+65l513njWPP2gef3Dx7m/dcy/9OnTNvtCk6QFJrKzqXNeJNmtt6+UVtVmrWrrLT7eWn26taun2az3RZq061yWJlQEwmx20MXC1wE0boaAgCAwCN21cswPMZgMoinK5vDWFcbmY6w5fuxVFUWD1fb9+NcDzawR8awyGm/UqkCCGS2/VJPuWMZvNJpMpLy/PbDbvW4XZvC/nE5d8GwFPRbW4uLi0tPT69etXr+a9oRdPdPcvl7zhv3WYB6fT2d/f39fX53Q6PRmbG8+zw2HvtNo6L9ucDq/DDvgCgkwOBwEAYMOGDQAACNx4Q89eekMXAcvQ6XQGgwGCIJ1ODwwMpNFoLDc0Gi0wMJBOp0GQK6TTaV7LP1SqCK8kQQwAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Rastreamento de treinos\"\n        title=\"Rastreamento de treinos\"\n        src=\"/static/d41801c4cd3ed5901fa8893f146a8c94/42a19/musclog-workout-screenshot.png\"\n        srcset=\"/static/d41801c4cd3ed5901fa8893f146a8c94/e3135/musclog-workout-screenshot.png 256w,\n/static/d41801c4cd3ed5901fa8893f146a8c94/06341/musclog-workout-screenshot.png 512w,\n/static/d41801c4cd3ed5901fa8893f146a8c94/42a19/musclog-workout-screenshot.png 1024w,\n/static/d41801c4cd3ed5901fa8893f146a8c94/b4ad3/musclog-workout-screenshot.png 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Rastreamento de treinos</figcaption>\n  </figure></p>\n<p>E o rastreamento de nutrição? Bem, não é só sobre registrar refeições. Eu precisava ser capaz de adicionar alimentos, diferentes macros, monitorar calorias e integrar tudo isso com os dados de treino. À medida que fui adicionando recursos, percebi que estava usando o GPT para obter informações nutricionais. Então, por que não integrá-lo ao aplicativo? Foi assim que o Musclog acabou com um recurso de chatbot. Agora, posso perguntar coisas como “Quantas calorias tem uma banana?” e obter uma resposta rápida. Mas não vamos nos precipitar.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 222.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAIAAADqwg+aAAAACXBIWXMAAAsTAAALEwEAmpwYAAAG3UlEQVRIx6WVa2wU1xXHBwR4lz5s73vnuW+vpcZm1/O489yZ2ZnZHXttLWvW2JJNMDUxdu02TVFs2hAwINHEITYxAkwoSq2AS9qqCgkQ4rpNEA+VJM2Hth/oxyof+pCiSpWI1A91NTO2WUKqvn462j333nOu5t77v+dCK/8H0BWbt/8noEAgAMPwpk2bXC5X3Rfgeszq1n+haCyWTKVCMIygGIJhMIrCKGo5CAojaBiGv8gQx4FO3vjgxZ+9/9KVW9Nv3jz+k+XpN2+eeOv2Cz/9he3cmlv66PP27r1Xrv9q7sa9uaUPofcerFz67Z9e++gPi7/7y7nb91//zR/f+P1fFz7+5Icff3L5/qfvPVh5aJ+t3Pxs5f2//eON+5++8+e/33ywAk2cvjh5dnHy7OKB+cXJcz+amF+cmF+cnF+cOHPJstMXJ87Ydvri/rmF/acWnj21sP+V1549tTBx+iK01VXnmGvLplB9Pe7zoR5PBIFxBMaQ8Fe/tNW9ZbO7bstWV1044A/6fd6GejQcrv/Kl911W6BAMIjhOI4TGI7HR/qbp55OHRxPiGw6mUql0zhBxOLxeCIBwwhOEIBlFVVNJJIwjPj8fsjr9YZCoWAwGAqH4YMj0fPH0DOHgjyJBUMohgUCgWjMSvf7/XV1da2traqqut3uhoYGj8cDBYPBVCrVnE4nE4lUczqebkqkm5KJRCwSTSSTqaZUPBaLx6wJYrEYjmEoisbj8WgsGgwGIYIgJFHU29v1ardW7sqXu5RSu9JuKqWOQt/OfFdJzOUkXQM0LcmyapqCKPIcx/N8JBKxkkVB0EyTEwQ+l+MUOVc05Pai3GGyLCvpmrajIhdNyTDylbLSVdJ7urVqRTJ0HMMgHMdFUVQVBQDAAgBoBtA0oGmGolkbhmFERXbmcmJ4SeJ4niCI1eR8Ps+yLMdxrPPHcazjr8HQjDNkT2G5VrL12aIoyzKwYRgG/Duc6VaTBUEwDCOXyymKIstyrVPblGXZcSRJBAAQhL1hDMNIkrQe6sRJkqRpmqqqko1oI0kSz3PFUpeiG9aGEQTB83zt8uwlcwAAXdcLhcL6d672M4yiGapRsJK9Xi+CICiKIjV8run0rHaiKGzj9XqhSCRCkmT2v4QkSUskqVSqXC739vaapsnzvPgfIAhCLpdLp9PWOWcymdYatv0LagMymQyO41BjY6P/UTw2Xq/XU4PX63VGfT5ffX29z+drbGyEMAyja2AYRtM0wzA0TdN1XdO0QqFgGEY+n2cYhiRJURSr1SoAAEVRa8O4NSU6p7J9+/ZKpbLdplwud3d379ixo7Ozk2VZmqYVRRkaGuIdbRME4aifoiiGsQRM1UDTNEVRJEnSFGXdCdbSbzab5TjuobZzOclsL+VkhaIojuMEQeBto2mK51d9RyeOogBgLHk6t4oHzNcPPM9JYt/gU0pe29byRFtbhiLbSl1lkmxra8tmWp/YNfotUZa3tXxNNzt6+p9E4DAUi8WMYrGQk+nxvTv3jnRNTFT3Dg8Nj/f2Dewe/ub0O7e//dzR4acnx7/z3OD5C9U9Q+WOzvKTg+0jo2goCKWamjpLHZphPnN54XvLd/f9+NLk20uT79459stfH1i6w/9get+15WeuLY9dXe69fOb5n985cu3uoatL5tBONARbb5Way7F59dLy/PFrs9fvXji7fPb49dn9V2Znb5y8de/V2RszV++ce+v2/Acfnj+1NDez9OqFu69PHdjr84egSISgaDqvyEe++9TLh0e/f3DfCweHXz48+tKhkROHR1+c+sbJo+MzR8ZOHh2bnhqbOTJ+Ymp05thYX08XDKPWbgMARFFsN00pr/O6rhVLqmEahqnpBTGn0CxPA8c4mhVoINCAkyTJOqpIJOIIxDRUWVWEvKIXinlNM/JqZ0d7Pq+yAFgVjbWNYwFDa4WibnasVk9bJICiaMaumzRFMTRNkqQsy44qawsYQ9OSokqygmEo5PF4wuEw/CgIgsAwHA6HA4HA46PhkPVAWcUAhuHWx2hpabGUkc2yLEuSZEtLy6N3NpPJZmEYttbM8zxXg1PxKpVKX1/fwMBAd3c39ygMTTM0tfrcOOXaWRtFUYZhDA4OViqVcrlcrVZ7enoGBgaKxSJJkgAAsi1rlLp69gyjCAJFo1HrGqwhCAIAoFwuDw4O7tq1q7+/f/fu3ZVK5eEowxgdnd0De6zdDgQCzc3N6TUSiQRJkrqu2yXaWo4oioqiZLPZZDLZ1NSUTqdj0WgEx/1+P1RLQ0NDIBCAIGjjxo0QZBUZDMPWm84pQBC0YcOG1YQNa0AQtHnzZpfLtR691Wa96Xa7neZ6yj8B8tDSCGGw/9QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Gráficos de nutrição\"\n        title=\"Gráficos de nutrição\"\n        src=\"/static/b69f535658f7c245847ca719437cf7af/42a19/musclog-nutrition-screenshot.png\"\n        srcset=\"/static/b69f535658f7c245847ca719437cf7af/e3135/musclog-nutrition-screenshot.png 256w,\n/static/b69f535658f7c245847ca719437cf7af/06341/musclog-nutrition-screenshot.png 512w,\n/static/b69f535658f7c245847ca719437cf7af/42a19/musclog-nutrition-screenshot.png 1024w,\n/static/b69f535658f7c245847ca719437cf7af/b4ad3/musclog-nutrition-screenshot.png 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Gráficos de nutrição</figcaption>\n  </figure></p>\n<h2 id=\"de-rastreamento-para-chatbots\" style=\"position:relative;\"><a href=\"#de-rastreamento-para-chatbots\" aria-label=\"de rastreamento para chatbots permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>De rastreamento para chatbots</h2>\n<p>Então, aqui estava eu, lidando com registros de treino, monitoramento de nutrição e gerenciando múltiplos componentes para diferentes plataformas, e ainda decidi adicionar um pouco de ✨IA✨ na mistura? Afinal, todo mundo adora um bom chatbot hoje em dia, e se você me conhece, oh garoto, eu gosto de um chatbot—tanto que passei centenas de horas codificando uma <a href=\"https://github.com/blopa/Magento-Chatbot\" target=\"_blank\" rel=\"noreferrer\">extensão de chatbot para Magento</a> que por muitos anos foi meu projeto de código aberto mais popular.</p>\n<p>Comecei adicionando uma interface de chat simples ao aplicativo, onde os usuários podiam fazer perguntas como “Qual é uma boa refeição pós-treino?” ou “Como posso melhorar minha forma no supino?“. A ideia era criar um treinador pessoal com IA que estivesse sempre disponível, pronto para fornecer insights e dicas.</p>\n<p>Como de costume, depois de muitas horas de codificação, decidi mostrar meu progresso para meus amigos, e eles disseram, “Por que não usar <a href=\"https://github.com/FaridSafi/react-native-gifted-chat/\" target=\"_blank\" rel=\"noreferrer\">Gifted Chat</a> para isso?“. Espere, você está me dizendo que após implementar uma interface de chat do zero, enviando e analisando mensagens, eu poderia simplesmente ter usado uma biblioteca? Bem, acho que essa é a beleza de aprender na prática.</p>\n<h2 id=\"integracao-com-openai\" style=\"position:relative;\"><a href=\"#integracao-com-openai\" aria-label=\"integracao com openai permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Integração com OpenAI</h2>\n<p>Integrar o OpenAI ao Musclog foi uma escolha óbvia para mim. Eu já tinha experimentado com isso em outros projetos, como quando usei o OpenAI para <a href=\"/pt-br/blog/coding/como-automatizar-a-criacao-de-instagram-reels-usando-gpt-da-openai/\">criar automaticamente tutoriais de codificação para Instagram Reels</a>. Com essa experiência, eu já estava familiarizado com chamadas de função, análise de respostas e manipulação de prompts. Então, pensei, por que não adicionar essa ferramenta poderosa ao meu aplicativo?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 222.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAIAAADqwg+aAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHPUlEQVRIx6XWeUyTaR4H8AcopRTRQi+ERURFUXe5FCi0FAoIGmSEGRyBlT0yOzMxMTBsnEODM9nNuu4fkxWG5RDEHY4KcqhUdKSAUEsppfTgKO1bQan0gJZytl0GhHfTt4LiMrNx95NvnvyeN+8vv/d98zQpgP8PgIVo+Z8AEonk6emJQqEwGIyT07sF+O7Zs2//gZ1eXp5eXjs9Pd8poKBVeLXp8d/vdxe2iYo7B4ofS/9bBoraJYXs/sI2EeD8C65TTJfynt55YWmdhX+Yhn8wvp1HM6/rFj3MnoU5ZrjLAoML31V+Wcx8OKLpGDWwoUk2NNmmnGpVaNnKyUcKbSukax81PJRPtj+dYisnWyGdaHqlskuSm//Pr0puAQ8Pgu9en/ZWNgQppRLpwMDg4OCQVDrQL+zv7xcJhSKpuPeZvGdcpX42NvZC9QKG4StX/goA2O7qCvKu5v2j4tu29s4fFw1zBs2icXLRqDPNTC5M6xaNuvlpnck4sWZ6sWJZeGmeW1qYhuG1q3/OQwPgQSIA/0OHfnlg35G41ON/LDuWXZTwWUniZyW21VrkliTmlsRnlx7LLjqWU3Qsu+h4bsnuEzmYI5m4fWHAdYfbdkeAOf43fBHsk7/slb/mXbC267s1pFjdVbDqXbC6u3DVK39t5zXrdY9ra3uLX5LLYVRWA8ATyQQXh20p+X4VcHCJJbhs+XDxSlj58uHi5UNF1iKgZPlo+XJgqTWHi5ePlK34F1qIBbDj2SbgTiDhne22pRX4VsH+11d8S+G91+F912G/Mnh/Gby/HN5TCh8oh/3LrfXBG9bC9duXqGsw+ncs4E4g4l1Q6NCPwXkIfNwHPhWBT/qt+VSE1JvzByH4SIjNluz8k8ot+Qpwd3fH4XDffPN1410Ws66RWdfAvN106/bd6tp6Zl1jTW0D83Zjbf0dZl3jrfqm5geP7jQ/CIugbduBx+PdAc7NjUQi9QoEKpVKCUEKhVL1fESnkiqgp+Pj46OjowqFAoKgZ2Nj4+PjM0YjDMNnz551dHQkkkgAh8ORyeS2trb+fhGvp4fbzROLBP19nD6hqFcg4PN7e3r4fH5vn1DI5/cK+vomp6YyMjLRaCcikQjckMlcLlen0w0PD8tkw6OjY3KFcnT0qXKdAgFBkE6ns1gs6enpaDT6VTORSOzp6bFYLAMDA2Kx2Ho+hwZHRkbkcrlEIoEgSKvVqtVqvV4/Pz9vMpnebubxeDMzMzwej81mP3nypKOjg8vl8vn87u7u3t5ekUg0NDQkEAggCFpaWtpistlslslkEolELBYrFAqNRqNWqzUajUqlUqvVKpXq+fPnWq12i8e2TeYgeDweh8MRi8UymWwYIZFI5HL54KD1Xcxm8xbNc3NzEoRQKJRIJHw+f3BwcAD5iUokEqlUKpPJ3p7sjncnk8k9PXyTycTj8bhcbldXV2dnZ19fn23y0NCQbb5cLlepVJs+mAvWZft2HIfDMRgMEAQplUrIelQUExMTGo1Gq9XaVp1ONzExodVqFxcXz5w586r5o/O/vfiXC908wcyMUa/XGwwGvV5vNBoNBsPU1JRer9doNFNTUwaDQa1Wz87O2k4YGo0mkUgg5cP3f5N15sIXXzXU19fU1NQibiFq/0NdXV1NTU1wcDAWi3VzcwO+u319dvn4+Oz6xRt2bcXb29tW+Pn5HTx40N/fH1Bp1DhEfHz8cUR8fDyNRqMiaDRaFCI6OjpmHZ1Op9FokZGRIDQ09NSpU5mZmRkZGZmZmVlZWenp6fHx8TExMXFxcXQ6PSwsjEKhREVFJZx87+QHHyanpScknYyKiqJQKIBCodBoNAaDER0dTafTY2JiGAxGXFwcg8GIjY2l0+nh4eEUCoVKpdJtrLdFU6lUa3N4ePiJEydOnz4dGxsbFRVFpVKPHj0ats7W+VOszUlJSWlpacnJySkpKcnJyYmJiRsDf561OSEhISUlJRWRlJSUmppKp9MjIyOpb4iIiNiiOTLCKigoKDAwMAgREBAQtFlgYGBoaGhkpO3e1wCJ7EEgkr++fLmhoaGysrKqqorJZFZVVVUjampqqqurmUwmg8EgEAje3t5ebwCf5Pw+7+rnAqF0+celubk5k8lksVgWEQsLC2azeX5+Hobhc+fO2dnZ4fF43DrrCTuV9v6vM06fz8n9vvL7GzcqKm7erKi4+WqteF2HUyg7cDgSmUwkkTYCUA4oezsHB3s7sJmzkxPB3Y2Id8M6YwAAGDRqGxbj4uz0OlhnEEGlUsNDwtNyQi7zQi51BF/qCLnUEXKxI/hiR8ilx8hqTeCXbQFfsF/l80e/usgJSc8DqzYwvALDL9/1f1hLSwuLxbrPambdu9N8t+nB/eaHLSxbWlj3Wlj3fmr78EHLpvfEYrE4HA4AYGdn/QRksgeZ7LGxJRCJRCJpY2uFWufg4IDBYLBYrIODg6Ojo729vSvC3t7+re1Gy78BjSQRtkO9ctIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Conversando no Musclog\"\n        title=\"Conversando no Musclog\"\n        src=\"/static/704cbad9cc4378eb4a5830458e14e1ff/42a19/musclog-chat-screenshot.png\"\n        srcset=\"/static/704cbad9cc4378eb4a5830458e14e1ff/e3135/musclog-chat-screenshot.png 256w,\n/static/704cbad9cc4378eb4a5830458e14e1ff/06341/musclog-chat-screenshot.png 512w,\n/static/704cbad9cc4378eb4a5830458e14e1ff/42a19/musclog-chat-screenshot.png 1024w,\n/static/704cbad9cc4378eb4a5830458e14e1ff/b4ad3/musclog-chat-screenshot.png 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Conversando no Musclog</figcaption>\n  </figure></p>\n<p>A integração em si foi bastante simples. Usei a API do OpenAI para processar as consultas dos usuários e fornecer respostas perspicazes. Toda vez que um usuário envia uma mensagem, o histórico do chat é enviado de volta ao OpenAI para manter o contexto da conversa intacto. Para dar um pouco de personalidade à IA, usei mensagens do sistema como, “Você é um treinador pessoal prestativo chamado Chad, e está aqui para ajudar nas jornadas de fitness. Pergunte-me qualquer coisa!”</p>\n<p>Mas não parou por aí. Eu imaginei que, se já estava integrando o OpenAI, por que não ir um passo além? Então, adicionei uma opção para pedir ao OpenAI que criasse um plano de treino diretamente. Por exemplo, você pode usar o chatbot para perguntar, “Você pode criar um treino de push-pull-legs para mim?” e pronto—Chad, o treinador, entra em ação, gerando uma rotina de treino personalizada na hora. Este recurso é particularmente útil quando você não tem certeza de como estruturar seu treinamento ou se está procurando variar sua rotina.</p>\n<p>As possibilidades aqui são bastante empolgantes. Com essa integração, o Musclog não é apenas um rastreador de treino estático; ele se torna um treinador de fitness dinâmico que evolui com suas necessidades. E sejamos honestos, ter uma IA que pode criar um plano de treino em segundos parece um superpoder, especialmente quando você está na academia e precisa de uma rotina rápida no momento.</p>\n<p>Não só isso, mas também dei acesso a todas as informações de saúde ao OpenAI, então meus dados de nutrição, treinos, peso e porcentagem de gordura estão disponíveis para a IA usar, para que ela possa me fornecer melhores insights. Claro, devido a preocupações com a privacidade, tornei isso opcional, e também adicionei um recurso para excluir todos os dados sempre que o usuário quiser. Mas imagine, fazer um treino realmente difícil e depois perguntar ao GPT o que ele acha sobre isso, bem legal, né?</p>\n<h2 id=\"design-do-app\" style=\"position:relative;\"><a href=\"#design-do-app\" aria-label=\"design do app permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Design do App</h2>\n<p>Eu não sou designer, mas gosto de pensar que tenho um bom olho para UI/UX por causa de muitos anos de desenvolvimento web. No entanto, o desenvolvimento móvel foi uma fera completamente diferente, então precisei terceirizar os designs de UI e qualquer arte, usando recursos gratuitos de código aberto ou IA.</p>\n<p>Sim, sim, eu sei de todo o ódio em relação à arte gerada por IA, mas era isso ou arte feita no MS-Paint, então optei pela arte gerada por IA.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 678px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVQY03WMUW+CMBSF+f8/Z8n2MLO9LAvEhIehVbAFEVCgt1hhpVCwdFEzY5bsy83NOfeeHMv8Ml25i7v9j2marMPhEAQBxvjm/7wB4LHOGCOl1Fr3fS+EsKIochzH8zyMMefcGCOEUEpxzpumIYQ8lrZtO5vNhmGoqmo+n1uEkHEcgdIVQgvPYwAE47IoVgh1UkZhSDDeBIHv+5vNZrlYhGFY13Unpeu6Ft5GxphknwFjn45zrOvlev2FUJymQsokywJCPLREK2Tb9j7PP2z76eX59f1t7rqWyktzasYSdAltkg4FrUmkCtrt8y7NzKnpD4UoKaWAAzyKduInWPmqoEaNFoOYljGDHYP4WKUV2/FjxmBXsaRiCdC4gh3/Lr6I5yc+43tabutTfs2nVnvupFZS91L37fm2u/bc30ZqdRFjpyaltJLXixgvgU4PP+Z5vEEZQerAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Logo do Musclog no MS-Paint\"\n        title=\"Logo do Musclog no MS-Paint\"\n        src=\"/static/7e20ac19f1f7fbefd54041cd6e4b562a/dc057/mspaint-musclog-logo.png\"\n        srcset=\"/static/7e20ac19f1f7fbefd54041cd6e4b562a/e3135/mspaint-musclog-logo.png 256w,\n/static/7e20ac19f1f7fbefd54041cd6e4b562a/06341/mspaint-musclog-logo.png 512w,\n/static/7e20ac19f1f7fbefd54041cd6e4b562a/dc057/mspaint-musclog-logo.png 678w\"\n        sizes=\"(max-width: 678px) 100vw, 678px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Logo do Musclog no MS-Paint</figcaption>\n  </figure></p>\n<h3 id=\"ui\" style=\"position:relative;\"><a href=\"#ui\" aria-label=\"ui permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UI</h3>\n<p>Para a interface do app, usei componentes do <a href=\"https://reactnativepaper.com/\" target=\"_blank\" rel=\"noreferrer\">react-native-paper</a>, o que facilitou a criação de um visual limpo e moderno, com a maioria dos componentes de que eu precisava, como botões, cartões e modais.</p>\n<p>Isso resolveu o lado funcional das coisas, mas e a parte estética? Eu terceirizei meus esforços para o <a href=\"https://v0.dev/\" target=\"_blank\" rel=\"noreferrer\">v0</a>, uma ferramenta da Vercel que usa IA para gerar aplicações simples de uma página para serem usadas em um app Next.js. Eu simplesmente inseri o texto explicando o que precisava e pedi que fosse mobile-first, e voilà, eu tinha um design lindo para o meu app.</p>\n<h3 id=\"logotipo-e-ilustracoes\" style=\"position:relative;\"><a href=\"#logotipo-e-ilustracoes\" aria-label=\"logotipo e ilustracoes permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Logotipo e ilustrações</h3>\n<p>Para o logotipo e as ilustrações, usei o <a href=\"https://openai.com/research/dall-e\" target=\"_blank\" rel=\"noreferrer\">DALL-E da OpenAI</a> para gerar as imagens. Eu simplesmente digitei o texto explicando o que precisava e detalhes sobre o meu app e obtive alguns resultados bem legais. Depois, usei o <a href=\"https://www.photopea.com/\" target=\"_blank\" rel=\"noreferrer\">Photopea</a> para fazer alguns retoques e adicionar efeitos às imagens.</p>\n<h2 id=\"chegando-na-google-play\" style=\"position:relative;\"><a href=\"#chegando-na-google-play\" aria-label=\"chegando na google play permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chegando na Google Play</h2>\n<p>Depois de meses de desenvolvimento, testes e uma quantidade não saudável de Pepsi Max, o Musclog estava finalmente pronto para o grande palco: Google Play. Mas é aqui que as coisas ficaram… interessantes. Eu estava sob a impressão de que poderia simplesmente enviar meu aplicativo e pronto, como fiz em 2019 para meu jogo Gotinha. Ha! Mal sabia eu que o Google Play força você a conseguir 20 pessoas para testar seu aplicativo antes de ele ser lançado, mesmo que você seja apenas um desenvolvedor solo. WTF, certo?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.796875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQozwEZA+b8ACwpKVxXVDEvMCAfIHVvarOuquro5NTV1aWmp0NGTHJvbsTBvdrX1MG/vHFvbjs5OTEvMEE8O3JtaiYlJgAnJCY6ODhfXFtOTE6DgH5nZmZ0dnswMTS6t7SanKDGxMNaXWOTkI+oqatbWFmLioomIyR8d3Tn5N9YWFoAMDAyMjAxQkA/aGdnQkJETUtKSklLoZ6bycrMa2tsjIyMZGJiqKWisrS2XFxdW1teLiwsv7+8dXR1FhUXAHZ3eh0dH0I+PVBOT1ZTUmdnaK6urtTV02tqanFvbmhmZVxZVrWzsKmqq1dVVlBOT25tbF5eXy0pKD87OQBJR0gjIyZ0cG5sbXJzc3RdXF2XlpSgnZpoZWJjX12ioqGFhIWgn56ZmJaCgYBSTk5cW1xPTU1aVFFSTEkAKCYnUE9RWFVVbm5vsLCvc3R2f3x6u7q3fHp4h4aFjY2Oh4WFw8LCn52cbGppeHRzfn1+XVlYVlJPLiwsAGpmY/L08mVnbElGRYB9fICBgpeVlL6+vaurq7a2tbq6uK+vsMLCw56en1xaWaqoppeYmFdUU0tGRR8eHwAYFxi6uLSxtblRT1BtammKiorPzsxWVVZ/fn97enmDg4OCgoNaWVjR0M57e31raml0cnFYVVRgXl4eHR4ACgsOPz08pKanYWBhhIF/zMzJg4KDFRYZU09OaGhpaWlrUE9PLCwwkZGS3NvalJOSRkJCnpuajY2PDg4PACUlKCUjJXl3d4aGiLi1s5+fnzo7QDM2PEtJSoyLi46NjFpaXD9BSDw9QqenprGwrmpnaFlaXDMyMnx5egAsLC86OTtgXl60srHCwL1NT1JQSUtuZm5zdntfYGJfX2F0dXhpaGlHR0lSU1e9vLuxsbFTU1ZOTU85OjwAIyQnWlhYsa+t29vZdnZ2UExOWHB2VXxxXl1gVVlfVlpfZGZqX2FlXmBjTk9ThISF5OPhxsfGbW5yGxsgAGRkZLu5uNbV05GRkVVVVmFdXxU/UDFMQicmJjA2PT9DSC4yOC80OhwhJ2NkZ1xeYaalo9fW1LKys19gZaAKVbzZf9AuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Musclog no Google Play\"\n        title=\"Musclog no Google Play\"\n        src=\"/static/2f4435481c82229b5ad1e2f673ddf4d0/42a19/20-testers.png\"\n        srcset=\"/static/2f4435481c82229b5ad1e2f673ddf4d0/e3135/20-testers.png 256w,\n/static/2f4435481c82229b5ad1e2f673ddf4d0/06341/20-testers.png 512w,\n/static/2f4435481c82229b5ad1e2f673ddf4d0/42a19/20-testers.png 1024w,\n/static/2f4435481c82229b5ad1e2f673ddf4d0/7383e/20-testers.png 1535w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Musclog no Google Play</figcaption>\n  </figure></p>\n<p>Encontrar 20 pessoas para testar seu aplicativo parece fácil até que você realmente faça isso. Acabei recrutando qualquer um e todos—amigos, família, colegas de trabalho, conhecidos em festas, talvez até tenha pedido a alguns estranhos na rua (brincadeira, talvez). Mas após reunir meus “bros” de teste e passar pela fase inicial de testes, adivinhe o que aconteceu? Meu aplicativo foi rejeitado. Sim, é como se a vida simplesmente não estivesse pronta para me deixar vencer.</p>\n<p>Então, lá estava eu, esperando mais 14 dias, corrigindo os problemas que eles apontaram e reenviando o aplicativo. Foi uma montanha-russa de emoções, para dizer o mínimo. E como se isso não bastasse, porque eu queria a integração com o Health Connect, <strong>mas não só isso</strong>, acredite ou não, eu também precisava ter um site público para o meu aplicativo, então tive que criar um site para ele, escrever uma política de privacidade e preencher um formulário explicando por que precisava de acesso aos dados do Health Connect. Então, criei rapidamente um site usando <a href=\"https://nextjs.org/\" target=\"_blank\" rel=\"noreferrer\">Next.js</a> e <a href=\"https://v0.dev/\" target=\"_blank\" rel=\"noreferrer\">https://v0.dev/</a>, e usei o GPT para escrever uma política de privacidade para mim, você pode vê-la aqui: <a href=\"https://blopa.github.io/musclog-website/\" target=\"_blank\" rel=\"noreferrer\">https://blopa.github.io/musclog-website/</a>.</p>\n<p>Você pode estar se perguntando se eu fiz este aplicativo para mim mesmo, por que me importo em tê-lo no Google Play? Bem, por um lado, acho que o Google Play é bastante conveniente e quero conveniência ao instalar o aplicativo no meu telefone, e em segundo lugar, quero compartilhá-lo com meus amigos e familiares, e acho que é mais fácil compartilhar um link para o aplicativo no Google Play do que enviar um arquivo APK.</p>\n<p>Mas depois de todos os obstáculos, recebi finalmente o sinal verde, e o Musclog estava oficialmente no Google Play. Então, sim, não foi fácil, mas definitivamente valeu a pena. <strong>“É hora do show, porra!”</strong></p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVQoz2N4+PDRnTt3noPB06dPnz179vTp01u3bt+6dfvZs+f/UcH3P//W3nm39s6bpddfPf/ym+HBo0cPHj58/uLFu3fvXr169fTpsydPQEbcv3//zZu3cG1///37////0XvvXBqXLT9+3bd91ax91xn+Ewf+/gVp3nP2TnzN1M0nr2V1Luxftoth8aUj8y8cvP7m6f////+hAhTNYO7tRy8CC7vd0ps8Mlu2HznPMP30nqmndp97dv/X719/UTWgAYhxN+49PXD6yrlrd//+/Qd19r8/f/79+f3n968/v3/Blf79/evf37///vz+9+cPVuMY/AP8e6dOK2lqn7VoWeuEKe2TprW0t2dkZk2aObuipXPu0pW1HT0rNmz+////mzdvPn36hOwpBl0dncDQUCN7+5iEhIPHTixfs87d11/T0CQqLt7A2CQlPdPS1q6qtu7///8/fvz49esXis05OZkJiYnuXh7Z2ZmTJ01sbm4OCQkxMNCPS0hQ1VSPiYkxs7JcvHgxOMD/ojs7LK8yNTPbztIiPiGpqLg4JSXVx8dXR083IjJCRU0tIiJCz8CgqroaHuAomvNKypvqavqa69u6+zo7Ojo6O2tqauPj4zs7O9PT0/v6+nNz82bPmQMPbRTNHz9++Pnz15dv3379+vnnzx9Mt+EBDJ8+ff758+c/vDGMSzMAxD14Zb8NfeEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Musclog no Google Play\"\n        title=\"Musclog no Google Play\"\n        src=\"/static/94c86cf4c9336297db75be297075c49d/42a19/musclog-on-google-play.png\"\n        srcset=\"/static/94c86cf4c9336297db75be297075c49d/e3135/musclog-on-google-play.png 256w,\n/static/94c86cf4c9336297db75be297075c49d/06341/musclog-on-google-play.png 512w,\n/static/94c86cf4c9336297db75be297075c49d/42a19/musclog-on-google-play.png 1024w,\n/static/94c86cf4c9336297db75be297075c49d/9bae8/musclog-on-google-play.png 1330w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Musclog no Google Play</figcaption>\n  </figure></p>\n<h2 id=\"tornar-se-open-source-ou-nao\" style=\"position:relative;\"><a href=\"#tornar-se-open-source-ou-nao\" aria-label=\"tornar se open source ou nao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tornar-se open-source ou não</h2>\n<p>Eu sempre libero todos os meus projetos como código aberto—é meio que minha coisa. Mas quando se tratou do Musclog, eu hesitei. Este aplicativo me levou mais de 300 horas para desenvolver, e tem alguns recursos realmente interessantes que não vi em outros aplicativos de fitness. Achei que talvez pudesse recuperar parte do tempo que gastei nele vendendo-o no Google Play ou talvez adicionando um botão de “me dê uma gorjeta”.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAELklEQVQ4y2WUWVMiVxiG+Z/5A8ldapKZi4xJSh3jgsuwg4psg+zdQAOyNDS90Mgm2Mgi7jqZmkr+Qjxv6hwHS2suvj770++3nGO6HtVxdSbhZlTH7VhmdvNtjq7NbT6mLbWHcxVfLjTcT5VXa6bnwVCCUI5CqMRwOXx9+CX0iv54IkOp8uC5MI6VLO5eQBnwbiwjL8awEbbBEXVDbwi4m8jfwS6ZMgUFIQb7fghJoYwt+x6kSoopvpwrpEBFTcMacyHA+zDoFJnrc4Vzo6GY9svwfwrDdRDBT28WcBBOwRfw42b8wmW6UZRS2I3tYTVgQbYSxcNUfXb9Zg5nSmvw+v346A7i3R9r8EczCIZ8LJZPCkcS7icKWsc5eLg9eHkvTnsl3E0UBjs/rWJ8UnkO/v25gk4jhy2rA7/+uQbP/j5GvfLzuunCqGHYLWM2qEJXsmiqAqZ9EUanxIBdvYAtiwWh0AGL66QvMus184hwfpy2i2xMoSwptKPU0lBraWhSBo16BrqcZf2ZUUVHyyMQ9MKz72FxpQCpwrH1jl5grSzyOFaEJyBVOGgVGVCVMqiWUqiLPJuj5dFUBNidDrQVAXfnCib9CgtBV8/D43GwfdSbs7lCmp3ZaRUtLYeCEEWGDzOF9BAFtupZCHse8C4nBnoet1OFxXfUK2Fnx8wSQfe9yvLlsIYvlw1EwvuIHnrx94XGMjwb1iBmIkh8tCJqszM4OzyqM6DNus3OzmFMIf3MgVzCj3QywPp07noiQztKImO1oRwNYtQXcX32dFNOmgVs75hZQqcD8fXVmxk1fL3SwcX9DPr5QmNheJipKAtRLL1fRjoRwrlRw7lRxXRQRVvLYWljBZFCEOOByFxnwJtRnXyeqORiLJFYxAuBC5F/r5u4OauDtlwqjB9+fIfltU12329HMh4mKtq6gIXVJdg4N3q9IzxMvtXh2aACoRaDr+gnm7vbZDfoJAUtSeic3s0Rj9+DNwtLWPiwhqrCoagkkJcTOMh48dvqIiwpF6y8G1KDZ2Vl6nWPSFaKEb4WgV84gJPzYIdzwhy3E0vWjfc76+Tt8gfy8++LMEds2Eo56BrsvBt7/B4SlTCEegyixrEkmrw5LwPKeoYMB2UyMURi9Mt0jJwWJyu2bfL2rxX8srgMd2wXJS2FVjsP6tnYENHu5FFRUwgXA8jX4zAlxcNHC+ci64dWYku4yadi4LGm8f/NjNrj18sGtq1WYrZZyNKGGcVcHP9c6eh2CshKMewLXliSLmwmHQgU/BgNKjDdjWViDMokmPaRRecmsfAurMdt8BV8j8NeieQyETSkDElzhzDaJdT1NMwJO4PsJJzYOrTjSE6wWqQJe3oPJ+zpId1OgegtgZTV1GOuHn+cGlXyeabSYBNae/RF0Y6zKMgJqM0smq0cTrpHrNDndfg/b78BFDz446kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Tornar-se open-source ou não\"\n        title=\"Tornar-se open-source ou não\"\n        src=\"/static/dd0d3e91e6e919e174aae6ca82c7d985/42a19/open-source-or-not.png\"\n        srcset=\"/static/dd0d3e91e6e919e174aae6ca82c7d985/e3135/open-source-or-not.png 256w,\n/static/dd0d3e91e6e919e174aae6ca82c7d985/06341/open-source-or-not.png 512w,\n/static/dd0d3e91e6e919e174aae6ca82c7d985/42a19/open-source-or-not.png 1024w,\n/static/dd0d3e91e6e919e174aae6ca82c7d985/e8464/open-source-or-not.png 1536w,\n/static/dd0d3e91e6e919e174aae6ca82c7d985/a52c7/open-source-or-not.png 2024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Tornar-se open-source ou não</figcaption>\n  </figure></p>\n<p>Mas uma vez que meu aplicativo foi aprovado e, para ser honesto, após usá-lo nas últimas semanas, percebi que, embora os recursos e ideias sejam legais, o aplicativo não é tão polido quanto eu gostaria que fosse. Percebi que talvez o Musclog fosse melhor como um projeto open-source, onde a comunidade pudesse me ajudar a melhorá-lo—o que, para ser honesto, também é um desejo, porque a maioria dos projetos open-source não ganha muito destaque e são principalmente mantidos pelo criador, então o melhor que posso esperar é que as pessoas criem issues e peçam recursos. Viva!</p>\n<p>Honestamente, meu sonho seria ter um aplicativo open-source que de alguma forma me fizesse ganhar dinheiro—algo como Mindustry ou Blender. Então, depois de limpar o histórico de commits do Git, não porque estou envergonhado do meu código—ok, talvez um pouco—mas principalmente porque não tinha certeza se tinha cometido um erro ao enviar uma chave do OpenAI por engano, decidi tornar o Musclog open-source.</p>\n<p>Você pode conferir o código aqui: <a href=\"https://github.com/blopa/musclog-app\" target=\"_blank\" rel=\"noreferrer\">https://github.com/blopa/musclog-app</a>. Se você gosta de fitness e codificação, sinta-se à vontade para contribuir. Quem sabe? Talvez juntos possamos transformar isso em algo realmente especial.</p>\n<h2 id=\"o-que-o-futuro-reserva\" style=\"position:relative;\"><a href=\"#o-que-o-futuro-reserva\" aria-label=\"o que o futuro reserva permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O que o futuro reserva</h2>\n<p>Agora que o Musclog está no mundo, já estou pensando no que vem a seguir. Existem muitos recursos que eu adoraria adicionar, como análises de treino mais detalhadas, capacidades de IA aprimoradas e talvez até alguns recursos sociais para compartilhar treinos com amigos ou participar de desafios.</p>\n<p>Um “problema” com o Musclog é que ele é realmente um aplicativo para levantadores avançados, não que eu seja avançado (não sou), mas sou louco por dados e monitoramento, e meu aplicativo realmente brilha se você é o tipo de pessoa que monitora cada repetição, série e caloria. Então, estou pensando em criar uma versão mais simples do aplicativo, com menos recursos, ou talvez com um processo de onboarding melhor, para que os iniciantes também possam usá-lo, afinal, a maioria dos levantadores são iniciantes, certo? Eu também gostaria de conseguir convencer meus amigos a começar a malhar e usar meu aplicativo, então preciso torná-lo mais atraente para eles.</p>\n<p>Alguns dos recursos que estou pensando em adicionar são:</p>\n<ul>\n<li>Integração com dispositivos BLE</li>\n<li>Capacidades de rastreamento de alimentos no aplicativo</li>\n<li>Análises de treino mais detalhadas</li>\n<li>Opção de usar um modelo OpenAI personalizado</li>\n<li>Talvez um modelo LLM local um dia</li>\n<li>Conta online para sincronizar dados entre dispositivos</li>\n<li>Perfil online para compartilhar treinos e desafios</li>\n<li>Recursos de gamificação</li>\n</ul>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Olhando para trás, a jornada de construir o Musclog foi tanto sobre crescimento pessoal quanto sobre codificação. Aprendi muito sobre desenvolvimento móvel, o que sempre é uma coisa boa. Eu posso ser um desenvolvedor web hoje em dia, mas não foi assim que tudo começou; nos meus dias de faculdade, eu era um desenvolvedor C++, e o desenvolvimento web nem fazia parte do curso, então voltar ao desenvolvimento de plataformas é uma mudança de ritmo agradável.</p>\n<p><img src=\"/c1611424e8d127b69fc982f398783569/just-do-it.gif\" alt=\"Apenas faça!\"></p>\n<p>Então, se você está pensando em iniciar seu próprio projeto—seja um aplicativo, um site ou outra coisa qualquer—meu conselho é simples: apenas faça. Abrace os desafios, aprenda com os contratempos e aproveite o processo. Porque no final das contas, a única coisa que está entre você e seus objetivos é a decisão de dar o primeiro passo.</p>\n<p>Obrigado por me acompanhar nesta jornada, e mal posso esperar para ver o que construímos a seguir. Levante, Registre, Repita!</p>\n<p>Vejo você no próximo!</p>\n<p>PS: Se você quiser experimentar o Musclog, pode baixá-lo no Google Play: <a href=\"https://play.google.com/store/apps/details?id=com.werules.logger\" target=\"_blank\" rel=\"noreferrer\">https://play.google.com/store/apps/details?id=com.werules.logger</a>.</p>\n<h3 id=\"mas-e-o-codigo\" style=\"position:relative;\"><a href=\"#mas-e-o-codigo\" aria-label=\"mas e o codigo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mas e o código?</h3>\n<p>Na verdade, eu queria incluir trechos de código e explicar como a maioria das funcionalidades funciona, mas percebi que isso deixaria o post muito longo. Então, decidi escrever uma série de posts explicando como construí o Musclog. Fique de olho!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTA5LTIxVDAwOjAwOjAwLjAwMFo=","slug":"/2024/2024-09-21-musclog-aproveitando-minha-experiencia-com-reactjs-para-criar-um-app-em-react-native.pt-br/","path":"/blog/coding/musclog-aproveitando-minha-experiencia-com-reactjs-para-criar-um-app-em-react-native/","locale":"pt-br"},"rawMarkdownBody":"![Ilustração do Musclog](../../uploads/blog/2024/09/musclog-illustration.png)\r\n\r\nEu constantemente tenho aquela sensação de \"[Você se torna aquilo que jurou destruir](https://youtu.be/CqQRDZP3FnQ?si=gAuQhD_7PHF8PAv5&t=178)\" devido ao tempo que tenho dedicado ao bodybuilding nos últimos dois anos. Tenho acompanhado meus macros, meus treinos e até tirado fotos de \"brogress\".\r\n\r\nNão que eu tivesse algo contra o bodybuilding no passado, mas já tentei malhar antes e nunca realmente me envolvi. Sempre senti que eu era um skatista de coração e que estava traindo meu verdadeiro eu levantando pesos. Eu sei, bobo.\r\n\r\nEnfim, tenho usado uma combinação de aplicativos e integrações para monitorar meu desempenho, incluindo um [script Node.js personalizado para calcular meu TDEE e calorias médias](/pt-br/blog/coding/usando-google-fitness-api-para-calcular-meu-tdee-e-mais/) usando a [Google Fit API](https://developers.google.com/fit), mas como o Google Fit será descontinuado em breve em favor do novo Health Connect, não pude adiar mais o desenvolvimento do meu próprio aplicativo. Afinal, eu **\"sai de casa e comi pra caralho!\"**, então agora vai!\r\n\r\nMas como? Eu honestamente não tinha ideia de por onde começar, especialmente ao explorar integrações com a API de outro aplicativo. Eu nem sabia em qual formato esses dados estariam disponíveis. Qual é o padrão do mercado? JSON? XML? Binário? Eu não tinha ideia. Felizmente, descobri que algumas pessoas realmente inteligentes criaram [uma biblioteca para integrar a API do Health Connect com React Native](https://github.com/matinzd/react-native-health-connect/), e saber disso foi o ponto de virada para eu começar a desenvolver meu próprio aplicativo.\r\n\r\n## A solução perfeita\r\nEu criei todos esses scripts e integrações para monitorar meus treinos e nutrição, porque uma coisa que descobri nesses últimos anos de bodybuilding é que o que realmente me ajuda a ser consistente é monitorar tudo. Eu sou um cara de dados, e se eu puder ver meu progresso nos números, isso me motiva a continuar. Até porque, a verdade é que se você não toma nenhum anabolizante, o progresso é lento, e eu, pelo menos, não vejo nenhuma diferença no espelho, então os números são tudo o que eu tenho.\r\n\r\nEu já faço o rastreamento de tudo que como há dois anos, e também me peso com uma balança que mede meu percentual de gordura, então tenho muitos dados para analisar e identificar meus padrões de alimentação e treino. O que eu quero é algo que realmente é difícil de encontrar, porque a maioria dos apps ou sites que existem por aí não espera que alguém seja tão meticuloso a ponto de rastrear tudo todos os dias de forma obsessiva, mas eu amo fazer isso.\r\n\r\nEntão, a primeira ideia era simplesmente obter os dados e continuar meus cálculos com meus scripts, e assim nasceu a ideia do meu primeiro MVP.\r\n\r\n## O MVP\r\nComo eu disse, tudo o que eu queria era acessar os dados do Health Connect e obter meus dados de nutrição e peso, para que eu pudesse continuar executando meu script Node.js, mesmo que eu tivesse que ter um aplicativo simples que obtivesse os dados em segundo plano e os enviasse para o meu servidor. Parece um plano, certo?\r\n\r\nBem... parece que o Health Connect só permite que os desenvolvedores acessem [dados dos últimos 30 dias devido a preocupações com a privacidade](https://developer.android.com/health-and-fitness/guides/health-connect/develop/frequently-asked-questions#time-range). Ok... então isso significa que não posso obter meus dados históricos, e tudo o que está no Google Fit será perdido para sempre. Incrível!\r\n\r\n## O _Verdadeiro_ MVP\r\n![Perfeição](../../uploads/blog/2024/09/musclog-mvp-perfection.png)\r\n\r\nLegal, então nosso MVP morreu antes de chegar à costa; hora de pivotar: E se, em vez de ter um script Node.js que se conecta a diferentes APIs, eu pudesse ter um aplicativo React Native que fará a maioria das coisas, como rastreamento de treinos, insights de nutrição, cálculo de TDEE, gráficos, dicas, etc., e qualquer outro dado que possa estar faltando, eu obtenho da API do Health Connect? Eu poderia até adicionar uma opção para importar dados passados de um arquivo JSON. Dessa forma, se o Google Fit eventualmente permitir que eu exporte meus dados, posso importá-los para o meu aplicativo.\r\n\r\nNa verdade, já passei de aplicativo em aplicativo no passado, tentando encontrar a melhor maneira de monitorar meus treinos. Até tentei o Google Planilhas, mas a UX era horrível no celular, e eu gostaria de me concentrar no meu treino e não me estressar com tocar a célula errada na planilha.\r\n\r\n![Certo, eu vou fazer isso sozinho](../../uploads/blog/2024/09/fine-i-will-do-it-myself.png)\r\n\r\n## Então, React Native, hein?\r\nClaro, eu sabia que o React Native existia, mas como desenvolvedor React.js, nunca considerei realmente mergulhar nele, mas certamente não poderia ser tão difícil, certo? Quer dizer, eu já conhecia o React, então quão diferente poderia ser?\r\n\r\nBem...\r\n\r\nAcontece que construir um aplicativo React Native quando sua única experiência é com React.js é como tentar mudar de um skate para uma prancha de surfe. Claro, os princípios são um pouco semelhantes—equilíbrio, navegação, manter a calma quando as coisas dão errado, mas o meio é totalmente diferente. Neste caso, o meio envolvia descobrir como lidar com todas as peculiaridades específicas do dispositivo enquanto mantinha o aplicativo funcional e responsivo.\r\n\r\n![Surfando com um skate](../../uploads/blog/2024/09/surfing-with-skateboard.png)\r\n\r\nPor exemplo, como desenvolvedor web, eu foco em manter um estado local no cliente e obter dados do servidor quando necessário, mas no React Native, quero ter um banco de dados local, como devo fazer isso? Bem, descobri o [AsyncStorage](https://react-native-async-storage.github.io/async-storage/), então por que não usá-lo por enquanto? (isso vai me morder mais tarde)\r\n\r\nAinda assim, eu não tinha ideia de onde começar, mas após conversar com meus amigos [Juampi](https://barreto.jp/) e [Raf](https://www.pato.dev/) sobre minha ideia, eles sugeriram que eu usasse o [Expo](https://expo.dev/), um framework que permite construir aplicativos React Native sem ter que lidar com a parte nativa das coisas. Isso foi honestamente um divisor de águas para mim porque eu poderia simplesmente executar meu aplicativo no navegador a maior parte do tempo e usar meu telefone apenas para testar os recursos que exigem código nativo.\r\n\r\n## Explorando o Expo\r\nComecei criando um novo projeto Expo seguindo o tutorial \"[Crie seu primeiro aplicativo](https://docs.expo.dev/tutorial/create-your-first-app/)\", e então criei uma nova tela com um botão simples que se conectaria à API do Health Connect e obteria meus dados de nutrição, e lá estava eu, já tinha meu primeiro MVP feito, mas como eu não gosto muito de testar no meu telefone, copiei basicamente a resposta JSON da API e a salvei em um arquivo, para que eu pudesse continuar desenvolvendo apenas no meu computador e navegador—isso vai me morder mais tarde².\r\n\r\nDepois de brincar com o Expo por um fim de semana, tive uma ideia vaga do que eu precisava para o meu aplicativo:\r\n\r\n- [AsyncStorage](https://react-native-async-storage.github.io/async-storage/) para armazenamento\r\n- [react-native-paper](https://reactnativepaper.com/) para a interface do usuário\r\n- [i18next](https://www.i18next.com/) para traduções\r\n- [react-native-charts-wrapper](https://github.com/wuxudong/react-native-charts-wrapper) para mostrar gráficos\r\n- [@shopify/flash-list](https://github.com/Shopify/flash-list) para renderizar listas (basicamente só por causa [desta palestra](https://www.youtube.com/watch?v=BrYxGrE9sW8) eu fui convencido)\r\n\r\nHora de colocar as mãos calejadas para trabalhar!\r\n\r\n## A alegria (e dor) de aprender na prática\r\nConforme eu me aprofundava no mundo do React Native, percebi rapidamente que minha caixa de ferramentas confiável do universo React.js, bem, não era totalmente adequada para o trabalho. Para começar, meu esquema de banco de dados era muito complexo para o AsyncStorage, então, pensei, por que não mudar para IndexedDB? Spoiler: IndexedDB só funciona na web, não na versão móvel do aplicativo Expo. Oops.\r\n\r\n![Vida de desenvolvedor solo](../../uploads/blog/2024/09/life-of-solo-developer.png)\r\n\r\nDepois de algumas horas perdidas tentando implementar um polyfill para IndexedDB no React Native, simplesmente desisti e me vi no meio de uma grande refatoração. Decidi mudar para `expo-sqlite`, uma solução de banco de dados local adequada para dispositivos móveis. Mas aqui está o truque—eu ainda precisava do Dexie.js (uma camada para IndexedDB) para manter a versão web funcional enquanto eu desenvolvia o aplicativo, já que uso principalmente o navegador para isso.\r\n\r\nFelizmente, a equipe por trás do Expo realmente pensou em tudo: apresento os arquivos `.web` no Expo—essencialmente, o Expo permite criar arquivos específicos para a plataforma (como `database.ts` e `database.web.ts`) para que você possa ter diferentes implementações para web e dispositivos móveis. Isso foi uma salvação, e depois dessa descoberta, posso confirmar que refatorar código enquanto murmura \"antes tarde do que nunca\" é totalmente uma coisa.\r\n\r\nE não podemos esquecer os gráficos—porque o que é um aplicativo de fitness sem gráficos de progresso legais, certo? Bem, o `react-native-charts-wrapper` funciona muito bem no celular, mas não na web, então tive que trazer o `react-chartjs-2` para a versão web. Você pode ver aonde isso está indo: lidar com duas bibliotecas de gráficos diferentes, dependendo da plataforma, foi apenas mais uma parte da diversão.\r\n\r\nA essa altura, eu estava bem fundo nesse buraco de coelho, e para facilitar um pouco a vida, adicionei algumas ferramentas de desenvolvedor ao aplicativo, como funções de exportação e importação de banco de dados. Isso permitiu mover dados entre a web e o celular durante o desenvolvimento. Foi por volta dessa época que percebi por que as pessoas são tão apaixonadas pelo Firebase—talvez em uma versão futura, eu faça a troca, mas por enquanto, o Musclog é 100% offline.\r\n\r\n## Novas funcionalidades\r\nO desenvolvimento de software é muito parecido com o bodybuilding, você começa com um plano, mas depois descobre que tem genética ruim para os bíceps, e acaba pivotando e fazendo 28 séries para bíceps por semana (certo, pessoal?). Minha visão original era bem simples: apenas um lugar para registrar meus treinos e nutrição. **Mas como o Bambam diria, \"Tá saindo da jaula o monstro!\"**, e as funcionalidades começaram a crescer.\r\n\r\n![Rastreamento de treinos](../../uploads/blog/2024/09/musclog-workout-screenshot.png)\r\n\r\nE o rastreamento de nutrição? Bem, não é só sobre registrar refeições. Eu precisava ser capaz de adicionar alimentos, diferentes macros, monitorar calorias e integrar tudo isso com os dados de treino. À medida que fui adicionando recursos, percebi que estava usando o GPT para obter informações nutricionais. Então, por que não integrá-lo ao aplicativo? Foi assim que o Musclog acabou com um recurso de chatbot. Agora, posso perguntar coisas como \"Quantas calorias tem uma banana?\" e obter uma resposta rápida. Mas não vamos nos precipitar.\r\n\r\n![Gráficos de nutrição](../../uploads/blog/2024/09/musclog-nutrition-screenshot.png)\r\n\r\n## De rastreamento para chatbots\r\nEntão, aqui estava eu, lidando com registros de treino, monitoramento de nutrição e gerenciando múltiplos componentes para diferentes plataformas, e ainda decidi adicionar um pouco de ✨IA✨ na mistura? Afinal, todo mundo adora um bom chatbot hoje em dia, e se você me conhece, oh garoto, eu gosto de um chatbot—tanto que passei centenas de horas codificando uma [extensão de chatbot para Magento](https://github.com/blopa/Magento-Chatbot) que por muitos anos foi meu projeto de código aberto mais popular.\r\n\r\nComecei adicionando uma interface de chat simples ao aplicativo, onde os usuários podiam fazer perguntas como \"Qual é uma boa refeição pós-treino?\" ou \"Como posso melhorar minha forma no supino?\". A ideia era criar um treinador pessoal com IA que estivesse sempre disponível, pronto para fornecer insights e dicas.\r\n\r\nComo de costume, depois de muitas horas de codificação, decidi mostrar meu progresso para meus amigos, e eles disseram, \"Por que não usar [Gifted Chat](https://github.com/FaridSafi/react-native-gifted-chat/) para isso?\". Espere, você está me dizendo que após implementar uma interface de chat do zero, enviando e analisando mensagens, eu poderia simplesmente ter usado uma biblioteca? Bem, acho que essa é a beleza de aprender na prática.\r\n\r\n## Integração com OpenAI\r\nIntegrar o OpenAI ao Musclog foi uma escolha óbvia para mim. Eu já tinha experimentado com isso em outros projetos, como quando usei o OpenAI para [criar automaticamente tutoriais de codificação para Instagram Reels](/pt-br/blog/coding/como-automatizar-a-criacao-de-instagram-reels-usando-gpt-da-openai/). Com essa experiência, eu já estava familiarizado com chamadas de função, análise de respostas e manipulação de prompts. Então, pensei, por que não adicionar essa ferramenta poderosa ao meu aplicativo?\r\n\r\n![Conversando no Musclog](../../uploads/blog/2024/09/musclog-chat-screenshot.png)\r\n\r\nA integração em si foi bastante simples. Usei a API do OpenAI para processar as consultas dos usuários e fornecer respostas perspicazes. Toda vez que um usuário envia uma mensagem, o histórico do chat é enviado de volta ao OpenAI para manter o contexto da conversa intacto. Para dar um pouco de personalidade à IA, usei mensagens do sistema como, \"Você é um treinador pessoal prestativo chamado Chad, e está aqui para ajudar nas jornadas de fitness. Pergunte-me qualquer coisa!\"\r\n\r\nMas não parou por aí. Eu imaginei que, se já estava integrando o OpenAI, por que não ir um passo além? Então, adicionei uma opção para pedir ao OpenAI que criasse um plano de treino diretamente. Por exemplo, você pode usar o chatbot para perguntar, \"Você pode criar um treino de push-pull-legs para mim?\" e pronto—Chad, o treinador, entra em ação, gerando uma rotina de treino personalizada na hora. Este recurso é particularmente útil quando você não tem certeza de como estruturar seu treinamento ou se está procurando variar sua rotina.\r\n\r\nAs possibilidades aqui são bastante empolgantes. Com essa integração, o Musclog não é apenas um rastreador de treino estático; ele se torna um treinador de fitness dinâmico que evolui com suas necessidades. E sejamos honestos, ter uma IA que pode criar um plano de treino em segundos parece um superpoder, especialmente quando você está na academia e precisa de uma rotina rápida no momento.\r\n\r\nNão só isso, mas também dei acesso a todas as informações de saúde ao OpenAI, então meus dados de nutrição, treinos, peso e porcentagem de gordura estão disponíveis para a IA usar, para que ela possa me fornecer melhores insights. Claro, devido a preocupações com a privacidade, tornei isso opcional, e também adicionei um recurso para excluir todos os dados sempre que o usuário quiser. Mas imagine, fazer um treino realmente difícil e depois perguntar ao GPT o que ele acha sobre isso, bem legal, né?\r\n\r\n## Design do App\r\nEu não sou designer, mas gosto de pensar que tenho um bom olho para UI/UX por causa de muitos anos de desenvolvimento web. No entanto, o desenvolvimento móvel foi uma fera completamente diferente, então precisei terceirizar os designs de UI e qualquer arte, usando recursos gratuitos de código aberto ou IA.\r\n\r\nSim, sim, eu sei de todo o ódio em relação à arte gerada por IA, mas era isso ou arte feita no MS-Paint, então optei pela arte gerada por IA.\r\n\r\n![Logo do Musclog no MS-Paint](../../uploads/blog/2024/09/mspaint-musclog-logo.png)\r\n\r\n### UI\r\nPara a interface do app, usei componentes do [react-native-paper](https://reactnativepaper.com/), o que facilitou a criação de um visual limpo e moderno, com a maioria dos componentes de que eu precisava, como botões, cartões e modais.\r\n\r\nIsso resolveu o lado funcional das coisas, mas e a parte estética? Eu terceirizei meus esforços para o [v0](https://v0.dev/), uma ferramenta da Vercel que usa IA para gerar aplicações simples de uma página para serem usadas em um app Next.js. Eu simplesmente inseri o texto explicando o que precisava e pedi que fosse mobile-first, e voilà, eu tinha um design lindo para o meu app.\r\n\r\n### Logotipo e ilustrações\r\nPara o logotipo e as ilustrações, usei o [DALL-E da OpenAI](https://openai.com/research/dall-e) para gerar as imagens. Eu simplesmente digitei o texto explicando o que precisava e detalhes sobre o meu app e obtive alguns resultados bem legais. Depois, usei o [Photopea](https://www.photopea.com/) para fazer alguns retoques e adicionar efeitos às imagens.\r\n\r\n## Chegando na Google Play\r\nDepois de meses de desenvolvimento, testes e uma quantidade não saudável de Pepsi Max, o Musclog estava finalmente pronto para o grande palco: Google Play. Mas é aqui que as coisas ficaram... interessantes. Eu estava sob a impressão de que poderia simplesmente enviar meu aplicativo e pronto, como fiz em 2019 para meu jogo Gotinha. Ha! Mal sabia eu que o Google Play força você a conseguir 20 pessoas para testar seu aplicativo antes de ele ser lançado, mesmo que você seja apenas um desenvolvedor solo. WTF, certo?\r\n\r\n![Musclog no Google Play](../../uploads/blog/2024/09/20-testers.png)\r\n\r\nEncontrar 20 pessoas para testar seu aplicativo parece fácil até que você realmente faça isso. Acabei recrutando qualquer um e todos—amigos, família, colegas de trabalho, conhecidos em festas, talvez até tenha pedido a alguns estranhos na rua (brincadeira, talvez). Mas após reunir meus \"bros\" de teste e passar pela fase inicial de testes, adivinhe o que aconteceu? Meu aplicativo foi rejeitado. Sim, é como se a vida simplesmente não estivesse pronta para me deixar vencer.\r\n\r\nEntão, lá estava eu, esperando mais 14 dias, corrigindo os problemas que eles apontaram e reenviando o aplicativo. Foi uma montanha-russa de emoções, para dizer o mínimo. E como se isso não bastasse, porque eu queria a integração com o Health Connect, **mas não só isso**, acredite ou não, eu também precisava ter um site público para o meu aplicativo, então tive que criar um site para ele, escrever uma política de privacidade e preencher um formulário explicando por que precisava de acesso aos dados do Health Connect. Então, criei rapidamente um site usando [Next.js](https://nextjs.org/) e [https://v0.dev/](https://v0.dev/), e usei o GPT para escrever uma política de privacidade para mim, você pode vê-la aqui: [https://blopa.github.io/musclog-website/](https://blopa.github.io/musclog-website/).\r\n\r\nVocê pode estar se perguntando se eu fiz este aplicativo para mim mesmo, por que me importo em tê-lo no Google Play? Bem, por um lado, acho que o Google Play é bastante conveniente e quero conveniência ao instalar o aplicativo no meu telefone, e em segundo lugar, quero compartilhá-lo com meus amigos e familiares, e acho que é mais fácil compartilhar um link para o aplicativo no Google Play do que enviar um arquivo APK.\r\n\r\nMas depois de todos os obstáculos, recebi finalmente o sinal verde, e o Musclog estava oficialmente no Google Play. Então, sim, não foi fácil, mas definitivamente valeu a pena. **\"É hora do show, porra!\"**\r\n\r\n![Musclog no Google Play](../../uploads/blog/2024/09/musclog-on-google-play.png)\r\n\r\n## Tornar-se open-source ou não\r\nEu sempre libero todos os meus projetos como código aberto—é meio que minha coisa. Mas quando se tratou do Musclog, eu hesitei. Este aplicativo me levou mais de 300 horas para desenvolver, e tem alguns recursos realmente interessantes que não vi em outros aplicativos de fitness. Achei que talvez pudesse recuperar parte do tempo que gastei nele vendendo-o no Google Play ou talvez adicionando um botão de \"me dê uma gorjeta\".\r\n\r\n![Tornar-se open-source ou não](../../uploads/blog/2024/09/open-source-or-not.png)\r\n\r\nMas uma vez que meu aplicativo foi aprovado e, para ser honesto, após usá-lo nas últimas semanas, percebi que, embora os recursos e ideias sejam legais, o aplicativo não é tão polido quanto eu gostaria que fosse. Percebi que talvez o Musclog fosse melhor como um projeto open-source, onde a comunidade pudesse me ajudar a melhorá-lo—o que, para ser honesto, também é um desejo, porque a maioria dos projetos open-source não ganha muito destaque e são principalmente mantidos pelo criador, então o melhor que posso esperar é que as pessoas criem issues e peçam recursos. Viva!\r\n\r\nHonestamente, meu sonho seria ter um aplicativo open-source que de alguma forma me fizesse ganhar dinheiro—algo como Mindustry ou Blender. Então, depois de limpar o histórico de commits do Git, não porque estou envergonhado do meu código—ok, talvez um pouco—mas principalmente porque não tinha certeza se tinha cometido um erro ao enviar uma chave do OpenAI por engano, decidi tornar o Musclog open-source.\r\n\r\nVocê pode conferir o código aqui: [https://github.com/blopa/musclog-app](https://github.com/blopa/musclog-app). Se você gosta de fitness e codificação, sinta-se à vontade para contribuir. Quem sabe? Talvez juntos possamos transformar isso em algo realmente especial.\r\n\r\n## O que o futuro reserva\r\nAgora que o Musclog está no mundo, já estou pensando no que vem a seguir. Existem muitos recursos que eu adoraria adicionar, como análises de treino mais detalhadas, capacidades de IA aprimoradas e talvez até alguns recursos sociais para compartilhar treinos com amigos ou participar de desafios.\r\n\r\nUm \"problema\" com o Musclog é que ele é realmente um aplicativo para levantadores avançados, não que eu seja avançado (não sou), mas sou louco por dados e monitoramento, e meu aplicativo realmente brilha se você é o tipo de pessoa que monitora cada repetição, série e caloria. Então, estou pensando em criar uma versão mais simples do aplicativo, com menos recursos, ou talvez com um processo de onboarding melhor, para que os iniciantes também possam usá-lo, afinal, a maioria dos levantadores são iniciantes, certo? Eu também gostaria de conseguir convencer meus amigos a começar a malhar e usar meu aplicativo, então preciso torná-lo mais atraente para eles.\r\n\r\nAlguns dos recursos que estou pensando em adicionar são:\r\n- Integração com dispositivos BLE\r\n- Capacidades de rastreamento de alimentos no aplicativo\r\n- Análises de treino mais detalhadas\r\n- Opção de usar um modelo OpenAI personalizado\r\n- Talvez um modelo LLM local um dia\r\n- Conta online para sincronizar dados entre dispositivos\r\n- Perfil online para compartilhar treinos e desafios\r\n- Recursos de gamificação\r\n\r\n## Conclusão\r\nOlhando para trás, a jornada de construir o Musclog foi tanto sobre crescimento pessoal quanto sobre codificação. Aprendi muito sobre desenvolvimento móvel, o que sempre é uma coisa boa. Eu posso ser um desenvolvedor web hoje em dia, mas não foi assim que tudo começou; nos meus dias de faculdade, eu era um desenvolvedor C++, e o desenvolvimento web nem fazia parte do curso, então voltar ao desenvolvimento de plataformas é uma mudança de ritmo agradável.\r\n\r\n![Apenas faça!](../../uploads/blog/2024/09/just-do-it.gif)\r\n\r\nEntão, se você está pensando em iniciar seu próprio projeto—seja um aplicativo, um site ou outra coisa qualquer—meu conselho é simples: apenas faça. Abrace os desafios, aprenda com os contratempos e aproveite o processo. Porque no final das contas, a única coisa que está entre você e seus objetivos é a decisão de dar o primeiro passo.\r\n\r\nObrigado por me acompanhar nesta jornada, e mal posso esperar para ver o que construímos a seguir. Levante, Registre, Repita!\r\n\r\nVejo você no próximo!\r\n\r\nPS: Se você quiser experimentar o Musclog, pode baixá-lo no Google Play: [https://play.google.com/store/apps/details?id=com.werules.logger](https://play.google.com/store/apps/details?id=com.werules.logger).\r\n\r\n### Mas e o código?\r\nNa verdade, eu queria incluir trechos de código e explicar como a maioria das funcionalidades funciona, mas percebi que isso deixaria o post muito longo. Então, decidi escrever uma série de posts explicando como construí o Musclog. Fique de olho!\r\n","frontmatter":{"tags":["react","react native","expo","android","workout","tracker","logger","musclog"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2024-09-21T00:00:00.000Z","id":null,"path":"musclog-aproveitando-minha-experiencia-com-reactjs-para-criar-um-app-em-react-native","show":true,"title":"Musclog: Aproveitando minha experiência com React.js para criar um App em React Native","hideExcerpt":false,"subtitle":"De Bodybuilding para Codebuilding: Criando um aplicativo de fitness completo usando React Native e Expo"}}},{"node":{"excerpt":"I constantly have that feeling of ”You become the very thing…","html":"<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9ANp6W958WuB+XeaMatedgt6hgeR6Vd97WLqMfo6RmNuaeeeZc+WEXbiGdueGXeyEW+WBW++HW+N9Wdt3VwDkeFLreFCbdHFxdYGLhoZudoG4mIjj1729zMKZtrzT2MXP0L/Y1cDCs6OognyigHuwgnaZh4vtkGbji2cAv4d5yo97Y2FzKz1geGNoN0NqaH6WfIKHZYGXZ4ifVmh8V2+FQFx5jIqJnJ6fimxwpHVueGFt7ZJo6ZFqAMCVhMCZiJ5uZH5ZWoSBiX2GmX6Cj1hOWE1Zdjteh0NBV11ZZyMlQ2FYYfm6kOetied/Vt2Na+aGXuh+VQDvf1LMk3vPj3XxjGDJtKLJ1caljoNXV2lCV3hTVmtCR2FIUWwnLUppbXfew6npwqDTn4WvnpbniWDphV0A6IRc2o5ts5eM4Jl30b6m4eLIm5WQSE9vYX2UaHSEPFF/VX2qY564aYqfw7Oo5cKisb68xZF83ZBu54dfAOuEWsCairCgmoeEk2V+paqvsaaqppaEhYCNoYiXqmZkgICHmEhgg5mVleDLscfLvZCgsKualMiVgOuAVgDsgFSropyiuLyDeIAgNmWSh47ux6fHnIZ5b4doWXCxe2zSrZaZfHfFn4etwcNHfLlkhbKgm6DQiW7ufU8A5oJanp+j5HpU8HxRcWp0c6e8t8O+l5qYqIJ2dlxfvXhe7s6rwbqndJutgZytgoGTdH6SlqaqfMXcl7K4AJuwtWCPu2ViiYVeaHyHoIGNn3Kcs2CVsH2vwa2imtGmkLmFdqOWk1WOu2djeaBuY2tha4FXXHe82HHL6QByyuZvu9tZmsZajK5knMJrkq9tpMRmpcZeocVtnLiBssiHqbt+r8hgncRrka1umLNxm7VolrVyvt16xt6H9XdtMXZTwwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Musclog illustration\"\n        title=\"Musclog illustration\"\n        src=\"/static/e09791c79da43db20131c45d78322136/42a19/musclog-illustration.png\"\n        srcset=\"/static/e09791c79da43db20131c45d78322136/e3135/musclog-illustration.png 256w,\n/static/e09791c79da43db20131c45d78322136/06341/musclog-illustration.png 512w,\n/static/e09791c79da43db20131c45d78322136/42a19/musclog-illustration.png 1024w,\n/static/e09791c79da43db20131c45d78322136/e8464/musclog-illustration.png 1536w,\n/static/e09791c79da43db20131c45d78322136/445c6/musclog-illustration.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Musclog illustration</figcaption>\n  </figure></p>\n<p>I constantly have that feeling of ”<a href=\"https://youtu.be/CqQRDZP3FnQ?si=gAuQhD_7PHF8PAv5&#x26;t=178\" target=\"_blank\" rel=\"noreferrer\">You become the very thing you swore to destroy</a>” due to the amount of time I’ve been dedicating to bodybuilding in the past two years. I’ve been tracking my macros, my workouts, and even taking brogress pictures.</p>\n<p>Not that I had anything against bodybuilding in the past, but I had tried working out before, and I never really got into it. I always felt like I was a skateboarder at heart and that I was betraying my true self by lifting weights. I know, silly.</p>\n<p>Anyway, I’ve been using a combination of apps and integrations to achieve my performance tracking, including a <a href=\"/en/blog/coding/using-google-fitness-api-to-calculate-my-tdee-and-more/\">custom Node.js script to calculate my TDEE and average calories</a> using the <a href=\"https://developers.google.com/fit\" target=\"_blank\" rel=\"noreferrer\">Google Fit API</a>, but since Google Fit is going to be deprecated soon in favor of the new Health Connect, I couldn’t postpone the development of my own app any longer.</p>\n<p>But how? I honestly had no idea where to start, especially tapping into integrations with another app’s API. I didn’t even know in which format this data would be available. What’s the market standard? JSON? XML? Binary? I had no idea. Luckily, I found out that some really smart people created <a href=\"https://github.com/matinzd/react-native-health-connect/\" target=\"_blank\" rel=\"noreferrer\">a library to integrate the Health Connect API with React Native</a>, and knowing that was the tipping point for me to start developing my own app.</p>\n<h2 id=\"the-perfect-solution\" style=\"position:relative;\"><a href=\"#the-perfect-solution\" aria-label=\"the perfect solution permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The perfect solution</h2>\n<p>I created all these scripts and integrations to monitor my workouts and nutrition because one thing I’ve discovered in these past few years of bodybuilding is that what really helps me stay consistent is tracking everything. I’m a data guy, and if I can see my progress in numbers, it motivates me to keep going. The truth is, if you’re not using any anabolic steroids, progress is slow, and at least for me, I don’t see any difference in the mirror, so the numbers are all I have.</p>\n<p>I’ve been tracking everything I eat for two years now, and I also weigh myself with a scale that measures my body fat percentage, so I have a lot of data to analyze and identify my eating and workout patterns. What I want is something that’s really hard to find because most apps or websites out there don’t expect someone to be so meticulous as to track everything obsessively every day, but I love doing it.</p>\n<p>So, the first idea was simply to get the data and continue my calculations with my scripts, and that’s how the idea for my first MVP was born.</p>\n<h2 id=\"the-mvp\" style=\"position:relative;\"><a href=\"#the-mvp\" aria-label=\"the mvp permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The MVP</h2>\n<p>As I said, all I wanted was to access the Health Connect data and get my nutrition and weight data, so I could continue running my Node.js script, even if I had to have a simple app that fetched the data in the background and sent it to my server. Sounds like a plan, right?</p>\n<p>Well… it seems like Health Connect only allows developers to access the <a href=\"https://developer.android.com/health-and-fitness/guides/health-connect/develop/frequently-asked-questions#time-range\" target=\"_blank\" rel=\"noreferrer\">data from the last 30 days due to privacy concerns</a>. Okay… so this means I can’t get my historical data, and everything that is on Google Fit will be lost forever. Awesome!</p>\n<h2 id=\"the-real-mvp\" style=\"position:relative;\"><a href=\"#the-real-mvp\" aria-label=\"the real mvp permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The <em>Real</em> MVP</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAADoElEQVQ4y12U22/iRhTGHcDg+w1jjMEEaAIkKxJIuCQN6WartFWlvqzah3Zf+tqX/ssRhGS7AWMbe2xjz9iuyGUr9ad5mPNJ3+jMfEeDJUmSPpMkqWUGzmb7vN+JEMLz/lim2X67QxMiiTNnTW161JQYgSPYuixjX82+D5dLsHxywxC9KDGE49F31aI66LQlSvixod129avjFokzuT1C4YSd2QNb1/E8L1p+cVdLEPjQtnZHxDC6mf7QVLXx0WFLVn7v7n86P7h+13hXU0/q6qilYRDGyyewfHICH66W3trwfB8+PlgbO0QQ/np7c1QWrrr6ca18LEsdVb44rA5blUGjclpXsfSVBEJorDxzDeIYvdwlidHF2ahM091aNYuR+SyNZygyRxeyVAYryDSHhc9EUWSZ3v3cuJ8brhu8aNvAH52OahIxHVRkgdJKdLlIaQrZ0hmZY6uChDlvmObGXG9MY7NaWrvadW3LvDifKDzbaWgsSZcYtl4SVInnKFqguJoofm37lTCKjRVAME7TFEF4fTFVOHFfrWqM8FunflXXKqLMF1iBZCsc/585jlEUhb4PDQO4rr/LOYp+vpnqIt2ulntK6c9e64+T1r4k6oJY44Wa8Gb2vXC9dhFKttt4tQyDIEQIxTG6Gg0lAtflIofTPzW124NaieXIHEnkKJXl3sx+ZJlBkqS+j1YruN3C3ZvH6HI4FAhcLyk5jOLyLI0zFM4QWZrE6V3bSZIglDgb3zJd34+SJLFMYK4dCBGC0fVkUqSJhspLbEHmKYmlijwh8yRTYHVRwGzLXhubxS6k1efPa8tyHu6N+9nKXDtrwxj1z3ii0G2ouibJIlWR6eOmpBbZIs329BKWJHGa+s8riKIAITdN/STZlQiGw8GlQAmn7U4+J3zDF8eV8qTdYgpcBsvn9ggsTSMA5hDOwnBm2wsIZzC6A+BuGywQ9L4dv1cEZdA5rAryx079r2H7+25jv1yqF6VmqYiFoWlZiyB4cp0vtv0IwJNt/wPchW0/OpuHXz68P1CkSbd+Uq9OtfLf4+6nUbvf0k4blZ6uYAAsgDvb2HPXmTvOHIAHx7nf2DMA5pZ5d3E2EAtEr1HNYPkDXvzY2e/XNSpPZbA8niEwhABCLoReFAEYeRC6wJ2FoRWF9saajfsDDid6zXp2L0/mSTpPE7uQSSJLEjni/+P5PGrx608ShZfDiUgxh5pG4gVdJXWV1BSSxAkyR7EF5l8xwV6kEeY6GQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Perfection\"\n        title=\"Perfection\"\n        src=\"/static/c03a23e83744cf5f92d6e94b6426ecd8/42a19/musclog-mvp-perfection.png\"\n        srcset=\"/static/c03a23e83744cf5f92d6e94b6426ecd8/e3135/musclog-mvp-perfection.png 256w,\n/static/c03a23e83744cf5f92d6e94b6426ecd8/06341/musclog-mvp-perfection.png 512w,\n/static/c03a23e83744cf5f92d6e94b6426ecd8/42a19/musclog-mvp-perfection.png 1024w,\n/static/c03a23e83744cf5f92d6e94b6426ecd8/68141/musclog-mvp-perfection.png 1534w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Perfection</figcaption>\n  </figure></p>\n<p>Cool, so our MVP died before reaching the shore; time to pivot: What if, instead of having a Node.js script that connects to different APIs, I could have a React Native app that will do most of the things, like workout tracking, nutrition insights, TDEE calculation, charts, tips, etc., and any other data that could be missing, I get from the Health Connect API? I could even add an option to import past data from a JSON file. This way, if Google Fit eventually allows me to export my data, I can import it to my app.</p>\n<p>I have actually jumped from app to app in the past, trying to find the best way to track my workouts. I even tried Google Spreadsheet, but the UX was horrible on mobile, and I would like to focus on my workout and not stress myself out about touching the wrong cell on the spreadsheet.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.890625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACtElEQVQoz2WSS08TYRiF50+4ceOCDQtZAIZoaaRAEUQsCDWUSwiKAgZqwXBpuFuQUhBBEES8cOnMlE6n07l833wz7bSFliqligmGaiJijAti+icMFNHE5CzPk7znnBeTgCspr+gOb/ji8d0PsbfrfmCz2qrrTab2Po7GvaIbCa5T56kwyDmQQAkMsbkh+4NB2ecLRzY5lr+QVZp79VaWSt/VObCucCJP/YshgUK8ExMYO/DgwIMLjH0jIO7sROPxj1MTkxO2+UQisRnZbr3X4UO0JBwBkCUFBgceMunHgIeALAlYAnKkyJECY1cQPTv1dGx0dmWZej63PNA7Ih+dTUmAkoBT5B2QI48QD4FBljwWEfBxoQDaigQ+7cYgFOZe4AuLxJOZJSiv7+3tRMLKdjQUDqKgIsjABVhCYHBM5EjIOSRA+b085BzhDfng+34icVhYWJdf0ZqZVTY9bPn5Y//w1+HWuyDk1hSZ9Yq0yDkQoDAkOCVAIeBUJDYURLFo6OuXXbcYWHzjVKlulOYWme+32obHoZs++Pb5fTTk9/HJaWRIYycFQtqLGCRQLoaxvqR0LY+AErH2Dc52NizMWKhRXdftKoZHsWjYKzIypCVIH031p3qXgmiCsJf3zBd3PSt7MLnsBL3dg+JY0cpEu2TNL9NVXmufZjjeJ9Knm/+FA5LbOvtK3WDRmec0zVbSIzUOLQw1low3FYzcuVJTUZma32ybfx1A/8HHMejG9odpObXF5rk842O9cVhbZy4obzKW5+s1mhljcUebsd406kc0Av/BIk8ZGs3nUjTaJou2ZUxd0519sy2vqNZUou41qPoN2Y7+0vqWHsGzJh8HPoGRQPklZnV1KSOn6uyZ9JSUyxm5tRma6jSV/nyqts9Q1Hxd3a+/dFeTnnlRh+PLipT8Gddvn3/Y5TycJc0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Fine, I will do it myself\"\n        title=\"Fine, I will do it myself\"\n        src=\"/static/96bce10dcf9e8d007b3b5a85ede8aaed/42a19/fine-i-will-do-it-myself.png\"\n        srcset=\"/static/96bce10dcf9e8d007b3b5a85ede8aaed/e3135/fine-i-will-do-it-myself.png 256w,\n/static/96bce10dcf9e8d007b3b5a85ede8aaed/06341/fine-i-will-do-it-myself.png 512w,\n/static/96bce10dcf9e8d007b3b5a85ede8aaed/42a19/fine-i-will-do-it-myself.png 1024w,\n/static/96bce10dcf9e8d007b3b5a85ede8aaed/e8464/fine-i-will-do-it-myself.png 1536w,\n/static/96bce10dcf9e8d007b3b5a85ede8aaed/dc8ac/fine-i-will-do-it-myself.png 1572w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Fine, I will do it myself</figcaption>\n  </figure></p>\n<h2 id=\"so-react-native-huh\" style=\"position:relative;\"><a href=\"#so-react-native-huh\" aria-label=\"so react native huh permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>So, React Native, huh?</h2>\n<p>Of course, I knew React Native was a thing, but as a React.js developer, I had never really considered diving into it, but surely it couldn’t be that hard, right? I mean, I already knew React, so how different could it be?</p>\n<p>Well…</p>\n<p>It turns out building a React Native app when your only experience is with React.js is like trying to switch from a skateboard to a surfboard. Sure, the principles are somewhat similar—balance, navigation, staying cool when things go wrong, but the medium is entirely different. In this case, the medium involved figuring out how to wrangle all sorts of device-specific quirks while keeping the app functional and responsive.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACnklEQVQozzXL3U8SAQAA8PtremvrzSdfXFn5NZdr6rK0B3O5nMwNUaaiIDOUQCKEjI+Tu+OA45tLODhABIQUUDkQLD7vQIaurJYPPdV66Pf+AxgKrlMwQ0F0Bqqe7JTSYPkYrByDDAU18mgprS+ldJW09rps+doijwveMhO4avpKJQ9dwQEmi/zPcCOH/CiZGlm4WTCgOrlkYf7nF309o79u+qhGYoQrXdXoeSrdE9ba8JRgEzMDNIXUcwYmi9AZuHaGnRT3a+eOZh4+JdUyNl/jJy6qOHke7WFLb3VMdzxdahtaut3JahtevtM1A9BZI5MzMTkTTaH0mblXGR8U2S+LmCmAW1KZvs0gKlitxsFkdGdKsn2P8/7RuqGbp3m8gfQKdoAaZaCzKJ01Vim0kUfjhE7AEa2INW/X5Ycpt9ARslp0127JFaFwJxzDGtcUsjsgd7x2fZxUYUAlg9QySI0y1Ci0kvn3r4rmi7TeFfZ2CfHBWVU4YSvmbM0zi/sIZxHRRU/kJUTIyWD/CgQweax+jtF57KJgaRSwMmUqnhpbFee4JtA5Kpx4tUgGjM1WuNaMkJ9jc+QB2+qft/rGFPa7s1rgpuW7aZF/vgWqVV8+j/9i3L8vie+t0Au+tlr2biNIezfbZDMl60l+JM7zBLlWYkDm7OBoR8RmQBHdk8aiLioKp8LYyR5ViURSBB6w94zy5+bFH7bVb3gb0jXVwv6nJW9oGnJ18tGHy9D4O8szmQVwhCBXGMajaOIITh5qj+JaVC7ijHHteh2R8ttzB6LYQb8S71Pg/WLs/qLu+ZaVizpmDS6W1grEgkqPX42ToJsETX4YDNmU8QDP6JlROYdA4oFA37usHpMZeEaHgtjdCvmELpxjdE5soe2Tkr+lvLqPYoqGewAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Surfing with a skateboard\"\n        title=\"Surfing with a skateboard\"\n        src=\"/static/052058d9f01be0cb6aab7b65270e7f9e/42a19/surfing-with-skateboard.png\"\n        srcset=\"/static/052058d9f01be0cb6aab7b65270e7f9e/e3135/surfing-with-skateboard.png 256w,\n/static/052058d9f01be0cb6aab7b65270e7f9e/06341/surfing-with-skateboard.png 512w,\n/static/052058d9f01be0cb6aab7b65270e7f9e/42a19/surfing-with-skateboard.png 1024w,\n/static/052058d9f01be0cb6aab7b65270e7f9e/e8464/surfing-with-skateboard.png 1536w,\n/static/052058d9f01be0cb6aab7b65270e7f9e/445c6/surfing-with-skateboard.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Surfing with a skateboard</figcaption>\n  </figure></p>\n<p>For example, as a web developer I focus on keeping a local state on the client and getting data from the server when needed, but on React Native, I want to have a local database, how should I go about that? Well, I found out about <a href=\"https://react-native-async-storage.github.io/async-storage/\" target=\"_blank\" rel=\"noreferrer\">AsyncStorage</a>, so why not go with it for now? (this will bite me in the ass later)</p>\n<p>Still, I had no idea where to start from, though, but after chatting with my friends <a href=\"https://barreto.jp/\" target=\"_blank\" rel=\"noreferrer\">Juampi</a> and <a href=\"https://www.pato.dev/\" target=\"_blank\" rel=\"noreferrer\">Raf</a> about my idea, they suggested I use <a href=\"https://expo.dev/\" target=\"_blank\" rel=\"noreferrer\">Expo</a>, a framework that allows you to build React Native apps without having to deal with the native side of things. That was honestly a game-changer for me because I could simply run my app in the browser most of the time and only use my phone to test the features that require native code.</p>\n<h2 id=\"diving-into-expo\" style=\"position:relative;\"><a href=\"#diving-into-expo\" aria-label=\"diving into expo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Diving into Expo</h2>\n<p>I started by creating a new Expo project by following the ”<a href=\"https://docs.expo.dev/tutorial/create-your-first-app/\" target=\"_blank\" rel=\"noreferrer\">Create your first app</a>” tutorial, and then I created a new screen with a simple button that would connect to the Health Connect API and get my nutrition data and there I was, I already had my first MVP done, but because I don’t really like testing on my phone, I basically just copied the JSON response from the API and saved it into a file, so I could continue developing only on my computer and browser—this will bite me in the ass later².</p>\n<p>After playing around with Expo for a weekend, I had a vague idea of what I needed for my app:</p>\n<ul>\n<li><a href=\"https://react-native-async-storage.github.io/async-storage/\" target=\"_blank\" rel=\"noreferrer\">AsyncStorage</a> for storage</li>\n<li><a href=\"https://reactnativepaper.com/\" target=\"_blank\" rel=\"noreferrer\">react-native-paper</a> for the UI</li>\n<li><a href=\"https://www.i18next.com/\" target=\"_blank\" rel=\"noreferrer\">i18next</a> for translations</li>\n<li><a href=\"https://github.com/wuxudong/react-native-charts-wrapper\" target=\"_blank\" rel=\"noreferrer\">react-native-charts-wrapper</a> to show charts</li>\n<li><a href=\"https://github.com/Shopify/flash-list\" target=\"_blank\" rel=\"noreferrer\">@shopify/flash-list</a> to render lists (basically just because of <a href=\"https://www.youtube.com/watch?v=BrYxGrE9sW8\" target=\"_blank\" rel=\"noreferrer\">this talk</a> I was sold on it)</li>\n</ul>\n<p>Time to get my calloused hands to work!</p>\n<h2 id=\"the-joy-and-pain-of-learning-on-the-fly\" style=\"position:relative;\"><a href=\"#the-joy-and-pain-of-learning-on-the-fly\" aria-label=\"the joy and pain of learning on the fly permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The joy (and pain) of learning on the fly</h2>\n<p>As I ventured deeper into the world of React Native, I quickly realized that my trusty toolbox from the React.js universe was, well, not entirely fit for the job. For starters, my database schema was way too complex for AsyncStorage, so, I figured, why not switch to IndexedDB? Spoiler alert: IndexedDB only works on the web, not on the mobile build of the Expo app. Oops.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACW0lEQVQozyXLa0/aUACA4f7QZfu2LNmSZTPuoskucU5FAbkWZ6EtFgqlpYXSc3o9bS2lLRYrlwFOPy2Zbv9iMSbPpzd5sbJo4aJVEswMC9MszLbUDAtTjJJqKEdNkGbBYUN5lGmpR02QbWtl0XqElbpmsWsWOtpBuVGkxVNOpQRdMn1RHxIcrLRAvW91gNtRvSoHC6SwV2kdcxouoYeZkN2WFWn+hXkeWI5XZYTFej2KZ1Ey1yyXk5Tpcj1wouBqqajIcn1Rcw8ZpfI4F7tOmrN3KSDp3kWSAB2tbm+AO1ZQYDgjESA0mgzs0I6ScTK1/AumZxUF84fsViSE7TeN7Sp8WxBwRu4A1wljO4i5ARqYfp2Hp82+6oSi6mpOoDrBeZSwfWuflGkYsFaMUTAgBv5OTaYFtY/Cy/nq95+7UZyUaXEr2/iYbeTJbk91Hvrd/f2/v8AJU5RMKkNaDbADBuzSyociz0NHRgHR0diBDe1ARaMCM/iGcyJ0gR3qbihqXs/wzySjJKCaMix3EbaFC6++117sEPWuHi+WTjzj0Xi+XKPRZONz7vnG3nAy6xuejHxO80Q7avbRlxL3Zp8sdgxsmwBP3uefbaZ59Xw8X4WzpRPPV9fX46tFqniWytPBZHr5cxUl88Wv2+n6BrrRy68nTzczOc7E3p3IhwwQVHsXb5eaymlHqwoGJaEqr7/+VNjcwY9JkezZBK8TvJEhxQNCOBEMyfD2ziBWVXwa+KI7ybX1koDwrlPXIkoL8239oCalqH6ehXU9omBQg6Nc28i1tJrsie6kqvj/Ady2xoYddCZ4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Life of solo developer\"\n        title=\"Life of solo developer\"\n        src=\"/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/42a19/life-of-solo-developer.png\"\n        srcset=\"/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/e3135/life-of-solo-developer.png 256w,\n/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/06341/life-of-solo-developer.png 512w,\n/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/42a19/life-of-solo-developer.png 1024w,\n/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/e8464/life-of-solo-developer.png 1536w,\n/static/2afc83fff1f0d25fe75b2a4b8c7ffbc5/445c6/life-of-solo-developer.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Life of solo developer</figcaption>\n  </figure></p>\n<p>After some wasted hours trying to polyfill IndexedDB for React Native, I simply gave up and I found myself in the middle of a major refactor. I decided to switch to <code class=\"language-text\">expo-sqlite</code>, a proper local database solution for mobile. But here’s the kicker—I still needed Dexie.js (a wrapper for IndexedDB) to keep the web build functional while I was developing the app since I mostly use the browser for it.</p>\n<p>Thankfully the team behind Expo really did think of everything: Enter <code class=\"language-text\">.web</code> files in Expo—essentially, Expo allows you to create platform-specific files (like <code class=\"language-text\">database.ts</code> and <code class=\"language-text\">database.web.ts</code>) so you can have different implementations for web and mobile. This was a lifesaver, and after this discovery, I can confirm that refactoring code while muttering “better late than never” is totally a thing.</p>\n<p>And let’s not forget the charts—because what’s a fitness app without fancy progress graphs, right? Well, <code class=\"language-text\">react-native-charts-wrapper</code> works great on mobile but not on web, so I had to bring in <code class=\"language-text\">react-chartjs-2</code> for the web version. You can see where this is going: juggling two different chart libraries depending on the platform was just another part of the fun.</p>\n<p>By now, I was deep into this rabbit hole, and to make life a bit easier, I added some developer tools to the app, like export and import database functions. This made it possible to move data between web and mobile during development. It was around this time that I realized why people are so in love with Firebase—maybe in a future version, I’ll make the switch, but for now, Musclog is 100% offline.</p>\n<h2 id=\"building-the-features-one-rep-at-a-time\" style=\"position:relative;\"><a href=\"#building-the-features-one-rep-at-a-time\" aria-label=\"building the features one rep at a time permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Building the features, one rep at a time</h2>\n<p>Software development is a lot like bodybuilding, you start with a plan, but then you find out that you have lagging biceps genetics, and you end up pivoting and doing 28 sets for biceps per week (right guys?). My original vision was pretty simple: just a place to track my workouts and nutrition. But to get there, I had to build a robust system for creating and editing exercises, constructing workout plans, viewing past workouts, calculating workout volume, and so much more.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 222.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAIAAADqwg+aAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFkUlEQVRIx6WW61MTVxjG1wQ0bDbZLLu5LLMbhRCCXEIuJIEsEJRbghGxGDTjhYEwY+XiMMpNC/3QdopVnEKlgoBTudSAgoYkIHeZcRytCs7YOnW0M461X9oR5R8odJKUEANUrb95Puz7nvOcc/bszjkvsPQRAHa7fWhoyPG/AHg8XkhISEBAAIPB2PSBAARBCIVCLpfL+xC4blwzCwQCBEGC3xsEQXAcd5lJkgwPD4dhGEXR9zRzOBySJHEcBxAE4XA4wR8I4gYI/giA9Ub1rAjx4R1mBEEwDNNoErRaiqIopRuVSqVUKimK4vF4fkP4m/l8flhYGEEQIpFIKBSSJBkaGip0g2HYujOjKArDsFgs3rFjh0FvSEhIyMrK0ul0BoNBrzcYjUaxWOz3UfzfmQ3DEATx+XyJRBIWFioSicLDxTiOQxALhuF3bFi4SBQRIY6K2iqVSgmCjIqKiomJwfGQyMiIiAjx2mYURVksdnT01j7rRdv13t6ejp6eC2fONJSWlNTV1R3Yf+jg/gMdHS2xsTEQxPKufMUMQZBSKZ+csE1P2aenHDM3x4adtrExe2/vpeampks/dFgvX9KolUwmtLZZLo+7MTJwc9oxMjzY2dk2NeUcHbMNDFgPHixsbv722qBVoZBB0DpmhUI2Nnp9espZWVnd2Nj46NHd589/vX//9qmGUzbb4OiNofh4+X/NPD5um5x0NDR83d7e/vjx3K1bMz3dXbMP7jycu3Pvp1upuqSgIND7wX3NLLlcenNmtL29/fjxarU6NduQa9yZV119wumwOR3XpqduJFGJIMhc0wypVIrrtisnT35eXV1bW1tz9GjF4EDf3MPbTqejqOjT8+fPJadQIAhi2PKyPT89iqJMJiSTxTqHr50929Ta+v29e9OTk/ampsYLF1pGRob35hfU153UajUgyPT8yC4zhmECgYDH4/H5fJIklUqFRBIplUqTk6nt23XbtqVIJJEajSY6OlYmiyMIAsMwPp+P4ziGYYBQKKQoKjMzU+tGpVJrNAnx8UqZTCaVxsXFyVSqeLlcrlQqFQqFTqfLzMxMTU3VarVCodB1DGVkZFRUVKSnp5tMptzc3D179iQnJycmJnqG8z6o1erdu3cfPny4uLg4OzubIAjX6Wk0Gi0Wi8GNxk3COqjVaoVCkZaWlpGRQZIkINy8OS09XW8wpKWnZ+n1VFLSiii3fDJJSckUlaTTpabodJu3bAGCEYTDhmCIyWFBMIsZDLO9QjlwMAf2zXiEsFkIzHYdgKERkQU1XxbXn7bUnbLUnyqqW9ZnDYdqviio/WolsyxL/TcFNV+GRkQCVNbOq08Xrjx985aeLfQ/mf9uYrZ15uf+J/NXnvl3uPp0gcraCfAFuN5cuMtSllNY4qddRaW7ikrXyFvK9OZCvgAHUox5EwtLE2/8NTa/2P3wjx9/+XNs/u/J1R0WllKMeYAghMgpPJJfVmUqOWYqOe5Vfmnl3vKaveU1+aWVvnlTybH8sqqcwiOCEALQpOm7Zl90zf7uq+65l513njWPP2gef3Dx7m/dcy/9OnTNvtCk6QFJrKzqXNeJNmtt6+UVtVmrWrrLT7eWn26taun2az3RZq061yWJlQEwmx20MXC1wE0boaAgCAwCN21cswPMZgMoinK5vDWFcbmY6w5fuxVFUWD1fb9+NcDzawR8awyGm/UqkCCGS2/VJPuWMZvNJpMpLy/PbDbvW4XZvC/nE5d8GwFPRbW4uLi0tPT69etXr+a9oRdPdPcvl7zhv3WYB6fT2d/f39fX53Q6PRmbG8+zw2HvtNo6L9ucDq/DDvgCgkwOBwEAYMOGDQAACNx4Q89eekMXAcvQ6XQGgwGCIJ1ODwwMpNFoLDc0Gi0wMJBOp0GQK6TTaV7LP1SqCK8kQQwAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Workouts tracking\"\n        title=\"Workouts tracking\"\n        src=\"/static/d41801c4cd3ed5901fa8893f146a8c94/42a19/musclog-workout-screenshot.png\"\n        srcset=\"/static/d41801c4cd3ed5901fa8893f146a8c94/e3135/musclog-workout-screenshot.png 256w,\n/static/d41801c4cd3ed5901fa8893f146a8c94/06341/musclog-workout-screenshot.png 512w,\n/static/d41801c4cd3ed5901fa8893f146a8c94/42a19/musclog-workout-screenshot.png 1024w,\n/static/d41801c4cd3ed5901fa8893f146a8c94/b4ad3/musclog-workout-screenshot.png 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Workouts tracking</figcaption>\n  </figure></p>\n<p>And nutrition tracking? Well, it’s not just about logging meals. I needed to be able to add foods, different macros, track calories, and integrate all of this with the workout data. As I kept adding features, I noticed that I was using GPT for nutrition information. So, why not integrate it into the app? That’s how Musclog ended up with a chatbot feature. Now, I can ask it things like, “How many calories are in a banana?” and get a quick answer. But let’s not get ahead of ourselves.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 222.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAIAAADqwg+aAAAACXBIWXMAAAsTAAALEwEAmpwYAAAG3UlEQVRIx6WVa2wU1xXHBwR4lz5s73vnuW+vpcZm1/O489yZ2ZnZHXttLWvW2JJNMDUxdu02TVFs2hAwINHEITYxAkwoSq2AS9qqCgkQ4rpNEA+VJM2Hth/oxyof+pCiSpWI1A91NTO2WUKqvn462j333nOu5t77v+dCK/8H0BWbt/8noEAgAMPwpk2bXC5X3Rfgeszq1n+haCyWTKVCMIygGIJhMIrCKGo5CAojaBiGv8gQx4FO3vjgxZ+9/9KVW9Nv3jz+k+XpN2+eeOv2Cz/9he3cmlv66PP27r1Xrv9q7sa9uaUPofcerFz67Z9e++gPi7/7y7nb91//zR/f+P1fFz7+5Icff3L5/qfvPVh5aJ+t3Pxs5f2//eON+5++8+e/33ywAk2cvjh5dnHy7OKB+cXJcz+amF+cmF+cnF+cOHPJstMXJ87Ydvri/rmF/acWnj21sP+V1549tTBx+iK01VXnmGvLplB9Pe7zoR5PBIFxBMaQ8Fe/tNW9ZbO7bstWV1044A/6fd6GejQcrv/Kl911W6BAMIjhOI4TGI7HR/qbp55OHRxPiGw6mUql0zhBxOLxeCIBwwhOEIBlFVVNJJIwjPj8fsjr9YZCoWAwGAqH4YMj0fPH0DOHgjyJBUMohgUCgWjMSvf7/XV1da2traqqut3uhoYGj8cDBYPBVCrVnE4nE4lUczqebkqkm5KJRCwSTSSTqaZUPBaLx6wJYrEYjmEoisbj8WgsGgwGIYIgJFHU29v1ardW7sqXu5RSu9JuKqWOQt/OfFdJzOUkXQM0LcmyapqCKPIcx/N8JBKxkkVB0EyTEwQ+l+MUOVc05Pai3GGyLCvpmrajIhdNyTDylbLSVdJ7urVqRTJ0HMMgHMdFUVQVBQDAAgBoBtA0oGmGolkbhmFERXbmcmJ4SeJ4niCI1eR8Ps+yLMdxrPPHcazjr8HQjDNkT2G5VrL12aIoyzKwYRgG/Duc6VaTBUEwDCOXyymKIstyrVPblGXZcSRJBAAQhL1hDMNIkrQe6sRJkqRpmqqqko1oI0kSz3PFUpeiG9aGEQTB83zt8uwlcwAAXdcLhcL6d672M4yiGapRsJK9Xi+CICiKIjV8run0rHaiKGzj9XqhSCRCkmT2v4QkSUskqVSqXC739vaapsnzvPgfIAhCLpdLp9PWOWcymdYatv0LagMymQyO41BjY6P/UTw2Xq/XU4PX63VGfT5ffX29z+drbGyEMAyja2AYRtM0wzA0TdN1XdO0QqFgGEY+n2cYhiRJURSr1SoAAEVRa8O4NSU6p7J9+/ZKpbLdplwud3d379ixo7Ozk2VZmqYVRRkaGuIdbRME4aifoiiGsQRM1UDTNEVRJEnSFGXdCdbSbzab5TjuobZzOclsL+VkhaIojuMEQeBto2mK51d9RyeOogBgLHk6t4oHzNcPPM9JYt/gU0pe29byRFtbhiLbSl1lkmxra8tmWp/YNfotUZa3tXxNNzt6+p9E4DAUi8WMYrGQk+nxvTv3jnRNTFT3Dg8Nj/f2Dewe/ub0O7e//dzR4acnx7/z3OD5C9U9Q+WOzvKTg+0jo2goCKWamjpLHZphPnN54XvLd/f9+NLk20uT79459stfH1i6w/9get+15WeuLY9dXe69fOb5n985cu3uoatL5tBONARbb5Way7F59dLy/PFrs9fvXji7fPb49dn9V2Znb5y8de/V2RszV++ce+v2/Acfnj+1NDez9OqFu69PHdjr84egSISgaDqvyEe++9TLh0e/f3DfCweHXz48+tKhkROHR1+c+sbJo+MzR8ZOHh2bnhqbOTJ+Ymp05thYX08XDKPWbgMARFFsN00pr/O6rhVLqmEahqnpBTGn0CxPA8c4mhVoINCAkyTJOqpIJOIIxDRUWVWEvKIXinlNM/JqZ0d7Pq+yAFgVjbWNYwFDa4WibnasVk9bJICiaMaumzRFMTRNkqQsy44qawsYQ9OSokqygmEo5PF4wuEw/CgIgsAwHA6HA4HA46PhkPVAWcUAhuHWx2hpabGUkc2yLEuSZEtLy6N3NpPJZmEYttbM8zxXg1PxKpVKX1/fwMBAd3c39ygMTTM0tfrcOOXaWRtFUYZhDA4OViqVcrlcrVZ7enoGBgaKxSJJkgAAsi1rlLp69gyjCAJFo1HrGqwhCAIAoFwuDw4O7tq1q7+/f/fu3ZVK5eEowxgdnd0De6zdDgQCzc3N6TUSiQRJkrqu2yXaWo4oioqiZLPZZDLZ1NSUTqdj0WgEx/1+P1RLQ0NDIBCAIGjjxo0QZBUZDMPWm84pQBC0YcOG1YQNa0AQtHnzZpfLtR691Wa96Xa7neZ6yj8B8tDSCGGw/9QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Nutrition charts\"\n        title=\"Nutrition charts\"\n        src=\"/static/b69f535658f7c245847ca719437cf7af/42a19/musclog-nutrition-screenshot.png\"\n        srcset=\"/static/b69f535658f7c245847ca719437cf7af/e3135/musclog-nutrition-screenshot.png 256w,\n/static/b69f535658f7c245847ca719437cf7af/06341/musclog-nutrition-screenshot.png 512w,\n/static/b69f535658f7c245847ca719437cf7af/42a19/musclog-nutrition-screenshot.png 1024w,\n/static/b69f535658f7c245847ca719437cf7af/b4ad3/musclog-nutrition-screenshot.png 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Nutrition charts</figcaption>\n  </figure></p>\n<h2 id=\"from-tracking-to-chatting\" style=\"position:relative;\"><a href=\"#from-tracking-to-chatting\" aria-label=\"from tracking to chatting permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>From tracking to chatting</h2>\n<p>So, here I was, juggling workout logs, nutrition tracking, and managing multiple components for different platforms, and still I decided to add some ✨AI✨ into the mix? After all, everyone loves a good chatbot these days, and if you know me, oh boy, do I like a chatbot—so much that I’ve spent hundreds of hours coding a <a href=\"https://github.com/blopa/Magento-Chatbot\" target=\"_blank\" rel=\"noreferrer\">Magento chatbot extension</a> that for many years was my most popular open-source project.</p>\n<p>I started by adding a simple chat interface to the app, where users could ask questions like, “What’s a good post-workout meal?” or “How do I improve my bench press form?” The idea was to create an AI-powered personal trainer that’s always on hand, ready to provide insights and tips.</p>\n<p>As usual, after many hours of coding, I decided to show my progress to my friends, and they were like, “Why not use <a href=\"https://github.com/FaridSafi/react-native-gifted-chat/\" target=\"_blank\" rel=\"noreferrer\">Gifted Chat</a> for this?“. Wait so you’re telling me after implementing a chat interface from scratch, sending and parsing messages, I could have just used a library? Well, I guess that’s the beauty of learning on the fly.</p>\n<h2 id=\"openai-integration\" style=\"position:relative;\"><a href=\"#openai-integration\" aria-label=\"openai integration permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenAI integration</h2>\n<p>Integrating OpenAI into Musclog was a no-brainer for me. I had already dabbled with it in other projects, like when I used OpenAI to <a href=\"/en/blog/coding/creating-instagram-reels-coding-tutorials-automatically-with-openais-gpt/\">automatically create Instagram Reels coding tutorials</a>. With that experience, I was already familiar with function calls, parsing responses, and handling prompts. So, I thought, why not add this powerful tool to my app?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 222.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAsCAIAAADqwg+aAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHPUlEQVRIx6XWeUyTaR4H8AcopRTRQi+ERURFUXe5FCi0FAoIGmSEGRyBlT0yOzMxMTBsnEODM9nNuu4fkxWG5RDEHY4KcqhUdKSAUEsppfTgKO1bQan0gJZytl0GhHfTt4LiMrNx95NvnvyeN+8vv/d98zQpgP8PgIVo+Z8AEonk6emJQqEwGIyT07sF+O7Zs2//gZ1eXp5eXjs9Pd8poKBVeLXp8d/vdxe2iYo7B4ofS/9bBoraJYXs/sI2EeD8C65TTJfynt55YWmdhX+Yhn8wvp1HM6/rFj3MnoU5ZrjLAoML31V+Wcx8OKLpGDWwoUk2NNmmnGpVaNnKyUcKbSukax81PJRPtj+dYisnWyGdaHqlskuSm//Pr0puAQ8Pgu9en/ZWNgQppRLpwMDg4OCQVDrQL+zv7xcJhSKpuPeZvGdcpX42NvZC9QKG4StX/goA2O7qCvKu5v2j4tu29s4fFw1zBs2icXLRqDPNTC5M6xaNuvlpnck4sWZ6sWJZeGmeW1qYhuG1q3/OQwPgQSIA/0OHfnlg35G41ON/LDuWXZTwWUniZyW21VrkliTmlsRnlx7LLjqWU3Qsu+h4bsnuEzmYI5m4fWHAdYfbdkeAOf43fBHsk7/slb/mXbC267s1pFjdVbDqXbC6u3DVK39t5zXrdY9ra3uLX5LLYVRWA8ATyQQXh20p+X4VcHCJJbhs+XDxSlj58uHi5UNF1iKgZPlo+XJgqTWHi5ePlK34F1qIBbDj2SbgTiDhne22pRX4VsH+11d8S+G91+F912G/Mnh/Gby/HN5TCh8oh/3LrfXBG9bC9duXqGsw+ncs4E4g4l1Q6NCPwXkIfNwHPhWBT/qt+VSE1JvzByH4SIjNluz8k8ot+Qpwd3fH4XDffPN1410Ws66RWdfAvN106/bd6tp6Zl1jTW0D83Zjbf0dZl3jrfqm5geP7jQ/CIugbduBx+PdAc7NjUQi9QoEKpVKCUEKhVL1fESnkiqgp+Pj46OjowqFAoKgZ2Nj4+PjM0YjDMNnz551dHQkkkgAh8ORyeS2trb+fhGvp4fbzROLBP19nD6hqFcg4PN7e3r4fH5vn1DI5/cK+vomp6YyMjLRaCcikQjckMlcLlen0w0PD8tkw6OjY3KFcnT0qXKdAgFBkE6ns1gs6enpaDT6VTORSOzp6bFYLAMDA2Kx2Ho+hwZHRkbkcrlEIoEgSKvVqtVqvV4/Pz9vMpnebubxeDMzMzwej81mP3nypKOjg8vl8vn87u7u3t5ekUg0NDQkEAggCFpaWtpistlslslkEolELBYrFAqNRqNWqzUajUqlUqvVKpXq+fPnWq12i8e2TeYgeDweh8MRi8UymWwYIZFI5HL54KD1Xcxm8xbNc3NzEoRQKJRIJHw+f3BwcAD5iUokEqlUKpPJ3p7sjncnk8k9PXyTycTj8bhcbldXV2dnZ19fn23y0NCQbb5cLlepVJs+mAvWZft2HIfDMRgMEAQplUrIelQUExMTGo1Gq9XaVp1ONzExodVqFxcXz5w586r5o/O/vfiXC908wcyMUa/XGwwGvV5vNBoNBsPU1JRer9doNFNTUwaDQa1Wz87O2k4YGo0mkUgg5cP3f5N15sIXXzXU19fU1NQibiFq/0NdXV1NTU1wcDAWi3VzcwO+u319dvn4+Oz6xRt2bcXb29tW+Pn5HTx40N/fH1Bp1DhEfHz8cUR8fDyNRqMiaDRaFCI6OjpmHZ1Op9FokZGRIDQ09NSpU5mZmRkZGZmZmVlZWenp6fHx8TExMXFxcXQ6PSwsjEKhREVFJZx87+QHHyanpScknYyKiqJQKIBCodBoNAaDER0dTafTY2JiGAxGXFwcg8GIjY2l0+nh4eEUCoVKpdJtrLdFU6lUa3N4ePiJEydOnz4dGxsbFRVFpVKPHj0ats7W+VOszUlJSWlpacnJySkpKcnJyYmJiRsDf561OSEhISUlJRWRlJSUmppKp9MjIyOpb4iIiNiiOTLCKigoKDAwMAgREBAQtFlgYGBoaGhkpO3e1wCJ7EEgkr++fLmhoaGysrKqqorJZFZVVVUjampqqqurmUwmg8EgEAje3t5ebwCf5Pw+7+rnAqF0+celubk5k8lksVgWEQsLC2azeX5+Hobhc+fO2dnZ4fF43DrrCTuV9v6vM06fz8n9vvL7GzcqKm7erKi4+WqteF2HUyg7cDgSmUwkkTYCUA4oezsHB3s7sJmzkxPB3Y2Id8M6YwAAGDRqGxbj4uz0OlhnEEGlUsNDwtNyQi7zQi51BF/qCLnUEXKxI/hiR8ilx8hqTeCXbQFfsF/l80e/usgJSc8DqzYwvALDL9/1f1hLSwuLxbrPambdu9N8t+nB/eaHLSxbWlj3Wlj3fmr78EHLpvfEYrE4HA4AYGdn/QRksgeZ7LGxJRCJRCJpY2uFWufg4IDBYLBYrIODg6Ojo729vSvC3t7+re1Gy78BjSQRtkO9ctIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Chatting on Musclog\"\n        title=\"Chatting on Musclog\"\n        src=\"/static/704cbad9cc4378eb4a5830458e14e1ff/42a19/musclog-chat-screenshot.png\"\n        srcset=\"/static/704cbad9cc4378eb4a5830458e14e1ff/e3135/musclog-chat-screenshot.png 256w,\n/static/704cbad9cc4378eb4a5830458e14e1ff/06341/musclog-chat-screenshot.png 512w,\n/static/704cbad9cc4378eb4a5830458e14e1ff/42a19/musclog-chat-screenshot.png 1024w,\n/static/704cbad9cc4378eb4a5830458e14e1ff/b4ad3/musclog-chat-screenshot.png 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Chatting on Musclog</figcaption>\n  </figure></p>\n<p>The integration itself was pretty straightforward. I used OpenAI’s API to process user queries and provide insightful responses. Every time a user sends a message, the chat history is sent back to OpenAI to keep the conversation context intact. To give the AI a bit of personality, I used system messages like, “You’re a helpful personal trainer named Chad, and you’re here to help with fitness journeys. Ask me anything!”</p>\n<p>But it didn’t stop there. I figured if I’m already integrating OpenAI, why not take it a step further? So, I added an option to ask OpenAI to create a workout plan directly. For instance, you can use the chatbot to ask, “Can you please create me a push-pull-legs workout?” and boom—Chad the trainer springs into action, generating a customized workout routine on the spot. This feature is particularly handy when you’re not sure how to structure your training or if you’re looking to mix things up.</p>\n<p>The possibilities here are pretty exciting. With this integration, Musclog isn’t just a static workout tracker; it becomes a dynamic fitness coach that evolves with your needs. And let’s be honest, having an AI that can whip up a workout plan in seconds feels like a superpower, especially when you’re in the gym and need a quick routine on the fly.</p>\n<p>Not only that, but I also gave access to all the health information to OpenAI, so my nutrition, workouts, weight, and fat percentage data is available for the AI to use, so it can give me better insights. Of course, due to privacy concerns, I made it optional, and I also added a feature to delete all the data whenever the user wants. But imagine, doing a really hard workout and then asking GPT what it thinks about it, pretty cool, right?</p>\n<h2 id=\"app-designs\" style=\"position:relative;\"><a href=\"#app-designs\" aria-label=\"app designs permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>App designs</h2>\n<p>I’m not a designer, but I like to think I have a good eye for good UI/UX due to many years of web development., but mobile development was a completely different beast, so I had to outsource the UI designs and any arts to either free open-source resources or to AI.</p>\n<p>Yeah yeah I know about the whole hate for AI-generated art, but it was either that or art made on MS-Paint, so I went with the AI-generated art.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 678px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVQY03WMUW+CMBSF+f8/Z8n2MLO9LAvEhIehVbAFEVCgt1hhpVCwdFEzY5bsy83NOfeeHMv8Ml25i7v9j2marMPhEAQBxvjm/7wB4LHOGCOl1Fr3fS+EsKIochzH8zyMMefcGCOEUEpxzpumIYQ8lrZtO5vNhmGoqmo+n1uEkHEcgdIVQgvPYwAE47IoVgh1UkZhSDDeBIHv+5vNZrlYhGFY13Unpeu6Ft5GxphknwFjn45zrOvlev2FUJymQsokywJCPLREK2Tb9j7PP2z76eX59f1t7rqWyktzasYSdAltkg4FrUmkCtrt8y7NzKnpD4UoKaWAAzyKduInWPmqoEaNFoOYljGDHYP4WKUV2/FjxmBXsaRiCdC4gh3/Lr6I5yc+43tabutTfs2nVnvupFZS91L37fm2u/bc30ZqdRFjpyaltJLXixgvgU4PP+Z5vEEZQerAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MS-Paint Musclog logo\"\n        title=\"MS-Paint Musclog logo\"\n        src=\"/static/7e20ac19f1f7fbefd54041cd6e4b562a/dc057/mspaint-musclog-logo.png\"\n        srcset=\"/static/7e20ac19f1f7fbefd54041cd6e4b562a/e3135/mspaint-musclog-logo.png 256w,\n/static/7e20ac19f1f7fbefd54041cd6e4b562a/06341/mspaint-musclog-logo.png 512w,\n/static/7e20ac19f1f7fbefd54041cd6e4b562a/dc057/mspaint-musclog-logo.png 678w\"\n        sizes=\"(max-width: 678px) 100vw, 678px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">MS-Paint Musclog logo</figcaption>\n  </figure></p>\n<h3 id=\"ui\" style=\"position:relative;\"><a href=\"#ui\" aria-label=\"ui permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UI</h3>\n<p>For the app UI, I used <a href=\"https://reactnativepaper.com/\" target=\"_blank\" rel=\"noreferrer\">react-native-paper</a> components, which made it easy to create a clean, modern look and has most of the components I needed, like buttons, cards, and modals.</p>\n<p>That took care of the functional side of things, but what about the aesthetics? I outsourced my efforts to <a href=\"https://v0.dev/\" target=\"_blank\" rel=\"noreferrer\">v0</a>, a tool by Vercel that uses AI to generate simple one-page applications to be used in a Next.js app. I simply inputted the text explaining what I needed, and asked it to be mobile-first, and voilà, I had a beautiful design for my app.</p>\n<h3 id=\"logo-and-illustrations\" style=\"position:relative;\"><a href=\"#logo-and-illustrations\" aria-label=\"logo and illustrations permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Logo and illustrations</h3>\n<p>For the logo and illustrations, I used <a href=\"https://openai.com/research/dall-e/\" target=\"_blank\" rel=\"noreferrer\">OpenAI’s DALL-E</a> to generate the images. I simply inputted the text explaining what I needed and details about my app and got some really cool results. I then used <a href=\"https://www.photopea.com/\" target=\"_blank\" rel=\"noreferrer\">Photopea</a> to do some retouching and add some effects to the images.</p>\n<h2 id=\"making-it-to-google-play\" style=\"position:relative;\"><a href=\"#making-it-to-google-play\" aria-label=\"making it to google play permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Making it to Google Play</h2>\n<p>After months of development, testing, and an unhealthy amount of Pepsi Max, Musclog was finally ready for the big stage: Google Play. But here’s where things got… interesting. I was under the impression that I could just submit my app and be done with it, like I did back in 2019 for my game Gotinha. Ha! Little did I know, Google Play forces you to get 20 people to test your app before it goes live, even if you’re just a solo developer. WTF, right?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.796875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQozwEZA+b8ACwpKVxXVDEvMCAfIHVvarOuquro5NTV1aWmp0NGTHJvbsTBvdrX1MG/vHFvbjs5OTEvMEE8O3JtaiYlJgAnJCY6ODhfXFtOTE6DgH5nZmZ0dnswMTS6t7SanKDGxMNaXWOTkI+oqatbWFmLioomIyR8d3Tn5N9YWFoAMDAyMjAxQkA/aGdnQkJETUtKSklLoZ6bycrMa2tsjIyMZGJiqKWisrS2XFxdW1teLiwsv7+8dXR1FhUXAHZ3eh0dH0I+PVBOT1ZTUmdnaK6urtTV02tqanFvbmhmZVxZVrWzsKmqq1dVVlBOT25tbF5eXy0pKD87OQBJR0gjIyZ0cG5sbXJzc3RdXF2XlpSgnZpoZWJjX12ioqGFhIWgn56ZmJaCgYBSTk5cW1xPTU1aVFFSTEkAKCYnUE9RWFVVbm5vsLCvc3R2f3x6u7q3fHp4h4aFjY2Oh4WFw8LCn52cbGppeHRzfn1+XVlYVlJPLiwsAGpmY/L08mVnbElGRYB9fICBgpeVlL6+vaurq7a2tbq6uK+vsMLCw56en1xaWaqoppeYmFdUU0tGRR8eHwAYFxi6uLSxtblRT1BtammKiorPzsxWVVZ/fn97enmDg4OCgoNaWVjR0M57e31raml0cnFYVVRgXl4eHR4ACgsOPz08pKanYWBhhIF/zMzJg4KDFRYZU09OaGhpaWlrUE9PLCwwkZGS3NvalJOSRkJCnpuajY2PDg4PACUlKCUjJXl3d4aGiLi1s5+fnzo7QDM2PEtJSoyLi46NjFpaXD9BSDw9QqenprGwrmpnaFlaXDMyMnx5egAsLC86OTtgXl60srHCwL1NT1JQSUtuZm5zdntfYGJfX2F0dXhpaGlHR0lSU1e9vLuxsbFTU1ZOTU85OjwAIyQnWlhYsa+t29vZdnZ2UExOWHB2VXxxXl1gVVlfVlpfZGZqX2FlXmBjTk9ThISF5OPhxsfGbW5yGxsgAGRkZLu5uNbV05GRkVVVVmFdXxU/UDFMQicmJjA2PT9DSC4yOC80OhwhJ2NkZ1xeYaalo9fW1LKys19gZaAKVbzZf9AuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Musclog on Google Play\"\n        title=\"Musclog on Google Play\"\n        src=\"/static/2f4435481c82229b5ad1e2f673ddf4d0/42a19/20-testers.png\"\n        srcset=\"/static/2f4435481c82229b5ad1e2f673ddf4d0/e3135/20-testers.png 256w,\n/static/2f4435481c82229b5ad1e2f673ddf4d0/06341/20-testers.png 512w,\n/static/2f4435481c82229b5ad1e2f673ddf4d0/42a19/20-testers.png 1024w,\n/static/2f4435481c82229b5ad1e2f673ddf4d0/7383e/20-testers.png 1535w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Musclog on Google Play</figcaption>\n  </figure></p>\n<p>Finding 20 people to test your app sounds easy until you’re actually doing it. I ended up recruiting anyone and everyone—friends, family, co-workers, acquaintances at parties, I might have even asked a few strangers on the street (kidding, maybe). But after gathering my testing “bros” and getting through the initial testing phase, guess what happened? My app got rejected. Yeah, it’s like life just wasn’t ready to let me win.</p>\n<p>So there I was, waiting another 14 days, fixing the issues they pointed out, and resubmitting the app. It was a rollercoaster of emotions, to say the least. And as if that wasn’t enough, because I wanted Health Connect integration, <strong>but not only that</strong>, believe it or not I also needed to have a public website for my app, so I had to create a website for it, and write a privacy policy, and fill out a form explaining why I needed access to Health Connect data. So I quickly spun a website using <a href=\"https://nextjs.org/\" target=\"_blank\" rel=\"noreferrer\">Next.js</a> and <a href=\"https://v0.dev/\" target=\"_blank\" rel=\"noreferrer\">https://v0.dev/</a>, and got GPT to write a privacy policy for me, you can see it here: <a href=\"https://blopa.github.io/musclog-website/\" target=\"_blank\" rel=\"noreferrer\">https://blopa.github.io/musclog-website/</a>.</p>\n<p>You might be wondering if I made this app for myself, why do I care to have it on Google Play? Well for one, I think Google Play is quite convenient and I want convenience on installing the app on my phone, and second, I want to share it with my friends and family, and I think it’s easier to share a link to the app on Google Play than to send them an APK file.</p>\n<p>But after all the hoops, I finally got the green light, and Musclog was officially on Google Play. So yeah, it wasn’t easy, but it was definitely worth it.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVQoz2N4+PDRnTt3noPB06dPnz179vTp01u3bt+6dfvZs+f/UcH3P//W3nm39s6bpddfPf/ym+HBo0cPHj58/uLFu3fvXr169fTpsydPQEbcv3//zZu3cG1///37////0XvvXBqXLT9+3bd91ax91xn+Ewf+/gVp3nP2TnzN1M0nr2V1Luxftoth8aUj8y8cvP7m6f////+hAhTNYO7tRy8CC7vd0ps8Mlu2HznPMP30nqmndp97dv/X719/UTWgAYhxN+49PXD6yrlrd//+/Qd19r8/f/79+f3n968/v3/Blf79/evf37///vz+9+cPVuMY/AP8e6dOK2lqn7VoWeuEKe2TprW0t2dkZk2aObuipXPu0pW1HT0rNmz+////mzdvPn36hOwpBl0dncDQUCN7+5iEhIPHTixfs87d11/T0CQqLt7A2CQlPdPS1q6qtu7///8/fvz49esXis05OZkJiYnuXh7Z2ZmTJ01sbm4OCQkxMNCPS0hQ1VSPiYkxs7JcvHgxOMD/ojs7LK8yNTPbztIiPiGpqLg4JSXVx8dXR083IjJCRU0tIiJCz8CgqroaHuAomvNKypvqavqa69u6+zo7Ojo6O2tqauPj4zs7O9PT0/v6+nNz82bPmQMPbRTNHz9++Pnz15dv3379+vnnzx9Mt+EBDJ8+ff758+c/vDGMSzMAxD14Zb8NfeEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Musclog on Google Play\"\n        title=\"Musclog on Google Play\"\n        src=\"/static/94c86cf4c9336297db75be297075c49d/42a19/musclog-on-google-play.png\"\n        srcset=\"/static/94c86cf4c9336297db75be297075c49d/e3135/musclog-on-google-play.png 256w,\n/static/94c86cf4c9336297db75be297075c49d/06341/musclog-on-google-play.png 512w,\n/static/94c86cf4c9336297db75be297075c49d/42a19/musclog-on-google-play.png 1024w,\n/static/94c86cf4c9336297db75be297075c49d/9bae8/musclog-on-google-play.png 1330w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Musclog on Google Play</figcaption>\n  </figure></p>\n<h2 id=\"to-open-source-or-not-to-open-source\" style=\"position:relative;\"><a href=\"#to-open-source-or-not-to-open-source\" aria-label=\"to open source or not to open source permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>To open-source or not to open-source</h2>\n<p>I always open-source all my projects—it’s kind of my thing. But when it came to Musclog, I hesitated. This app took me over 300 hours to develop, and it has some really nice features that I haven’t seen in other fitness apps. I figured maybe I could recoup some of the time I spent on it by selling it on Google Play or maybe adding a “tip me” button.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAELklEQVQ4y2WUWVMiVxiG+Z/5A8ldapKZi4xJSh3jgsuwg4psg+zdQAOyNDS90Mgm2Mgi7jqZmkr+Qjxv6hwHS2suvj770++3nGO6HtVxdSbhZlTH7VhmdvNtjq7NbT6mLbWHcxVfLjTcT5VXa6bnwVCCUI5CqMRwOXx9+CX0iv54IkOp8uC5MI6VLO5eQBnwbiwjL8awEbbBEXVDbwi4m8jfwS6ZMgUFIQb7fghJoYwt+x6kSoopvpwrpEBFTcMacyHA+zDoFJnrc4Vzo6GY9svwfwrDdRDBT28WcBBOwRfw42b8wmW6UZRS2I3tYTVgQbYSxcNUfXb9Zg5nSmvw+v346A7i3R9r8EczCIZ8LJZPCkcS7icKWsc5eLg9eHkvTnsl3E0UBjs/rWJ8UnkO/v25gk4jhy2rA7/+uQbP/j5GvfLzuunCqGHYLWM2qEJXsmiqAqZ9EUanxIBdvYAtiwWh0AGL66QvMus184hwfpy2i2xMoSwptKPU0lBraWhSBo16BrqcZf2ZUUVHyyMQ9MKz72FxpQCpwrH1jl5grSzyOFaEJyBVOGgVGVCVMqiWUqiLPJuj5dFUBNidDrQVAXfnCib9CgtBV8/D43GwfdSbs7lCmp3ZaRUtLYeCEEWGDzOF9BAFtupZCHse8C4nBnoet1OFxXfUK2Fnx8wSQfe9yvLlsIYvlw1EwvuIHnrx94XGMjwb1iBmIkh8tCJqszM4OzyqM6DNus3OzmFMIf3MgVzCj3QywPp07noiQztKImO1oRwNYtQXcX32dFNOmgVs75hZQqcD8fXVmxk1fL3SwcX9DPr5QmNheJipKAtRLL1fRjoRwrlRw7lRxXRQRVvLYWljBZFCEOOByFxnwJtRnXyeqORiLJFYxAuBC5F/r5u4OauDtlwqjB9+fIfltU12329HMh4mKtq6gIXVJdg4N3q9IzxMvtXh2aACoRaDr+gnm7vbZDfoJAUtSeic3s0Rj9+DNwtLWPiwhqrCoagkkJcTOMh48dvqIiwpF6y8G1KDZ2Vl6nWPSFaKEb4WgV84gJPzYIdzwhy3E0vWjfc76+Tt8gfy8++LMEds2Eo56BrsvBt7/B4SlTCEegyixrEkmrw5LwPKeoYMB2UyMURi9Mt0jJwWJyu2bfL2rxX8srgMd2wXJS2FVjsP6tnYENHu5FFRUwgXA8jX4zAlxcNHC+ci64dWYku4yadi4LGm8f/NjNrj18sGtq1WYrZZyNKGGcVcHP9c6eh2CshKMewLXliSLmwmHQgU/BgNKjDdjWViDMokmPaRRecmsfAurMdt8BV8j8NeieQyETSkDElzhzDaJdT1NMwJO4PsJJzYOrTjSE6wWqQJe3oPJ+zpId1OgegtgZTV1GOuHn+cGlXyeabSYBNae/RF0Y6zKMgJqM0smq0cTrpHrNDndfg/b78BFDz446kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"To open-source or not\"\n        title=\"To open-source or not\"\n        src=\"/static/dd0d3e91e6e919e174aae6ca82c7d985/42a19/open-source-or-not.png\"\n        srcset=\"/static/dd0d3e91e6e919e174aae6ca82c7d985/e3135/open-source-or-not.png 256w,\n/static/dd0d3e91e6e919e174aae6ca82c7d985/06341/open-source-or-not.png 512w,\n/static/dd0d3e91e6e919e174aae6ca82c7d985/42a19/open-source-or-not.png 1024w,\n/static/dd0d3e91e6e919e174aae6ca82c7d985/e8464/open-source-or-not.png 1536w,\n/static/dd0d3e91e6e919e174aae6ca82c7d985/a52c7/open-source-or-not.png 2024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">To open-source or not</figcaption>\n  </figure></p>\n<p>But once my app was approved and, to be honest, after using it for the past few weeks, I realized that while the features and ideas are cool, the app isn’t as polished as I would like it to be. It dawned on me that maybe Musclog would be better off as an open-source project, where the community could help me improve it—which, to be honest, is also wishful thinking because most open-source projects don’t get much traction and are mainly maintained by the creator, so the best I can hope for is people creating issues and asking for features. Hooray!</p>\n<p>Honestly, my dream would be to have an open-source app that somehow makes me money—something like Mindustry or Blender. So, after cleaning up the Git commit history, not because I’m ashamed of my code—okay, maybe a little—but mostly because I wasn’t sure if I had committed an OpenAI key by mistake, I decided to open-source Musclog.</p>\n<p>You can check out the code here: <a href=\"https://github.com/blopa/musclog-app\" target=\"_blank\" rel=\"noreferrer\">https://github.com/blopa/musclog-app</a>. If you’re into fitness and coding, feel free to contribute. Who knows? Maybe together we can turn this into something really special.</p>\n<h2 id=\"whats-next-for-musclog\" style=\"position:relative;\"><a href=\"#whats-next-for-musclog\" aria-label=\"whats next for musclog permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What’s Next for Musclog?</h2>\n<p>Now that Musclog is out in the wild, I’m already thinking about what’s next. There are a ton of features I’d love to add, like more detailed workout analytics, enhanced AI capabilities, and maybe even some social features to share workouts with friends or join challenges.</p>\n<p>One “problem” with Musclog is that it’s really an app for advanced lifters, not that I am advanced myself (I am not), but I am crazy about data and tracking, and my app really shines if you’re the type of person who tracks every single rep, set, and calorie. So, I’m thinking about creating a simpler version of the app, with fewer features, or maybe with a better onboarding process, so beginners can use it too, after all, most lifters are beginners, right? I also would like to be able to convince my friends to start working out and using my app, so I need to make it more appealing to them.</p>\n<p>Some of the features I’m thinking about adding are:</p>\n<ul>\n<li>Integration with BLE devices</li>\n<li>In-app food tracking capabilities</li>\n<li>More detailed workout analytics</li>\n<li>Option to use a custom OpenAI model</li>\n<li>Maybe a local LLM one day</li>\n<li>Online account to sync data between devices</li>\n<li>Online profile to share workouts and challenges</li>\n<li>Gamification features</li>\n</ul>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Looking back, the journey of building Musclog has been as much about personal growth as it has been about coding. I’ve learned so much about mobile development, which is always a good thing. I might be a web developer nowadays, but that’s not how everything started; back in my college days, I was a C++ developer, and web development wasn’t even a track in my course, so kind of coming back to platform development is a nice change of pace.</p>\n<p><img src=\"/c1611424e8d127b69fc982f398783569/just-do-it.gif\" alt=\"Just do it!\"></p>\n<p>So, if you’re thinking about starting your own project—whether it’s an app, a website, or something else entirely—my advice is simple: just do it. Embrace the challenges, learn from the setbacks, and enjoy the process. Because at the end of the day, the only thing standing between you and your goals is the decision to take that first step.</p>\n<p>Thanks for joining me on this journey, and I can’t wait to see what we build next. Lift, Log, Repeat!</p>\n<p>See you in the next one!</p>\n<p>PS: If you want to try Musclog, you can download it from Google Play: <a href=\"https://play.google.com/store/apps/details?id=com.werules.logger\" target=\"_blank\" rel=\"noreferrer\">https://play.google.com/store/apps/details?id=com.werules.logger</a>.</p>\n<h3 id=\"what-about-code-snippets\" style=\"position:relative;\"><a href=\"#what-about-code-snippets\" aria-label=\"what about code snippets permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What about code snippets?</h3>\n<p>I actually wanted to include code snippets and explain how most of the features work, but I realized that it would make this post way too long, so I decided to write a series of posts explaining how I built Musclog, so stay tuned for that!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTA5LTIxVDAwOjAwOjAwLjAwMFo=","slug":"/2024/2024-09-21-musclog-leveraging-my-reactjs-experience-to-build-a-react-native-app.en/","path":"/blog/coding/musclog-leveraging-my-reactjs-experience-to-build-a-react-native-app/","locale":"en"},"rawMarkdownBody":"![Musclog illustration](../../uploads/blog/2024/09/musclog-illustration.png)\r\n\r\nI constantly have that feeling of \"[You become the very thing you swore to destroy](https://youtu.be/CqQRDZP3FnQ?si=gAuQhD_7PHF8PAv5&t=178)\" due to the amount of time I've been dedicating to bodybuilding in the past two years. I've been tracking my macros, my workouts, and even taking brogress pictures.\r\n\r\nNot that I had anything against bodybuilding in the past, but I had tried working out before, and I never really got into it. I always felt like I was a skateboarder at heart and that I was betraying my true self by lifting weights. I know, silly.\r\n\r\nAnyway, I've been using a combination of apps and integrations to achieve my performance tracking, including a [custom Node.js script to calculate my TDEE and average calories](/en/blog/coding/using-google-fitness-api-to-calculate-my-tdee-and-more/) using the [Google Fit API](https://developers.google.com/fit), but since Google Fit is going to be deprecated soon in favor of the new Health Connect, I couldn't postpone the development of my own app any longer.\r\n\r\nBut how? I honestly had no idea where to start, especially tapping into integrations with another app's API. I didn't even know in which format this data would be available. What's the market standard? JSON? XML? Binary? I had no idea. Luckily, I found out that some really smart people created [a library to integrate the Health Connect API with React Native](https://github.com/matinzd/react-native-health-connect/), and knowing that was the tipping point for me to start developing my own app.\r\n\r\n## The perfect solution\r\nI created all these scripts and integrations to monitor my workouts and nutrition because one thing I've discovered in these past few years of bodybuilding is that what really helps me stay consistent is tracking everything. I'm a data guy, and if I can see my progress in numbers, it motivates me to keep going. The truth is, if you're not using any anabolic steroids, progress is slow, and at least for me, I don't see any difference in the mirror, so the numbers are all I have.\r\n\r\nI've been tracking everything I eat for two years now, and I also weigh myself with a scale that measures my body fat percentage, so I have a lot of data to analyze and identify my eating and workout patterns. What I want is something that's really hard to find because most apps or websites out there don't expect someone to be so meticulous as to track everything obsessively every day, but I love doing it.\r\n\r\nSo, the first idea was simply to get the data and continue my calculations with my scripts, and that's how the idea for my first MVP was born.\r\n\r\n## The MVP\r\nAs I said, all I wanted was to access the Health Connect data and get my nutrition and weight data, so I could continue running my Node.js script, even if I had to have a simple app that fetched the data in the background and sent it to my server. Sounds like a plan, right?\r\n\r\nWell... it seems like Health Connect only allows developers to access the [data from the last 30 days due to privacy concerns](https://developer.android.com/health-and-fitness/guides/health-connect/develop/frequently-asked-questions#time-range). Okay... so this means I can't get my historical data, and everything that is on Google Fit will be lost forever. Awesome!\r\n\r\n## The _Real_ MVP\r\n![Perfection](../../uploads/blog/2024/09/musclog-mvp-perfection.png)\r\n\r\nCool, so our MVP died before reaching the shore; time to pivot: What if, instead of having a Node.js script that connects to different APIs, I could have a React Native app that will do most of the things, like workout tracking, nutrition insights, TDEE calculation, charts, tips, etc., and any other data that could be missing, I get from the Health Connect API? I could even add an option to import past data from a JSON file. This way, if Google Fit eventually allows me to export my data, I can import it to my app.\r\n\r\nI have actually jumped from app to app in the past, trying to find the best way to track my workouts. I even tried Google Spreadsheet, but the UX was horrible on mobile, and I would like to focus on my workout and not stress myself out about touching the wrong cell on the spreadsheet.\r\n\r\n![Fine, I will do it myself](../../uploads/blog/2024/09/fine-i-will-do-it-myself.png)\r\n\r\n## So, React Native, huh?\r\nOf course, I knew React Native was a thing, but as a React.js developer, I had never really considered diving into it, but surely it couldn't be that hard, right? I mean, I already knew React, so how different could it be?\r\n\r\nWell...\r\n\r\nIt turns out building a React Native app when your only experience is with React.js is like trying to switch from a skateboard to a surfboard. Sure, the principles are somewhat similar—balance, navigation, staying cool when things go wrong, but the medium is entirely different. In this case, the medium involved figuring out how to wrangle all sorts of device-specific quirks while keeping the app functional and responsive.\r\n\r\n![Surfing with a skateboard](../../uploads/blog/2024/09/surfing-with-skateboard.png)\r\n\r\nFor example, as a web developer I focus on keeping a local state on the client and getting data from the server when needed, but on React Native, I want to have a local database, how should I go about that? Well, I found out about [AsyncStorage](https://react-native-async-storage.github.io/async-storage/), so why not go with it for now? (this will bite me in the ass later)\r\n\r\nStill, I had no idea where to start from, though, but after chatting with my friends [Juampi](https://barreto.jp/) and [Raf](https://www.pato.dev/) about my idea, they suggested I use [Expo](https://expo.dev/), a framework that allows you to build React Native apps without having to deal with the native side of things. That was honestly a game-changer for me because I could simply run my app in the browser most of the time and only use my phone to test the features that require native code.\r\n\r\n## Diving into Expo\r\nI started by creating a new Expo project by following the \"[Create your first app](https://docs.expo.dev/tutorial/create-your-first-app/)\" tutorial, and then I created a new screen with a simple button that would connect to the Health Connect API and get my nutrition data and there I was, I already had my first MVP done, but because I don't really like testing on my phone, I basically just copied the JSON response from the API and saved it into a file, so I could continue developing only on my computer and browser—this will bite me in the ass later².\r\n\r\nAfter playing around with Expo for a weekend, I had a vague idea of what I needed for my app:\r\n\r\n- [AsyncStorage](https://react-native-async-storage.github.io/async-storage/) for storage\r\n- [react-native-paper](https://reactnativepaper.com/) for the UI\r\n- [i18next](https://www.i18next.com/) for translations\r\n- [react-native-charts-wrapper](https://github.com/wuxudong/react-native-charts-wrapper) to show charts\r\n- [@shopify/flash-list](https://github.com/Shopify/flash-list) to render lists (basically just because of [this talk](https://www.youtube.com/watch?v=BrYxGrE9sW8) I was sold on it)\r\n\r\nTime to get my calloused hands to work!\r\n\r\n## The joy (and pain) of learning on the fly\r\nAs I ventured deeper into the world of React Native, I quickly realized that my trusty toolbox from the React.js universe was, well, not entirely fit for the job. For starters, my database schema was way too complex for AsyncStorage, so, I figured, why not switch to IndexedDB? Spoiler alert: IndexedDB only works on the web, not on the mobile build of the Expo app. Oops.\r\n\r\n![Life of solo developer](../../uploads/blog/2024/09/life-of-solo-developer.png)\r\n\r\nAfter some wasted hours trying to polyfill IndexedDB for React Native, I simply gave up and I found myself in the middle of a major refactor. I decided to switch to `expo-sqlite`, a proper local database solution for mobile. But here’s the kicker—I still needed Dexie.js (a wrapper for IndexedDB) to keep the web build functional while I was developing the app since I mostly use the browser for it.\r\n\r\nThankfully the team behind Expo really did think of everything: Enter `.web` files in Expo—essentially, Expo allows you to create platform-specific files (like `database.ts` and `database.web.ts`) so you can have different implementations for web and mobile. This was a lifesaver, and after this discovery, I can confirm that refactoring code while muttering \"better late than never\" is totally a thing.\r\n\r\nAnd let’s not forget the charts—because what’s a fitness app without fancy progress graphs, right? Well, `react-native-charts-wrapper` works great on mobile but not on web, so I had to bring in `react-chartjs-2` for the web version. You can see where this is going: juggling two different chart libraries depending on the platform was just another part of the fun.\r\n\r\nBy now, I was deep into this rabbit hole, and to make life a bit easier, I added some developer tools to the app, like export and import database functions. This made it possible to move data between web and mobile during development. It was around this time that I realized why people are so in love with Firebase—maybe in a future version, I’ll make the switch, but for now, Musclog is 100% offline.\r\n\r\n## Building the features, one rep at a time\r\nSoftware development is a lot like bodybuilding, you start with a plan, but then you find out that you have lagging biceps genetics, and you end up pivoting and doing 28 sets for biceps per week (right guys?). My original vision was pretty simple: just a place to track my workouts and nutrition. But to get there, I had to build a robust system for creating and editing exercises, constructing workout plans, viewing past workouts, calculating workout volume, and so much more.\r\n\r\n![Workouts tracking](../../uploads/blog/2024/09/musclog-workout-screenshot.png)\r\n\r\nAnd nutrition tracking? Well, it’s not just about logging meals. I needed to be able to add foods, different macros, track calories, and integrate all of this with the workout data. As I kept adding features, I noticed that I was using GPT for nutrition information. So, why not integrate it into the app? That’s how Musclog ended up with a chatbot feature. Now, I can ask it things like, \"How many calories are in a banana?\" and get a quick answer. But let's not get ahead of ourselves.\r\n\r\n![Nutrition charts](../../uploads/blog/2024/09/musclog-nutrition-screenshot.png)\r\n\r\n## From tracking to chatting\r\nSo, here I was, juggling workout logs, nutrition tracking, and managing multiple components for different platforms, and still I decided to add some ✨AI✨ into the mix? After all, everyone loves a good chatbot these days, and if you know me, oh boy, do I like a chatbot—so much that I've spent hundreds of hours coding a [Magento chatbot extension](https://github.com/blopa/Magento-Chatbot) that for many years was my most popular open-source project.\r\n\r\nI started by adding a simple chat interface to the app, where users could ask questions like, \"What’s a good post-workout meal?\" or \"How do I improve my bench press form?\" The idea was to create an AI-powered personal trainer that’s always on hand, ready to provide insights and tips.\r\n\r\nAs usual, after many hours of coding, I decided to show my progress to my friends, and they were like, \"Why not use [Gifted Chat](https://github.com/FaridSafi/react-native-gifted-chat/) for this?\". Wait so you're telling me after implementing a chat interface from scratch, sending and parsing messages, I could have just used a library? Well, I guess that's the beauty of learning on the fly.\r\n\r\n## OpenAI integration\r\nIntegrating OpenAI into Musclog was a no-brainer for me. I had already dabbled with it in other projects, like when I used OpenAI to [automatically create Instagram Reels coding tutorials](/en/blog/coding/creating-instagram-reels-coding-tutorials-automatically-with-openais-gpt/). With that experience, I was already familiar with function calls, parsing responses, and handling prompts. So, I thought, why not add this powerful tool to my app?\r\n\r\n![Chatting on Musclog](../../uploads/blog/2024/09/musclog-chat-screenshot.png)\r\n\r\nThe integration itself was pretty straightforward. I used OpenAI's API to process user queries and provide insightful responses. Every time a user sends a message, the chat history is sent back to OpenAI to keep the conversation context intact. To give the AI a bit of personality, I used system messages like, \"You're a helpful personal trainer named Chad, and you're here to help with fitness journeys. Ask me anything!\"\r\n\r\nBut it didn't stop there. I figured if I'm already integrating OpenAI, why not take it a step further? So, I added an option to ask OpenAI to create a workout plan directly. For instance, you can use the chatbot to ask, \"Can you please create me a push-pull-legs workout?\" and boom—Chad the trainer springs into action, generating a customized workout routine on the spot. This feature is particularly handy when you're not sure how to structure your training or if you're looking to mix things up.\r\n\r\nThe possibilities here are pretty exciting. With this integration, Musclog isn't just a static workout tracker; it becomes a dynamic fitness coach that evolves with your needs. And let's be honest, having an AI that can whip up a workout plan in seconds feels like a superpower, especially when you're in the gym and need a quick routine on the fly.\r\n\r\nNot only that, but I also gave access to all the health information to OpenAI, so my nutrition, workouts, weight, and fat percentage data is available for the AI to use, so it can give me better insights. Of course, due to privacy concerns, I made it optional, and I also added a feature to delete all the data whenever the user wants. But imagine, doing a really hard workout and then asking GPT what it thinks about it, pretty cool, right?\r\n\r\n## App designs\r\nI'm not a designer, but I like to think I have a good eye for good UI/UX due to many years of web development., but mobile development was a completely different beast, so I had to outsource the UI designs and any arts to either free open-source resources or to AI.\r\n\r\nYeah yeah I know about the whole hate for AI-generated art, but it was either that or art made on MS-Paint, so I went with the AI-generated art.\r\n\r\n![MS-Paint Musclog logo](../../uploads/blog/2024/09/mspaint-musclog-logo.png)\r\n\r\n### UI\r\nFor the app UI, I used [react-native-paper](https://reactnativepaper.com/) components, which made it easy to create a clean, modern look and has most of the components I needed, like buttons, cards, and modals.\r\n\r\nThat took care of the functional side of things, but what about the aesthetics? I outsourced my efforts to [v0](https://v0.dev/), a tool by Vercel that uses AI to generate simple one-page applications to be used in a Next.js app. I simply inputted the text explaining what I needed, and asked it to be mobile-first, and voilà, I had a beautiful design for my app.\r\n\r\n### Logo and illustrations\r\nFor the logo and illustrations, I used [OpenAI's DALL-E](https://openai.com/research/dall-e/) to generate the images. I simply inputted the text explaining what I needed and details about my app and got some really cool results. I then used [Photopea](https://www.photopea.com/) to do some retouching and add some effects to the images.\r\n\r\n## Making it to Google Play\r\nAfter months of development, testing, and an unhealthy amount of Pepsi Max, Musclog was finally ready for the big stage: Google Play. But here’s where things got... interesting. I was under the impression that I could just submit my app and be done with it, like I did back in 2019 for my game Gotinha. Ha! Little did I know, Google Play forces you to get 20 people to test your app before it goes live, even if you're just a solo developer. WTF, right?\r\n\r\n![Musclog on Google Play](../../uploads/blog/2024/09/20-testers.png)\r\n\r\nFinding 20 people to test your app sounds easy until you’re actually doing it. I ended up recruiting anyone and everyone—friends, family, co-workers, acquaintances at parties, I might have even asked a few strangers on the street (kidding, maybe). But after gathering my testing \"bros\" and getting through the initial testing phase, guess what happened? My app got rejected. Yeah, it’s like life just wasn’t ready to let me win.\r\n\r\nSo there I was, waiting another 14 days, fixing the issues they pointed out, and resubmitting the app. It was a rollercoaster of emotions, to say the least. And as if that wasn’t enough, because I wanted Health Connect integration, **but not only that**, believe it or not I also needed to have a public website for my app, so I had to create a website for it, and write a privacy policy, and fill out a form explaining why I needed access to Health Connect data. So I quickly spun a website using [Next.js](https://nextjs.org/) and [https://v0.dev/](https://v0.dev/), and got GPT to write a privacy policy for me, you can see it here: [https://blopa.github.io/musclog-website/](https://blopa.github.io/musclog-website/).\r\n\r\nYou might be wondering if I made this app for myself, why do I care to have it on Google Play? Well for one, I think Google Play is quite convenient and I want convenience on installing the app on my phone, and second, I want to share it with my friends and family, and I think it's easier to share a link to the app on Google Play than to send them an APK file.\r\n\r\nBut after all the hoops, I finally got the green light, and Musclog was officially on Google Play. So yeah, it wasn’t easy, but it was definitely worth it.\r\n\r\n![Musclog on Google Play](../../uploads/blog/2024/09/musclog-on-google-play.png)\r\n\r\n## To open-source or not to open-source\r\nI always open-source all my projects—it's kind of my thing. But when it came to Musclog, I hesitated. This app took me over 300 hours to develop, and it has some really nice features that I haven't seen in other fitness apps. I figured maybe I could recoup some of the time I spent on it by selling it on Google Play or maybe adding a \"tip me\" button.\r\n\r\n![To open-source or not](../../uploads/blog/2024/09/open-source-or-not.png)\r\n\r\nBut once my app was approved and, to be honest, after using it for the past few weeks, I realized that while the features and ideas are cool, the app isn't as polished as I would like it to be. It dawned on me that maybe Musclog would be better off as an open-source project, where the community could help me improve it—which, to be honest, is also wishful thinking because most open-source projects don't get much traction and are mainly maintained by the creator, so the best I can hope for is people creating issues and asking for features. Hooray!\r\n\r\nHonestly, my dream would be to have an open-source app that somehow makes me money—something like Mindustry or Blender. So, after cleaning up the Git commit history, not because I'm ashamed of my code—okay, maybe a little—but mostly because I wasn't sure if I had committed an OpenAI key by mistake, I decided to open-source Musclog.\r\n\r\nYou can check out the code here: [https://github.com/blopa/musclog-app](https://github.com/blopa/musclog-app). If you're into fitness and coding, feel free to contribute. Who knows? Maybe together we can turn this into something really special.\r\n\r\n## What’s Next for Musclog?\r\nNow that Musclog is out in the wild, I’m already thinking about what’s next. There are a ton of features I’d love to add, like more detailed workout analytics, enhanced AI capabilities, and maybe even some social features to share workouts with friends or join challenges.\r\n\r\nOne \"problem\" with Musclog is that it's really an app for advanced lifters, not that I am advanced myself (I am not), but I am crazy about data and tracking, and my app really shines if you're the type of person who tracks every single rep, set, and calorie. So, I'm thinking about creating a simpler version of the app, with fewer features, or maybe with a better onboarding process, so beginners can use it too, after all, most lifters are beginners, right? I also would like to be able to convince my friends to start working out and using my app, so I need to make it more appealing to them.\r\n\r\nSome of the features I'm thinking about adding are:\r\n- Integration with BLE devices\r\n- In-app food tracking capabilities\r\n- More detailed workout analytics\r\n- Option to use a custom OpenAI model\r\n- Maybe a local LLM one day\r\n- Online account to sync data between devices\r\n- Online profile to share workouts and challenges\r\n- Gamification features\r\n\r\n## Conclusion\r\nLooking back, the journey of building Musclog has been as much about personal growth as it has been about coding. I’ve learned so much about mobile development, which is always a good thing. I might be a web developer nowadays, but that's not how everything started; back in my college days, I was a C++ developer, and web development wasn't even a track in my course, so kind of coming back to platform development is a nice change of pace.\r\n\r\n![Just do it!](../../uploads/blog/2024/09/just-do-it.gif)\r\n\r\nSo, if you’re thinking about starting your own project—whether it’s an app, a website, or something else entirely—my advice is simple: just do it. Embrace the challenges, learn from the setbacks, and enjoy the process. Because at the end of the day, the only thing standing between you and your goals is the decision to take that first step.\r\n\r\nThanks for joining me on this journey, and I can’t wait to see what we build next. Lift, Log, Repeat!\r\n\r\nSee you in the next one!\r\n\r\nPS: If you want to try Musclog, you can download it from Google Play: [https://play.google.com/store/apps/details?id=com.werules.logger](https://play.google.com/store/apps/details?id=com.werules.logger).\r\n\r\n### What about code snippets?\r\nI actually wanted to include code snippets and explain how most of the features work, but I realized that it would make this post way too long, so I decided to write a series of posts explaining how I built Musclog, so stay tuned for that!\r\n","frontmatter":{"tags":["react","react native","expo","android","workout","tracker","logger","musclog"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2024-09-21T00:00:00.000Z","id":null,"path":"musclog-leveraging-my-reactjs-experience-to-build-a-react-native-app","show":true,"title":"Musclog: Leveraging my React.js experience to build a React Native App","hideExcerpt":false,"subtitle":"From Bodybuilding to Codebuilding: Crafting a comprehensive fitness App using React Native and Expo"}}},{"node":{"excerpt":"Como um desenvolvedor totalmente ”commitado” (trocadilho…","html":"<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9AMiUA8uYBMuWAsmYC8+XBG51Z5OSWq6VQY6LV9i1I9ClFrGfW5qeW7aIDs+LAMyYDs+WBtOZAM+ZA9CaAgDNlgHUmQHjnACtsj2qwEpza1Obqbqus7l8j6yPkGaenWq0n1pMbalea2GJuocoqr5hl3TglgDUmwPSmwIAnok+o5JH3agH0blJraxOZWdxi5GbsrG1zb7Al4VdVWRjVVJVJENtFXikG4mqbnJGRI+Lw5EU0JMEzZcEAI59SJ240LS+rMC+ip+QT08zQGZga9fOvurUzLa0kpaPTGIlRFA5WxJYgR5DaaeQPjmmppiOObiLGNCWAgCwiBSlsbHq6s6Xn5pBRVdPUWpncofk5NOdsLRnloqlyG1eS1hhQVUZXYANUn5yY0GrrEKnnjzIoh3goAAA0KEQl6KUy8vBsZSHjoJzMUVoSVBdYVlmkIFrT3ltPHN/cKJ9XYVoE3qXGY2tbXBW9rkvzq03mJpE5akEAOevCKKaYrzByPnctIN6cQgaTqGobNvOUtnIVv/pVFV+bhZbfBlFZBw0WB6sx0uTlNChSO+8MHyPV8ylGQDmqA+xljyuvsX/9tBwdXd0eINYZnCounf/9Vf/9FSOekBGNTG3nES0lTlYY1AhK1WTjlmauW5IeXHjsA0A5MkX2Mcpn56Oi310XWZ12NrJpJ5vZmxX9Ohbzs9mp7VwhXJtnKl4oJ5hootJVGVXFUt5MlZhtZgl/80EAN+0G7GMSlhDSlpeg4GNkXtwcqt8X3VhRJCCT3mHbU95o3V6l3eMmnJ3kntiUEmDhD5fbZ19ZsaeOPC+BQDxvgO/jx+VeTmYe0yvnmuqrHy4mm+lfShnXVW0iDqZg2drgpCLb4Z9XlKomH6ojF/IiyOus6amj1P4xwWkVkqDztXvPgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ilustração de como é trabalhar com foss\"\n        title=\"ilustração de como é trabalhar com foss\"\n        src=\"/static/e33431ea4c32553f41b55b637ea5a114/42a19/foss-git-calculation-illustration.png\"\n        srcset=\"/static/e33431ea4c32553f41b55b637ea5a114/e3135/foss-git-calculation-illustration.png 256w,\n/static/e33431ea4c32553f41b55b637ea5a114/06341/foss-git-calculation-illustration.png 512w,\n/static/e33431ea4c32553f41b55b637ea5a114/42a19/foss-git-calculation-illustration.png 1024w,\n/static/e33431ea4c32553f41b55b637ea5a114/e8464/foss-git-calculation-illustration.png 1536w,\n/static/e33431ea4c32553f41b55b637ea5a114/445c6/foss-git-calculation-illustration.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">ilustração de como é trabalhar com foss</figcaption>\n  </figure></p>\n<p>Como um desenvolvedor totalmente ”<a href=\"https://git-scm.com/docs/git-commit\" target=\"_blank\" rel=\"noreferrer\">commitado</a>” (trocadilho intencional, e não vai ser o único) em projetos pessoais de FOSS, muitas vezes perco a noção do tempo. Parece que passei muitas e muitas horas programando, mas quantas exatamente? A curiosidade falou mais alto, então decidi escrever um script em Node.js para descobrir. Spoiler: Imediatamente me arrependi dessa decisão ao ver quanto do meu tempo livre foi gasto programando. Brabo.</p>\n<h2 id=\"esbocando-o-plano\" style=\"position:relative;\"><a href=\"#esbocando-o-plano\" aria-label=\"esbocando o plano permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Esboçando o plano</h2>\n<p>Eu queria um script que pudesse calcular minhas horas de trabalho com base nos meus commits do GIT. Como sou um ávido defensor das convenções de commits atômicos, a ideia é simples: quando estou trabalhando em meus projetos pessoais, estou fazendo commits. Se houver um intervalo de mais de 3 horas entre os commits, isso significa que provavelmente estou fazendo alguma outra coisa, como comendo, dormindo ou assistindo vídeos de programação (não, espera).</p>\n<h2 id=\"escolhendo-o-pacote-certo\" style=\"position:relative;\"><a href=\"#escolhendo-o-pacote-certo\" aria-label=\"escolhendo o pacote certo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Escolhendo o pacote certo</h2>\n<p>Existem muitas bibliotecas GIT para Node.js, mas escolhi <code class=\"language-text\">simple-git</code> por sua facilidade de uso. É um wrapper em torno dos comandos GIT, tornando-o perfeito para essa tarefa.</p>\n<p>Então, depois de instalar o <code class=\"language-text\">simple-git</code>, e fazer <code class=\"language-text\">npm init</code> e todas as outras coisas, eu estava pronto para começar a programar.</p>\n<h2 id=\"o-codigo\" style=\"position:relative;\"><a href=\"#o-codigo\" aria-label=\"o codigo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O código</h2>\n<p>Ok, vamos primeiro nos familiarizar com <code class=\"language-text\">simple-git</code>, aqui está um código simples para buscar o log de commits:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> simpleGIT <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'simple-git'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> git <span class=\"token operator\">=</span> <span class=\"token function\">simpleGIT</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getCommitLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> log <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> git<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> log<span class=\"token punctuation\">.</span>all<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Erro ao buscar o log de commits:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">getCommitLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">commits</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Com o log de commits em mãos, vamos ”<a href=\"https://git-scm.com/docs/git-apply\" target=\"_blank\" rel=\"noreferrer\">aplicar</a>” nosso plano esboçado no código e calcular as horas de trabalho. A ideia é iterar pelos commits e, sempre que houver um intervalo de mais de 3 horas entre dois commits, considerar o commit anterior como o fim de uma sessão de trabalho.</p>\n<p>Por exemplo, se eu começar a trabalhar às 9h e fizer um commit às 10h, depois fizer outro commit às 15h, o script deve considerar a sessão de trabalho das 9h às 10h, então 1 hora.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">calculateWorkHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> commits <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCommitLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Nenhum commit encontrado neste repositório.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">let</span> totalWorkTime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">let</span> currentCommit <span class=\"token operator\">=</span> commits<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> maxInterval <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3 horas em milissegundos</span>\r\n\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> commits<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">const</span> nextCommit <span class=\"token operator\">=</span> commits<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">const</span> currentCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>currentCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">const</span> nextCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>nextCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>currentCommitTime <span class=\"token operator\">-</span> nextCommitTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> maxInterval<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                totalWorkTime <span class=\"token operator\">+=</span> currentCommitTime <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                currentCommit <span class=\"token operator\">=</span> nextCommit<span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        totalWorkTime <span class=\"token operator\">+=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>currentCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> totalWorkHours <span class=\"token operator\">=</span> totalWorkTime <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Total de horas de trabalho: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>totalWorkHours<span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> horas</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Erro ao calcular as horas de trabalho:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">calculateWorkHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Basicamente é isso, mas já que estamos aqui, por que não extrair mais algumas informações? Não que saber o total de horas não seja suficiente, mas agora quero saber quanto tempo, em média, estou, uh, “desperdiçando”, quero dizer, tendo algum tempo de qualidade com meu laptop.</p>\n<p>Vamos adicionar esse cálculo:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">calculateWorkHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> commits <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCommitLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Nenhum commit encontrado neste repositório.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">let</span> totalWorkTime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">let</span> currentCommit <span class=\"token operator\">=</span> commits<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> maxInterval <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3 horas em milissegundos</span>\r\n\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> commits<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">const</span> nextCommit <span class=\"token operator\">=</span> commits<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">const</span> currentCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>currentCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">const</span> nextCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>nextCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>currentCommitTime <span class=\"token operator\">-</span> nextCommitTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> maxInterval<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                totalWorkTime <span class=\"token operator\">+=</span> currentCommitTime <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                currentCommit <span class=\"token operator\">=</span> nextCommit<span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        totalWorkTime <span class=\"token operator\">+=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>currentCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> totalWorkHours <span class=\"token operator\">=</span> totalWorkTime <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">const</span> firstCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> lastCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> totalDays <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>lastCommitTime <span class=\"token operator\">-</span> firstCommitTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">const</span> averageHoursPerDay <span class=\"token operator\">=</span> totalWorkHours <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">;</span>\r\n\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Total de horas de trabalho: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>totalWorkHours<span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> horas</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Média de horas por dia: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>averageHoursPerDay<span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> horas</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Erro ao calcular as horas de trabalho:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">calculateWorkHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"vamos-colocar-em-pratica\" style=\"position:relative;\"><a href=\"#vamos-colocar-em-pratica\" aria-label=\"vamos colocar em pratica permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vamos colocar em prática</h2>\n<p>Depois de rodar esse script no meu último projeto pessoal, que talvez eu escreva um post sobre em breve, recebi o seguinte resultado:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> scripts/calculateWorkHours.js \r\nTotal de horas de trabalho: <span class=\"token number\">98.77</span> horas\r\nMédia de horas por dia: <span class=\"token number\">3.74</span> horas</code></pre></div>\n<p>PERA AI, WHAT?? 98,77 horas? Isso é quase 100 horas gastas em um projeto pessoal em um mês. E 3,74 horas por dia? Quero dizer, eu sabia que estava gastando muito tempo nos meus projetos pessoais, mas ver esses números foi realmente um choque.</p>\n<p>Se as pessoas me perguntarem, eu digo que sou uma pessoa bastante ativa, afinal faço saltos ornamentais 3 vezes por semana, totalizando 4 horas por semana, além das sessões de academia, que somam cerca de 6 horas por semana. Então, sim, um total de 10 horas por semana, ou 1,42 horas por dia, nem perto das 3,74 horas por dia que estou gastando nos meus projetos pessoais. Punk!</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.171875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHUlEQVQozwXB2XKaUAAAUD6hnaTGqAQXDBExUTZFtntBRCKybwJK1ESzzLRvnT71A/rVPQcJjFlqiTtbOrjqwVWqjfziqpWj5pa4W8sHD3xsXW2qgjHP4iOVnvGDCdHqEc1evvYQU2YDS01tfeuaqbPcOnpiw+J5fvTUS6T/LM3PIpsOWX7IEHcE2e4TGNGuo82rZumGiCXRnj7zIRvqs/TZeM2zY7I5h6tzoB7d2d+v3fu2GOMP4/4jVsfublACIzq3d71G1xAUJIBMqLEhZBLI5AuuXANbB5YopVB628B/f37z5Ai7aZHdYe17rV1Hhx2y+aOOt7p4C0cCQCc6lxjT3BQKU9hbQmyKGjeWyAG8Rdejp+lgMKUGfbTbuL7p1NFOA699u25c1aYUhQQqnUAmUsYZpPcmV9li5ajVRkyBAPCBNBxBhg2XamTwB3ceaBxH9vtofUK0y/UciSGbGXwG6dJg9iv66MpHV3pPQKhrc4q35hNT5ucsw5NdRxm/J9pnqr2FyiVSD84cidVJApmjo5xc8bgRzjE8h/LXVj8H2sEBn4nyq1xdYi23JZV7MgQmWYmHcFF6YO/ISCw/RjKVLZ5ebObFYU/+7BTMTv70LRIusXCOpK9Cf83BPtUTB3jPkibTBuB8G+yiJZJrdKZRkY7FS6xwHip/mLv3uXOfWnixISv/sfQo3yLXy66p4QvQWxk9oHSWOul7+n989pj+LrbIxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"decepcionado mas não surpreso\"\n        title=\"decepcionado mas não surpreso\"\n        src=\"/static/342ed021e5dea82ee6c67621bde3a959/42a19/perfectly-balanced.png\"\n        srcset=\"/static/342ed021e5dea82ee6c67621bde3a959/e3135/perfectly-balanced.png 256w,\n/static/342ed021e5dea82ee6c67621bde3a959/06341/perfectly-balanced.png 512w,\n/static/342ed021e5dea82ee6c67621bde3a959/42a19/perfectly-balanced.png 1024w,\n/static/342ed021e5dea82ee6c67621bde3a959/6ee55/perfectly-balanced.png 1496w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">decepcionado mas não surpreso</figcaption>\n  </figure></p>\n<h2 id=\"coisas-a-se-considerar\" style=\"position:relative;\"><a href=\"#coisas-a-se-considerar\" aria-label=\"coisas a se considerar permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coisas a se considerar</h2>\n<p>Embora este script seja bem simples, há algumas coisas a se considerar:</p>\n<ul>\n<li><strong>Pressuposições sobre pausas</strong>: Ele assume que qualquer período superior a 3 horas entre commits é uma pausa. Isso pode nem sempre ser verdade, mas é uma aproximação boa o suficiente.</li>\n<li><strong>Hábitos de commit</strong>: Se você é alguém que se esquece de fazer commits frequentemente, a precisão do script cai consideravelmente.</li>\n<li><strong>Diferenças de fuso horário</strong>: Commits feitos em fusos horários diferentes podem atrapalhar os cálculos.</li>\n<li><strong>Descobrir quanto tempo você realmente está desperdiçando</strong>: Esse ponto é um pouco subjetivo, eu acho, mas no meu caso, mermão, eu não estava pronto para esse número.</li>\n</ul>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Escrever este script foi tanto esclarecedor quanto horripilante. Agora tenho provas concretas do absurdo número de horas que gasto em meus projetos pessoais. Se você for curioso (ou louco) o suficiente para ”<a href=\"https://git-scm.com/docs/git-bisect\" target=\"_blank\" rel=\"noreferrer\">bisectar</a>” seus hábitos de programação, pode ser um exercício bastante “divertido”.</p>\n<p>E lembre-se, embora acompanhar sua produtividade seja ótimo, às vezes a ignorância é uma bênção. Porque, depois de ver minhas horas totais, só queria me encolher e zerar alguns dos jogos do meu backlog para compensar todo esse tempo livre perdido.</p>\n<p>Bom, e é isso, pessoal, espero que vocês tenham gostado deste post e vejo vocês no próximo!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTA2LTE2VDAwOjAwOjAwLjAwMFo=","slug":"/2024/2024-06-16-calculando-minhas-horas-de-trabalho-em-projetos-pessoais-usando-nodejs.pt-br/","path":"/blog/coding/calculando-minhas-horas-de-trabalho-em-projetos-pessoais-usando-nodejs/","locale":"pt-br"},"rawMarkdownBody":"![ilustração de como é trabalhar com foss](../../uploads/blog/2024/06/foss-git-calculation-illustration.png)\r\n\r\nComo um desenvolvedor totalmente \"[commitado](https://git-scm.com/docs/git-commit)\" (trocadilho intencional, e não vai ser o único) em projetos pessoais de FOSS, muitas vezes perco a noção do tempo. Parece que passei muitas e muitas horas programando, mas quantas exatamente? A curiosidade falou mais alto, então decidi escrever um script em Node.js para descobrir. Spoiler: Imediatamente me arrependi dessa decisão ao ver quanto do meu tempo livre foi gasto programando. Brabo.\r\n\r\n## Esboçando o plano\r\nEu queria um script que pudesse calcular minhas horas de trabalho com base nos meus commits do GIT. Como sou um ávido defensor das convenções de commits atômicos, a ideia é simples: quando estou trabalhando em meus projetos pessoais, estou fazendo commits. Se houver um intervalo de mais de 3 horas entre os commits, isso significa que provavelmente estou fazendo alguma outra coisa, como comendo, dormindo ou assistindo vídeos de programação (não, espera).\r\n\r\n## Escolhendo o pacote certo\r\nExistem muitas bibliotecas GIT para Node.js, mas escolhi `simple-git` por sua facilidade de uso. É um wrapper em torno dos comandos GIT, tornando-o perfeito para essa tarefa.\r\n\r\nEntão, depois de instalar o `simple-git`, e fazer `npm init` e todas as outras coisas, eu estava pronto para começar a programar.\r\n\r\n## O código\r\nOk, vamos primeiro nos familiarizar com `simple-git`, aqui está um código simples para buscar o log de commits:\r\n\r\n```javascript\r\nconst simpleGIT = require('simple-git');\r\nconst git = simpleGIT();\r\n\r\nasync function getCommitLog() {\r\n    try {\r\n        const log = await git.log();\r\n        return log.all;\r\n    } catch (error) {\r\n        console.error('Erro ao buscar o log de commits:', error);\r\n    }\r\n}\r\n\r\ngetCommitLog().then(commits => console.log(commits));\r\n```\r\n\r\nCom o log de commits em mãos, vamos \"[aplicar](https://git-scm.com/docs/git-apply)\" nosso plano esboçado no código e calcular as horas de trabalho. A ideia é iterar pelos commits e, sempre que houver um intervalo de mais de 3 horas entre dois commits, considerar o commit anterior como o fim de uma sessão de trabalho.\r\n\r\nPor exemplo, se eu começar a trabalhar às 9h e fizer um commit às 10h, depois fizer outro commit às 15h, o script deve considerar a sessão de trabalho das 9h às 10h, então 1 hora.\r\n\r\n```javascript\r\nasync function calculateWorkHours() {\r\n    try {\r\n        const commits = await getCommitLog();\r\n\r\n        if (commits.length === 0) {\r\n            console.log('Nenhum commit encontrado neste repositório.');\r\n            return;\r\n        }\r\n\r\n        let totalWorkTime = 0;\r\n        let currentCommit = commits[0];\r\n        const maxInterval = 3 * (60 * 60 * 1000); // 3 horas em milissegundos\r\n\r\n        for (let i = 1; i < commits.length; i++) {\r\n            const nextCommit = commits[i];\r\n            const currentCommitTime = new Date(currentCommit.date).getTime();\r\n            const nextCommitTime = new Date(nextCommit.date).getTime();\r\n\r\n            if ((currentCommitTime - nextCommitTime) > maxInterval) {\r\n                totalWorkTime += currentCommitTime - new Date(commits[i - 1].date).getTime();\r\n                currentCommit = nextCommit;\r\n            }\r\n        }\r\n\r\n        totalWorkTime += new Date(currentCommit.date).getTime() - new Date(commits[commits.length - 1].date).getTime();\r\n        const totalWorkHours = totalWorkTime / (1000 * 60 * 60);\r\n\r\n        console.log(`Total de horas de trabalho: ${totalWorkHours.toFixed(2)} horas`);\r\n    } catch (error) {\r\n        console.error('Erro ao calcular as horas de trabalho:', error);\r\n    }\r\n}\r\n\r\ncalculateWorkHours();\r\n```\r\n\r\nBasicamente é isso, mas já que estamos aqui, por que não extrair mais algumas informações? Não que saber o total de horas não seja suficiente, mas agora quero saber quanto tempo, em média, estou, uh, \"desperdiçando\", quero dizer, tendo algum tempo de qualidade com meu laptop.\r\n\r\nVamos adicionar esse cálculo:\r\n\r\n```javascript\r\nasync function calculateWorkHours() {\r\n    try {\r\n        const commits = await getCommitLog();\r\n\r\n        if (commits.length === 0) {\r\n            console.log('Nenhum commit encontrado neste repositório.');\r\n            return;\r\n        }\r\n\r\n        let totalWorkTime = 0;\r\n        let currentCommit = commits[0];\r\n        const maxInterval = 3 * (60 * 60 * 1000); // 3 horas em milissegundos\r\n\r\n        for (let i = 1; i < commits.length; i++) {\r\n            const nextCommit = commits[i];\r\n            const currentCommitTime = new Date(currentCommit.date).getTime();\r\n            const nextCommitTime = new Date(nextCommit.date).getTime();\r\n\r\n            if ((currentCommitTime - nextCommitTime) > maxInterval) {\r\n                totalWorkTime += currentCommitTime - new Date(commits[i - 1].date).getTime();\r\n                currentCommit = nextCommit;\r\n            }\r\n        }\r\n\r\n        totalWorkTime += new Date(currentCommit.date).getTime() - new Date(commits[commits.length - 1].date).getTime();\r\n        const totalWorkHours = totalWorkTime / (1000 * 60 * 60);\r\n\r\n        const firstCommitTime = new Date(commits[commits.length - 1].date).getTime();\r\n        const lastCommitTime = new Date(commits[0].date).getTime();\r\n        const totalDays = (lastCommitTime - firstCommitTime) / (1000 * 60 * 60 * 24);\r\n\r\n        const averageHoursPerDay = totalWorkHours / totalDays;\r\n\r\n        console.log(`Total de horas de trabalho: ${totalWorkHours.toFixed(2)} horas`);\r\n        console.log(`Média de horas por dia: ${averageHoursPerDay.toFixed(2)} horas`);\r\n    } catch (error) {\r\n        console.error('Erro ao calcular as horas de trabalho:', error);\r\n    }\r\n}\r\n\r\ncalculateWorkHours();\r\n```\r\n\r\n## Vamos colocar em prática\r\nDepois de rodar esse script no meu último projeto pessoal, que talvez eu escreva um post sobre em breve, recebi o seguinte resultado:\r\n\r\n```shell\r\n$ node scripts/calculateWorkHours.js \r\nTotal de horas de trabalho: 98.77 horas\r\nMédia de horas por dia: 3.74 horas\r\n```\r\n\r\nPERA AI, WHAT?? 98,77 horas? Isso é quase 100 horas gastas em um projeto pessoal em um mês. E 3,74 horas por dia? Quero dizer, eu sabia que estava gastando muito tempo nos meus projetos pessoais, mas ver esses números foi realmente um choque.\r\n\r\nSe as pessoas me perguntarem, eu digo que sou uma pessoa bastante ativa, afinal faço saltos ornamentais 3 vezes por semana, totalizando 4 horas por semana, além das sessões de academia, que somam cerca de 6 horas por semana. Então, sim, um total de 10 horas por semana, ou 1,42 horas por dia, nem perto das 3,74 horas por dia que estou gastando nos meus projetos pessoais. Punk!\r\n\r\n![decepcionado mas não surpreso](../../uploads/blog/2024/06/perfectly-balanced.png)\r\n\r\n## Coisas a se considerar\r\nEmbora este script seja bem simples, há algumas coisas a se considerar:\r\n\r\n- **Pressuposições sobre pausas**: Ele assume que qualquer período superior a 3 horas entre commits é uma pausa. Isso pode nem sempre ser verdade, mas é uma aproximação boa o suficiente.\r\n- **Hábitos de commit**: Se você é alguém que se esquece de fazer commits frequentemente, a precisão do script cai consideravelmente.\r\n- **Diferenças de fuso horário**: Commits feitos em fusos horários diferentes podem atrapalhar os cálculos.\r\n- **Descobrir quanto tempo você realmente está desperdiçando**: Esse ponto é um pouco subjetivo, eu acho, mas no meu caso, mermão, eu não estava pronto para esse número.\r\n\r\n## Conclusão\r\nEscrever este script foi tanto esclarecedor quanto horripilante. Agora tenho provas concretas do absurdo número de horas que gasto em meus projetos pessoais. Se você for curioso (ou louco) o suficiente para \"[bisectar](https://git-scm.com/docs/git-bisect)\" seus hábitos de programação, pode ser um exercício bastante \"divertido\".\r\n\r\nE lembre-se, embora acompanhar sua produtividade seja ótimo, às vezes a ignorância é uma bênção. Porque, depois de ver minhas horas totais, só queria me encolher e zerar alguns dos jogos do meu backlog para compensar todo esse tempo livre perdido.\r\n\r\nBom, e é isso, pessoal, espero que vocês tenham gostado deste post e vejo vocês no próximo!\r\n","frontmatter":{"tags":["nodejs","git","foss","javascript","simple-git","math"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2024-06-16T00:00:00.000Z","id":null,"path":"calculando-minhas-horas-de-trabalho-em-projetos-pessoais-usando-nodejs","show":true,"title":"Calculando minhas horas de trabalho em projetos pessoais usando Node.js","hideExcerpt":false,"subtitle":"Descobrindo da pior maneira que algumas informações não deveriam ser conhecidas"}}},{"node":{"excerpt":"As a developer fully committed (pun intended, and not the…","html":"<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9AMiUA8uYBMuWAsmYC8+XBG51Z5OSWq6VQY6LV9i1I9ClFrGfW5qeW7aIDs+LAMyYDs+WBtOZAM+ZA9CaAgDNlgHUmQHjnACtsj2qwEpza1Obqbqus7l8j6yPkGaenWq0n1pMbalea2GJuocoqr5hl3TglgDUmwPSmwIAnok+o5JH3agH0blJraxOZWdxi5GbsrG1zb7Al4VdVWRjVVJVJENtFXikG4mqbnJGRI+Lw5EU0JMEzZcEAI59SJ240LS+rMC+ip+QT08zQGZga9fOvurUzLa0kpaPTGIlRFA5WxJYgR5DaaeQPjmmppiOObiLGNCWAgCwiBSlsbHq6s6Xn5pBRVdPUWpncofk5NOdsLRnloqlyG1eS1hhQVUZXYANUn5yY0GrrEKnnjzIoh3goAAA0KEQl6KUy8vBsZSHjoJzMUVoSVBdYVlmkIFrT3ltPHN/cKJ9XYVoE3qXGY2tbXBW9rkvzq03mJpE5akEAOevCKKaYrzByPnctIN6cQgaTqGobNvOUtnIVv/pVFV+bhZbfBlFZBw0WB6sx0uTlNChSO+8MHyPV8ylGQDmqA+xljyuvsX/9tBwdXd0eINYZnCounf/9Vf/9FSOekBGNTG3nES0lTlYY1AhK1WTjlmauW5IeXHjsA0A5MkX2Mcpn56Oi310XWZ12NrJpJ5vZmxX9Ohbzs9mp7VwhXJtnKl4oJ5hootJVGVXFUt5MlZhtZgl/80EAN+0G7GMSlhDSlpeg4GNkXtwcqt8X3VhRJCCT3mHbU95o3V6l3eMmnJ3kntiUEmDhD5fbZ19ZsaeOPC+BQDxvgO/jx+VeTmYe0yvnmuqrHy4mm+lfShnXVW0iDqZg2drgpCLb4Z9XlKomH6ojF/IiyOus6amj1P4xwWkVkqDztXvPgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"illustration of how it feels to work with foss\"\n        title=\"illustration of how it feels to work with foss\"\n        src=\"/static/e33431ea4c32553f41b55b637ea5a114/42a19/foss-git-calculation-illustration.png\"\n        srcset=\"/static/e33431ea4c32553f41b55b637ea5a114/e3135/foss-git-calculation-illustration.png 256w,\n/static/e33431ea4c32553f41b55b637ea5a114/06341/foss-git-calculation-illustration.png 512w,\n/static/e33431ea4c32553f41b55b637ea5a114/42a19/foss-git-calculation-illustration.png 1024w,\n/static/e33431ea4c32553f41b55b637ea5a114/e8464/foss-git-calculation-illustration.png 1536w,\n/static/e33431ea4c32553f41b55b637ea5a114/445c6/foss-git-calculation-illustration.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">illustration of how it feels to work with foss</figcaption>\n  </figure></p>\n<p>As a developer fully committed (pun intended, and not the only one) in FOSS side projects, I often lose track of time. It feels like I’ve spent countless hours coding, but how many exactly? Curiosity got the best of me, so I decided to write a Node.js script to find out. Spoiler: I immediately regretted this decision after seeing just how much of my free time was spent coding. Here’s the story.</p>\n<h2 id=\"drafting-the-plan\" style=\"position:relative;\"><a href=\"#drafting-the-plan\" aria-label=\"drafting the plan permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Drafting the plan</h2>\n<p>I wanted a script that could calculate my working hours based on my GIT commits. Since I’m an avid believer of the atomic commits conventions, the idea is simple: when I’m working on my side projects, I’m committing. If there’s a gap of more than 3 hours between commits it means I’m probably off doing something else, like eating, sleeping, or watching programming videos (no wait).</p>\n<h2 id=\"choosing-the-right-package\" style=\"position:relative;\"><a href=\"#choosing-the-right-package\" aria-label=\"choosing the right package permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Choosing the right package</h2>\n<p>There are many GIT libraries for Node.js, but I went with <code class=\"language-text\">simple-git</code> for its ease of use. It’s a wrapper around GIT commands, making it perfect for this task.</p>\n<p>So after installing <code class=\"language-text\">simple-git</code>, and doing <code class=\"language-text\">npm init</code> and all of these shenanigans, I was ready to start coding.</p>\n<h2 id=\"the-code\" style=\"position:relative;\"><a href=\"#the-code\" aria-label=\"the code permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The code</h2>\n<p>Ok, let’s first get familiarized with <code class=\"language-text\">simple-git</code>, here is a simple code to fetch the commit log:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> simpleGIT <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'simple-git'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> git <span class=\"token operator\">=</span> <span class=\"token function\">simpleGIT</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getCommitLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> log <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> git<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> log<span class=\"token punctuation\">.</span>all<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error fetching commit log:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">getCommitLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">commits</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With the commit log in hand, let’s ”<a href=\"https://git-scm.com/docs/git-apply\" target=\"_blank\" rel=\"noreferrer\">apply</a>” our drafted plan into code and calculate the work hours. The idea is to iterate through the commits, and whenever there’s a gap of more than 3 hours between two commits, consider the previous commit as the end of a work session.</p>\n<p>So for example, if I start working at 9 AM and commit at 10 AM, then commit again at 3 PM, the script should consider the work session to be from 9 AM to 10 AM, so 1 hour.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">calculateWorkHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> commits <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCommitLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No commits found in this repository.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">let</span> totalWorkTime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">let</span> currentCommit <span class=\"token operator\">=</span> commits<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> maxInterval <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3 hours in milliseconds</span>\r\n\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> commits<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">const</span> nextCommit <span class=\"token operator\">=</span> commits<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">const</span> currentCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>currentCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">const</span> nextCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>nextCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>currentCommitTime <span class=\"token operator\">-</span> nextCommitTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> maxInterval<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                totalWorkTime <span class=\"token operator\">+=</span> currentCommitTime <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                currentCommit <span class=\"token operator\">=</span> nextCommit<span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        totalWorkTime <span class=\"token operator\">+=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>currentCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> totalWorkHours <span class=\"token operator\">=</span> totalWorkTime <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Total work hours: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>totalWorkHours<span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> hours</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error calculating work hours:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">calculateWorkHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s basically it, but since we’re here, why not squeeze some more information? Not that knowing the total hours isn’t enough, but now I want to know how much time, on average, I am, uh, wasting—uh, I mean, having some quality time with my laptop.</p>\n<p>Let’s add that calculation:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">calculateWorkHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> commits <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getCommitLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No commits found in this repository.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        <span class=\"token keyword\">let</span> totalWorkTime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">let</span> currentCommit <span class=\"token operator\">=</span> commits<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> maxInterval <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3 hours in milliseconds</span>\r\n\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> commits<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">const</span> nextCommit <span class=\"token operator\">=</span> commits<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">const</span> currentCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>currentCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">const</span> nextCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>nextCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>currentCommitTime <span class=\"token operator\">-</span> nextCommitTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> maxInterval<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                totalWorkTime <span class=\"token operator\">+=</span> currentCommitTime <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                currentCommit <span class=\"token operator\">=</span> nextCommit<span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        totalWorkTime <span class=\"token operator\">+=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>currentCommit<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> totalWorkHours <span class=\"token operator\">=</span> totalWorkTime <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">const</span> firstCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span>commits<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> lastCommitTime <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>commits<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">const</span> totalDays <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>lastCommitTime <span class=\"token operator\">-</span> firstCommitTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token keyword\">const</span> averageHoursPerDay <span class=\"token operator\">=</span> totalWorkHours <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">;</span>\r\n\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Total work hours: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>totalWorkHours<span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> hours</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average hours per day: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>averageHoursPerDay<span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> hours</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Error calculating work hours:'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">calculateWorkHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"lets-put-it-to-practice\" style=\"position:relative;\"><a href=\"#lets-put-it-to-practice\" aria-label=\"lets put it to practice permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’s put it to practice</h2>\n<p>After running the script on my latest side project, which I might write a blog post about soon, I was greeted with the following output:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">node</span> scripts/calculateWorkHours.js \r\nTotal work hours: <span class=\"token number\">98.77</span> hours\r\nAverage hours per day: <span class=\"token number\">3.74</span> hours</code></pre></div>\n<p>Excuse me, what? 98.77 hours? That’s almost 100 hours spent on a side project in a month. And 3.74 hours per day? I mean, I knew I was spending a lot of time on my side projects, but seeing the numbers was a bit of a shock.</p>\n<p>If people ask me, I say I’m quite an active person, after all, I do springboard diving 3 times a week, for a total of 4 hours per week, plus the gym sessions, around a total of 6 hours per week. So, yeah, a total of 10 hours per week, or 1.42 hours per day, not even close to the 3.74 hours per day I’m spending on my side projects.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.171875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHUlEQVQozwXB2XKaUAAAUD6hnaTGqAQXDBExUTZFtntBRCKybwJK1ESzzLRvnT71A/rVPQcJjFlqiTtbOrjqwVWqjfziqpWj5pa4W8sHD3xsXW2qgjHP4iOVnvGDCdHqEc1evvYQU2YDS01tfeuaqbPcOnpiw+J5fvTUS6T/LM3PIpsOWX7IEHcE2e4TGNGuo82rZumGiCXRnj7zIRvqs/TZeM2zY7I5h6tzoB7d2d+v3fu2GOMP4/4jVsfublACIzq3d71G1xAUJIBMqLEhZBLI5AuuXANbB5YopVB628B/f37z5Ai7aZHdYe17rV1Hhx2y+aOOt7p4C0cCQCc6lxjT3BQKU9hbQmyKGjeWyAG8Rdejp+lgMKUGfbTbuL7p1NFOA699u25c1aYUhQQqnUAmUsYZpPcmV9li5ajVRkyBAPCBNBxBhg2XamTwB3ceaBxH9vtofUK0y/UciSGbGXwG6dJg9iv66MpHV3pPQKhrc4q35hNT5ucsw5NdRxm/J9pnqr2FyiVSD84cidVJApmjo5xc8bgRzjE8h/LXVj8H2sEBn4nyq1xdYi23JZV7MgQmWYmHcFF6YO/ISCw/RjKVLZ5ebObFYU/+7BTMTv70LRIusXCOpK9Cf83BPtUTB3jPkibTBuB8G+yiJZJrdKZRkY7FS6xwHip/mLv3uXOfWnixISv/sfQo3yLXy66p4QvQWxk9oHSWOul7+n989pj+LrbIxQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dissapointed but not surprised\"\n        title=\"dissapointed but not surprised\"\n        src=\"/static/342ed021e5dea82ee6c67621bde3a959/42a19/perfectly-balanced.png\"\n        srcset=\"/static/342ed021e5dea82ee6c67621bde3a959/e3135/perfectly-balanced.png 256w,\n/static/342ed021e5dea82ee6c67621bde3a959/06341/perfectly-balanced.png 512w,\n/static/342ed021e5dea82ee6c67621bde3a959/42a19/perfectly-balanced.png 1024w,\n/static/342ed021e5dea82ee6c67621bde3a959/6ee55/perfectly-balanced.png 1496w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">dissapointed but not surprised</figcaption>\n  </figure></p>\n<h2 id=\"caveats\" style=\"position:relative;\"><a href=\"#caveats\" aria-label=\"caveats permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Caveats</h2>\n<p>While this script is nifty, it’s not without its flaws:</p>\n<ul>\n<li><strong>Assumptions on Breaks</strong>: It assumes any period longer than 3 hours between commits is a break. This might not always be true, but it’s a good enough approximation.</li>\n<li><strong>Commit Habits</strong>: If you’re someone who forgets to commit frequently, the script’s accuracy plummets.</li>\n<li><strong>Timezone Differences</strong>: Commits made in different time zones can mess with the calculations.</li>\n<li><strong>Figuring out how much time you’re wasting</strong>: This one is a bit subjective, I guess, but in my case, oof, I was not ready for that number.</li>\n</ul>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Writing this script was enlightening and horrifying all at once. I now have concrete proof of the absurd number of hours I spend on my side projects. If you’re curious (or crazy) enough to ”<a href=\"https://git-scm.com/docs/git-bisect\" target=\"_blank\" rel=\"noreferrer\">bisect</a>” your programming habits, it can be quite a “fun” exercise.</p>\n<p>And remember, while tracking your productivity is great, sometimes ignorance is bliss because after seeing my total hours, I just wanted to curl up and play some of my backlog games to compensate for all that lost free time.</p>\n<p>Happy coding, and happy atomic commits!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTA2LTE2VDAwOjAwOjAwLjAwMFo=","slug":"/2024/2024-06-16-tracking-my-working-hours-on-personal-projects-ssing-nodejs.en/","path":"/blog/coding/tracking-my-working-hours-on-personal-projects-ssing-nodejs/","locale":"en"},"rawMarkdownBody":"![illustration of how it feels to work with foss](../../uploads/blog/2024/06/foss-git-calculation-illustration.png)\r\n\r\nAs a developer fully committed (pun intended, and not the only one) in FOSS side projects, I often lose track of time. It feels like I've spent countless hours coding, but how many exactly? Curiosity got the best of me, so I decided to write a Node.js script to find out. Spoiler: I immediately regretted this decision after seeing just how much of my free time was spent coding. Here’s the story.\r\n\r\n## Drafting the plan\r\nI wanted a script that could calculate my working hours based on my GIT commits. Since I'm an avid believer of the atomic commits conventions, the idea is simple: when I'm working on my side projects, I'm committing. If there's a gap of more than 3 hours between commits it means I'm probably off doing something else, like eating, sleeping, or watching programming videos (no wait).\r\n\r\n## Choosing the right package\r\nThere are many GIT libraries for Node.js, but I went with `simple-git` for its ease of use. It's a wrapper around GIT commands, making it perfect for this task.\r\n\r\nSo after installing `simple-git`, and doing `npm init` and all of these shenanigans, I was ready to start coding.\r\n\r\n## The code\r\nOk, let's first get familiarized with `simple-git`, here is a simple code to fetch the commit log:\r\n\r\n```javascript\r\nconst simpleGIT = require('simple-git');\r\nconst git = simpleGIT();\r\n\r\nasync function getCommitLog() {\r\n    try {\r\n        const log = await git.log();\r\n        return log.all;\r\n    } catch (error) {\r\n        console.error('Error fetching commit log:', error);\r\n    }\r\n}\r\n\r\ngetCommitLog().then(commits => console.log(commits));\r\n```\r\n\r\nWith the commit log in hand, let's \"[apply](https://git-scm.com/docs/git-apply)\" our drafted plan into code and calculate the work hours. The idea is to iterate through the commits, and whenever there's a gap of more than 3 hours between two commits, consider the previous commit as the end of a work session.\r\n\r\nSo for example, if I start working at 9 AM and commit at 10 AM, then commit again at 3 PM, the script should consider the work session to be from 9 AM to 10 AM, so 1 hour.\r\n\r\n```javascript\r\nasync function calculateWorkHours() {\r\n    try {\r\n        const commits = await getCommitLog();\r\n\r\n        if (commits.length === 0) {\r\n            console.log('No commits found in this repository.');\r\n            return;\r\n        }\r\n\r\n        let totalWorkTime = 0;\r\n        let currentCommit = commits[0];\r\n        const maxInterval = 3 * (60 * 60 * 1000); // 3 hours in milliseconds\r\n\r\n        for (let i = 1; i < commits.length; i++) {\r\n            const nextCommit = commits[i];\r\n            const currentCommitTime = new Date(currentCommit.date).getTime();\r\n            const nextCommitTime = new Date(nextCommit.date).getTime();\r\n\r\n            if ((currentCommitTime - nextCommitTime) > maxInterval) {\r\n                totalWorkTime += currentCommitTime - new Date(commits[i - 1].date).getTime();\r\n                currentCommit = nextCommit;\r\n            }\r\n        }\r\n\r\n        totalWorkTime += new Date(currentCommit.date).getTime() - new Date(commits[commits.length - 1].date).getTime();\r\n        const totalWorkHours = totalWorkTime / (1000 * 60 * 60);\r\n\r\n        console.log(`Total work hours: ${totalWorkHours.toFixed(2)} hours`);\r\n    } catch (error) {\r\n        console.error('Error calculating work hours:', error);\r\n    }\r\n}\r\n\r\ncalculateWorkHours();\r\n```\r\n\r\nThat's basically it, but since we're here, why not squeeze some more information? Not that knowing the total hours isn't enough, but now I want to know how much time, on average, I am, uh, wasting—uh, I mean, having some quality time with my laptop.\r\n\r\nLet's add that calculation:\r\n\r\n```javascript\r\nasync function calculateWorkHours() {\r\n    try {\r\n        const commits = await getCommitLog();\r\n\r\n        if (commits.length === 0) {\r\n            console.log('No commits found in this repository.');\r\n            return;\r\n        }\r\n\r\n        let totalWorkTime = 0;\r\n        let currentCommit = commits[0];\r\n        const maxInterval = 3 * (60 * 60 * 1000); // 3 hours in milliseconds\r\n\r\n        for (let i = 1; i < commits.length; i++) {\r\n            const nextCommit = commits[i];\r\n            const currentCommitTime = new Date(currentCommit.date).getTime();\r\n            const nextCommitTime = new Date(nextCommit.date).getTime();\r\n\r\n            if ((currentCommitTime - nextCommitTime) > maxInterval) {\r\n                totalWorkTime += currentCommitTime - new Date(commits[i - 1].date).getTime();\r\n                currentCommit = nextCommit;\r\n            }\r\n        }\r\n\r\n        totalWorkTime += new Date(currentCommit.date).getTime() - new Date(commits[commits.length - 1].date).getTime();\r\n        const totalWorkHours = totalWorkTime / (1000 * 60 * 60);\r\n\r\n        const firstCommitTime = new Date(commits[commits.length - 1].date).getTime();\r\n        const lastCommitTime = new Date(commits[0].date).getTime();\r\n        const totalDays = (lastCommitTime - firstCommitTime) / (1000 * 60 * 60 * 24);\r\n\r\n        const averageHoursPerDay = totalWorkHours / totalDays;\r\n\r\n        console.log(`Total work hours: ${totalWorkHours.toFixed(2)} hours`);\r\n        console.log(`Average hours per day: ${averageHoursPerDay.toFixed(2)} hours`);\r\n    } catch (error) {\r\n        console.error('Error calculating work hours:', error);\r\n    }\r\n}\r\n\r\ncalculateWorkHours();\r\n```\r\n\r\n## Let's put it to practice\r\nAfter running the script on my latest side project, which I might write a blog post about soon, I was greeted with the following output:\r\n\r\n```shell\r\n$ node scripts/calculateWorkHours.js \r\nTotal work hours: 98.77 hours\r\nAverage hours per day: 3.74 hours\r\n```\r\n\r\nExcuse me, what? 98.77 hours? That's almost 100 hours spent on a side project in a month. And 3.74 hours per day? I mean, I knew I was spending a lot of time on my side projects, but seeing the numbers was a bit of a shock.\r\n\r\nIf people ask me, I say I'm quite an active person, after all, I do springboard diving 3 times a week, for a total of 4 hours per week, plus the gym sessions, around a total of 6 hours per week. So, yeah, a total of 10 hours per week, or 1.42 hours per day, not even close to the 3.74 hours per day I'm spending on my side projects.\r\n\r\n![dissapointed but not surprised](../../uploads/blog/2024/06/perfectly-balanced.png)\r\n\r\n## Caveats\r\nWhile this script is nifty, it's not without its flaws:\r\n\r\n- **Assumptions on Breaks**: It assumes any period longer than 3 hours between commits is a break. This might not always be true, but it's a good enough approximation.\r\n- **Commit Habits**: If you're someone who forgets to commit frequently, the script's accuracy plummets.\r\n- **Timezone Differences**: Commits made in different time zones can mess with the calculations.\r\n- **Figuring out how much time you're wasting**: This one is a bit subjective, I guess, but in my case, oof, I was not ready for that number.\r\n\r\n## Conclusion\r\nWriting this script was enlightening and horrifying all at once. I now have concrete proof of the absurd number of hours I spend on my side projects. If you're curious (or crazy) enough to \"[bisect](https://git-scm.com/docs/git-bisect)\" your programming habits, it can be quite a \"fun\" exercise.\r\n\r\nAnd remember, while tracking your productivity is great, sometimes ignorance is bliss because after seeing my total hours, I just wanted to curl up and play some of my backlog games to compensate for all that lost free time.\r\n\r\nHappy coding, and happy atomic commits!\r\n","frontmatter":{"tags":["nodejs","git","foss","javascript","simple-git","math"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2024-06-16T00:00:00.000Z","id":null,"path":"tracking-my-working-hours-on-personal-projects-using-nodejs","show":true,"title":"Tracking my working hours on personal projects using Node.js","hideExcerpt":false,"subtitle":"Finding out the hard way that some information are not supposed to be known"}}},{"node":{"excerpt":"Navegar pelas complexidades do mangá como um leitor…","html":"<p>Navegar pelas complexidades do mangá como um leitor ocidental pode ser comparável a depurar código assembly: frustrante e com um alto risco de errar completamente. Mas não tema, meus companheiros desajustados de mangá! Com uma pitada de código Python e uma boa dose de habilidade em programação, criei um script magistral para adaptar as páginas de mangá para o consumo ocidental.</p>\n<p>Então, se você é meio preguiçoso, como eu, este script é para você.</p>\n<p><strong>Aviso:</strong> Este projeto é uma exploração divertida no processamento de imagens com Python. Não tem a intenção de depreciar a experiência tradicional de mangá, mas sim oferecer uma alternativa para aqueles que possam ter dificuldades com ela.</p>\n<h2 id=\"mas-por-que\" style=\"position:relative;\"><a href=\"#mas-por-que\" aria-label=\"mas por que permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mas… por quê?</h2>\n<p>Como um fã colossal de Dragon Ball, esperar pela nova temporada de “Dragon Ball Super” tem se sentido como uma tarefa impossível, mesmo já tendo esperado por sete anos. Com a nova temporada ainda sem confirmação de que vai acontecer, e Dragon Ball Daima logo ali, minha única alternativa para finalmente descobrir quem é Moro foi o mangá. No entanto, o formato tradicional do mangá, lido da direita para a esquerda, destrói completamente meu cérebro de macaco (talvez com algumas tendências disléxicas) e hábitos de leitura ocidentais.</p>\n<h2 id=\"este-projeto-foss-e-apresentado-por\" style=\"position:relative;\"><a href=\"#este-projeto-foss-e-apresentado-por\" aria-label=\"este projeto foss e apresentado por permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Este projeto FOSS é apresentado por</h2>\n<h3 id=\"easyocr\" style=\"position:relative;\"><a href=\"#easyocr\" aria-label=\"easyocr permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>easyOCR</h3>\n<p>Vamos reservar um momento para cantar os louvores do <code class=\"language-text\">easyOCR</code>, o herói deste projeto. Ele não apenas lê texto de imagens — ele fornece as coordenadas precisas (x, y) junto com largura e altura.</p>\n<p>Isso é crucial porque, em nosso script, saber onde o texto está localizado é o primeiro passo no processo mágico de virá-lo corretamente, e a maioria das ferramentas de OCR não oferece esse nível de detalhe. Com essa informação, podemos espelhar a imagem mantendo o texto no lugar certo, para que seja lido da esquerda para a direita.</p>\n<p>Você pode ler mais sobre o <code class=\"language-text\">easyOCR</code> <a href=\"https://github.com/JaidedAI/EasyOCR\" target=\"_blank\" rel=\"noreferrer\">aqui</a>.</p>\n<h3 id=\"chatgpt\" style=\"position:relative;\"><a href=\"#chatgpt\" aria-label=\"chatgpt permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ChatGPT</h3>\n<p>ChatGPT é como aquele amigo que insiste em ler as instruções quando você só quer montar os móveis e ver o que acontece.</p>\n<p>Foi ótimo trabalhar com o <code class=\"language-text\">easyOCR</code> e o <code class=\"language-text\">PIL</code> para ler os dados e manipular as imagens, mas quando chegou a hora de virar o texto para a posição correta, eu precisei de um pouco mais de ajuda.</p>\n<p>Além disso, coisas como fazer o script funcionar com diferentes parâmetros da linha de comando e escrever o arquivo README.md, o ChatGPT estava lá para me ajudar.</p>\n<p>Bem, na verdade para o arquivo README.md, eu apenas usei o Copilot, já que ele tinha o contexto completo do código e do projeto. Mas eu acho que dá no mesmo, né?</p>\n<h3 id=\"a-arte-da-procrastinacao\" style=\"position:relative;\"><a href=\"#a-arte-da-procrastinacao\" aria-label=\"a arte da procrastinacao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A arte da procrastinação</h3>\n<p>Eu poderia ter gastado meu tempo aprendendo a ler mangá do modo tradicional, mas onde está a diversão nisso? Em vez disso, decidi criar um script Python que fizesse o trabalho pesado por mim. E assim nasceu o <a href=\"https://github.com/blopa/manga-converter\" target=\"_blank\" rel=\"noreferrer\">Manga to Comics Converter</a>.</p>\n<h2 id=\"o-espelho-magico-\" style=\"position:relative;\"><a href=\"#o-espelho-magico-\" aria-label=\"o espelho magico  permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O Espelho Mágico ✨</h2>\n<p>Ok, mas como podemos fazer isso sem ter que redesenhar toda a página do mangá? Vamos realmente contratar alguém no Fiverr para fazer isso por nós? Não, não vamos. Vamos usar Python.</p>\n<p>Imagine espelhar uma página de mangá de uma maneira que não faça seu cérebro doer. É isso que estamos fazendo aqui.</p>\n<p>Viramos toda a imagem horizontalmente, mas reposicionamos cuidadosamente o texto, para que ele seja lido da esquerda para a direita, assim como um quadrinho ocidental. É um pouco como um livro de adesivos, onde você pode descolar o texto, usar Python para virar a página horizontalmente e colá-lo de volta do outro lado. Era assim que funcionava antigamente, certo?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.390625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwT/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHszbJKD//EABoQAAMAAwEAAAAAAAAAAAAAAAECAwAREjH/2gAIAQEAAQUCQDN7Po4oHorkSSvP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHRAAAgIBBQAAAAAAAAAAAAAAAAECETEDQYGRof/aAAgBAQAGPwKtxqOn2J1VjcY+jTVXkwnyf//EABoQAQEBAQADAAAAAAAAAAAAAAERACFBUZH/2gAIAQEAAT8hloL70vMvpR4QQ0CVAZoiPu7DqE6L9wkMjxc//9oADAMBAAIAAwAAABDAz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQADAQEAAwAAAAAAAAAAAAEAESExUUFhkf/aAAgBAQABPxAKHo+A4jAU9ApdPN57kBBsRyz6i8hoKRLz8gu6KLDiPrCqcpljZTTrMyf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Um garoto colocando adesivos em um livro de adesivos, de onde emerge uma cobra Python para ajudar\"\n        title=\"Um garoto colocando adesivos em um livro de adesivos, de onde emerge uma cobra Python para ajudar\"\n        src=\"/static/d17cb3dc28424401404395a9b03cef41/63217/python-snake-stickers.jpg\"\n        srcset=\"/static/d17cb3dc28424401404395a9b03cef41/db830/python-snake-stickers.jpg 256w,\n/static/d17cb3dc28424401404395a9b03cef41/8102f/python-snake-stickers.jpg 512w,\n/static/d17cb3dc28424401404395a9b03cef41/63217/python-snake-stickers.jpg 1024w,\n/static/d17cb3dc28424401404395a9b03cef41/f2d78/python-snake-stickers.jpg 1359w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Um garoto colocando adesivos em um livro de adesivos, de onde emerge uma cobra Python para ajudar</figcaption>\n  </figure></p>\n<p>(isso é o que a DALL·E acha que a piada acima parece)</p>\n<h2 id=\"programando\" style=\"position:relative;\"><a href=\"#programando\" aria-label=\"programando permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Programando</h2>\n<p>Como mencionado anteriormente, graças ao mapeamento meticuloso de texto do <code class=\"language-text\">easyOCR</code>, podemos identificar onde os blocos de texto começam e terminam. Usamos essa informação para evitar que nosso texto se torne uma bagunça espelhada ilegível após ser virado.</p>\n<p>Então, primeiro criamos uma função chamada <code class=\"language-text\">extract_text_from_manga</code> que carrega a imagem e usa o <code class=\"language-text\">easyOCR</code> para detectar os blocos de texto e suas coordenadas, e retorna um JSON com os dados.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">extract_text_from_manga</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    reader <span class=\"token operator\">=</span> easyocr<span class=\"token punctuation\">.</span>Reader<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'en'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> Image<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        base_image <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span>\r\n\r\n    results <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span>readtext<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> detail<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n    extracted_data <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n    <span class=\"token keyword\">for</span> result <span class=\"token keyword\">in</span> results<span class=\"token punctuation\">:</span>\r\n        data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> result<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token string\">\"location\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>point<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> point <span class=\"token keyword\">in</span> result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token string\">\"width\"</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token string\">\"height\"</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        extracted_data<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">return</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>extracted_data<span class=\"token punctuation\">,</span> ensure_ascii<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Com esses dados, agora podemos reposicionar os textos criando uma nova função, <code class=\"language-text\">create_image_with_inverted_text_placement</code>, que recebe os dados de posição do texto e cria uma nova imagem.</p>\n<p>Esta função adiciona os textos às suas respectivas posições, mas os inverte horizontalmente. Por exemplo, se um texto está originalmente posicionado em 10 em uma imagem com uma largura de 100, sua nova posição torna-se 90 devido à inversão (calculada como 100 - 10 = 90).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">create_image_with_inverted_text_placement</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    width<span class=\"token punctuation\">,</span> height <span class=\"token operator\">=</span> base_image<span class=\"token punctuation\">.</span>size\r\n    new_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span><span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\r\n    data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">for</span> index<span class=\"token punctuation\">,</span> item <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        x<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">'location'</span><span class=\"token punctuation\">]</span>\r\n        box_width<span class=\"token punctuation\">,</span> box_height <span class=\"token operator\">=</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">'width'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">'height'</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token keyword\">if</span> box_width <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span> <span class=\"token keyword\">or</span> box_height <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">continue</span>\r\n\r\n        new_x <span class=\"token operator\">=</span> width <span class=\"token operator\">-</span> x <span class=\"token operator\">-</span> box_width\r\n        cropped_image <span class=\"token operator\">=</span> base_image<span class=\"token punctuation\">.</span>crop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> x <span class=\"token operator\">+</span> box_width<span class=\"token punctuation\">,</span> y <span class=\"token operator\">+</span> box_height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        cropped_image <span class=\"token operator\">=</span> cropped_image<span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">)</span>\r\n        new_image<span class=\"token punctuation\">.</span>paste<span class=\"token punctuation\">(</span>cropped_image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>new_x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cropped_image<span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">return</span> new_image</code></pre></div>\n<p>Agora o último passo é pegar a imagem original, virá-la horizontalmente e colar a imagem transparente com os textos em cima dela. Isso é feito pela função <code class=\"language-text\">overlay_flipped_with_transparent</code>, que recebe a imagem base, a imagem transparente com o texto e o caminho para salvar a imagem de saída final.</p>\n<p>A função vira a imagem base, a converte para RGBA e então usa <code class=\"language-text\">Image.alpha_composite</code> para sobrepor a imagem virada com a imagem transparente. Por fim, ela salva a imagem de saída no caminho especificado.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">overlay_flipped_with_transparent</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> transparent_image<span class=\"token punctuation\">,</span> final_output_image_path<span class=\"token operator\">=</span><span class=\"token string\">'final_output_image.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    flipped_base_image <span class=\"token operator\">=</span> base_image<span class=\"token punctuation\">.</span>transpose<span class=\"token punctuation\">(</span>Image<span class=\"token punctuation\">.</span>FLIP_LEFT_RIGHT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">if</span> transparent_image<span class=\"token punctuation\">.</span>mode <span class=\"token operator\">!=</span> <span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">:</span>\r\n        transparent_image <span class=\"token operator\">=</span> transparent_image<span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">)</span>\r\n\r\n    combined_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span>alpha_composite<span class=\"token punctuation\">(</span>flipped_base_image<span class=\"token punctuation\">,</span> transparent_image<span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">if</span> final_output_image_path<span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>endswith<span class=\"token punctuation\">(</span><span class=\"token string\">'.jpg'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> final_output_image_path<span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>endswith<span class=\"token punctuation\">(</span><span class=\"token string\">'.jpeg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        combined_image <span class=\"token operator\">=</span> combined_image<span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'RGB'</span><span class=\"token punctuation\">)</span>\r\n\r\n    combined_image<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>final_output_image_path<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Então, juntando tudo, agora podemos extrair o texto da imagem do mangá, inverter as posições do texto e sobrepor a imagem virada com o texto na posição correta. O resultado é uma página de mangá que se lê da esquerda para a direita, assim como um quadrinho ocidental.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">do_task</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> final_output_image_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        base_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span>\r\n    extracted_text <span class=\"token operator\">=</span> extract_text_from_manga<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span>\r\n    base_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> base_image\r\n    transparent_image <span class=\"token operator\">=</span> create_image_with_inverted_text_placement<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> extracted_text<span class=\"token punctuation\">)</span>\r\n    overlay_flipped_with_transparent<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> transparent_image<span class=\"token punctuation\">,</span> final_output_image_path<span class=\"token punctuation\">)</span></code></pre></div>\n<p>E é isso! Claro, há mais código para lidar com diferentes cenários, como processar várias imagens ou arquivos CBR, mas a lógica principal permanece a mesma. Você pode conferir o script completo <a href=\"https://github.com/blopa/manga-converter\" target=\"_blank\" rel=\"noreferrer\">aqui</a>.</p>\n<h2 id=\"como-usar\" style=\"position:relative;\"><a href=\"#como-usar\" aria-label=\"como usar permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Como usar</h2>\n<p>Para começar com o <a href=\"https://github.com/blopa/manga-converter\" target=\"_blank\" rel=\"noreferrer\">Manga to Comics Converter</a>, você primeiro precisa garantir que seu ambiente esteja configurado corretamente:</p>\n<ol>\n<li>\n<p><strong>Clone ou Baixe o Script</strong>: Obtenha uma cópia do script de nosso repositório. Se você está familiarizado com o Git, pode cloná-lo; caso contrário, basta baixar o arquivo zip e extrair para um local conveniente em seu computador.</p>\n</li>\n<li>\n<p><strong>Instale as Dependências</strong>: Abra seu terminal e navegue até o diretório do script. Instale todas as dependências necessárias executando:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> <span class=\"token parameter variable\">-r</span> requirements.txt</code></pre></div>\n</li>\n<li>\n<p><strong>Prepare seus arquivos de mangá</strong>: Certifique-se de que suas páginas de mangá estejam em um formato suportado (formatos comuns de imagem como JPG, PNG são perfeitos). Organize as páginas em um único diretório se você tiver vários arquivos.</p>\n</li>\n<li>\n<p><strong>Execute o Script</strong>: Use a linha de comando para especificar o diretório de origem e o diretório de saída. Se você não especificar um diretório de saída, o script criará um automaticamente. Veja como você pode executar o script:</p>\n<ul>\n<li>Para converter uma única página de mangá:\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">python3 script.py <span class=\"token parameter variable\">--source</span> manga_page.jpg <span class=\"token parameter variable\">--output</span> comic_folder</code></pre></div>\n</li>\n<li>Para converter várias páginas armazenadas em uma pasta:\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">python3 script.py <span class=\"token parameter variable\">--source</span> manga_folder <span class=\"token parameter variable\">--output</span> comic_folder</code></pre></div>\n</li>\n<li>Para converter um arquivo CBR:\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">python3 script.py <span class=\"token parameter variable\">--source</span> manga.cbr <span class=\"token parameter variable\">--output</span> comic_folder</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Verifique os resultados</strong>: Depois que o script terminar de processar, verifique o diretório de saída para suas novas páginas de quadrinhos transformadas.</p>\n</li>\n</ol>\n<h2 id=\"consideracoes\" style=\"position:relative;\"><a href=\"#consideracoes\" aria-label=\"consideracoes permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Considerações</h2>\n<p>Embora o <a href=\"https://github.com/blopa/manga-converter\" target=\"_blank\" rel=\"noreferrer\">Manga to Comics Converter</a> tenha como objetivo simplificar sua experiência de leitura de mangá, há alguns pontos a serem considerados:</p>\n<ul>\n<li><strong>Qualidade do Reconhecimento de Texto</strong>: A precisão da detecção de texto pode variar com base na qualidade das imagens do mangá. Imagens de alta resolução tendem a produzir melhores resultados.</li>\n<li><strong>Nuanças Culturais</strong>: A inversão das imagens às vezes pode perturbar a intenção artística original ou o fluxo da história. Certos elementos visuais destinados a estar em um lado da página podem não se traduzir bem quando espelhados.</li>\n<li><strong>Desempenho</strong>: O processamento de várias páginas de mangá ou de alta resolução pode ser intensivo computacionalmente, especialmente se você não estiver usando uma GPU.</li>\n<li><strong>Falhas Específicas</strong>: Se o texto sobrepuser elementos visuais significativos (como um “BOOOM” no meio de um desenho de personagem), a parte da imagem sob o texto será virada, o que poderia resultar em uma visualização com falha. Isso ocorre devido ao script virar a página inteira, exceto as áreas de texto.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 569px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAGpUlEQVQ4yy2Vb0xS3x/H7+ppqzWz5eZq63mrZ9XaWvVrucJ0/rkynNrUxYP+TKUcuFx/lNQxMTWNBHRoJPmPoCQBUZTpxYFeVCDRKZB5vcDlXi4Eaqmc75Tf69F5cj7nnPfn/f4cyOfzBQIBsVj8/ft3AIDVahWJRC9fvnz//r3ZbF5eXvb7/Tab7cePHzKZbGJiQqPRfPv2ra2tjcViQX6/v+qQ4uJivV5vMpkUCkVLS0t9ff3i4mIkEgmFQj6fLxKJqA/59OkTn8+XyWQNDQ3Q3Nzc5cuXL168eP36dS6X+/HjR6FQKBKJVCqVx+OhKIogiD9//gAAzGbzw4cPeTyeVCpdX1/X6XSQVqu9dOmSRCKpr6/PzMy0WCy9vb11dXX9/f04jgeDQZIkt7a2AABqtVqhULS2tg4MDESjUalUCi0vLysUilgs5nK57t69W1NTMzk5OTs7S9M0QRAul2tlZSVx88bGxoaGhpmZmV+/fmEYNjk5CW1vb0ej0WAwuLq6yufzX79+PTIygqIoTdM/f/5EUdTr9dpstsXFxYmJCRRFHQ4HiqLDw8NNTU1QIBBYWFiYm5sLBoNqtbqurk4oFCIIQtN0OBymafrfv38YhlEURZJkLBZDEGRgYEAkEn3+/BnS6XQSiQRF0YqKCgiCJBLJ4uJid3f3ysoKOCQaja6trSXW4XB4aGhILBYbDAav1wv19vZCEHTkyJGjR49CENTY2OjxeJaXl9fW1iiKAgDQNJ0Q7O/fv+vr6xRFzc/PWywWh8MBWSyWnJycwsLCoqIiGIa1Wi2O4wRB+P1+p9OJ4zhFUUql0ul02mw2t9ttsVhMJtPU1JTb7Ya2trb29vYoivp3CHmIz+fDcZym6cRTURS12+06na6mpqaiooLD4Uil0rGxMQjDMKfT6fP5CIIIhUKRSGR7ezsUCm1sbHi93q2tLbvdLpFIfv/+bTQau7q6JBJJe3t7f39/Z2cnRBDE0tISSZJut9vj8bjd7kShQCDgcrkwDENRVC6Xc7lcHo9nMBh4PN6XL18SboEoigqFQtvb238OScgTj8dpmsZx3O/37+7uJjS/cuWKWq0uKyszGAxSqXRpaenAJPF4fH9/PxqN0jS9u7tLkmRfX19ra2tXVxeO4/F4XKPR7O/v19bWfvjwAQCAYRiXy93c3ITGxsY6OjoQBHG73QRBjIyMZGZmCgSCvr6+/v5+s9kMAMjKylKpVOPj42lpacPDwxwOZ3BwcHd3F6qsrBQKhRwOB4bhtra2wsJCJpNptVp7eno0Go1CoaAoSiAQ1NfXz8/Pv3jxQqfT2e12r9dLkiS0uroqFAqdTqdSqRQKhXK5vK+vLyMjo7u7OxwOT01Neb1evV6vUqlMJpNIJNrZ2UEQZHJycnBw8KBVbDa7vb29qampuroaABCLxZRKZVVV1dDQ0OzsrMlkWlhYWF1d7erq4nA4QqFQo9EgCPLmzRvIarU+e/YsKysrOzsbRVEMwwAAYrGYzWbzeLyEMcrKysrLyysqKp4/f56fn4/jOACAx+NB09PTMAxnZWXp9fqOjg6bzabX669evVpSUgLDcHV1dVFREZPJzM/PZ7FYRUVF6enpHR0dAID8/HzIaDReu3aNwWA8ePDgwoULIpGIyWTevHmTwWDcuHGDy+Xeu3fv1q1bt2/f/t8hd+7cYTAYb9++ZTAYkEqlOnbsWHJy8okTJ1JTU0+fPn3u3LnU1NSkpKTjx4+XlJScP3/+5MmTycnJSUlJycnJp06dOnPmTEpKytmzZyGz2ZyRkQHDcF5eXk5OTl5eXnZ2NpPJLC0tLS4uFggEBQUFOTk5TCaTxWLBMJybmwvDMIvFys3NPUhVAp/Pl0hYLBaz2Wzl5eWPHz+urKzEMGxzc9Nms6EoGgwGI5FIOByOx+MAACiRAb/fbzKZEpPN4XB0dnaWlpaWl5enpKQgCKJQKBobG7VaLYqiHo+HIIidnZ14PA6RJLmxsdHT02MwGMbHx+fn52dmZlZWVsbHxwEAzc3NT548qaysZLPZX79+nZqamp2dtdvte3t7BydHIpFAIMDj8dhstkAgmJmZGRkZ2dnZWVhYePfuXXp6+qtXr0pKSjgcjkwmm5ubk8vlCIIkRtrBd4Oi6PT09KNHj/h8/ujoqFqtTrQxLS1tbGzM6XRKJJKnT5/K5XKr1SoWi00m0/83b25uqtVqu93e0tLC4XCam5s7OztJkqytrTUajZmZmffv3zcYDDKZrKCgQCwWK5XK0dHRhGD/AWVownytEmZHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"página de mangá com falha\"\n        title=\"página de mangá com falha\"\n        src=\"/static/f70dec21cf63a8d87241917f2b71a8ea/7ca0c/glitched-manga-page.png\"\n        srcset=\"/static/f70dec21cf63a8d87241917f2b71a8ea/e3135/glitched-manga-page.png 256w,\n/static/f70dec21cf63a8d87241917f2b71a8ea/06341/glitched-manga-page.png 512w,\n/static/f70dec21cf63a8d87241917f2b71a8ea/7ca0c/glitched-manga-page.png 569w\"\n        sizes=\"(max-width: 569px) 100vw, 569px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">página de mangá com falha</figcaption>\n  </figure></p>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Nós construímos uma ponte entre Oriente e Ocidente com algumas linhas de Python, transformando mangás de leitura da direita para a esquerda em quadrinhos de leitura da esquerda para a direita. Agora, você pode desfrutar de “Dragon Ball Super” sem sentir que está lendo um livro em um espelho.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTA1LTAxVDAwOjAwOjAwLjAwMFo=","slug":"/2024/2024-05-01-transformando-paginas-de-manga-para-leitores-ocidentais-preguicosos.pt-br/","path":"/blog/coding/transformando-paginas-de-manga-para-leitores-ocidentais-preguicosos/","locale":"pt-br"},"rawMarkdownBody":"Navegar pelas complexidades do mangá como um leitor ocidental pode ser comparável a depurar código assembly: frustrante e com um alto risco de errar completamente. Mas não tema, meus companheiros desajustados de mangá! Com uma pitada de código Python e uma boa dose de habilidade em programação, criei um script magistral para adaptar as páginas de mangá para o consumo ocidental.\r\n\r\nEntão, se você é meio preguiçoso, como eu, este script é para você.\r\n\r\n**Aviso:** Este projeto é uma exploração divertida no processamento de imagens com Python. Não tem a intenção de depreciar a experiência tradicional de mangá, mas sim oferecer uma alternativa para aqueles que possam ter dificuldades com ela.\r\n\r\n## Mas... por quê?\r\nComo um fã colossal de Dragon Ball, esperar pela nova temporada de \"Dragon Ball Super\" tem se sentido como uma tarefa impossível, mesmo já tendo esperado por sete anos. Com a nova temporada ainda sem confirmação de que vai acontecer, e Dragon Ball Daima logo ali, minha única alternativa para finalmente descobrir quem é Moro foi o mangá. No entanto, o formato tradicional do mangá, lido da direita para a esquerda, destrói completamente meu cérebro de macaco (talvez com algumas tendências disléxicas) e hábitos de leitura ocidentais.\r\n\r\n## Este projeto FOSS é apresentado por\r\n\r\n### easyOCR\r\nVamos reservar um momento para cantar os louvores do `easyOCR`, o herói deste projeto. Ele não apenas lê texto de imagens — ele fornece as coordenadas precisas (x, y) junto com largura e altura.\r\n\r\nIsso é crucial porque, em nosso script, saber onde o texto está localizado é o primeiro passo no processo mágico de virá-lo corretamente, e a maioria das ferramentas de OCR não oferece esse nível de detalhe. Com essa informação, podemos espelhar a imagem mantendo o texto no lugar certo, para que seja lido da esquerda para a direita.\r\n\r\nVocê pode ler mais sobre o `easyOCR` [aqui](https://github.com/JaidedAI/EasyOCR).\r\n\r\n### ChatGPT\r\nChatGPT é como aquele amigo que insiste em ler as instruções quando você só quer montar os móveis e ver o que acontece.\r\n\r\nFoi ótimo trabalhar com o `easyOCR` e o `PIL` para ler os dados e manipular as imagens, mas quando chegou a hora de virar o texto para a posição correta, eu precisei de um pouco mais de ajuda.\r\n\r\nAlém disso, coisas como fazer o script funcionar com diferentes parâmetros da linha de comando e escrever o arquivo README.md, o ChatGPT estava lá para me ajudar.\r\n\r\nBem, na verdade para o arquivo README.md, eu apenas usei o Copilot, já que ele tinha o contexto completo do código e do projeto. Mas eu acho que dá no mesmo, né?\r\n\r\n### A arte da procrastinação\r\nEu poderia ter gastado meu tempo aprendendo a ler mangá do modo tradicional, mas onde está a diversão nisso? Em vez disso, decidi criar um script Python que fizesse o trabalho pesado por mim. E assim nasceu o [Manga to Comics Converter](https://github.com/blopa/manga-converter).\r\n\r\n## O Espelho Mágico ✨\r\nOk, mas como podemos fazer isso sem ter que redesenhar toda a página do mangá? Vamos realmente contratar alguém no Fiverr para fazer isso por nós? Não, não vamos. Vamos usar Python.\r\n\r\nImagine espelhar uma página de mangá de uma maneira que não faça seu cérebro doer. É isso que estamos fazendo aqui.\r\n\r\nViramos toda a imagem horizontalmente, mas reposicionamos cuidadosamente o texto, para que ele seja lido da esquerda para a direita, assim como um quadrinho ocidental. É um pouco como um livro de adesivos, onde você pode descolar o texto, usar Python para virar a página horizontalmente e colá-lo de volta do outro lado. Era assim que funcionava antigamente, certo?\r\n\r\n![Um garoto colocando adesivos em um livro de adesivos, de onde emerge uma cobra Python para ajudar](../../uploads/blog/2024/05/python-snake-stickers.jpg)\r\n\r\n(isso é o que a DALL·E acha que a piada acima parece)\r\n\r\n## Programando\r\nComo mencionado anteriormente, graças ao mapeamento meticuloso de texto do `easyOCR`, podemos identificar onde os blocos de texto começam e terminam. Usamos essa informação para evitar que nosso texto se torne uma bagunça espelhada ilegível após ser virado.\r\n\r\nEntão, primeiro criamos uma função chamada `extract_text_from_manga` que carrega a imagem e usa o `easyOCR` para detectar os blocos de texto e suas coordenadas, e retorna um JSON com os dados.\r\n\r\n```python\r\ndef extract_text_from_manga(base_image):\r\n    reader = easyocr.Reader(['en'])\r\n    if isinstance(base_image, Image.Image):\r\n        base_image = np.array(base_image)\r\n\r\n    results = reader.readtext(base_image, detail=1)\r\n    extracted_data = []\r\n    for result in results:\r\n        data = {\r\n            \"text\": result[1],\r\n            \"location\": [int(point) for point in result[0][0]],\r\n            \"width\": int(result[0][2][0] - result[0][0][0]),\r\n            \"height\": int(result[0][2][1] - result[0][0][1])\r\n        }\r\n        extracted_data.append(data)\r\n    return json.dumps(extracted_data, ensure_ascii=False)\r\n```\r\n\r\nCom esses dados, agora podemos reposicionar os textos criando uma nova função, `create_image_with_inverted_text_placement`, que recebe os dados de posição do texto e cria uma nova imagem.\r\n\r\nEsta função adiciona os textos às suas respectivas posições, mas os inverte horizontalmente. Por exemplo, se um texto está originalmente posicionado em 10 em uma imagem com uma largura de 100, sua nova posição torna-se 90 devido à inversão (calculada como 100 - 10 = 90).\r\n\r\n```python\r\ndef create_image_with_inverted_text_placement(base_image, data):\r\n    width, height = base_image.size\r\n    new_image = Image.new('RGBA', (width, height), (255, 255, 255, 0))\r\n\r\n    data = json.loads(data)\r\n    for index, item in enumerate(data):\r\n        x, y = item['location']\r\n        box_width, box_height = item['width'], item['height']\r\n        if box_width <= 0 or box_height <= 0:\r\n            continue\r\n\r\n        new_x = width - x - box_width\r\n        cropped_image = base_image.crop((x, y, x + box_width, y + box_height))\r\n        cropped_image = cropped_image.convert('RGBA')\r\n        new_image.paste(cropped_image, (new_x, y), cropped_image)\r\n\r\n    return new_image\r\n```\r\n\r\nAgora o último passo é pegar a imagem original, virá-la horizontalmente e colar a imagem transparente com os textos em cima dela. Isso é feito pela função `overlay_flipped_with_transparent`, que recebe a imagem base, a imagem transparente com o texto e o caminho para salvar a imagem de saída final.\r\n\r\nA função vira a imagem base, a converte para RGBA e então usa `Image.alpha_composite` para sobrepor a imagem virada com a imagem transparente. Por fim, ela salva a imagem de saída no caminho especificado.\r\n\r\n```python\r\ndef overlay_flipped_with_transparent(base_image, transparent_image, final_output_image_path='final_output_image.png'):\r\n    flipped_base_image = base_image.transpose(Image.FLIP_LEFT_RIGHT).convert('RGBA')\r\n\r\n    if transparent_image.mode != 'RGBA':\r\n        transparent_image = transparent_image.convert('RGBA')\r\n\r\n    combined_image = Image.alpha_composite(flipped_base_image, transparent_image)\r\n\r\n    if final_output_image_path.lower().endswith('.jpg') or final_output_image_path.lower().endswith('.jpeg'):\r\n        combined_image = combined_image.convert('RGB')\r\n\r\n    combined_image.save(final_output_image_path)\r\n```\r\n\r\nEntão, juntando tudo, agora podemos extrair o texto da imagem do mangá, inverter as posições do texto e sobrepor a imagem virada com o texto na posição correta. O resultado é uma página de mangá que se lê da esquerda para a direita, assim como um quadrinho ocidental.\r\n\r\n```python\r\ndef do_task(base_image, final_output_image_path):\r\n    if isinstance(base_image, str):\r\n        base_image = Image.open(base_image)\r\n    extracted_text = extract_text_from_manga(base_image)\r\n    base_image = Image.open(base_image) if isinstance(base_image, str) else base_image\r\n    transparent_image = create_image_with_inverted_text_placement(base_image, extracted_text)\r\n    overlay_flipped_with_transparent(base_image, transparent_image, final_output_image_path)\r\n```\r\n\r\nE é isso! Claro, há mais código para lidar com diferentes cenários, como processar várias imagens ou arquivos CBR, mas a lógica principal permanece a mesma. Você pode conferir o script completo [aqui](https://github.com/blopa/manga-converter).\r\n\r\n## Como usar\r\nPara começar com o [Manga to Comics Converter](https://github.com/blopa/manga-converter), você primeiro precisa garantir que seu ambiente esteja configurado corretamente:\r\n\r\n1. **Clone ou Baixe o Script**: Obtenha uma cópia do script de nosso repositório. Se você está familiarizado com o Git, pode cloná-lo; caso contrário, basta baixar o arquivo zip e extrair para um local conveniente em seu computador.\r\n\r\n2. **Instale as Dependências**: Abra seu terminal e navegue até o diretório do script. Instale todas as dependências necessárias executando:\r\n    ```bash\r\n    pip install -r requirements.txt\r\n    ```\r\n\r\n3. **Prepare seus arquivos de mangá**: Certifique-se de que suas páginas de mangá estejam em um formato suportado (formatos comuns de imagem como JPG, PNG são perfeitos). Organize as páginas em um único diretório se você tiver vários arquivos.\r\n\r\n4. **Execute o Script**: Use a linha de comando para especificar o diretório de origem e o diretório de saída. Se você não especificar um diretório de saída, o script criará um automaticamente. Veja como você pode executar o script:\r\n    - Para converter uma única página de mangá:\r\n        ```bash\r\n        python3 script.py --source manga_page.jpg --output comic_folder\r\n        ```\r\n    - Para converter várias páginas armazenadas em uma pasta:\r\n        ```bash\r\n        python3 script.py --source manga_folder --output comic_folder\r\n        ```\r\n    - Para converter um arquivo CBR:\r\n        ```bash\r\n        python3 script.py --source manga.cbr --output comic_folder\r\n        ```\r\n\r\n5. **Verifique os resultados**: Depois que o script terminar de processar, verifique o diretório de saída para suas novas páginas de quadrinhos transformadas.\r\n\r\n## Considerações\r\nEmbora o [Manga to Comics Converter](https://github.com/blopa/manga-converter) tenha como objetivo simplificar sua experiência de leitura de mangá, há alguns pontos a serem considerados:\r\n\r\n- **Qualidade do Reconhecimento de Texto**: A precisão da detecção de texto pode variar com base na qualidade das imagens do mangá. Imagens de alta resolução tendem a produzir melhores resultados.\r\n- **Nuanças Culturais**: A inversão das imagens às vezes pode perturbar a intenção artística original ou o fluxo da história. Certos elementos visuais destinados a estar em um lado da página podem não se traduzir bem quando espelhados.\r\n- **Desempenho**: O processamento de várias páginas de mangá ou de alta resolução pode ser intensivo computacionalmente, especialmente se você não estiver usando uma GPU.\r\n- **Falhas Específicas**: Se o texto sobrepuser elementos visuais significativos (como um \"BOOOM\" no meio de um desenho de personagem), a parte da imagem sob o texto será virada, o que poderia resultar em uma visualização com falha. Isso ocorre devido ao script virar a página inteira, exceto as áreas de texto.\r\n\r\n![página de mangá com falha](../../uploads/blog/2024/05/glitched-manga-page.png)\r\n\r\n## Conclusão\r\nNós construímos uma ponte entre Oriente e Ocidente com algumas linhas de Python, transformando mangás de leitura da direita para a esquerda em quadrinhos de leitura da esquerda para a direita. Agora, você pode desfrutar de \"Dragon Ball Super\" sem sentir que está lendo um livro em um espelho.\r\n","frontmatter":{"tags":["python","manga","processamento de imagens","easyocr","PIL","quadrinhos","transformação"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2024-05-01T00:00:00.000Z","id":null,"path":"transformando-paginas-de-manga-para-leitores-ocidentais-preguicosos","show":true,"title":"Transformando páginas de mangá para leitores ocidentais preguiçosos","hideExcerpt":false,"subtitle":"Quando ser preguiçoso é a única opção"}}},{"node":{"excerpt":"Navigating the intricacies of manga as a Western reader can…","html":"<p>Navigating the intricacies of manga as a Western reader can feel a bit like debugging assembly code, frustrating, and with a high risk of getting it all wrong. But fear not, my fellow manga misfits! With a pinch of Python code, and a heaping spoonful of programming prowess, I’ve created a masterpiece script to transform manga pages for Western consumption.</p>\n<p>So if you’re quite lazy, like me, this script is for you.</p>\n<p><strong>Disclaimer:</strong> This project is a fun exploration into image processing with Python. It’s not intended to undermine the traditional manga experience but rather to provide an alternative for those who might struggle with it.</p>\n<h2 id=\"but-why\" style=\"position:relative;\"><a href=\"#but-why\" aria-label=\"but why permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>But… why?</h2>\n<p>As a colossal Dragon Ball fan, waiting for the new season of “Dragon Ball Super” has felt like an impossible task, even though I’ve already been waiting for seven years. With the new season not even confirmed to happen yet, and Dragon Ball Daima just around the corner, my only recourse to finally learn who Moro is was the manga. However, the traditional manga format, read from right to left, completely obliterates my monkey brain (perhaps with some dyslexic tendencies) and Western reading habits.</p>\n<h2 id=\"this-foss-project-is-brought-to-you-by\" style=\"position:relative;\"><a href=\"#this-foss-project-is-brought-to-you-by\" aria-label=\"this foss project is brought to you by permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>This FOSS project is brought to you by</h2>\n<h3 id=\"easyocr\" style=\"position:relative;\"><a href=\"#easyocr\" aria-label=\"easyocr permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>easyOCR</h3>\n<p>Let’s take a moment to sing praises for <code class=\"language-text\">easyOCR</code>, the hero of this project. It not only reads text from images — it provides the precise coordinates (x, y) along with width and height.</p>\n<p>This is crucial because, in our script, knowing where the text lives is the first step in the magical process of flipping it correctly, and most OCR tools don’t provide this level of detail. With this information, we can mirror the image while keeping the text in the right place, so it reads left to right.</p>\n<p>You can read more about <code class=\"language-text\">easyOCR</code> <a href=\"https://github.com/JaidedAI/EasyOCR\" target=\"_blank\" rel=\"noreferrer\">here</a>.</p>\n<h3 id=\"chatgpt\" style=\"position:relative;\"><a href=\"#chatgpt\" aria-label=\"chatgpt permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ChatGPT</h3>\n<p>ChatGPT is like that friend who insists on reading the instructions when you just want to put the furniture together and see what happens.</p>\n<p>It was great working with <code class=\"language-text\">easyOCR</code> and <code class=\"language-text\">PIL</code> to read the data and manipulate the images, but when it came to flipping the text to it’s correct position, I needed a little more help.</p>\n<p>Also, things like make the script work with different params from the command line, and writing the README.md file, ChatGPT was there to help me.</p>\n<p>Well, actually for the README.md file, I just used Copilot, since it had the full context of the code and the project. But I guess “potato, potahto”.</p>\n<h3 id=\"the-art-of-procrastination\" style=\"position:relative;\"><a href=\"#the-art-of-procrastination\" aria-label=\"the art of procrastination permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The art of procrastination</h3>\n<p>I could have spent my time learning how to read manga the traditional way, but where’s the fun in that? Instead, I decided to create a Python script that would do the heavy lifting for me. And so, the <a href=\"https://github.com/blopa/manga-converter\" target=\"_blank\" rel=\"noreferrer\">Manga to Comics Converter</a> was born.</p>\n<h2 id=\"the-magical-mirror-\" style=\"position:relative;\"><a href=\"#the-magical-mirror-\" aria-label=\"the magical mirror  permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Magical Mirror ✨</h2>\n<p>Ok but how can we actually do this without having to re-draw the whole manga page? Are we really going to hire someone on Fiverr to do this for us? No, we’re not. We’re going to use Python.</p>\n<p>Imagine mirroring a manga page in a way that doesn’t make your brain hurt. That’s what we’re doing here.</p>\n<p>We flip the whole image horizontally but carefully reposition the text, so it reads left to right, just like a Western comic. It’s a bit like a sticker book, where you can peel off the text, use Python to flip the page horizontally and stick it back on the other side. That’s how they work back in the days, right?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.390625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwT/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHszbJKD//EABoQAAMAAwEAAAAAAAAAAAAAAAECAwAREjH/2gAIAQEAAQUCQDN7Po4oHorkSSvP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHRAAAgIBBQAAAAAAAAAAAAAAAAECETEDQYGRof/aAAgBAQAGPwKtxqOn2J1VjcY+jTVXkwnyf//EABoQAQEBAQADAAAAAAAAAAAAAAERACFBUZH/2gAIAQEAAT8hloL70vMvpR4QQ0CVAZoiPu7DqE6L9wkMjxc//9oADAMBAAIAAwAAABDAz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQADAQEAAwAAAAAAAAAAAAEAESExUUFhkf/aAAgBAQABPxAKHo+A4jAU9ApdPN57kBBsRyz6i8hoKRLz8gu6KLDiPrCqcpljZTTrMyf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A boy placing stickers in a sticker book, from which a Python snake emerges to help\"\n        title=\"A boy placing stickers in a sticker book, from which a Python snake emerges to help\"\n        src=\"/static/d17cb3dc28424401404395a9b03cef41/63217/python-snake-stickers.jpg\"\n        srcset=\"/static/d17cb3dc28424401404395a9b03cef41/db830/python-snake-stickers.jpg 256w,\n/static/d17cb3dc28424401404395a9b03cef41/8102f/python-snake-stickers.jpg 512w,\n/static/d17cb3dc28424401404395a9b03cef41/63217/python-snake-stickers.jpg 1024w,\n/static/d17cb3dc28424401404395a9b03cef41/f2d78/python-snake-stickers.jpg 1359w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">A boy placing stickers in a sticker book, from which a Python snake emerges to help</figcaption>\n  </figure></p>\n<p>(this is what DALL·E thinks the joke above looks like)</p>\n<h2 id=\"coding\" style=\"position:relative;\"><a href=\"#coding\" aria-label=\"coding permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coding</h2>\n<p>As mentioned before, thanks to <code class=\"language-text\">easyOCR</code>’s meticulous text mapping, we can pinpoint where text blocks start and end. We use this info to keep our text from turning into an unreadable mirrored mess after flipping.</p>\n<p>So first, we create a function called <code class=\"language-text\">extract_text_from_manga</code> that loads the image and use <code class=\"language-text\">easyOCR</code> to detect the text blocks and their coordinates and returns a JSON with the data.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">extract_text_from_manga</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    reader <span class=\"token operator\">=</span> easyocr<span class=\"token punctuation\">.</span>Reader<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'en'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> Image<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        base_image <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span>\r\n\r\n    results <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span>readtext<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> detail<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n    extracted_data <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n    <span class=\"token keyword\">for</span> result <span class=\"token keyword\">in</span> results<span class=\"token punctuation\">:</span>\r\n        data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">:</span> result<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token string\">\"location\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>point<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> point <span class=\"token keyword\">in</span> result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token string\">\"width\"</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token string\">\"height\"</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> result<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        extracted_data<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">return</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>extracted_data<span class=\"token punctuation\">,</span> ensure_ascii<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>With this data, we can now reposition the texts by creating a new function, <code class=\"language-text\">create_image_with_inverted_text_placement</code>, which takes text position data and creates a new image.</p>\n<p>This function adds the texts to their respective positions but inverts them horizontally. For example, if a text is originally positioned at 10 in an image with a width of 100, its new position becomes 90 due to the inversion (calculated as 100 - 10 = 90).</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">create_image_with_inverted_text_placement</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    width<span class=\"token punctuation\">,</span> height <span class=\"token operator\">=</span> base_image<span class=\"token punctuation\">.</span>size\r\n    new_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span><span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\r\n    data <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">for</span> index<span class=\"token punctuation\">,</span> item <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        x<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">'location'</span><span class=\"token punctuation\">]</span>\r\n        box_width<span class=\"token punctuation\">,</span> box_height <span class=\"token operator\">=</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">'width'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">[</span><span class=\"token string\">'height'</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token keyword\">if</span> box_width <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span> <span class=\"token keyword\">or</span> box_height <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">continue</span>\r\n\r\n        new_x <span class=\"token operator\">=</span> width <span class=\"token operator\">-</span> x <span class=\"token operator\">-</span> box_width\r\n        cropped_image <span class=\"token operator\">=</span> base_image<span class=\"token punctuation\">.</span>crop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> x <span class=\"token operator\">+</span> box_width<span class=\"token punctuation\">,</span> y <span class=\"token operator\">+</span> box_height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        cropped_image <span class=\"token operator\">=</span> cropped_image<span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">)</span>\r\n        new_image<span class=\"token punctuation\">.</span>paste<span class=\"token punctuation\">(</span>cropped_image<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>new_x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cropped_image<span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">return</span> new_image</code></pre></div>\n<p>Now the final step is to take the original image, flip it horizontally, and paste the transparent image with the texts on top of it. This is done by the <code class=\"language-text\">overlay_flipped_with_transparent</code> function, which takes the base image, the transparent image with the text, and the path to save the final output image.</p>\n<p>The function flips the base image, converts it to RGBA, and then uses <code class=\"language-text\">Image.alpha_composite</code> to overlay the flipped image with the transparent image. Finally, it saves the output image to the specified path.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">overlay_flipped_with_transparent</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> transparent_image<span class=\"token punctuation\">,</span> final_output_image_path<span class=\"token operator\">=</span><span class=\"token string\">'final_output_image.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    flipped_base_image <span class=\"token operator\">=</span> base_image<span class=\"token punctuation\">.</span>transpose<span class=\"token punctuation\">(</span>Image<span class=\"token punctuation\">.</span>FLIP_LEFT_RIGHT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">if</span> transparent_image<span class=\"token punctuation\">.</span>mode <span class=\"token operator\">!=</span> <span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">:</span>\r\n        transparent_image <span class=\"token operator\">=</span> transparent_image<span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'RGBA'</span><span class=\"token punctuation\">)</span>\r\n\r\n    combined_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span>alpha_composite<span class=\"token punctuation\">(</span>flipped_base_image<span class=\"token punctuation\">,</span> transparent_image<span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">if</span> final_output_image_path<span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>endswith<span class=\"token punctuation\">(</span><span class=\"token string\">'.jpg'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> final_output_image_path<span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>endswith<span class=\"token punctuation\">(</span><span class=\"token string\">'.jpeg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        combined_image <span class=\"token operator\">=</span> combined_image<span class=\"token punctuation\">.</span>convert<span class=\"token punctuation\">(</span><span class=\"token string\">'RGB'</span><span class=\"token punctuation\">)</span>\r\n\r\n    combined_image<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>final_output_image_path<span class=\"token punctuation\">)</span></code></pre></div>\n<p>So, putting it all together, we can now extract the text from the manga image, invert the text positions, and overlay the flipped image with the text in the correct position. The result is a manga page that reads from left to right, just like a Western comic.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">do_task</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> final_output_image_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        base_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span>\r\n    extracted_text <span class=\"token operator\">=</span> extract_text_from_manga<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span>\r\n    base_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> <span class=\"token builtin\">isinstance</span><span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> base_image\r\n    transparent_image <span class=\"token operator\">=</span> create_image_with_inverted_text_placement<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> extracted_text<span class=\"token punctuation\">)</span>\r\n    overlay_flipped_with_transparent<span class=\"token punctuation\">(</span>base_image<span class=\"token punctuation\">,</span> transparent_image<span class=\"token punctuation\">,</span> final_output_image_path<span class=\"token punctuation\">)</span></code></pre></div>\n<p>And that’s it! Of course there’s more code to account for different scenarios, like processing multiple images or CBR files, but the core logic remains the same. You can check the full script <a href=\"https://github.com/blopa/manga-converter\" target=\"_blank\" rel=\"noreferrer\">here</a>.</p>\n<h2 id=\"how-to-use-it\" style=\"position:relative;\"><a href=\"#how-to-use-it\" aria-label=\"how to use it permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to use it</h2>\n<p>To get started with the <a href=\"https://github.com/blopa/manga-converter\" target=\"_blank\" rel=\"noreferrer\">Manga to Comics Converter</a>, you’ll first need to ensure your environment is set up correctly:</p>\n<ol>\n<li>\n<p><strong>Clone or Download the Script</strong>: Get a copy of the script from our repository. If you’re familiar with Git, you can clone it; otherwise, simply download the zip file and extract it to a convenient location on your computer.</p>\n</li>\n<li>\n<p><strong>Install Dependencies</strong>: Open your terminal and navigate to the script’s directory. Install all required dependencies by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> <span class=\"token parameter variable\">-r</span> requirements.txt</code></pre></div>\n</li>\n<li>\n<p><strong>Prepare Your Manga Files</strong>: Make sure your manga pages are in a supported format (common image formats like JPG, PNG are perfect). Organize the pages in a single directory if you have multiple files.</p>\n</li>\n<li>\n<p><strong>Run the Script</strong>: Use the command line to specify the source and the output directory. If you don’t specify an output directory, the script will automatically create one. Here’s how you can run the script:</p>\n<ul>\n<li>To convert a single manga page:\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">python3 script.py <span class=\"token parameter variable\">--source</span> manga_page.jpg <span class=\"token parameter variable\">--output</span> comic_folder</code></pre></div>\n</li>\n<li>To convert multiple pages stored in a folder:\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">python3 script.py <span class=\"token parameter variable\">--source</span> manga_folder <span class=\"token parameter variable\">--output</span> comic_folder</code></pre></div>\n</li>\n<li>To convert a CBR file:\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">python3 script.py <span class=\"token parameter variable\">--source</span> manga.cbr <span class=\"token parameter variable\">--output</span> comic_folder</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Check the results</strong>: Once the script has finished processing, check the output directory for your newly transformed comic pages.</p>\n</li>\n</ol>\n<h2 id=\"some-caveats\" style=\"position:relative;\"><a href=\"#some-caveats\" aria-label=\"some caveats permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Some caveats</h2>\n<p>While the <a href=\"https://github.com/blopa/manga-converter\" target=\"_blank\" rel=\"noreferrer\">Manga to Comics Converter</a> aims to simplify your manga reading experience, there are a few points to keep in mind:</p>\n<ul>\n<li><strong>Quality of Text Recognition</strong>: The accuracy of text detection can vary based on the quality of the manga images. High-resolution images tend to yield better results.</li>\n<li><strong>Cultural Nuances</strong>: Flipping the images can sometimes disrupt the original artistic intent or the flow of the story. Certain visual elements intended to be on one side of the page might not translate well when mirrored.</li>\n<li><strong>Performance</strong>: Processing multiple or high-resolution manga pages can be computationally intensive, especially if you don’t use a GPU.</li>\n<li><strong>Specific Glitches</strong>: If the text overlays significant visual elements (like a “BOOOM” in the middle of a character drawing), the part of the image underneath the text will be flipped, which could result in a glitched visual. This is due to the script flipping the entire page except for the text areas.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 569px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAGpUlEQVQ4yy2Vb0xS3x/H7+ppqzWz5eZq63mrZ9XaWvVrucJ0/rkynNrUxYP+TKUcuFx/lNQxMTWNBHRoJPmPoCQBUZTpxYFeVCDRKZB5vcDlXi4Eaqmc75Tf69F5cj7nnPfn/f4cyOfzBQIBsVj8/ft3AIDVahWJRC9fvnz//r3ZbF5eXvb7/Tab7cePHzKZbGJiQqPRfPv2ra2tjcViQX6/v+qQ4uJivV5vMpkUCkVLS0t9ff3i4mIkEgmFQj6fLxKJqA/59OkTn8+XyWQNDQ3Q3Nzc5cuXL168eP36dS6X+/HjR6FQKBKJVCqVx+OhKIogiD9//gAAzGbzw4cPeTyeVCpdX1/X6XSQVqu9dOmSRCKpr6/PzMy0WCy9vb11dXX9/f04jgeDQZIkt7a2AABqtVqhULS2tg4MDESjUalUCi0vLysUilgs5nK57t69W1NTMzk5OTs7S9M0QRAul2tlZSVx88bGxoaGhpmZmV+/fmEYNjk5CW1vb0ej0WAwuLq6yufzX79+PTIygqIoTdM/f/5EUdTr9dpstsXFxYmJCRRFHQ4HiqLDw8NNTU1QIBBYWFiYm5sLBoNqtbqurk4oFCIIQtN0OBymafrfv38YhlEURZJkLBZDEGRgYEAkEn3+/BnS6XQSiQRF0YqKCgiCJBLJ4uJid3f3ysoKOCQaja6trSXW4XB4aGhILBYbDAav1wv19vZCEHTkyJGjR49CENTY2OjxeJaXl9fW1iiKAgDQNJ0Q7O/fv+vr6xRFzc/PWywWh8MBWSyWnJycwsLCoqIiGIa1Wi2O4wRB+P1+p9OJ4zhFUUql0ul02mw2t9ttsVhMJtPU1JTb7Ya2trb29vYoivp3CHmIz+fDcZym6cRTURS12+06na6mpqaiooLD4Uil0rGxMQjDMKfT6fP5CIIIhUKRSGR7ezsUCm1sbHi93q2tLbvdLpFIfv/+bTQau7q6JBJJe3t7f39/Z2cnRBDE0tISSZJut9vj8bjd7kShQCDgcrkwDENRVC6Xc7lcHo9nMBh4PN6XL18SboEoigqFQtvb238OScgTj8dpmsZx3O/37+7uJjS/cuWKWq0uKyszGAxSqXRpaenAJPF4fH9/PxqN0jS9u7tLkmRfX19ra2tXVxeO4/F4XKPR7O/v19bWfvjwAQCAYRiXy93c3ITGxsY6OjoQBHG73QRBjIyMZGZmCgSCvr6+/v5+s9kMAMjKylKpVOPj42lpacPDwxwOZ3BwcHd3F6qsrBQKhRwOB4bhtra2wsJCJpNptVp7eno0Go1CoaAoSiAQ1NfXz8/Pv3jxQqfT2e12r9dLkiS0uroqFAqdTqdSqRQKhXK5vK+vLyMjo7u7OxwOT01Neb1evV6vUqlMJpNIJNrZ2UEQZHJycnBw8KBVbDa7vb29qampuroaABCLxZRKZVVV1dDQ0OzsrMlkWlhYWF1d7erq4nA4QqFQo9EgCPLmzRvIarU+e/YsKysrOzsbRVEMwwAAYrGYzWbzeLyEMcrKysrLyysqKp4/f56fn4/jOACAx+NB09PTMAxnZWXp9fqOjg6bzabX669evVpSUgLDcHV1dVFREZPJzM/PZ7FYRUVF6enpHR0dAID8/HzIaDReu3aNwWA8ePDgwoULIpGIyWTevHmTwWDcuHGDy+Xeu3fv1q1bt2/f/t8hd+7cYTAYb9++ZTAYkEqlOnbsWHJy8okTJ1JTU0+fPn3u3LnU1NSkpKTjx4+XlJScP3/+5MmTycnJSUlJycnJp06dOnPmTEpKytmzZyGz2ZyRkQHDcF5eXk5OTl5eXnZ2NpPJLC0tLS4uFggEBQUFOTk5TCaTxWLBMJybmwvDMIvFys3NPUhVAp/Pl0hYLBaz2Wzl5eWPHz+urKzEMGxzc9Nms6EoGgwGI5FIOByOx+MAACiRAb/fbzKZEpPN4XB0dnaWlpaWl5enpKQgCKJQKBobG7VaLYqiHo+HIIidnZ14PA6RJLmxsdHT02MwGMbHx+fn52dmZlZWVsbHxwEAzc3NT548qaysZLPZX79+nZqamp2dtdvte3t7BydHIpFAIMDj8dhstkAgmJmZGRkZ2dnZWVhYePfuXXp6+qtXr0pKSjgcjkwmm5ubk8vlCIIkRtrBd4Oi6PT09KNHj/h8/ujoqFqtTrQxLS1tbGzM6XRKJJKnT5/K5XKr1SoWi00m0/83b25uqtVqu93e0tLC4XCam5s7OztJkqytrTUajZmZmffv3zcYDDKZrKCgQCwWK5XK0dHRhGD/AWVownytEmZHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"glitched manga page\"\n        title=\"glitched manga page\"\n        src=\"/static/f70dec21cf63a8d87241917f2b71a8ea/7ca0c/glitched-manga-page.png\"\n        srcset=\"/static/f70dec21cf63a8d87241917f2b71a8ea/e3135/glitched-manga-page.png 256w,\n/static/f70dec21cf63a8d87241917f2b71a8ea/06341/glitched-manga-page.png 512w,\n/static/f70dec21cf63a8d87241917f2b71a8ea/7ca0c/glitched-manga-page.png 569w\"\n        sizes=\"(max-width: 569px) 100vw, 569px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">glitched manga page</figcaption>\n  </figure></p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>We’ve bridged the gap between East and West with a few lines of Python, transforming right-to-left manga into left-to-right page-turners. Now, you can enjoy “Dragon Ball Super” without feeling like you’re reading a book in a mirror.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDI0LTA1LTAxVDAwOjAwOjAwLjAwMFo=","slug":"/2024/2024-05-01-transforming-manga-pages-for-western-readers.en/","path":"/blog/coding/transforming-manga-pages-for-western-readers/","locale":"en"},"rawMarkdownBody":"Navigating the intricacies of manga as a Western reader can feel a bit like debugging assembly code, frustrating, and with a high risk of getting it all wrong. But fear not, my fellow manga misfits! With a pinch of Python code, and a heaping spoonful of programming prowess, I've created a masterpiece script to transform manga pages for Western consumption.\r\n\r\nSo if you're quite lazy, like me, this script is for you.\r\n\r\n**Disclaimer:** This project is a fun exploration into image processing with Python. It's not intended to undermine the traditional manga experience but rather to provide an alternative for those who might struggle with it.\r\n\r\n## But... why?\r\nAs a colossal Dragon Ball fan, waiting for the new season of \"Dragon Ball Super\" has felt like an impossible task, even though I've already been waiting for seven years. With the new season not even confirmed to happen yet, and Dragon Ball Daima just around the corner, my only recourse to finally learn who Moro is was the manga. However, the traditional manga format, read from right to left, completely obliterates my monkey brain (perhaps with some dyslexic tendencies) and Western reading habits.\r\n\r\n## This FOSS project is brought to you by\r\n\r\n### easyOCR\r\nLet’s take a moment to sing praises for `easyOCR`, the hero of this project. It not only reads text from images — it provides the precise coordinates (x, y) along with width and height.\r\n\r\nThis is crucial because, in our script, knowing where the text lives is the first step in the magical process of flipping it correctly, and most OCR tools don't provide this level of detail. With this information, we can mirror the image while keeping the text in the right place, so it reads left to right.\r\n\r\nYou can read more about `easyOCR` [here](https://github.com/JaidedAI/EasyOCR).\r\n\r\n### ChatGPT\r\nChatGPT is like that friend who insists on reading the instructions when you just want to put the furniture together and see what happens.\r\n\r\nIt was great working with `easyOCR` and `PIL` to read the data and manipulate the images, but when it came to flipping the text to it's correct position, I needed a little more help.\r\n\r\nAlso, things like make the script work with different params from the command line, and writing the README.md file, ChatGPT was there to help me.\r\n\r\nWell, actually for the README.md file, I just used Copilot, since it had the full context of the code and the project. But I guess \"potato, potahto\".\r\n\r\n### The art of procrastination\r\nI could have spent my time learning how to read manga the traditional way, but where's the fun in that? Instead, I decided to create a Python script that would do the heavy lifting for me. And so, the [Manga to Comics Converter](https://github.com/blopa/manga-converter) was born.\r\n\r\n## The Magical Mirror ✨\r\nOk but how can we actually do this without having to re-draw the whole manga page? Are we really going to hire someone on Fiverr to do this for us? No, we're not. We're going to use Python.\r\n\r\nImagine mirroring a manga page in a way that doesn't make your brain hurt. That's what we're doing here.\r\n\r\nWe flip the whole image horizontally but carefully reposition the text, so it reads left to right, just like a Western comic. It’s a bit like a sticker book, where you can peel off the text, use Python to flip the page horizontally and stick it back on the other side. That's how they work back in the days, right?\r\n\r\n![A boy placing stickers in a sticker book, from which a Python snake emerges to help](../../uploads/blog/2024/05/python-snake-stickers.jpg)\r\n\r\n(this is what DALL·E thinks the joke above looks like)\r\n\r\n## Coding\r\nAs mentioned before, thanks to `easyOCR`'s meticulous text mapping, we can pinpoint where text blocks start and end. We use this info to keep our text from turning into an unreadable mirrored mess after flipping.\r\n\r\nSo first, we create a function called `extract_text_from_manga` that loads the image and use `easyOCR` to detect the text blocks and their coordinates and returns a JSON with the data.\r\n\r\n```python\r\ndef extract_text_from_manga(base_image):\r\n    reader = easyocr.Reader(['en'])\r\n    if isinstance(base_image, Image.Image):\r\n        base_image = np.array(base_image)\r\n\r\n    results = reader.readtext(base_image, detail=1)\r\n    extracted_data = []\r\n    for result in results:\r\n        data = {\r\n            \"text\": result[1],\r\n            \"location\": [int(point) for point in result[0][0]],\r\n            \"width\": int(result[0][2][0] - result[0][0][0]),\r\n            \"height\": int(result[0][2][1] - result[0][0][1])\r\n        }\r\n        extracted_data.append(data)\r\n    return json.dumps(extracted_data, ensure_ascii=False)\r\n```\r\n\r\nWith this data, we can now reposition the texts by creating a new function, `create_image_with_inverted_text_placement`, which takes text position data and creates a new image.\r\n\r\nThis function adds the texts to their respective positions but inverts them horizontally. For example, if a text is originally positioned at 10 in an image with a width of 100, its new position becomes 90 due to the inversion (calculated as 100 - 10 = 90).\r\n\r\n```python\r\ndef create_image_with_inverted_text_placement(base_image, data):\r\n    width, height = base_image.size\r\n    new_image = Image.new('RGBA', (width, height), (255, 255, 255, 0))\r\n\r\n    data = json.loads(data)\r\n    for index, item in enumerate(data):\r\n        x, y = item['location']\r\n        box_width, box_height = item['width'], item['height']\r\n        if box_width <= 0 or box_height <= 0:\r\n            continue\r\n\r\n        new_x = width - x - box_width\r\n        cropped_image = base_image.crop((x, y, x + box_width, y + box_height))\r\n        cropped_image = cropped_image.convert('RGBA')\r\n        new_image.paste(cropped_image, (new_x, y), cropped_image)\r\n\r\n    return new_image\r\n```\r\n\r\nNow the final step is to take the original image, flip it horizontally, and paste the transparent image with the texts on top of it. This is done by the `overlay_flipped_with_transparent` function, which takes the base image, the transparent image with the text, and the path to save the final output image.\r\n\r\nThe function flips the base image, converts it to RGBA, and then uses `Image.alpha_composite` to overlay the flipped image with the transparent image. Finally, it saves the output image to the specified path.\r\n\r\n```python\r\ndef overlay_flipped_with_transparent(base_image, transparent_image, final_output_image_path='final_output_image.png'):\r\n    flipped_base_image = base_image.transpose(Image.FLIP_LEFT_RIGHT).convert('RGBA')\r\n\r\n    if transparent_image.mode != 'RGBA':\r\n        transparent_image = transparent_image.convert('RGBA')\r\n\r\n    combined_image = Image.alpha_composite(flipped_base_image, transparent_image)\r\n\r\n    if final_output_image_path.lower().endswith('.jpg') or final_output_image_path.lower().endswith('.jpeg'):\r\n        combined_image = combined_image.convert('RGB')\r\n\r\n    combined_image.save(final_output_image_path)\r\n```\r\n\r\nSo, putting it all together, we can now extract the text from the manga image, invert the text positions, and overlay the flipped image with the text in the correct position. The result is a manga page that reads from left to right, just like a Western comic.\r\n\r\n```python\r\ndef do_task(base_image, final_output_image_path):\r\n    if isinstance(base_image, str):\r\n        base_image = Image.open(base_image)\r\n    extracted_text = extract_text_from_manga(base_image)\r\n    base_image = Image.open(base_image) if isinstance(base_image, str) else base_image\r\n    transparent_image = create_image_with_inverted_text_placement(base_image, extracted_text)\r\n    overlay_flipped_with_transparent(base_image, transparent_image, final_output_image_path)\r\n```\r\n\r\nAnd that's it! Of course there's more code to account for different scenarios, like processing multiple images or CBR files, but the core logic remains the same. You can check the full script [here](https://github.com/blopa/manga-converter).\r\n\r\n## How to use it\r\nTo get started with the [Manga to Comics Converter](https://github.com/blopa/manga-converter), you'll first need to ensure your environment is set up correctly:\r\n\r\n1. **Clone or Download the Script**: Get a copy of the script from our repository. If you’re familiar with Git, you can clone it; otherwise, simply download the zip file and extract it to a convenient location on your computer.\r\n\r\n2. **Install Dependencies**: Open your terminal and navigate to the script’s directory. Install all required dependencies by running:\r\n    ```bash\r\n    pip install -r requirements.txt\r\n    ```\r\n\r\n3. **Prepare Your Manga Files**: Make sure your manga pages are in a supported format (common image formats like JPG, PNG are perfect). Organize the pages in a single directory if you have multiple files.\r\n\r\n4. **Run the Script**: Use the command line to specify the source and the output directory. If you don’t specify an output directory, the script will automatically create one. Here’s how you can run the script:\r\n    - To convert a single manga page:\r\n        ```bash\r\n        python3 script.py --source manga_page.jpg --output comic_folder\r\n        ```\r\n    - To convert multiple pages stored in a folder:\r\n        ```bash\r\n        python3 script.py --source manga_folder --output comic_folder\r\n        ```\r\n    - To convert a CBR file:\r\n        ```bash\r\n        python3 script.py --source manga.cbr --output comic_folder\r\n        ```\r\n\r\n5. **Check the results**: Once the script has finished processing, check the output directory for your newly transformed comic pages.\r\n\r\n## Some caveats\r\nWhile the [Manga to Comics Converter](https://github.com/blopa/manga-converter) aims to simplify your manga reading experience, there are a few points to keep in mind:\r\n\r\n- **Quality of Text Recognition**: The accuracy of text detection can vary based on the quality of the manga images. High-resolution images tend to yield better results.\r\n- **Cultural Nuances**: Flipping the images can sometimes disrupt the original artistic intent or the flow of the story. Certain visual elements intended to be on one side of the page might not translate well when mirrored.\r\n- **Performance**: Processing multiple or high-resolution manga pages can be computationally intensive, especially if you don't use a GPU.\r\n- **Specific Glitches**: If the text overlays significant visual elements (like a \"BOOOM\" in the middle of a character drawing), the part of the image underneath the text will be flipped, which could result in a glitched visual. This is due to the script flipping the entire page except for the text areas.\r\n\r\n![glitched manga page](../../uploads/blog/2024/05/glitched-manga-page.png)\r\n\r\n## Conclusion\r\nWe've bridged the gap between East and West with a few lines of Python, transforming right-to-left manga into left-to-right page-turners. Now, you can enjoy \"Dragon Ball Super\" without feeling like you're reading a book in a mirror.\r\n","frontmatter":{"tags":["python","manga","image processing","easyocr","PIL","comic","transformation"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2024-05-01T00:00:00.000Z","id":null,"path":"transforming-manga-pages-for-lazy-western-readers","show":true,"title":"Transforming manga pages for lazy western readers","hideExcerpt":false,"subtitle":"When being lazy is the only option"}}},{"node":{"excerpt":"Após criar um script Node.js para postar automaticamente…","html":"<p>Após criar um script Node.js para <a href=\"/pt-br/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/\">postar automaticamente Reels no Instagram</a> e outro para <a href=\"/pt-br/blog/coding/como-criar-thumbnails-para-seus-videos-automaticamente-com-nodejs/\">gerar automaticamente miniaturas para Reels no Instagram</a>, o que vem a seguir? Gerar automaticamente o conteúdo do vídeo, claro!</p>\n<p>Neste post, vou mostrar como usar o GPT-3.5 da OpenAI para gerar o conteúdo de um vídeo tutorial de programação. Vou usar o mesmo script Node.js que usei nos posts anteriores, além de um <code class=\"language-text\">create-react-app</code> que será usado para digitar o código do tutorial gerado.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADKElEQVQozwXBWUzTBwDA4T+DcTnAEKAUWqUDWi5rAaFgBbMqZ01bYAhylk5aOZxU1kKhwEBhKIhYFDBgZIBAq5I5QAScWyRbsiW7spctZG9L9uLDkmXJnvbb9wlRUg1yWTpnM3OxX+7gxfYcvxy8xLt0n5qCCyi1TRwpNnG0uhVphZUjla2IKqxElF0iUn+JaIMFsd5CUEox/qIchFiZlix5Nm3nythxD/L3gRf++5G/DnZxj6+i7VsnzrGGpGsVyexLRJ4fiNv4lXj7BKHv1RKibye0yk6wugr/2HwEkUyLIimbkpJyrg1e5+fvHvHmjx02th/TbhtA23iFQ6dbEDm8FP0Dx/+FuDcQ2zvLO7UODrseIH/4JWEV3fjF5COEywqRHTtNhs5EUccI888esPX9Fs2L65yq/xCxsYfUvmWy7j4j+dE+0Ss/IXvxG0enPCTOrJKz8ZrEtdeEVfbiKz2LECY3ID6hJ73OTp5zEuvdSQY+W6Hy08/JsjpJndxB3uUhvcSCkFTDsYZ7qKdf8e7aLineTdS736Dc3Ceq8RqCzIgQmFqNuKiFAtcw6v5bGO7MYb4ziXFqCcnt31E+/xPZ4rdIbA8JufqU8Cvr5I1tUrj8hLTlFRSLXtK924ibbyIoGhCEjDbiG7spuH4LVb8b2+MVdENuDB+PYVjYI9bUR8r0GrnrX5C79QqV52skM/uY51fRjI4jd1zl5JCLGPM4gsqGEJDRQHjpZTRj81i8HipnF4g03eCMzUW1s5MAZT7Fjh4uToxiGujAPPIRF929WEd7aOw2k1RVTnzNeSKrBxHU/QiBqgZ8dG5iHEsoemeIsN4ktGkYqbGdpGYXhzM1pL1vIt95D/86D4JugZP229RP9JGgKySksJwIQwVB+j6EU8MIvqpWgnVu/BLOEJGsISL3HGH1nYiNzeS02Ui0ucg0WZDqaznR1ImvsoK0Fgel07NElpbhc95EQJ0ZP50TIbMHwVdxAf8sC28n5BF0XEuw/gMktiGSu8ZQLT4n/pNpsm9MIfPuod37iui5ZaJGp4gdneOQsQn/FieBI/d5q2wQH3kr/wMcxNdOxLj/fAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AI trabalhando\"\n        title=\"AI trabalhando\"\n        src=\"/static/cdcc77b7fb8d6bdf43386ce698ba2c79/42a19/auto-generating-tutorials.png\"\n        srcset=\"/static/cdcc77b7fb8d6bdf43386ce698ba2c79/e3135/auto-generating-tutorials.png 256w,\n/static/cdcc77b7fb8d6bdf43386ce698ba2c79/06341/auto-generating-tutorials.png 512w,\n/static/cdcc77b7fb8d6bdf43386ce698ba2c79/42a19/auto-generating-tutorials.png 1024w,\n/static/cdcc77b7fb8d6bdf43386ce698ba2c79/e8464/auto-generating-tutorials.png 1536w,\n/static/cdcc77b7fb8d6bdf43386ce698ba2c79/445c6/auto-generating-tutorials.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">AI trabalhando</figcaption>\n  </figure></p>\n<h2 id=\"engenharia-de-prompts\" style=\"position:relative;\"><a href=\"#engenharia-de-prompts\" aria-label=\"engenharia de prompts permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Engenharia de prompts</h2>\n<p>A primeira pergunta que tive que me fazer foi: como posso pedir ao GPT-3.5 para gerar um tutorial de programação? Quero dizer, não posso simplesmente pedir para ele gerar um tutorial de programação, certo? Preciso dar um contexto, alguma informação, algo com que ele possa trabalhar.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVQoz4WSaY6cMBCF+xg9wwyLjfcFGwxmb6DpZZLc/zwJTdKKlIxGerL8431Vr8o+DNN5udz7cZmW63r7hoiAmBGuEZVhgo5B9Pqe/KtjEAHEDnU3jtPaDXPTncZ5VaYo665q+rxsirIJE/TyFn8KA8Qo1ynhEHMqNEgpFRlmCmKOqAxCcAyip17fkyAEQQhe3uINJlzlZZ3llTJO29I6L3Se5ZXznSkq59u8bKzzvh1M4bmyEG9tkpQyaQ6Yyp0UympbKuMI1zsvs0IZpx7nw1MgKiOAY0hCgDeYSWNdra1j0mR5tZUwrqp7ZQrrvPOtzAqu7N7A+c75zjqvjKMiOwht5/V2uf9wVdsO83S+LZf7OF/60+Kqdlquw7TW3bjevp+vH0132uI8ym2dk5QhqriyKREpEUwaJu2eHFGJmaIioyLjygqdE6ZiSJKURntsKrKq6bV1Zd0X1RYySWmS0t30vO9KUgoQA4jFkGwwxHz/EoTr/YX+Nn2m37DQth2mP5uou3Eb27o6huRrGCCGmcJUIiIQEeQxJCLimfm/iiH5te2fhep7nFSF4lsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"O futuro está aqui\"\n        title=\"O futuro está aqui\"\n        src=\"/static/f74dd4bc90e600f64b196b06fb41b1db/42a19/programming-2050.png\"\n        srcset=\"/static/f74dd4bc90e600f64b196b06fb41b1db/e3135/programming-2050.png 256w,\n/static/f74dd4bc90e600f64b196b06fb41b1db/06341/programming-2050.png 512w,\n/static/f74dd4bc90e600f64b196b06fb41b1db/42a19/programming-2050.png 1024w,\n/static/f74dd4bc90e600f64b196b06fb41b1db/69083/programming-2050.png 1158w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">O futuro está aqui</figcaption>\n  </figure></p>\n<p>Nesta nova era de trabalhar com modelos de linguagem, é estranho que, se você quer que o modelo faça algo, você só precisa pedir. Então, comecei criando uma lista de coisas que eu queria que estivessem no vídeo, como:</p>\n<ul>\n<li>Um título</li>\n<li>Uma descrição</li>\n<li>O próprio código</li>\n<li>Uma lista de ideias que já usei antes</li>\n<li>Uma lista de coisas a evitar</li>\n</ul>\n<p>E então comecei a pensar em como eu poderia usar essa informação para pedir ao GPT-3.5 para gerar um tutorial de programação. Cheguei ao seguinte prompt:</p>\n<blockquote>\n<p>Respire fundo, relaxe e pense analiticamente sobre o problema que está tentando resolver.\r\nTenho um arquivo JSON para um script de um tutorial de programação em vídeo para Reels no Instagram, que se parece com isto:\r\n&#x3C;EXEMPLO_JSON_AQUI>\r\nPor favor, use este modelo para gerar um novo script para um tutorial de programação em vídeo para Reels no Instagram.\r\nEvite usar as seguintes ideias:\r\n&#x3C;IDEIAS_UTILIZADAS>\r\nE evite os seguintes tópicos:\r\n&#x3C;TÓPICOS_A_EVITAR>\r\nCertifique-se de responder apenas com um arquivo JSON com a mesma estrutura do que eu te dei e nada mais.</p>\n</blockquote>\n<p>Após elaborar este prompt, testei-o algumas vezes no ChatGPT, e parecia bom, mas como esperado, às vezes a saída não era um formato JSON válido, e foi então que aprendi sobre <a href=\"https://openai.com/blog/function-calling-and-other-api-updates\" target=\"_blank\" rel=\"noreferrer\">chamadas de função</a>.</p>\n<h2 id=\"function-calling\" style=\"position:relative;\"><a href=\"#function-calling\" aria-label=\"function calling permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Function calling</h2>\n<p>Chamadas de função são uma nova funcionalidade da API da OpenAI que permite chamar uma função a partir do prompt, e isso ajuda a garantir que a saída do GPT seja o que você espera.</p>\n<p>No meu caso, criei uma função chamada <code class=\"language-text\">generateTutorialViaOpenAi</code> que recebe o arquivo JSON com o script para o vídeo e retorna um novo arquivo JSON com o script para o vídeo.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> OpenAI <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'openai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> openai <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OpenAI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">apiKey</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">OPENAI_API_KEY</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateTutorialViaOpenAi</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">prompt</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> schema <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'object'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'commands'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'files'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'description'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">properties</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'A nice and catchy description for the tutorial.'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">commands</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'A string with the code and commands to use for the tutorial. It must not be empty.'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'array'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'The list of files that are going to be used in the tutorial. One of them MUST be index.html'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">items</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'object'</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'A file that is going to be used in the tutorial'</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">properties</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n              <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'The name of the file'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n              <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'The content of the file. Should be empty for the file that is going to be typed from the script.'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> reelsCommands <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> openai<span class=\"token punctuation\">.</span>chat<span class=\"token punctuation\">.</span>completions<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">model</span><span class=\"token operator\">:</span> <span class=\"token string\">'gpt-3.5-turbo'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">messages</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n      <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">role</span><span class=\"token operator\">:</span> <span class=\"token string\">'system'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token string\">'You are a helpful programming professor.'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">role</span><span class=\"token operator\">:</span> <span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> prompt <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">functions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'generate_tutorial'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">parameters</span><span class=\"token operator\">:</span> schema <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">function_call</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'generate_tutorial'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> reelsCommands<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Como você pode ver, o objeto <code class=\"language-text\">schema</code> é a chave aqui, garantindo que a saída do GPT seja o que eu espero.</p>\n<h2 id=\"gerando-o-video\" style=\"position:relative;\"><a href=\"#gerando-o-video\" aria-label=\"gerando o video permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gerando o vídeo</h2>\n<p>Agora que tenho um arquivo JSON gerado sob demanda pela OpenAI, preciso de alguma forma convertê-lo em um vídeo, e é aqui que o script Puppeteer.js entra em cena.</p>\n<p>Não vou entrar em muitos detalhes aqui porque esta é, na verdade, a parte mais complexa, e merece seu próprio post um dia, mas em resumo, estou usando Puppeteer.js para abrir um navegador Chrome sem cabeçalho, carregar um aplicativo React, e usando <a href=\"https://www.npmjs.com/package/react-ace\" target=\"_blank\" rel=\"noreferrer\">react-ace</a> para o destaque de código, então com Puppeteer.js estou digitando o código e tirando uma captura de tela da página e salvando-a como um arquivo PNG usando o <a href=\"https://chromedevtools.github.io/devtools-protocol/tot/Page/#event-screencastFrame\" target=\"_blank\" rel=\"noreferrer\">‘Page.screencastFrame’</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> allFrames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">pages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">target</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createCDPSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nclient<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Page.screencastFrame'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> sessionId <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Page.screencastFrameAck'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> sessionId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  allFrames<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Depois disso, estou usando <a href=\"https://ffmpeg.org/\" target=\"_blank\" rel=\"noreferrer\">ffmpeg</a> para converter os arquivos PNG em um vídeo.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ffmpeg <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fluent-ffmpeg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> ffmpegPath <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ffmpeg-static'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> ffprobe <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ffprobe-static'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\nffmpeg<span class=\"token punctuation\">.</span><span class=\"token function\">setFfmpegPath</span><span class=\"token punctuation\">(</span>ffmpegPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nffmpeg<span class=\"token punctuation\">.</span><span class=\"token function\">setFfprobePath</span><span class=\"token punctuation\">(</span>ffprobe<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createVideoFromFrames</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">fps<span class=\"token punctuation\">,</span>\r\n  frames<span class=\"token punctuation\">,</span>\r\n  outputPath</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> tempOutput <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.temp</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">ffmpeg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">input</span><span class=\"token punctuation\">(</span>frames<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">inputFPS</span><span class=\"token punctuation\">(</span>fps<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">toFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mp4'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">videoCodec</span><span class=\"token punctuation\">(</span><span class=\"token string\">'libx264'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">videoBitrate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'5000k'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addOption</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-crf'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'23'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addOption</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-g'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addOption</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-profile:v'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'high'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addOption</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-level'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'4.0'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> resolve<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>tempOutput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">ffmpeg</span><span class=\"token punctuation\">(</span>tempOutput<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">fps</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FPS</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> resolve<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span>outputPath<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"juntando-tudo\" style=\"position:relative;\"><a href=\"#juntando-tudo\" aria-label=\"juntando tudo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Juntando tudo</h2>\n<p>Agora que tenho todas as peças, só preciso uni-las. Criei um novo script Node.js que irá:</p>\n<ul>\n<li>Gerar um novo arquivo JSON com o script para o vídeo</li>\n<li>Gerar um novo vídeo com o script para o vídeo</li>\n<li>Gerar uma nova miniatura para o vídeo</li>\n<li>Postar o vídeo no Instagram Reels</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> generateTutorialViaOpenAi <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./generate-tutorial-via-openai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> generateImageForPost <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./generate-image-for-post'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> generateVideoForPost <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./generate-video-for-post'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> postVideoToInstagramReels <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./post-video-to-instagram-reels'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> prompt <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./prompt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateTutorial</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> reelsCommands <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">generateTutorialViaOpenAi</span><span class=\"token punctuation\">(</span>prompt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> description<span class=\"token punctuation\">,</span> commands<span class=\"token punctuation\">,</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> reelsCommands<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>choices<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> outputPath <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./output/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> thumbnailPath <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/thumbnail.png</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> videoPath <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/video.mp4</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">generateImageForPost</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'./assets/background.png'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'./assets/foreground.png'</span><span class=\"token punctuation\">,</span>\r\n    description<span class=\"token punctuation\">,</span>\r\n    thumbnailPath\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">generateVideoForPost</span><span class=\"token punctuation\">(</span>commands<span class=\"token punctuation\">,</span> files<span class=\"token punctuation\">,</span> videoPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">postVideoToInstagramReels</span><span class=\"token punctuation\">(</span>description<span class=\"token punctuation\">,</span> videoPath<span class=\"token punctuation\">,</span> thumbnailPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token function\">generateTutorial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>O código real que estou usando é um pouco mais complexo, mas essa é a ideia geral.</p>\n<h2 id=\"prova-de-conceito\" style=\"position:relative;\"><a href=\"#prova-de-conceito\" aria-label=\"prova de conceito permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prova de conceito</h2>\n<p>Claro que depois de fazer todo esse trabalho, eu tinha que testá-lo, então criei uma <a href=\"https://www.instagram.com/anchorarray/\" target=\"_blank\" rel=\"noreferrer\">nova conta no Instagram</a> que postará um novo tutorial todos os dias, e sempre evitará ideias e tópicos existentes, bem, pelo menos em teoria…</p>\n<p><div class=\"instagram-embed\"><iframe src=\"https://instagram.com/p/C1OpOUzsfwd/embed\" frameborder=\"0\" allowfullscreen scrolling=\"no\" allowtransparency width=\"400\" height=\"400\"></iframe></div></p>\n<p>… mas a realidade acabou sendo que os tutoriais gerados não são tão bons, e não tenho certeza se é devido ao prompt que estou usando, ou devido ao próprio modelo, mas tenho certeza que é uma combinação de ambos. Por alguma razão, ele continua gerando os mesmos tutoriais, sempre relacionados a colorir coisas usando CSS.</p>\n<p>Estive executando esta conta por 3 meses agora, e ela obteve apenas 38 seguidores até hoje e alcançou 466 contas nos últimos 30 dias, então não tenho certeza se vale a pena continuar com ela, mesmo que seja totalmente automatizada e o custo total até agora foi de apenas U$1.00.</p>\n<p>Acho que a melhor abordagem aqui é uma híbrida, onde gero meus próprios scripts e uso meu código Node.js para gerar o vídeo e postá-lo no Instagram Reels, o que já automatiza muito do trabalho.</p>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Estou realmente animado com esta nova era de trabalho com modelos de linguagem. Tenho certeza de que veremos muitas coisas legais sendo criadas nos próximos anos.</p>\n<p>Mesmo que este projeto não tenha funcionado como esperado, aprendi muito sobre a API da OpenAI e como usá-la, e tenho certeza de que a usarei no futuro.</p>\n<p>Espero que tenham gostado deste post, e não se esqueçam de conferir como <a href=\"/pt-br/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/\">postar automaticamente Reels no Instagram usando Node.js</a> e <a href=\"/pt-br/blog/coding/como-criar-thumbnails-para-seus-videos-automaticamente-com-nodejs/\">como gerar automaticamente miniaturas para seus vídeos com Node.js</a>.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEyLTIwVDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-12-20-como-automatizar-a-criacao-de-instagram-reels-usando-gpt-da-openai.pt-br/","path":"/blog/coding/como-automatizar-a-criacao-de-instagram-reels-usando-gpt-da-openai/","locale":"pt-br"},"rawMarkdownBody":"Após criar um script Node.js para [postar automaticamente Reels no Instagram](/pt-br/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/) e outro para [gerar automaticamente miniaturas para Reels no Instagram](/pt-br/blog/coding/como-criar-thumbnails-para-seus-videos-automaticamente-com-nodejs/), o que vem a seguir? Gerar automaticamente o conteúdo do vídeo, claro!\r\n\r\nNeste post, vou mostrar como usar o GPT-3.5 da OpenAI para gerar o conteúdo de um vídeo tutorial de programação. Vou usar o mesmo script Node.js que usei nos posts anteriores, além de um `create-react-app` que será usado para digitar o código do tutorial gerado.\r\n\r\n![AI trabalhando](../../uploads/blog/2023/12/auto-generating-tutorials.png)\r\n\r\n## Engenharia de prompts\r\nA primeira pergunta que tive que me fazer foi: como posso pedir ao GPT-3.5 para gerar um tutorial de programação? Quero dizer, não posso simplesmente pedir para ele gerar um tutorial de programação, certo? Preciso dar um contexto, alguma informação, algo com que ele possa trabalhar.\r\n\r\n![O futuro está aqui](../../uploads/blog/2023/12/programming-2050.png)\r\n\r\nNesta nova era de trabalhar com modelos de linguagem, é estranho que, se você quer que o modelo faça algo, você só precisa pedir. Então, comecei criando uma lista de coisas que eu queria que estivessem no vídeo, como:\r\n\r\n- Um título\r\n- Uma descrição\r\n- O próprio código\r\n- Uma lista de ideias que já usei antes\r\n- Uma lista de coisas a evitar\r\n\r\nE então comecei a pensar em como eu poderia usar essa informação para pedir ao GPT-3.5 para gerar um tutorial de programação. Cheguei ao seguinte prompt:\r\n\r\n> Respire fundo, relaxe e pense analiticamente sobre o problema que está tentando resolver.\r\n> Tenho um arquivo JSON para um script de um tutorial de programação em vídeo para Reels no Instagram, que se parece com isto:\r\n> <EXEMPLO_JSON_AQUI>\r\n> Por favor, use este modelo para gerar um novo script para um tutorial de programação em vídeo para Reels no Instagram.\r\n> Evite usar as seguintes ideias:\r\n> <IDEIAS_UTILIZADAS>\r\n> E evite os seguintes tópicos:\r\n> <TÓPICOS_A_EVITAR>\r\n> Certifique-se de responder apenas com um arquivo JSON com a mesma estrutura do que eu te dei e nada mais.\r\n\r\nApós elaborar este prompt, testei-o algumas vezes no ChatGPT, e parecia bom, mas como esperado, às vezes a saída não era um formato JSON válido, e foi então que aprendi sobre [chamadas de função](https://openai.com/blog/function-calling-and-other-api-updates).\r\n\r\n## Function calling\r\nChamadas de função são uma nova funcionalidade da API da OpenAI que permite chamar uma função a partir do prompt, e isso ajuda a garantir que a saída do GPT seja o que você espera.\r\n\r\nNo meu caso, criei uma função chamada `generateTutorialViaOpenAi` que recebe o arquivo JSON com o script para o vídeo e retorna um novo arquivo JSON com o script para o vídeo.\r\n\r\n```javascript\r\nconst OpenAI = require('openai');\r\n\r\nconst openai = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\nconst generateTutorialViaOpenAi = async (prompt) => {\r\n  const schema = {\r\n    type: 'object',\r\n    required: ['commands', 'files', 'description'],\r\n    properties: {\r\n      description: {\r\n        type: 'string',\r\n        description: 'A nice and catchy description for the tutorial.',\r\n      },\r\n      commands: {\r\n        type: 'string',\r\n        description: 'A string with the code and commands to use for the tutorial. It must not be empty.',\r\n      },\r\n      files: {\r\n        type: 'array',\r\n        description: 'The list of files that are going to be used in the tutorial. One of them MUST be index.html',\r\n        items: {\r\n          type: 'object',\r\n          description: 'A file that is going to be used in the tutorial',\r\n          required: ['name', 'content'],\r\n          properties: {\r\n            name: {\r\n              type: 'string',\r\n              description: 'The name of the file',\r\n            },\r\n            content: {\r\n              type: 'string',\r\n              description: 'The content of the file. Should be empty for the file that is going to be typed from the script.',\r\n            },\r\n          },\r\n        },\r\n      },\r\n    },\r\n  };\r\n\r\n  const reelsCommands = await openai.chat.completions.create({\r\n    model: 'gpt-3.5-turbo',\r\n    messages: [\r\n      { role: 'system', content: 'You are a helpful programming professor.' },\r\n      { role: 'user', content: prompt },\r\n    ],\r\n    functions: [{ name: 'generate_tutorial', parameters: schema }],\r\n    function_call: { name: 'generate_tutorial' },\r\n  });\r\n\r\n  return reelsCommands;\r\n};\r\n```\r\n\r\nComo você pode ver, o objeto `schema` é a chave aqui, garantindo que a saída do GPT seja o que eu espero.\r\n\r\n## Gerando o vídeo\r\nAgora que tenho um arquivo JSON gerado sob demanda pela OpenAI, preciso de alguma forma convertê-lo em um vídeo, e é aqui que o script Puppeteer.js entra em cena.\r\n\r\nNão vou entrar em muitos detalhes aqui porque esta é, na verdade, a parte mais complexa, e merece seu próprio post um dia, mas em resumo, estou usando Puppeteer.js para abrir um navegador Chrome sem cabeçalho, carregar um aplicativo React, e usando [react-ace](https://www.npmjs.com/package/react-ace) para o destaque de código, então com Puppeteer.js estou digitando o código e tirando uma captura de tela da página e salvando-a como um arquivo PNG usando o ['Page.screencastFrame'](https://chromedevtools.github.io/devtools-protocol/tot/Page/#event-screencastFrame).\r\n\r\n```javascript\r\nconst allFrames = [];\r\nconst browser = await puppeteer.launch();\r\nconst [page] = await browser.pages();\r\nconst client = await page.target().createCDPSession();\r\nclient.on('Page.screencastFrame', async ({ data, sessionId }) => {\r\n  await client.send('Page.screencastFrameAck', { sessionId });\r\n  allFrames.push(data);\r\n});\r\n```\r\n\r\nDepois disso, estou usando [ffmpeg](https://ffmpeg.org/) para converter os arquivos PNG em um vídeo.\r\n\r\n```javascript\r\nconst ffmpeg = require('fluent-ffmpeg');\r\nconst ffmpegPath = require('ffmpeg-static');\r\nconst ffprobe = require('ffprobe-static');\r\n\r\nffmpeg.setFfmpegPath(ffmpegPath);\r\nffmpeg.setFfprobePath(ffprobe.path);\r\n\r\nconst createVideoFromFrames = async (\r\n  fps,\r\n  frames,\r\n  outputPath\r\n) => {\r\n  const tempOutput = `${outputPath}.temp`;\r\n  await new Promise((resolve, reject) => {\r\n    ffmpeg()\r\n      .input(frames)\r\n      .inputFPS(fps)\r\n      .toFormat('mp4')\r\n      .videoCodec('libx264')\r\n      .videoBitrate('5000k')\r\n      .addOption('-crf', '23')\r\n      .addOption('-g', '30')\r\n      .addOption('-profile:v', 'high')\r\n      .addOption('-level', '4.0')\r\n      .on('end', resolve)\r\n      .on('error', reject)\r\n      .save(tempOutput);\r\n  });\r\n\r\n  await new Promise((resolve, reject) => {\r\n    ffmpeg(tempOutput)\r\n      .fps(FPS)\r\n      .on('end', resolve)\r\n      .on('error', reject)\r\n      .output(outputPath)\r\n      .run();\r\n  });\r\n};\r\n```\r\n\r\n## Juntando tudo\r\nAgora que tenho todas as peças, só preciso uni-las. Criei um novo script Node.js que irá:\r\n\r\n- Gerar um novo arquivo JSON com o script para o vídeo\r\n- Gerar um novo vídeo com o script para o vídeo\r\n- Gerar uma nova miniatura para o vídeo\r\n- Postar o vídeo no Instagram Reels\r\n\r\n```javascript\r\nconst generateTutorialViaOpenAi = require('./generate-tutorial-via-openai');\r\nconst generateImageForPost = require('./generate-image-for-post');\r\nconst generateVideoForPost = require('./generate-video-for-post');\r\nconst postVideoToInstagramReels = require('./post-video-to-instagram-reels');\r\nconst prompt = require('./prompt');\r\n\r\nconst generateTutorial = async () => {\r\n  const reelsCommands = await generateTutorialViaOpenAi(prompt);\r\n  const { description, commands, files } = reelsCommands.data.choices[0].value;\r\n\r\n  const outputPath = `./output/${Date.now()}`;\r\n  const thumbnailPath = `${outputPath}/thumbnail.png`;\r\n  const videoPath = `${outputPath}/video.mp4`;\r\n\r\n  await generateImageForPost(\r\n    './assets/background.png',\r\n    './assets/foreground.png',\r\n    description,\r\n    thumbnailPath\r\n  );\r\n\r\n  await generateVideoForPost(commands, files, videoPath);\r\n\r\n  await postVideoToInstagramReels(description, videoPath, thumbnailPath);\r\n};\r\n\r\ngenerateTutorial();\r\n```\r\n\r\nO código real que estou usando é um pouco mais complexo, mas essa é a ideia geral.\r\n\r\n## Prova de conceito\r\nClaro que depois de fazer todo esse trabalho, eu tinha que testá-lo, então criei uma [nova conta no Instagram](https://www.instagram.com/anchorarray/) que postará um novo tutorial todos os dias, e sempre evitará ideias e tópicos existentes, bem, pelo menos em teoria...\r\n\r\n![instagram](C1OpOUzsfwd)\r\n\r\n... mas a realidade acabou sendo que os tutoriais gerados não são tão bons, e não tenho certeza se é devido ao prompt que estou usando, ou devido ao próprio modelo, mas tenho certeza que é uma combinação de ambos. Por alguma razão, ele continua gerando os mesmos tutoriais, sempre relacionados a colorir coisas usando CSS.\r\n\r\nEstive executando esta conta por 3 meses agora, e ela obteve apenas 38 seguidores até hoje e alcançou 466 contas nos últimos 30 dias, então não tenho certeza se vale a pena continuar com ela, mesmo que seja totalmente automatizada e o custo total até agora foi de apenas U$1.00.\r\n\r\nAcho que a melhor abordagem aqui é uma híbrida, onde gero meus próprios scripts e uso meu código Node.js para gerar o vídeo e postá-lo no Instagram Reels, o que já automatiza muito do trabalho.\r\n\r\n## Conclusão\r\nEstou realmente animado com esta nova era de trabalho com modelos de linguagem. Tenho certeza de que veremos muitas coisas legais sendo criadas nos próximos anos.\r\n\r\nMesmo que este projeto não tenha funcionado como esperado, aprendi muito sobre a API da OpenAI e como usá-la, e tenho certeza de que a usarei no futuro.\r\n\r\nEspero que tenham gostado deste post, e não se esqueçam de conferir como [postar automaticamente Reels no Instagram usando Node.js](/pt-br/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/) e [como gerar automaticamente miniaturas para seus vídeos com Node.js](/pt-br/blog/coding/como-criar-thumbnails-para-seus-videos-automaticamente-com-nodejs/).\r\n","frontmatter":{"tags":["openai","gpt","javascript","node","nodejs","instagram"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-12-20T00:00:00.000Z","id":null,"path":"como-automatizar-a-criacao-de-instagram-reels-usando-gpt-da-openai","show":true,"title":"Como automatizar a criação de Instagram Reels usando GPT da OpenAI","hideExcerpt":false,"subtitle":""}}},{"node":{"excerpt":"After creating a Node.js script to automatically post…","html":"<p>After creating a Node.js script to <a href=\"/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/\">automatically post Instagram Reels</a> and one to <a href=\"/en/blog/coding/how-to-automatically-create-thumbnails-for-your-videos-with-nodejs/\">automatically generate thumbnails for a Instagram Reels</a>, what comes next? Automatically generating the content of the video, of course!</p>\n<p>In this post I’ll show you how to use OpenAI’s GPT-3.5 to generate the content of a coding tutorial video. I’ll use the same Node.js script I used in the previous posts, plus a <code class=\"language-text\">create-react-app</code> that will be used to type in the code from the generated tutorial.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADKElEQVQozwXBWUzTBwDA4T+DcTnAEKAUWqUDWi5rAaFgBbMqZ01bYAhylk5aOZxU1kKhwEBhKIhYFDBgZIBAq5I5QAScWyRbsiW7spctZG9L9uLDkmXJnvbb9wlRUg1yWTpnM3OxX+7gxfYcvxy8xLt0n5qCCyi1TRwpNnG0uhVphZUjla2IKqxElF0iUn+JaIMFsd5CUEox/qIchFiZlix5Nm3nythxD/L3gRf++5G/DnZxj6+i7VsnzrGGpGsVyexLRJ4fiNv4lXj7BKHv1RKibye0yk6wugr/2HwEkUyLIimbkpJyrg1e5+fvHvHmjx02th/TbhtA23iFQ6dbEDm8FP0Dx/+FuDcQ2zvLO7UODrseIH/4JWEV3fjF5COEywqRHTtNhs5EUccI888esPX9Fs2L65yq/xCxsYfUvmWy7j4j+dE+0Ss/IXvxG0enPCTOrJKz8ZrEtdeEVfbiKz2LECY3ID6hJ73OTp5zEuvdSQY+W6Hy08/JsjpJndxB3uUhvcSCkFTDsYZ7qKdf8e7aLineTdS736Dc3Ceq8RqCzIgQmFqNuKiFAtcw6v5bGO7MYb4ziXFqCcnt31E+/xPZ4rdIbA8JufqU8Cvr5I1tUrj8hLTlFRSLXtK924ibbyIoGhCEjDbiG7spuH4LVb8b2+MVdENuDB+PYVjYI9bUR8r0GrnrX5C79QqV52skM/uY51fRjI4jd1zl5JCLGPM4gsqGEJDRQHjpZTRj81i8HipnF4g03eCMzUW1s5MAZT7Fjh4uToxiGujAPPIRF929WEd7aOw2k1RVTnzNeSKrBxHU/QiBqgZ8dG5iHEsoemeIsN4ktGkYqbGdpGYXhzM1pL1vIt95D/86D4JugZP229RP9JGgKySksJwIQwVB+j6EU8MIvqpWgnVu/BLOEJGsISL3HGH1nYiNzeS02Ui0ucg0WZDqaznR1ImvsoK0Fgel07NElpbhc95EQJ0ZP50TIbMHwVdxAf8sC28n5BF0XEuw/gMktiGSu8ZQLT4n/pNpsm9MIfPuod37iui5ZaJGp4gdneOQsQn/FieBI/d5q2wQH3kr/wMcxNdOxLj/fAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AI is taking over\"\n        title=\"AI is taking over\"\n        src=\"/static/cdcc77b7fb8d6bdf43386ce698ba2c79/42a19/auto-generating-tutorials.png\"\n        srcset=\"/static/cdcc77b7fb8d6bdf43386ce698ba2c79/e3135/auto-generating-tutorials.png 256w,\n/static/cdcc77b7fb8d6bdf43386ce698ba2c79/06341/auto-generating-tutorials.png 512w,\n/static/cdcc77b7fb8d6bdf43386ce698ba2c79/42a19/auto-generating-tutorials.png 1024w,\n/static/cdcc77b7fb8d6bdf43386ce698ba2c79/e8464/auto-generating-tutorials.png 1536w,\n/static/cdcc77b7fb8d6bdf43386ce698ba2c79/445c6/auto-generating-tutorials.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">AI is taking over</figcaption>\n  </figure></p>\n<h2 id=\"prompting-engineeering\" style=\"position:relative;\"><a href=\"#prompting-engineeering\" aria-label=\"prompting engineeering permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prompting engineeering</h2>\n<p>The first question I had to ask myself was: how can I prompt GPT-3.5 to generate a coding tutorial? I mean, I can’t just ask it to generate a coding tutorial, right? I need to give it some context, some information, something to work with.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVQoz4WSaY6cMBCF+xg9wwyLjfcFGwxmb6DpZZLc/zwJTdKKlIxGerL8431Vr8o+DNN5udz7cZmW63r7hoiAmBGuEZVhgo5B9Pqe/KtjEAHEDnU3jtPaDXPTncZ5VaYo665q+rxsirIJE/TyFn8KA8Qo1ynhEHMqNEgpFRlmCmKOqAxCcAyip17fkyAEQQhe3uINJlzlZZ3llTJO29I6L3Se5ZXznSkq59u8bKzzvh1M4bmyEG9tkpQyaQ6Yyp0UympbKuMI1zsvs0IZpx7nw1MgKiOAY0hCgDeYSWNdra1j0mR5tZUwrqp7ZQrrvPOtzAqu7N7A+c75zjqvjKMiOwht5/V2uf9wVdsO83S+LZf7OF/60+Kqdlquw7TW3bjevp+vH0132uI8ym2dk5QhqriyKREpEUwaJu2eHFGJmaIioyLjygqdE6ZiSJKURntsKrKq6bV1Zd0X1RYySWmS0t30vO9KUgoQA4jFkGwwxHz/EoTr/YX+Nn2m37DQth2mP5uou3Eb27o6huRrGCCGmcJUIiIQEeQxJCLimfm/iiH5te2fhep7nFSF4lsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Future is here\"\n        title=\"Future is here\"\n        src=\"/static/f74dd4bc90e600f64b196b06fb41b1db/42a19/programming-2050.png\"\n        srcset=\"/static/f74dd4bc90e600f64b196b06fb41b1db/e3135/programming-2050.png 256w,\n/static/f74dd4bc90e600f64b196b06fb41b1db/06341/programming-2050.png 512w,\n/static/f74dd4bc90e600f64b196b06fb41b1db/42a19/programming-2050.png 1024w,\n/static/f74dd4bc90e600f64b196b06fb41b1db/69083/programming-2050.png 1158w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Future is here</figcaption>\n  </figure></p>\n<p>In this new era of working with language models, it’s weird that if you want the model to do someting, you just have to ask for it. So, I started by creating a list of things I wanted to be in the video, like:</p>\n<ul>\n<li>A title</li>\n<li>A description</li>\n<li>The code itself</li>\n<li>A list of ideas I’ve used before</li>\n<li>A list of things to avoid</li>\n</ul>\n<p>And then I started to think about how I could use this information to prompt GPT-3.5 to generate a coding tutorial. I came up with the following prompt:</p>\n<blockquote>\n<p>Take a deep breath, relax, and think analytically about the problem you’re trying to solve.\r\nI have a JSON file for a script for a video coding tutorial for Instagram Reels, which looks like this:\r\n&#x3C;JSON_EXAMPLE_HERE>\r\nPlease use this template to generate a new script for a video coding tutorial for Instagram Reels.\r\nAvoid using the following ideas:\r\n&#x3C;USED_IDEAS>\r\nAnd avoid the following topics:\r\n&#x3C;AVOID_TOPICS>\r\nMake sure to only answer me with a JSON file with the same structure as the one I gave you and nothing else.</p>\n</blockquote>\n<p>After crafting this prompt, I tested it a few time on the ChatGPT, and it was looking good, but as expected, sometimes the output wasn’t a valid JSON format, and that’s when I’ve learned about <a href=\"https://openai.com/blog/function-calling-and-other-api-updates\" target=\"_blank\" rel=\"noreferrer\">function calling</a>.</p>\n<h2 id=\"function-calling\" style=\"position:relative;\"><a href=\"#function-calling\" aria-label=\"function calling permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Function calling</h2>\n<p>Function calling is a new feature of the OpenAI API that allows you to call a function from the prompt, and it helps it to make sure the output from GPT is what you expect.</p>\n<p>In my case, I created a function called <code class=\"language-text\">generateTutorialViaOpenAi</code> that receives the JSON file with the script for the video and returns a new JSON file with the script for the video.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> OpenAI <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'openai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> openai <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OpenAI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">apiKey</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">OPENAI_API_KEY</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateTutorialViaOpenAi</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">prompt</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> schema <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'object'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'commands'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'files'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'description'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">properties</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'A nice and catchy description for the tutorial.'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">commands</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'A string with the code and commands to use for the tutorial. It must not be empty.'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'array'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'The list of files that are going to be used in the tutorial. One of them MUST be index.html'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">items</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'object'</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'A file that is going to be used in the tutorial'</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">required</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">properties</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n              <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'The name of the file'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n              <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token literal-property property\">description</span><span class=\"token operator\">:</span> <span class=\"token string\">'The content of the file. Should be empty for the file that is going to be typed from the script.'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> reelsCommands <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> openai<span class=\"token punctuation\">.</span>chat<span class=\"token punctuation\">.</span>completions<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">model</span><span class=\"token operator\">:</span> <span class=\"token string\">'gpt-3.5-turbo'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">messages</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n      <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">role</span><span class=\"token operator\">:</span> <span class=\"token string\">'system'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> <span class=\"token string\">'You are a helpful programming professor.'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">role</span><span class=\"token operator\">:</span> <span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> prompt <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">functions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'generate_tutorial'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">parameters</span><span class=\"token operator\">:</span> schema <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">function_call</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'generate_tutorial'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> reelsCommands<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>As you can see, the <code class=\"language-text\">schema</code> object is the key here, making sure the output from GPT is what I expect.</p>\n<h2 id=\"generating-the-video\" style=\"position:relative;\"><a href=\"#generating-the-video\" aria-label=\"generating the video permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Generating the video</h2>\n<p>Now that I have a JSON file generated on demand by OpenAI, I need to somehow convert it into a video, and this is where the Puppeteer.js script comes into play.</p>\n<p>I’m not going to get into too much detail here because this is actually the most complex part, and it deserves its own post one day, but in a nutshell, I’m using Puppeteer.js to open a headless Chrome browser, load a React app, and using <a href=\"https://www.npmjs.com/package/react-ace\" target=\"_blank\" rel=\"noreferrer\">react-ace</a> for the coding highlighting, then with Puppeteer.js I’m typing away the code and taking a screenshot of the page and saving it as a PNG file by using the <a href=\"https://chromedevtools.github.io/devtools-protocol/tot/Page/#event-screencastFrame\" target=\"_blank\" rel=\"noreferrer\">‘Page.screencastFrame’</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> allFrames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">pages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">target</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createCDPSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nclient<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Page.screencastFrame'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> sessionId <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Page.screencastFrameAck'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> sessionId <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  allFrames<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After that, I’m using <a href=\"https://ffmpeg.org/\" target=\"_blank\" rel=\"noreferrer\">ffmpeg</a> to convert the PNG files into a video.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ffmpeg <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fluent-ffmpeg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> ffmpegPath <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ffmpeg-static'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> ffprobe <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ffprobe-static'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\nffmpeg<span class=\"token punctuation\">.</span><span class=\"token function\">setFfmpegPath</span><span class=\"token punctuation\">(</span>ffmpegPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nffmpeg<span class=\"token punctuation\">.</span><span class=\"token function\">setFfprobePath</span><span class=\"token punctuation\">(</span>ffprobe<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createVideoFromFrames</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">fps<span class=\"token punctuation\">,</span>\r\n  frames<span class=\"token punctuation\">,</span>\r\n  outputPath</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> tempOutput <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.temp</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">ffmpeg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">input</span><span class=\"token punctuation\">(</span>frames<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">inputFPS</span><span class=\"token punctuation\">(</span>fps<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">toFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mp4'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">videoCodec</span><span class=\"token punctuation\">(</span><span class=\"token string\">'libx264'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">videoBitrate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'5000k'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addOption</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-crf'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'23'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addOption</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-g'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'30'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addOption</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-profile:v'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'high'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">addOption</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-level'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'4.0'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> resolve<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>tempOutput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">ffmpeg</span><span class=\"token punctuation\">(</span>tempOutput<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">fps</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FPS</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> resolve<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span>outputPath<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"putting-it-all-together\" style=\"position:relative;\"><a href=\"#putting-it-all-together\" aria-label=\"putting it all together permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Putting it all together</h2>\n<p>Now that I have all the pieces, I just need to put them together. I created a new Node.js script that will:</p>\n<ul>\n<li>Generate a new JSON file with the script for the video</li>\n<li>Generate a new video with the script for the video</li>\n<li>Generate a new thumbnail for the video</li>\n<li>Post the video to Instagram Reels</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> generateTutorialViaOpenAi <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./generate-tutorial-via-openai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> generateImageForPost <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./generate-image-for-post'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> generateVideoForPost <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./generate-video-for-post'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> postVideoToInstagramReels <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./post-video-to-instagram-reels'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> prompt <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./prompt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateTutorial</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> reelsCommands <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">generateTutorialViaOpenAi</span><span class=\"token punctuation\">(</span>prompt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> description<span class=\"token punctuation\">,</span> commands<span class=\"token punctuation\">,</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> reelsCommands<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>choices<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> outputPath <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./output/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> thumbnailPath <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/thumbnail.png</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> videoPath <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/video.mp4</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">generateImageForPost</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'./assets/background.png'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'./assets/foreground.png'</span><span class=\"token punctuation\">,</span>\r\n    description<span class=\"token punctuation\">,</span>\r\n    thumbnailPath\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">generateVideoForPost</span><span class=\"token punctuation\">(</span>commands<span class=\"token punctuation\">,</span> files<span class=\"token punctuation\">,</span> videoPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">postVideoToInstagramReels</span><span class=\"token punctuation\">(</span>description<span class=\"token punctuation\">,</span> videoPath<span class=\"token punctuation\">,</span> thumbnailPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token function\">generateTutorial</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The actual code I’m using is a little bit more complex, but this is the gist of it.</p>\n<h2 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of concept</h2>\n<p>Of course after doing all this work I had to test it, so I created a <a href=\"https://www.instagram.com/anchorarray/\" target=\"_blank\" rel=\"noreferrer\">new Instagram account</a> that will post a new tutorial every day, and always avoid existing ideas and topics, well, at least in theory…</p>\n<p><div class=\"instagram-embed\"><iframe src=\"https://instagram.com/p/C1OpOUzsfwd/embed\" frameborder=\"0\" allowfullscreen scrolling=\"no\" allowtransparency width=\"400\" height=\"400\"></iframe></div></p>\n<p>… but the reality ended up being that the generated tutorials are not that good, and I’m not sure if it’s because of the prompt I’m using, or because of the model itself, but I’m sure it’s a combination of both. For some reason it keeps generating the same tutorials, always related to coloring things using CSS.</p>\n<p>I have been running this account for 3 months now, and it got only 38 followers as of today and 466 accounts reached in the past 30 days, so I’m not sure if it’s worth it to keep it running, even though it’s fully automated and the total cost so far was only U$1.00.</p>\n<p>I think the best approach here is a hybrid one, where I generate my own scripts and use my Node.js code to generate the video and post it to Instagram Reels, which already automates a lot of the work.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>I’m really excited about this new era of working with language models. I’m sure we’ll see a lot of cool stuff being created in the next few years.</p>\n<p>Even though this project didn’t work as expected, I learned a lot about OpenAI’s API and how to use it, and I’m sure I’ll be using it in the future.</p>\n<p>I hope you enjoyed this post, and don’t forget to check how to <a href=\"/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/\">automatically post Instagram Reels using Node.js</a> and <a href=\"/en/blog/coding/how-to-automatically-create-thumbnails-for-your-videos-with-nodejs/\">how to automatically generate thumbnails for your videos with Node.js</a>.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEyLTIwVDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-12-20-creating-instagram-reels-coding-tutorials-automatically-with-openais-gpt.en/","path":"/blog/coding/creating-instagram-reels-coding-tutorials-automatically-with-openais-gpt/","locale":"en"},"rawMarkdownBody":"After creating a Node.js script to [automatically post Instagram Reels](/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/) and one to [automatically generate thumbnails for a Instagram Reels](/en/blog/coding/how-to-automatically-create-thumbnails-for-your-videos-with-nodejs/), what comes next? Automatically generating the content of the video, of course!\r\n\r\nIn this post I'll show you how to use OpenAI's GPT-3.5 to generate the content of a coding tutorial video. I'll use the same Node.js script I used in the previous posts, plus a `create-react-app` that will be used to type in the code from the generated tutorial.\r\n\r\n![AI is taking over](../../uploads/blog/2023/12/auto-generating-tutorials.png)\r\n\r\n## Prompting engineeering\r\nThe first question I had to ask myself was: how can I prompt GPT-3.5 to generate a coding tutorial? I mean, I can't just ask it to generate a coding tutorial, right? I need to give it some context, some information, something to work with.\r\n\r\n![Future is here](../../uploads/blog/2023/12/programming-2050.png)\r\n\r\nIn this new era of working with language models, it's weird that if you want the model to do someting, you just have to ask for it. So, I started by creating a list of things I wanted to be in the video, like:\r\n\r\n- A title\r\n- A description\r\n- The code itself\r\n- A list of ideas I've used before\r\n- A list of things to avoid\r\n\r\nAnd then I started to think about how I could use this information to prompt GPT-3.5 to generate a coding tutorial. I came up with the following prompt:\r\n\r\n> Take a deep breath, relax, and think analytically about the problem you're trying to solve.\r\n> I have a JSON file for a script for a video coding tutorial for Instagram Reels, which looks like this:\r\n> <JSON_EXAMPLE_HERE>\r\n> Please use this template to generate a new script for a video coding tutorial for Instagram Reels.\r\n> Avoid using the following ideas:\r\n> <USED_IDEAS>\r\n> And avoid the following topics:\r\n> <AVOID_TOPICS>\r\n> Make sure to only answer me with a JSON file with the same structure as the one I gave you and nothing else.\r\n\r\nAfter crafting this prompt, I tested it a few time on the ChatGPT, and it was looking good, but as expected, sometimes the output wasn't a valid JSON format, and that's when I've learned about [function calling](https://openai.com/blog/function-calling-and-other-api-updates).\r\n\r\n## Function calling\r\nFunction calling is a new feature of the OpenAI API that allows you to call a function from the prompt, and it helps it to make sure the output from GPT is what you expect.\r\n\r\nIn my case, I created a function called `generateTutorialViaOpenAi` that receives the JSON file with the script for the video and returns a new JSON file with the script for the video.\r\n\r\n```javascript\r\nconst OpenAI = require('openai');\r\n\r\nconst openai = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY,\r\n});\r\n\r\nconst generateTutorialViaOpenAi = async (prompt) => {\r\n  const schema = {\r\n    type: 'object',\r\n    required: ['commands', 'files', 'description'],\r\n    properties: {\r\n      description: {\r\n        type: 'string',\r\n        description: 'A nice and catchy description for the tutorial.',\r\n      },\r\n      commands: {\r\n        type: 'string',\r\n        description: 'A string with the code and commands to use for the tutorial. It must not be empty.',\r\n      },\r\n      files: {\r\n        type: 'array',\r\n        description: 'The list of files that are going to be used in the tutorial. One of them MUST be index.html',\r\n        items: {\r\n          type: 'object',\r\n          description: 'A file that is going to be used in the tutorial',\r\n          required: ['name', 'content'],\r\n          properties: {\r\n            name: {\r\n              type: 'string',\r\n              description: 'The name of the file',\r\n            },\r\n            content: {\r\n              type: 'string',\r\n              description: 'The content of the file. Should be empty for the file that is going to be typed from the script.',\r\n            },\r\n          },\r\n        },\r\n      },\r\n    },\r\n  };\r\n\r\n  const reelsCommands = await openai.chat.completions.create({\r\n    model: 'gpt-3.5-turbo',\r\n    messages: [\r\n      { role: 'system', content: 'You are a helpful programming professor.' },\r\n      { role: 'user', content: prompt },\r\n    ],\r\n    functions: [{ name: 'generate_tutorial', parameters: schema }],\r\n    function_call: { name: 'generate_tutorial' },\r\n  });\r\n\r\n  return reelsCommands;\r\n};\r\n```\r\n\r\nAs you can see, the `schema` object is the key here, making sure the output from GPT is what I expect.\r\n\r\n## Generating the video\r\nNow that I have a JSON file generated on demand by OpenAI, I need to somehow convert it into a video, and this is where the Puppeteer.js script comes into play.\r\n\r\nI'm not going to get into too much detail here because this is actually the most complex part, and it deserves its own post one day, but in a nutshell, I'm using Puppeteer.js to open a headless Chrome browser, load a React app, and using [react-ace](https://www.npmjs.com/package/react-ace) for the coding highlighting, then with Puppeteer.js I'm typing away the code and taking a screenshot of the page and saving it as a PNG file by using the ['Page.screencastFrame'](https://chromedevtools.github.io/devtools-protocol/tot/Page/#event-screencastFrame).\r\n\r\n```javascript\r\nconst allFrames = [];\r\nconst browser = await puppeteer.launch();\r\nconst [page] = await browser.pages();\r\nconst client = await page.target().createCDPSession();\r\nclient.on('Page.screencastFrame', async ({ data, sessionId }) => {\r\n  await client.send('Page.screencastFrameAck', { sessionId });\r\n  allFrames.push(data);\r\n});\r\n```\r\n\r\nAfter that, I'm using [ffmpeg](https://ffmpeg.org/) to convert the PNG files into a video.\r\n\r\n```javascript\r\nconst ffmpeg = require('fluent-ffmpeg');\r\nconst ffmpegPath = require('ffmpeg-static');\r\nconst ffprobe = require('ffprobe-static');\r\n\r\nffmpeg.setFfmpegPath(ffmpegPath);\r\nffmpeg.setFfprobePath(ffprobe.path);\r\n\r\nconst createVideoFromFrames = async (\r\n  fps,\r\n  frames,\r\n  outputPath\r\n) => {\r\n  const tempOutput = `${outputPath}.temp`;\r\n  await new Promise((resolve, reject) => {\r\n    ffmpeg()\r\n      .input(frames)\r\n      .inputFPS(fps)\r\n      .toFormat('mp4')\r\n      .videoCodec('libx264')\r\n      .videoBitrate('5000k')\r\n      .addOption('-crf', '23')\r\n      .addOption('-g', '30')\r\n      .addOption('-profile:v', 'high')\r\n      .addOption('-level', '4.0')\r\n      .on('end', resolve)\r\n      .on('error', reject)\r\n      .save(tempOutput);\r\n  });\r\n\r\n  await new Promise((resolve, reject) => {\r\n    ffmpeg(tempOutput)\r\n      .fps(FPS)\r\n      .on('end', resolve)\r\n      .on('error', reject)\r\n      .output(outputPath)\r\n      .run();\r\n  });\r\n};\r\n```\r\n\r\n## Putting it all together\r\nNow that I have all the pieces, I just need to put them together. I created a new Node.js script that will:\r\n\r\n- Generate a new JSON file with the script for the video\r\n- Generate a new video with the script for the video\r\n- Generate a new thumbnail for the video\r\n- Post the video to Instagram Reels\r\n\r\n```javascript\r\nconst generateTutorialViaOpenAi = require('./generate-tutorial-via-openai');\r\nconst generateImageForPost = require('./generate-image-for-post');\r\nconst generateVideoForPost = require('./generate-video-for-post');\r\nconst postVideoToInstagramReels = require('./post-video-to-instagram-reels');\r\nconst prompt = require('./prompt');\r\n\r\nconst generateTutorial = async () => {\r\n  const reelsCommands = await generateTutorialViaOpenAi(prompt);\r\n  const { description, commands, files } = reelsCommands.data.choices[0].value;\r\n\r\n  const outputPath = `./output/${Date.now()}`;\r\n  const thumbnailPath = `${outputPath}/thumbnail.png`;\r\n  const videoPath = `${outputPath}/video.mp4`;\r\n\r\n  await generateImageForPost(\r\n    './assets/background.png',\r\n    './assets/foreground.png',\r\n    description,\r\n    thumbnailPath\r\n  );\r\n\r\n  await generateVideoForPost(commands, files, videoPath);\r\n\r\n  await postVideoToInstagramReels(description, videoPath, thumbnailPath);\r\n};\r\n\r\ngenerateTutorial();\r\n```\r\n\r\nThe actual code I'm using is a little bit more complex, but this is the gist of it.\r\n\r\n## Proof of concept\r\nOf course after doing all this work I had to test it, so I created a [new Instagram account](https://www.instagram.com/anchorarray/) that will post a new tutorial every day, and always avoid existing ideas and topics, well, at least in theory...\r\n\r\n![instagram](C1OpOUzsfwd)\r\n\r\n... but the reality ended up being that the generated tutorials are not that good, and I'm not sure if it's because of the prompt I'm using, or because of the model itself, but I'm sure it's a combination of both. For some reason it keeps generating the same tutorials, always related to coloring things using CSS.\r\n\r\nI have been running this account for 3 months now, and it got only 38 followers as of today and 466 accounts reached in the past 30 days, so I'm not sure if it's worth it to keep it running, even though it's fully automated and the total cost so far was only U$1.00.\r\n\r\nI think the best approach here is a hybrid one, where I generate my own scripts and use my Node.js code to generate the video and post it to Instagram Reels, which already automates a lot of the work.\r\n\r\n## Conclusion\r\nI'm really excited about this new era of working with language models. I'm sure we'll see a lot of cool stuff being created in the next few years.\r\n\r\nEven though this project didn't work as expected, I learned a lot about OpenAI's API and how to use it, and I'm sure I'll be using it in the future.\r\n\r\nI hope you enjoyed this post, and don't forget to check how to [automatically post Instagram Reels using Node.js](/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/) and [how to automatically generate thumbnails for your videos with Node.js](/en/blog/coding/how-to-automatically-create-thumbnails-for-your-videos-with-nodejs/).\r\n","frontmatter":{"tags":["openai","gpt","javascript","node","nodejs","instagram"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-12-20T00:00:00.000Z","id":null,"path":"creating-instagram-reels-coding-tutorials-automatically-with-openais-gpt","show":true,"title":"Creating Instagram Reels coding tutorials automatically with OpenAI's GPT","hideExcerpt":false,"subtitle":""}}},{"node":{"excerpt":"Apenas na semana passada eu postei sobre como fazer upload…","html":"<p>Apenas na semana passada eu postei sobre <a href=\"/pt-br/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/\">como fazer upload de Reels para o Instagram usando Node.js</a>, e no código era possível fazer upload de um thumbnail para o vídeo também, mas eu não expliquei como criar esse thumbnail.</p>\n<p>I mean, claro que você pode ir para no <a href=\"https://www.photopea.com/\" target=\"_blank\" rel=\"noreferrer\">Photopea</a> e criar um thumbnail para o seu vídeo, mas e se você quiser automatizar esse processo? E se você quiser criar um thumbnail diferente para todos os seus vídeos automaticamente?</p>\n<p>Bem, é isso que eu vou te mostrar hoje.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdklEQVQozxXQu27TUACA4RPbcXx8ObaPj+9O7DiXNiRNUqcpzQXVtEFtgBZISUsZ6JWFAaR2oEUVEoKyMQALQkgIgZB4AAYkZgpvgMTEBhti7QDqv3/LDzJyTlOxJkhIwgwvMgJKESNFdK1ey9QaaKIjFcdhJqsJrqd4rkZUETEMTVMnAdkPHC9r6cSUtRTkoJOG/bly3F3vnFmNop34fK/Y5KImKtctwyI2EXgOQi7FJk+wK+YDbcTHPuZlybGMVie8Opg+1azLwXRQXa1EIs3xVoEMh07UUlSDRwqEMEFRAAAQ4BFH8TCUpSSHwtC4NH86OxH5uYtxayxXmBqvtJsNjPJm7zKOY8XIknToYEfhcZJlgeNWMG9CSpQoQRovkelOGYdPb20cf3/769vL4x/vv757OOpNpsbG8EzbhJjnOchBHvI8zwPbCV3X1kQNcaLcLHNxA7BMvzKIq93Pzw9uLsz368u+kgOjWXu2l04XdFOj6QSgAM3QILRyGYOwKTYBgJDzxZV+M2rcXdvffnz45+j1kxeHd+4/W47OWutLdq2mY8siro5MldWSVBIUUclNZpBiasTl83lpZeHKcOPD7Z1/vz9+ebD/9+jNz0+vds+tlW4MFN/VdUMUDVkwECtTgAIuDhRT51VMVMUqBnh+1tvf6PbOHizObcUze4ML16e6+c1luz1t2CWVOFDioAQTicTJbZR1FN3UkYNVJBGN1CfNa4tgb8mz9dnqaMv3wUwV3Vs3i/WQ8wuGZxNTEmU2xdJJBmRRwU55FrKwqqgKQpYRxl3t0ZbT7gMARMHUdjfR9tAOqg7x1EA3DWJgRUEiQzP/AerQaSbt1hVqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ilustração\"\n        title=\"Ilustração\"\n        src=\"/static/f8272dae5fedf81e3304107e04988bdb/42a19/instagram-reels-thumbnail-illustration.png\"\n        srcset=\"/static/f8272dae5fedf81e3304107e04988bdb/e3135/instagram-reels-thumbnail-illustration.png 256w,\n/static/f8272dae5fedf81e3304107e04988bdb/06341/instagram-reels-thumbnail-illustration.png 512w,\n/static/f8272dae5fedf81e3304107e04988bdb/42a19/instagram-reels-thumbnail-illustration.png 1024w,\n/static/f8272dae5fedf81e3304107e04988bdb/e8464/instagram-reels-thumbnail-illustration.png 1536w,\n/static/f8272dae5fedf81e3304107e04988bdb/445c6/instagram-reels-thumbnail-illustration.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Ilustração</figcaption>\n  </figure></p>\n<h2 id=\"encontrando-o-package-certo\" style=\"position:relative;\"><a href=\"#encontrando-o-package-certo\" aria-label=\"encontrando o package certo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Encontrando o package certo</h2>\n<p>Como um desenvolvedor frontend, a única coisa que eu sei sobre manipulação de imagens é usando canvas, e felizmente existe um package para Node.js que nos permite fazer isso, ele se chama <a href=\"https://www.npmjs.com/package/canvas\" target=\"_blank\" rel=\"noreferrer\">node-canvas</a>.</p>\n<p>Com ele, nós podemos criar um canvas, desenhar imagens, textos, formas, etc. É bem legal, dê uma olhada no exemplo abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas<span class=\"token punctuation\">,</span> loadImage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> writeFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">'30px Impact'</span><span class=\"token punctuation\">;</span>\r\nctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'#000'</span><span class=\"token punctuation\">;</span>\r\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\ncanvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image/png'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> buffer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./hello-world.png'</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"criando-um-design\" style=\"position:relative;\"><a href=\"#criando-um-design\" aria-label=\"criando um design permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Criando um design</h2>\n<p>Eu não sou um designer, então eu não vou te ensinar como criar um bom design, mas eu posso te mostrar como eu criei o design para as minhas thumbnails.</p>\n<p>Eu comecei criando um novo arquivo no Photopea com o mesmo tamanho do vídeo do Instagram Reels, que é 1080x1920px. Então eu adicionei uma imagem de fundo e um texto com o título do vídeo, e também uma cor de fundo para o texto com um pouco de opacidade.</p>\n<p>E para finalizar, eu adicionei uma imagem com fundo transparente com uma imagem minha em pixel art.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.734375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsTAAALEwEAmpwYAAAHoUlEQVRIxy1VWXAbWRXtYRbHlmTtliNLvbz3elN3q6VudavV2ndZtuU940kcT8ngCZnYhGBnw3bisZ0EkUwcJeCkTIVMUYGESg0MpCiYqQxkUixf+aKKml9++OCTgiq+MMjk1P295713zz3vYIackwWFZWmEIElRBEHRLOAkmKlFcqOh1AhnVrncOB8v02ZWTeaEwohQmRFqb0fKmWEsGxsaTE2lTKUxGq9UlGJBicUigsADEgASUGSHS4jQsoZiuqxGQ0lTzKYjmiJFZBkDIIhDnEIUx9GKIqRSUipjplJKY0QfqseKpVhUDLMQcCKNEAUAIHFAUEGaBgwLsSwZrhORvKAgDuFEECdIAACEkGFoUWBimiixIUVhEjUmOcSl6kyixGcSJZnXBC6MTY6bmVg4CyKqqAucyLIMQhDRAEIKQEBRACKAEIIA0TTiBaQYfFLLFfWJQXMGy+clSWYliBJSJqs00tF6NGQwkOeQiACNECBJAsdxgjgonAgM4AOBw4Hg4UBwADt82OtyWZ2enq6u151dFp9jIOBBPgfutfv9bsrttPv6Lf4Bp91ut1gsXV1dVqvVYrHarDaXy4VZrbZmc35zc+vWrfbS4tLW5pWTC0vL3zy/vra+tnbp5s2b165tX7x4ttVqnThx4sKFC5VKZWJiolAoWK1WzGazzc8319fXd3Z2isXi1NTUwnsLW9ubc3NzU1OTd+7cabdvNxqjzWZzeXl5dXV1Y2Pj3Llzuq5bLBbM6XRGIpFarRaPxzOZzMhIIx6PFwoFTdO0mFapVHK5XD6f0w/AcRxJkt3d3b29vW63G7Pb7StnVz755OcvXrzY3d29d+9eq9VaWlra29t7+PDhy5cvnz179vTp00ePHu3u7rbb7Uq12tXV5fV6O2+22+2yHJYkyTAMnuc5jpMkCcdxCGE6nVYURT1AOBw2TbNarYZCIfcBOs2BYHBza/uHDx589NGDlZXlvb0f7Oy079+/v7q2un1l+8mTJ3fv3m2321evXn38+NHW1mar1Tp16tSrazMDvqwRmxwbnZgYy2RizeZMs/nO+Hgjm83NzMzMz88fP358enp6cnJydnZ2cHBQ0zTTNB0Ox8HJ3v7lxZNrZ791aXX93MoFTY1tbFwEkLQ7HG6Pu7un+1D3IYulp6enp7u722az2e12q9XqOgDmc+EXz6+1b7dv3r5+fad1+szizZ0PxZAU6ANUgDnsC3g9Xq+3z+V2ut0uj8fjdrs9Hs+rZr+/P+AjPHbXgNNO9XsA7QsiJ4n6SSIACJwMUAEf5feQA33A4/Q5HU63y9NrtzocdrvDjtE0wcnBaCguUzHOCxQksSHW5/cFAv0A+Bk2EIvRERmqsigLLAgGBKgpbIoiAMBZrKxPGtG0GS1n1aFktJRN1FRaChN8iA/TNKJpmuOYSCQUj4dyxXAqGQ1LIVMz40qqbExhRX3MiOTSsXpcNDSVyYzxiSKdUHRTLSYSGscjkiQo6sCbEDAdoJDAJORSxZjCSvHxRKSQ04aL6aISY+PxqJkVy4WhIXPWUHIxyZBEmWFomoYdnx8UhBAhwDAsVtTHzUgpqw7n05l8XolLUZ1OlONHDMFMs7GcMVpM1SJymKRwiCiEII0g3QFCCGD1aCEeN3J6PZsxjXRUZHkJqVl1JCcmUoxQTI0V1NGMWgnzihxSOl8KAhQgKEBACDBTTuo5AUVZq83WbbNDVTUbQ1RYIfyEIcWKxnhBayTkvCHn8kZDo1idjmhyNhyK0jTCjHCp34ljX3nztdffwjCsy+mJpFN8OkPrGs8ZBWU0rwzHRDMZLSejZZ2gDU6rJo42CsfSySQm0DKGYXGy/5dnj1yeTA/0WrA3et7wBelE0gMZyIgZo6hFzLw2YsQSPAQyG87FRsv5mixLmCqkXBarGuz73unR/b/cfd6a/86JkY9Pj2YE2sNLRIjXTVkQOUACnuU7ciEKQDIUCrEsg3n6+jh3b5EOvHWo6yffnt7//Mq/Pt18fuvEtSO5N3usfgo3S0x+kjfyIVnhOAEiiCDszAwhiC3XjfdzyvUbLac/kCN8q8MG4Xe/hmGM1+GyHqLogFnlM+NMuirnh5TCNJ8oMrquKWK803ypEP340rvPP/3ZqfeO//1HK1sz5V4cLR4dl929vX12zeTTDa74Np+tRUsN1awzehFWCvWxzHxaLWPHTPmLu4v7f77z7y/a+3/Y+fIX312/1rp3dW1MwtnObiMhQseydKqgpob4whE+Ueaq2ZGiNqFJSczu9t5bnfvN979xZqK0OVb752fX9r/88a+2mhslZS4dHSApBCBFAAgQLyLFZLQ0V0mN14yZuJzBhvXQh18fv3xmdne9+f5cY2/jq//49QcLw+nb09m0SAdInKEhwxyk1SsWyLFcRNC0cApbrBo33q3dOX90qdn46Vbz5MJ0rl5GRPCdY5FUKaGKSYQQCXAS4uiAhaZfTRsACvvs8uxfH5392+Nzf2o1f3/jawujGau7D0IAGEpT1ZI+NmjOpNWqKhqoE5wEgB2R/u8NbP/z7f/87sr+b6/88WqzxpGLpojwAOrkLKQoigI4y7JRUc+qdU01dDmjigbT8RT4n1T/BXdR/JE3X+zEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Thumbnail para Reels\"\n        title=\"Thumbnail para Reels\"\n        src=\"/static/352db45cb6eb4b617148e7cfaf35c1dd/42a19/instagram-reels-thumbnail.png\"\n        srcset=\"/static/352db45cb6eb4b617148e7cfaf35c1dd/e3135/instagram-reels-thumbnail.png 256w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/06341/instagram-reels-thumbnail.png 512w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/42a19/instagram-reels-thumbnail.png 1024w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/b4ad3/instagram-reels-thumbnail.png 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Thumbnail para Reels</figcaption>\n  </figure></p>\n<h2 id=\"criando-a-thumbnail\" style=\"position:relative;\"><a href=\"#criando-a-thumbnail\" aria-label=\"criando a thumbnail permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Criando a thumbnail</h2>\n<p>Agora que nós temos o design, nós podemos começar a programar. Primeiro, nós precisamos criar uma função que irá criar a thumbnail para nós, e ela irá receber uma imagem de fundo, uma imagem de primeiro plano, um título e o caminho para salvar a thumbnail como parâmetros.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateImageForPost</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">backgroundImagePath<span class=\"token punctuation\">,</span>\r\n  foregroundImagePath<span class=\"token punctuation\">,</span>\r\n  title<span class=\"token punctuation\">,</span>\r\n  outputPath</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> backgroundImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadImage</span><span class=\"token punctuation\">(</span>backgroundImagePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> foregroundImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadImage</span><span class=\"token punctuation\">(</span>foregroundImagePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span>backgroundImage<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> backgroundImage<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>foregroundImage<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// TODO add text</span>\r\n  <span class=\"token comment\">// addCenteredTextWithBackground(ctx, title, canvas.width, canvas.height);</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> out <span class=\"token operator\">=</span> <span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span>outputPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">createPNGStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    stream<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    out<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finish'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The PNG file was created.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    out<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Esse código irá carregar as imagens de fundo e primeiro plano, criar um canvas com o mesmo tamanho da imagem de fundo, desenhar a imagem de primeiro plano no canvas, e salvar o canvas como um arquivo PNG. Essa foi a parte fácil, agora nós precisamos adicionar o texto.</p>\n<p>O desafio aqui é adicionar o texto no centro do canvas, e garantir que ele não irá ultrapassar o canvas. Vamos ver como podemos fazer isso.</p>\n<h2 id=\"adicionando-o-texto\" style=\"position:relative;\"><a href=\"#adicionando-o-texto\" aria-label=\"adicionando o texto permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adicionando o texto</h2>\n<p>Primeiro, nós precisamos criar uma função que irá adicionar o texto no centro do canvas, e ela irá receber o texto e o canvas como parâmetros. Nós iremos fazer isso na função <code class=\"language-text\">addCenteredTextWithBackground</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">addCenteredTextWithBackground</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span>\r\n  text<span class=\"token punctuation\">,</span>\r\n  canvasWidth<span class=\"token punctuation\">,</span>\r\n  canvasHeight</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> fontSize <span class=\"token operator\">=</span> <span class=\"token number\">150</span><span class=\"token punctuation\">;</span>\r\n  ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fontSize<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px Impact</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> textHeight <span class=\"token operator\">=</span> fontSize <span class=\"token operator\">*</span> lines<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> rectWidth <span class=\"token operator\">=</span> canvasWidth<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> rectHeight <span class=\"token operator\">=</span> textHeight <span class=\"token operator\">+</span> <span class=\"token number\">60</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> rectX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvasWidth <span class=\"token operator\">-</span> rectWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> rectY <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">;</span>\r\n\r\n  ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'rgba(0, 0, 0, 0.5)'</span><span class=\"token punctuation\">;</span>\r\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>rectX<span class=\"token punctuation\">,</span> rectY<span class=\"token punctuation\">,</span> rectWidth<span class=\"token punctuation\">,</span> rectHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> lines<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> textX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvasWidth <span class=\"token operator\">-</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">measureText</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> textY <span class=\"token operator\">=</span> rectY <span class=\"token operator\">+</span> fontSize <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span> textX<span class=\"token punctuation\">,</span> textY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Essa função irá calcular o tamanho do retângulo que será o fundo do texto, e então irá desenhar o retângulo e o texto no canvas. Infelizmente, apenas fazer <code class=\"language-text\">text.split(' ');</code> não irá funcionar, porque dividir o texto por espaços irá simplesmente aumentar a altura do texto, mas não necessariamente irá fazer o texto caber no canvas.</p>\n<p>Então vamos criar uma função chamada <code class=\"language-text\">breakTextToFitCanvas</code> que irá receber o texto, o contexto do canvas e uma largura máxima como parâmetros, e irá retornar um array de strings com o texto dividido em linhas que irão caber no canvas.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">breakTextToFitCanvas</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">,</span> maxWidth</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> words <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">let</span> currentLine <span class=\"token operator\">=</span> words<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> words<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> word <span class=\"token operator\">=</span> words<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> width <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">measureText</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>currentLine<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>word<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>width <span class=\"token operator\">&lt;</span> maxWidth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      currentLine <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>word<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      lines<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>currentLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      currentLine <span class=\"token operator\">=</span> word<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  lines<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>currentLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> lines<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"juntando-tudo\" style=\"position:relative;\"><a href=\"#juntando-tudo\" aria-label=\"juntando tudo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Juntando tudo</h2>\n<p>Agora que nós temos todas as funções que precisamos, nós podemos juntar tudo e criar a thumbnail. Vamos criar uma função chamada <code class=\"language-text\">generateThumbnail</code> que irá receber o título do vídeo e o caminho para salvar a thumbnail como parâmetros.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateThumbnail</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> outputPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> backgroundImagePath <span class=\"token operator\">=</span> <span class=\"token string\">'./background.png'</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> foregroundImagePath <span class=\"token operator\">=</span> <span class=\"token string\">'./foreground.png'</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">generateImageForPost</span><span class=\"token punctuation\">(</span>\r\n    backgroundImagePath<span class=\"token punctuation\">,</span>\r\n    foregroundImagePath<span class=\"token punctuation\">,</span>\r\n    title<span class=\"token punctuation\">,</span>\r\n    outputPath\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>E agora nós podemos chamar essa função e criar a thumbnail.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">generateThumbnail</span><span class=\"token punctuation\">(</span><span class=\"token string\">'How to create thumbnails for your videos with Node.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./thumbnail.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>E é isso! Agora você pode criar thumbnails para seus vídeos automaticamente. Eu espero que você tenha gostado desse post, e não se esqueça de ver como <a href=\"/pt-br/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/\">fazer upload de Reels para o Instagram usando Node.js</a>.</p>\n<p>Até a próxima!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEwLTI1VDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-10-25-como-criar-thumbnails-para-seus-videos-automaticamente-com-nodejs.pt-br/","path":"/blog/coding/como-criar-thumbnails-para-seus-videos-automaticamente-com-nodejs/","locale":"pt-br"},"rawMarkdownBody":"Apenas na semana passada eu postei sobre [como fazer upload de Reels para o Instagram usando Node.js](/pt-br/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/), e no código era possível fazer upload de um thumbnail para o vídeo também, mas eu não expliquei como criar esse thumbnail.\r\n\r\nI mean, claro que você pode ir para no [Photopea](https://www.photopea.com/) e criar um thumbnail para o seu vídeo, mas e se você quiser automatizar esse processo? E se você quiser criar um thumbnail diferente para todos os seus vídeos automaticamente?\r\n\r\nBem, é isso que eu vou te mostrar hoje.\r\n\r\n![Ilustração](../../uploads/blog/2023/10/instagram-reels-thumbnail-illustration.png)\r\n\r\n## Encontrando o package certo\r\nComo um desenvolvedor frontend, a única coisa que eu sei sobre manipulação de imagens é usando canvas, e felizmente existe um package para Node.js que nos permite fazer isso, ele se chama [node-canvas](https://www.npmjs.com/package/canvas).\r\n\r\nCom ele, nós podemos criar um canvas, desenhar imagens, textos, formas, etc. É bem legal, dê uma olhada no exemplo abaixo:\r\n\r\n```javascript\r\nconst { createCanvas, loadImage } = require('canvas');\r\nconst { writeFileSync } = require('fs');\r\n\r\nconst canvas = createCanvas(200, 200);\r\nconst ctx = canvas.getContext('2d');\r\nctx.font = '30px Impact';\r\nctx.fillStyle = '#000';\r\nctx.fillText('Hello World!', 0, 0);\r\ncanvas.toBuffer('image/png', (err, buffer) => {\r\n  writeFileSync('./hello-world.png', buffer);\r\n});\r\n```\r\n\r\n## Criando um design\r\nEu não sou um designer, então eu não vou te ensinar como criar um bom design, mas eu posso te mostrar como eu criei o design para as minhas thumbnails.\r\n\r\nEu comecei criando um novo arquivo no Photopea com o mesmo tamanho do vídeo do Instagram Reels, que é 1080x1920px. Então eu adicionei uma imagem de fundo e um texto com o título do vídeo, e também uma cor de fundo para o texto com um pouco de opacidade.\r\n\r\nE para finalizar, eu adicionei uma imagem com fundo transparente com uma imagem minha em pixel art.\r\n\r\n![Thumbnail para Reels](../../uploads/blog/2023/10/instagram-reels-thumbnail.png)\r\n\r\n## Criando a thumbnail\r\nAgora que nós temos o design, nós podemos começar a programar. Primeiro, nós precisamos criar uma função que irá criar a thumbnail para nós, e ela irá receber uma imagem de fundo, uma imagem de primeiro plano, um título e o caminho para salvar a thumbnail como parâmetros.\r\n\r\n```javascript\r\nconst generateImageForPost = async (\r\n  backgroundImagePath,\r\n  foregroundImagePath,\r\n  title,\r\n  outputPath\r\n) => {\r\n  const backgroundImage = await loadImage(backgroundImagePath);\r\n  const foregroundImage = await loadImage(foregroundImagePath);\r\n\r\n  const canvas = createCanvas(backgroundImage.width, backgroundImage.height);\r\n  const ctx = canvas.getContext('2d');\r\n\r\n  ctx.drawImage(foregroundImage, 0, 0);\r\n\r\n  // TODO add text\r\n  // addCenteredTextWithBackground(ctx, title, canvas.width, canvas.height);\r\n\r\n  await new Promise((resolve, reject) => {\r\n    const out = createWriteStream(outputPath);\r\n    const stream = canvas.createPNGStream();\r\n    stream.pipe(out);\r\n\r\n    out.on('finish', () => {\r\n      console.log('The PNG file was created.');\r\n      resolve();\r\n    });\r\n\r\n    out.on('error', (err) => {\r\n      reject(err);\r\n    });\r\n  });\r\n};\r\n```\r\n\r\nEsse código irá carregar as imagens de fundo e primeiro plano, criar um canvas com o mesmo tamanho da imagem de fundo, desenhar a imagem de primeiro plano no canvas, e salvar o canvas como um arquivo PNG. Essa foi a parte fácil, agora nós precisamos adicionar o texto.\r\n\r\nO desafio aqui é adicionar o texto no centro do canvas, e garantir que ele não irá ultrapassar o canvas. Vamos ver como podemos fazer isso.\r\n\r\n## Adicionando o texto\r\nPrimeiro, nós precisamos criar uma função que irá adicionar o texto no centro do canvas, e ela irá receber o texto e o canvas como parâmetros. Nós iremos fazer isso na função `addCenteredTextWithBackground`.\r\n\r\n```javascript\r\nconst addCenteredTextWithBackground = (\r\n  ctx,\r\n  text,\r\n  canvasWidth,\r\n  canvasHeight\r\n) => {\r\n  const fontSize = 150;\r\n  ctx.font = `${fontSize}px Impact`;\r\n  const lines = text.split(' ');\r\n\r\n  const textHeight = fontSize * lines.length;\r\n  const rectWidth = canvasWidth;\r\n  const rectHeight = textHeight + 60;\r\n\r\n  const rectX = (canvasWidth - rectWidth) / 2;\r\n  const rectY = 300;\r\n\r\n  ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\r\n  ctx.fillRect(rectX, rectY, rectWidth, rectHeight);\r\n\r\n  ctx.fillStyle = 'white';\r\n  for (const [i, line] of lines.entries()) {\r\n    const textX = (canvasWidth - ctx.measureText(line).width) / 2;\r\n    const textY = rectY + fontSize * (i + 1);\r\n    ctx.fillText(line, textX, textY);\r\n  }\r\n};\r\n```\r\n\r\nEssa função irá calcular o tamanho do retângulo que será o fundo do texto, e então irá desenhar o retângulo e o texto no canvas. Infelizmente, apenas fazer `text.split(' ');` não irá funcionar, porque dividir o texto por espaços irá simplesmente aumentar a altura do texto, mas não necessariamente irá fazer o texto caber no canvas.\r\n\r\nEntão vamos criar uma função chamada `breakTextToFitCanvas` que irá receber o texto, o contexto do canvas e uma largura máxima como parâmetros, e irá retornar um array de strings com o texto dividido em linhas que irão caber no canvas.\r\n\r\n```javascript\r\nconst breakTextToFitCanvas = (ctx, text, maxWidth) => {\r\n  const words = text.split(' ');\r\n  const lines = [];\r\n  let currentLine = words[0];\r\n\r\n  for (let i = 1; i < words.length; i++) {\r\n    const word = words[i];\r\n    const { width } = ctx.measureText(`${currentLine} ${word}`);\r\n\r\n    if (width < maxWidth) {\r\n      currentLine += ` ${word}`;\r\n    } else {\r\n      lines.push(currentLine);\r\n      currentLine = word;\r\n    }\r\n  }\r\n\r\n  lines.push(currentLine);\r\n\r\n  return lines;\r\n};\r\n```\r\n\r\n## Juntando tudo\r\nAgora que nós temos todas as funções que precisamos, nós podemos juntar tudo e criar a thumbnail. Vamos criar uma função chamada `generateThumbnail` que irá receber o título do vídeo e o caminho para salvar a thumbnail como parâmetros.\r\n\r\n```javascript\r\nconst generateThumbnail = async (title, outputPath) => {\r\n  const backgroundImagePath = './background.png';\r\n  const foregroundImagePath = './foreground.png';\r\n\r\n  await generateImageForPost(\r\n    backgroundImagePath,\r\n    foregroundImagePath,\r\n    title,\r\n    outputPath\r\n  );\r\n};\r\n```\r\n\r\nE agora nós podemos chamar essa função e criar a thumbnail.\r\n\r\n```javascript\r\ngenerateThumbnail('How to create thumbnails for your videos with Node.js', './thumbnail.png');\r\n```\r\n\r\n## Conclusão\r\nE é isso! Agora você pode criar thumbnails para seus vídeos automaticamente. Eu espero que você tenha gostado desse post, e não se esqueça de ver como [fazer upload de Reels para o Instagram usando Node.js](/pt-br/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/).\r\n\r\nAté a próxima!\r\n","frontmatter":{"tags":["instagram","miniatura","node","nodejs","javascript","canvas","imagem","vídeo"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-10-25T00:00:00.000Z","id":null,"path":"como-criar-thumbnails-para-seus-videos-automaticamente-com-nodejs","show":true,"title":"Como criar thumbnails para seus vídeos automaticamente com Node.js","hideExcerpt":false,"subtitle":"A melhor forma de criar thumbnails para seus vídeos no Instagram"}}},{"node":{"excerpt":"Just last week I posted about how to create upload reels to…","html":"<p>Just last week I posted about <a href=\"/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/\">how to create upload reels to Instagram using Node.js</a>, and in the code it was possible to upload a cover image for the video too, but I didn’t explain how to create this cover image.</p>\n<p>I mean, of course you can go to <a href=\"https://www.photopea.com/\" target=\"_blank\" rel=\"noreferrer\">Photopea</a> and create a cover image for your video, but what if you want to automate this process? What if you want to create a cover image for all your videos automatically?</p>\n<p>Well, that’s what I’m going to show you today.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdklEQVQozxXQu27TUACA4RPbcXx8ObaPj+9O7DiXNiRNUqcpzQXVtEFtgBZISUsZ6JWFAaR2oEUVEoKyMQALQkgIgZB4AAYkZgpvgMTEBhti7QDqv3/LDzJyTlOxJkhIwgwvMgJKESNFdK1ey9QaaKIjFcdhJqsJrqd4rkZUETEMTVMnAdkPHC9r6cSUtRTkoJOG/bly3F3vnFmNop34fK/Y5KImKtctwyI2EXgOQi7FJk+wK+YDbcTHPuZlybGMVie8Opg+1azLwXRQXa1EIs3xVoEMh07UUlSDRwqEMEFRAAAQ4BFH8TCUpSSHwtC4NH86OxH5uYtxayxXmBqvtJsNjPJm7zKOY8XIknToYEfhcZJlgeNWMG9CSpQoQRovkelOGYdPb20cf3/769vL4x/vv757OOpNpsbG8EzbhJjnOchBHvI8zwPbCV3X1kQNcaLcLHNxA7BMvzKIq93Pzw9uLsz368u+kgOjWXu2l04XdFOj6QSgAM3QILRyGYOwKTYBgJDzxZV+M2rcXdvffnz45+j1kxeHd+4/W47OWutLdq2mY8siro5MldWSVBIUUclNZpBiasTl83lpZeHKcOPD7Z1/vz9+ebD/9+jNz0+vds+tlW4MFN/VdUMUDVkwECtTgAIuDhRT51VMVMUqBnh+1tvf6PbOHizObcUze4ML16e6+c1luz1t2CWVOFDioAQTicTJbZR1FN3UkYNVJBGN1CfNa4tgb8mz9dnqaMv3wUwV3Vs3i/WQ8wuGZxNTEmU2xdJJBmRRwU55FrKwqqgKQpYRxl3t0ZbT7gMARMHUdjfR9tAOqg7x1EA3DWJgRUEiQzP/AerQaSbt1hVqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Illustration\"\n        title=\"Illustration\"\n        src=\"/static/f8272dae5fedf81e3304107e04988bdb/42a19/instagram-reels-thumbnail-illustration.png\"\n        srcset=\"/static/f8272dae5fedf81e3304107e04988bdb/e3135/instagram-reels-thumbnail-illustration.png 256w,\n/static/f8272dae5fedf81e3304107e04988bdb/06341/instagram-reels-thumbnail-illustration.png 512w,\n/static/f8272dae5fedf81e3304107e04988bdb/42a19/instagram-reels-thumbnail-illustration.png 1024w,\n/static/f8272dae5fedf81e3304107e04988bdb/e8464/instagram-reels-thumbnail-illustration.png 1536w,\n/static/f8272dae5fedf81e3304107e04988bdb/445c6/instagram-reels-thumbnail-illustration.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Illustration</figcaption>\n  </figure></p>\n<h2 id=\"finding-the-right-package\" style=\"position:relative;\"><a href=\"#finding-the-right-package\" aria-label=\"finding the right package permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Finding the right package</h2>\n<p>As a frontend developer, the only thing I know about image manipulation is by using canvas, and luckly there’s a Node.js library that allows us to do that, it’s called <a href=\"https://www.npmjs.com/package/canvas\" target=\"_blank\" rel=\"noreferrer\">node-canvas</a>.</p>\n<p>With it, we can create a canvas, draw images, text, shapes, etc. It’s pretty cool, check out the example below:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas<span class=\"token punctuation\">,</span> loadImage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> writeFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">'30px Impact'</span><span class=\"token punctuation\">;</span>\r\nctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'#000'</span><span class=\"token punctuation\">;</span>\r\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\ncanvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image/png'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> buffer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./hello-world.png'</span><span class=\"token punctuation\">,</span> buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"coming-up-with-a-design\" style=\"position:relative;\"><a href=\"#coming-up-with-a-design\" aria-label=\"coming up with a design permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coming up with a design</h2>\n<p>I’m not a designer, so I’m not going to teach you how to create a good design, but I can show you how I came up with the design for my thumbnails.</p>\n<p>I started by creating a new file on Photopea with the same size as the Instagram Reels video, which is 1080x1920px. Then I added a background image and a text with the title of the video, and also a background color for the text with some opacity.</p>\n<p>And for the cherry on top, I added a foreground image with a transparent background with an image of myself in pixel art style.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.734375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsTAAALEwEAmpwYAAAHoUlEQVRIxy1VWXAbWRXtYRbHlmTtliNLvbz3elN3q6VudavV2ndZtuU940kcT8ngCZnYhGBnw3bisZ0EkUwcJeCkTIVMUYGESg0MpCiYqQxkUixf+aKKml9++OCTgiq+MMjk1P295713zz3vYIackwWFZWmEIElRBEHRLOAkmKlFcqOh1AhnVrncOB8v02ZWTeaEwohQmRFqb0fKmWEsGxsaTE2lTKUxGq9UlGJBicUigsADEgASUGSHS4jQsoZiuqxGQ0lTzKYjmiJFZBkDIIhDnEIUx9GKIqRSUipjplJKY0QfqseKpVhUDLMQcCKNEAUAIHFAUEGaBgwLsSwZrhORvKAgDuFEECdIAACEkGFoUWBimiixIUVhEjUmOcSl6kyixGcSJZnXBC6MTY6bmVg4CyKqqAucyLIMQhDRAEIKQEBRACKAEIIA0TTiBaQYfFLLFfWJQXMGy+clSWYliBJSJqs00tF6NGQwkOeQiACNECBJAsdxgjgonAgM4AOBw4Hg4UBwADt82OtyWZ2enq6u151dFp9jIOBBPgfutfv9bsrttPv6Lf4Bp91ut1gsXV1dVqvVYrHarDaXy4VZrbZmc35zc+vWrfbS4tLW5pWTC0vL3zy/vra+tnbp5s2b165tX7x4ttVqnThx4sKFC5VKZWJiolAoWK1WzGazzc8319fXd3Z2isXi1NTUwnsLW9ubc3NzU1OTd+7cabdvNxqjzWZzeXl5dXV1Y2Pj3Llzuq5bLBbM6XRGIpFarRaPxzOZzMhIIx6PFwoFTdO0mFapVHK5XD6f0w/AcRxJkt3d3b29vW63G7Pb7StnVz755OcvXrzY3d29d+9eq9VaWlra29t7+PDhy5cvnz179vTp00ePHu3u7rbb7Uq12tXV5fV6O2+22+2yHJYkyTAMnuc5jpMkCcdxCGE6nVYURT1AOBw2TbNarYZCIfcBOs2BYHBza/uHDx589NGDlZXlvb0f7Oy079+/v7q2un1l+8mTJ3fv3m2321evXn38+NHW1mar1Tp16tSrazMDvqwRmxwbnZgYy2RizeZMs/nO+Hgjm83NzMzMz88fP358enp6cnJydnZ2cHBQ0zTTNB0Ox8HJ3v7lxZNrZ791aXX93MoFTY1tbFwEkLQ7HG6Pu7un+1D3IYulp6enp7u722az2e12q9XqOgDmc+EXz6+1b7dv3r5+fad1+szizZ0PxZAU6ANUgDnsC3g9Xq+3z+V2ut0uj8fjdrs9Hs+rZr+/P+AjPHbXgNNO9XsA7QsiJ4n6SSIACJwMUAEf5feQA33A4/Q5HU63y9NrtzocdrvDjtE0wcnBaCguUzHOCxQksSHW5/cFAv0A+Bk2EIvRERmqsigLLAgGBKgpbIoiAMBZrKxPGtG0GS1n1aFktJRN1FRaChN8iA/TNKJpmuOYSCQUj4dyxXAqGQ1LIVMz40qqbExhRX3MiOTSsXpcNDSVyYzxiSKdUHRTLSYSGscjkiQo6sCbEDAdoJDAJORSxZjCSvHxRKSQ04aL6aISY+PxqJkVy4WhIXPWUHIxyZBEmWFomoYdnx8UhBAhwDAsVtTHzUgpqw7n05l8XolLUZ1OlONHDMFMs7GcMVpM1SJymKRwiCiEII0g3QFCCGD1aCEeN3J6PZsxjXRUZHkJqVl1JCcmUoxQTI0V1NGMWgnzihxSOl8KAhQgKEBACDBTTuo5AUVZq83WbbNDVTUbQ1RYIfyEIcWKxnhBayTkvCHn8kZDo1idjmhyNhyK0jTCjHCp34ljX3nztdffwjCsy+mJpFN8OkPrGs8ZBWU0rwzHRDMZLSejZZ2gDU6rJo42CsfSySQm0DKGYXGy/5dnj1yeTA/0WrA3et7wBelE0gMZyIgZo6hFzLw2YsQSPAQyG87FRsv5mixLmCqkXBarGuz73unR/b/cfd6a/86JkY9Pj2YE2sNLRIjXTVkQOUACnuU7ciEKQDIUCrEsg3n6+jh3b5EOvHWo6yffnt7//Mq/Pt18fuvEtSO5N3usfgo3S0x+kjfyIVnhOAEiiCDszAwhiC3XjfdzyvUbLac/kCN8q8MG4Xe/hmGM1+GyHqLogFnlM+NMuirnh5TCNJ8oMrquKWK803ypEP340rvPP/3ZqfeO//1HK1sz5V4cLR4dl929vX12zeTTDa74Np+tRUsN1awzehFWCvWxzHxaLWPHTPmLu4v7f77z7y/a+3/Y+fIX312/1rp3dW1MwtnObiMhQseydKqgpob4whE+Ueaq2ZGiNqFJSczu9t5bnfvN979xZqK0OVb752fX9r/88a+2mhslZS4dHSApBCBFAAgQLyLFZLQ0V0mN14yZuJzBhvXQh18fv3xmdne9+f5cY2/jq//49QcLw+nb09m0SAdInKEhwxyk1SsWyLFcRNC0cApbrBo33q3dOX90qdn46Vbz5MJ0rl5GRPCdY5FUKaGKSYQQCXAS4uiAhaZfTRsACvvs8uxfH5392+Nzf2o1f3/jawujGau7D0IAGEpT1ZI+NmjOpNWqKhqoE5wEgB2R/u8NbP/z7f/87sr+b6/88WqzxpGLpojwAOrkLKQoigI4y7JRUc+qdU01dDmjigbT8RT4n1T/BXdR/JE3X+zEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Reels thumbnail\"\n        title=\"Reels thumbnail\"\n        src=\"/static/352db45cb6eb4b617148e7cfaf35c1dd/42a19/instagram-reels-thumbnail.png\"\n        srcset=\"/static/352db45cb6eb4b617148e7cfaf35c1dd/e3135/instagram-reels-thumbnail.png 256w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/06341/instagram-reels-thumbnail.png 512w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/42a19/instagram-reels-thumbnail.png 1024w,\n/static/352db45cb6eb4b617148e7cfaf35c1dd/b4ad3/instagram-reels-thumbnail.png 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Reels thumbnail</figcaption>\n  </figure></p>\n<h2 id=\"creating-the-thumbnail\" style=\"position:relative;\"><a href=\"#creating-the-thumbnail\" aria-label=\"creating the thumbnail permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating the thumbnail</h2>\n<p>Now that we have the design, we can start coding. First, we need to create a function that will create the thumbnail for us, and it will receive a background image, a foreground image, a title and the path to save the thumbnail as parameters.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateImageForPost</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">backgroundImagePath<span class=\"token punctuation\">,</span>\r\n  foregroundImagePath<span class=\"token punctuation\">,</span>\r\n  title<span class=\"token punctuation\">,</span>\r\n  outputPath</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> backgroundImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadImage</span><span class=\"token punctuation\">(</span>backgroundImagePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> foregroundImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">loadImage</span><span class=\"token punctuation\">(</span>foregroundImagePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span>backgroundImage<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> backgroundImage<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>foregroundImage<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token comment\">// TODO add text</span>\r\n  <span class=\"token comment\">// addCenteredTextWithBackground(ctx, title, canvas.width, canvas.height);</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> out <span class=\"token operator\">=</span> <span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span>outputPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">createPNGStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    stream<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    out<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finish'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'The PNG file was created.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    out<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This code will load the background and foreground images, create a canvas with the same size as the background image, draw the foreground image on the canvas, and save the canvas as a PNG file. That was the easy part, now we need to add the text.</p>\n<p>The challenge here is to add the text in the center of the canvas, and make sure it won’t overflow the canvas. Let’s take a look how we can do that.</p>\n<h2 id=\"adding-the-text\" style=\"position:relative;\"><a href=\"#adding-the-text\" aria-label=\"adding the text permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding the text</h2>\n<p>First, we need to create a function that will add the text in the center of the canvas, and it will receive the text and the canvas as parameters. We’re going to do that in the <code class=\"language-text\">addCenteredTextWithBackground</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">addCenteredTextWithBackground</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span>\r\n  text<span class=\"token punctuation\">,</span>\r\n  canvasWidth<span class=\"token punctuation\">,</span>\r\n  canvasHeight</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> fontSize <span class=\"token operator\">=</span> <span class=\"token number\">150</span><span class=\"token punctuation\">;</span>\r\n  ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fontSize<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px Impact</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> textHeight <span class=\"token operator\">=</span> fontSize <span class=\"token operator\">*</span> lines<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> rectWidth <span class=\"token operator\">=</span> canvasWidth<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> rectHeight <span class=\"token operator\">=</span> textHeight <span class=\"token operator\">+</span> <span class=\"token number\">60</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> rectX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvasWidth <span class=\"token operator\">-</span> rectWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> rectY <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">;</span>\r\n\r\n  ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'rgba(0, 0, 0, 0.5)'</span><span class=\"token punctuation\">;</span>\r\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>rectX<span class=\"token punctuation\">,</span> rectY<span class=\"token punctuation\">,</span> rectWidth<span class=\"token punctuation\">,</span> rectHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> line<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> lines<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> textX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvasWidth <span class=\"token operator\">-</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">measureText</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> textY <span class=\"token operator\">=</span> rectY <span class=\"token operator\">+</span> fontSize <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">,</span> textX<span class=\"token punctuation\">,</span> textY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This function will calculate the size of the rectangle that will be the background of the text, and then it will draw the rectangle and the text on the canvas. Unfortunately, just doing <code class=\"language-text\">text.split(' ');</code> won’t do the job, because splitting the text by spaces will simply make the text’s height bigger, but it won’t necessarely make the text fit in the canvas.</p>\n<p>So let’s create a function called <code class=\"language-text\">breakTextToFitCanvas</code> that will receive the text, a canvas context and a maximum width as parameters, and it will return an array of strings with the text broken into lines that will fit in the canvas.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">breakTextToFitCanvas</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">,</span> maxWidth</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> words <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">let</span> currentLine <span class=\"token operator\">=</span> words<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> words<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> word <span class=\"token operator\">=</span> words<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> width <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">measureText</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>currentLine<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>word<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>width <span class=\"token operator\">&lt;</span> maxWidth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      currentLine <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>word<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      lines<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>currentLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      currentLine <span class=\"token operator\">=</span> word<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  lines<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>currentLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> lines<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"putting-it-all-together\" style=\"position:relative;\"><a href=\"#putting-it-all-together\" aria-label=\"putting it all together permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Putting it all together</h2>\n<p>Now that we have all the functions we need, we can put it all together and create the thumbnail. Let’s create a function called <code class=\"language-text\">generateThumbnail</code> that will receive the title of the video and the path to save the thumbnail as parameters.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateThumbnail</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> outputPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> backgroundImagePath <span class=\"token operator\">=</span> <span class=\"token string\">'./background.png'</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> foregroundImagePath <span class=\"token operator\">=</span> <span class=\"token string\">'./foreground.png'</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">generateImageForPost</span><span class=\"token punctuation\">(</span>\r\n    backgroundImagePath<span class=\"token punctuation\">,</span>\r\n    foregroundImagePath<span class=\"token punctuation\">,</span>\r\n    title<span class=\"token punctuation\">,</span>\r\n    outputPath\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And now we can call this function and create the thumbnail.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">generateThumbnail</span><span class=\"token punctuation\">(</span><span class=\"token string\">'How to create thumbnails for your videos with Node.js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./thumbnail.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>And that’s it! Now you can create thumbnails for your videos automatically. I hope you enjoyed this post, and  don’t forget to check how to <a href=\"/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/\">upload Instagram Reels using Node.js</a>.</p>\n<p>See you next time!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEwLTI1VDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-10-25-how-to-automatically-create-thumbnails-for-your-videos-with-nodejs.en/","path":"/blog/coding/how-to-automatically-create-thumbnails-for-your-videos-with-nodejs/","locale":"en"},"rawMarkdownBody":"Just last week I posted about [how to create upload reels to Instagram using Node.js](/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/), and in the code it was possible to upload a cover image for the video too, but I didn't explain how to create this cover image.\r\n\r\nI mean, of course you can go to [Photopea](https://www.photopea.com/) and create a cover image for your video, but what if you want to automate this process? What if you want to create a cover image for all your videos automatically?\r\n\r\nWell, that's what I'm going to show you today.\r\n\r\n![Illustration](../../uploads/blog/2023/10/instagram-reels-thumbnail-illustration.png)\r\n\r\n## Finding the right package\r\nAs a frontend developer, the only thing I know about image manipulation is by using canvas, and luckly there's a Node.js library that allows us to do that, it's called [node-canvas](https://www.npmjs.com/package/canvas).\r\n\r\nWith it, we can create a canvas, draw images, text, shapes, etc. It's pretty cool, check out the example below:\r\n\r\n```javascript\r\nconst { createCanvas, loadImage } = require('canvas');\r\nconst { writeFileSync } = require('fs');\r\n\r\nconst canvas = createCanvas(200, 200);\r\nconst ctx = canvas.getContext('2d');\r\nctx.font = '30px Impact';\r\nctx.fillStyle = '#000';\r\nctx.fillText('Hello World!', 0, 0);\r\ncanvas.toBuffer('image/png', (err, buffer) => {\r\n  writeFileSync('./hello-world.png', buffer);\r\n});\r\n```\r\n\r\n## Coming up with a design\r\nI'm not a designer, so I'm not going to teach you how to create a good design, but I can show you how I came up with the design for my thumbnails.\r\n\r\nI started by creating a new file on Photopea with the same size as the Instagram Reels video, which is 1080x1920px. Then I added a background image and a text with the title of the video, and also a background color for the text with some opacity.\r\n\r\nAnd for the cherry on top, I added a foreground image with a transparent background with an image of myself in pixel art style.\r\n\r\n![Reels thumbnail](../../uploads/blog/2023/10/instagram-reels-thumbnail.png)\r\n\r\n## Creating the thumbnail\r\nNow that we have the design, we can start coding. First, we need to create a function that will create the thumbnail for us, and it will receive a background image, a foreground image, a title and the path to save the thumbnail as parameters.\r\n\r\n```javascript\r\nconst generateImageForPost = async (\r\n  backgroundImagePath,\r\n  foregroundImagePath,\r\n  title,\r\n  outputPath\r\n) => {\r\n  const backgroundImage = await loadImage(backgroundImagePath);\r\n  const foregroundImage = await loadImage(foregroundImagePath);\r\n\r\n  const canvas = createCanvas(backgroundImage.width, backgroundImage.height);\r\n  const ctx = canvas.getContext('2d');\r\n\r\n  ctx.drawImage(foregroundImage, 0, 0);\r\n\r\n  // TODO add text\r\n  // addCenteredTextWithBackground(ctx, title, canvas.width, canvas.height);\r\n\r\n  await new Promise((resolve, reject) => {\r\n    const out = createWriteStream(outputPath);\r\n    const stream = canvas.createPNGStream();\r\n    stream.pipe(out);\r\n\r\n    out.on('finish', () => {\r\n      console.log('The PNG file was created.');\r\n      resolve();\r\n    });\r\n\r\n    out.on('error', (err) => {\r\n      reject(err);\r\n    });\r\n  });\r\n};\r\n```\r\n\r\nThis code will load the background and foreground images, create a canvas with the same size as the background image, draw the foreground image on the canvas, and save the canvas as a PNG file. That was the easy part, now we need to add the text.\r\n\r\nThe challenge here is to add the text in the center of the canvas, and make sure it won't overflow the canvas. Let's take a look how we can do that.\r\n\r\n## Adding the text\r\nFirst, we need to create a function that will add the text in the center of the canvas, and it will receive the text and the canvas as parameters. We're going to do that in the `addCenteredTextWithBackground` function.\r\n\r\n```javascript\r\nconst addCenteredTextWithBackground = (\r\n  ctx,\r\n  text,\r\n  canvasWidth,\r\n  canvasHeight\r\n) => {\r\n  const fontSize = 150;\r\n  ctx.font = `${fontSize}px Impact`;\r\n  const lines = text.split(' ');\r\n\r\n  const textHeight = fontSize * lines.length;\r\n  const rectWidth = canvasWidth;\r\n  const rectHeight = textHeight + 60;\r\n\r\n  const rectX = (canvasWidth - rectWidth) / 2;\r\n  const rectY = 300;\r\n\r\n  ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\r\n  ctx.fillRect(rectX, rectY, rectWidth, rectHeight);\r\n\r\n  ctx.fillStyle = 'white';\r\n  for (const [i, line] of lines.entries()) {\r\n    const textX = (canvasWidth - ctx.measureText(line).width) / 2;\r\n    const textY = rectY + fontSize * (i + 1);\r\n    ctx.fillText(line, textX, textY);\r\n  }\r\n};\r\n```\r\n\r\nThis function will calculate the size of the rectangle that will be the background of the text, and then it will draw the rectangle and the text on the canvas. Unfortunately, just doing `text.split(' ');` won't do the job, because splitting the text by spaces will simply make the text's height bigger, but it won't necessarely make the text fit in the canvas.\r\n\r\nSo let's create a function called `breakTextToFitCanvas` that will receive the text, a canvas context and a maximum width as parameters, and it will return an array of strings with the text broken into lines that will fit in the canvas.\r\n\r\n```javascript\r\nconst breakTextToFitCanvas = (ctx, text, maxWidth) => {\r\n  const words = text.split(' ');\r\n  const lines = [];\r\n  let currentLine = words[0];\r\n\r\n  for (let i = 1; i < words.length; i++) {\r\n    const word = words[i];\r\n    const { width } = ctx.measureText(`${currentLine} ${word}`);\r\n\r\n    if (width < maxWidth) {\r\n      currentLine += ` ${word}`;\r\n    } else {\r\n      lines.push(currentLine);\r\n      currentLine = word;\r\n    }\r\n  }\r\n\r\n  lines.push(currentLine);\r\n\r\n  return lines;\r\n};\r\n```\r\n\r\n## Putting it all together\r\nNow that we have all the functions we need, we can put it all together and create the thumbnail. Let's create a function called `generateThumbnail` that will receive the title of the video and the path to save the thumbnail as parameters.\r\n\r\n```javascript\r\nconst generateThumbnail = async (title, outputPath) => {\r\n  const backgroundImagePath = './background.png';\r\n  const foregroundImagePath = './foreground.png';\r\n\r\n  await generateImageForPost(\r\n    backgroundImagePath,\r\n    foregroundImagePath,\r\n    title,\r\n    outputPath\r\n  );\r\n};\r\n```\r\n\r\nAnd now we can call this function and create the thumbnail.\r\n\r\n```javascript\r\ngenerateThumbnail('How to create thumbnails for your videos with Node.js', './thumbnail.png');\r\n```\r\n\r\n## Conclusion\r\nAnd that's it! Now you can create thumbnails for your videos automatically. I hope you enjoyed this post, and  don't forget to check how to [upload Instagram Reels using Node.js](/en/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/).\r\n\r\nSee you next time!\r\n","frontmatter":{"tags":["instagram","thumbnail","node","nodejs","javascript","canvas","image","video"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-10-25T00:00:00.000Z","id":null,"path":"how-to-automatically-create-thumbnails-for-your-videos-with-nodejs","show":true,"title":"How to automatically create thumbnails for your videos with Node.js","hideExcerpt":false,"subtitle":"The best way to create thumbnails for your videos on Instagram"}}},{"node":{"excerpt":"Hey guys! It’s hard to be a geek these days, so many events…","html":"<p>Hey guys! It’s hard to be a geek these days, so many events are exclusive to media people and influencers - <a href=\"https://www.ign.com/articles/2017/02/08/e3-2017-open-to-the-public-tickets-on-sale-next-week\" target=\"_blank\" rel=\"noreferrer\">even E3 was a trade-only show for many years</a>. So let’s say you’re already happy with your job, and you don’t really want to become a journalist, so your best bet is to become an influencer, and then maybe get invited to the next <code class=\"language-text\">[insert name of gaming franchise]</code> release event, right?</p>\n<p>I’m pretty lucky to have worked as a freelancer journalist for various media outlets in Brazil, but since I moved to the Netherlands, I can’t go to these events anymore, since I have no media contacts here, and also don’t speak Dutch. One of the things I’ve already missed this year was the <a href=\"https://www.youtube.com/watch?v=rkeZx_wDLKs\" target=\"_blank\" rel=\"noreferrer\">The Last of Us release event in Amsterdam</a> and recently (just last week) the <a href=\"https://playsense.nl/558031/prijsvraag-ga-mee-naar-de-marvels-spider-man-2-launchparty/\" target=\"_blank\" rel=\"noreferrer\">Marvel Spider-Man 2 event in Hilversum</a>.</p>\n<p>Ok so now what? Well, I’ve decided to become an influencer, and I’ve started posting on Instagram, but I don’t really enjoy posting stuff on Instagram, I’d rather spend my time coding, and of course, becoming an Instagram celebrity these days is not an easy task, so I decided to automate some parts of it, after all, Meta provides an API that allows us to do many things, including posting Stories, Reels, or photos, so what could go wrong?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9AB4DGR8HJSENLiERNCAVOiAaQCAdRSAhSSAlTh0lTiIwVz9RcjM/ZBgcRRsaRCAYPiETNiENLx8HJR4DGQAeBB0gCyshEjUgFjsfHEMfIkofJ08dKlIcL1cbNFxZb5Bxgqt5jadjdJA3N1gbHUYcGD8iFDcgDCweBB4AHwYiIQ4wIRU5IBpBHyBJHidPHS1VIjtjKEVwO1qDX3qsYHeoTFmMVFFoOCA1UUheOC5MHBQ7Ig8xHwYkAB8HJCERMyAYPh8eRh4kTB4vVy1LdC5ReUFeiEd+tWir42mm2ExTky42Vyg5V08xOjgzUBsXPyIRNB8HJQAfCCYhEjYgG0IfIkkfL1Y3TnQ2U3sxXIZLirxHndVdrN5IbKkmOmxKfZ2Dm60tKEMaJ1EhHkUhFDgfCScAHwkoIRU6IB9GHSdNJj1sMlGCQGKWdqrhgL/yWK3kRIa1OnCXUomnc5u1QztTGTNXHi5VHyJJIRY8HwopACALKyEXPB8hSCUxVTFReCFMbV1ep7uB5cyb6naUyidljSxXfV1vkE0/VjJAVBg+Yh4xVh8mTCEZPiAMLAAhDjAhG0AdJ00cNVY/U3JAWn+Uc4P9gpzRbclKZqAjZIMmWX4bJEkwGS85VGoWRWYbOVodLFEgHUIhDzEAIh9BIjRWJkZlK118OEZmSGGBi7S39tKyzYS5Up24S5qtQHWVOk6DLSFCZ09TPnOMLWJ/J1BuIzhaISBDACY9XTNfeUZ/mz5cmDZHY02Bs06Lz2amynOuzlmdz2m20kZefjJDeiMjSjwcKFhkcEeIokF0jTJcdyU7WwAlMVIuTWw6Z4Q+aYY+ZoxUj7pqrc1UkclEeLlRispknsZdkbRKeKA7WoQtQms1R2gvTm8tR2gpPl4kLE2TfspoXO4w5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Instagram automation\"\n        title=\"Instagram automation\"\n        src=\"/static/275b237567c6ae515dbfdcf11f91ffc4/42a19/auto-post-instagram.png\"\n        srcset=\"/static/275b237567c6ae515dbfdcf11f91ffc4/e3135/auto-post-instagram.png 256w,\n/static/275b237567c6ae515dbfdcf11f91ffc4/06341/auto-post-instagram.png 512w,\n/static/275b237567c6ae515dbfdcf11f91ffc4/42a19/auto-post-instagram.png 1024w,\n/static/275b237567c6ae515dbfdcf11f91ffc4/e8464/auto-post-instagram.png 1536w,\n/static/275b237567c6ae515dbfdcf11f91ffc4/445c6/auto-post-instagram.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Instagram automation</figcaption>\n  </figure></p>\n<h2 id=\"the-instagram-api\" style=\"position:relative;\"><a href=\"#the-instagram-api\" aria-label=\"the instagram api permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Instagram API</h2>\n<p>Awesome, so we simply <code class=\"language-text\">npm install axios</code> and start posting on Instagram, right? Well… for some reason, you can’t upload videos to Instagram directly via the API, you need to provide an URL which then they will download your video from… like… what? I mean, <a href=\"https://www.dailymail.co.uk/news/article-3263921/What-mean-no-one-Mars-Scores-people-believe-blockbuster-movie-Martian-based-true-story.html\" target=\"_blank\" rel=\"noreferrer\">we’ve sent people to Mars</a>, but we can’t send a video to Instagram without a link?</p>\n<p>But fear not, I am here to help you solve this problem, my fellow developer. I’ve created a Node.js script that will allow you to post videos to Instagram, and I’ll explain how it works.</p>\n<h2 id=\"the-instagram-video-posting-dilemma\" style=\"position:relative;\"><a href=\"#the-instagram-video-posting-dilemma\" aria-label=\"the instagram video posting dilemma permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Instagram video posting dilemma</h2>\n<p>Before we dive deep, let’s get our tools ready. Install the necessary libraries:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> axios @ngrok/ngrok express fluent-ffmpeg ffmpeg-static</code></pre></div>\n<p>Now, let’s break down the code and understand the magic behind it.</p>\n<p>First, we need to set up our environment. We’re using <code class=\"language-text\">axios</code> for HTTP requests, <code class=\"language-text\">ngrok</code> to expose our local server to the world (because, you know, Instagram needs a link), and express to serve our video.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> ngrok <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@ngrok/ngrok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">GRAPH_API_VERSION</span> <span class=\"token operator\">=</span> <span class=\"token string\">'v18.0'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> expressApp <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, let’s get to the fun part. We need to upload our video to a container on Instagram. But remember, we’re not actually uploading the video. We’re just telling Instagram where to find it. So we need to create a container, and then upload the video to it.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">uploadReelsToContainer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span>\r\n  instagramAccountId<span class=\"token punctuation\">,</span>\r\n  caption<span class=\"token punctuation\">,</span>\r\n  videoUrl<span class=\"token punctuation\">,</span>\r\n  coverUrl</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.facebook.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">GRAPH_API_VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>instagramAccountId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/media</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">access_token</span><span class=\"token operator\">:</span> accessToken<span class=\"token punctuation\">,</span>\r\n      caption<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">media_type</span><span class=\"token operator\">:</span> <span class=\"token string\">'REELS'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">video_url</span><span class=\"token operator\">:</span> videoUrl<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">cover_url</span><span class=\"token operator\">:</span> coverUrl<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This code simply makes a <code class=\"language-text\">POST</code> request to the Instagram API to create a container and “upload” the video to it.</p>\n<p>The “upload” is in quotes because we’re not actually uploading the video, we’re just telling Instagram where to find it.</p>\n<p>Cool, but you must be thinking, “where do I get the <code class=\"language-text\">accessToken</code> and <code class=\"language-text\">instagramAccountId</code> from?” Well, you need to create a Facebook app, and then create an Instagram account, and then link your Instagram account to your Facebook app. You can find more information about this <a href=\"https://developers.facebook.com/docs/instagram-api/getting-started\" target=\"_blank\" rel=\"noreferrer\">here</a>. To be honest, this is the hardest part of the process, but once you get it working, you’re good to go.</p>\n<p>Ah, wait, you also want to know how to get the <code class=\"language-text\">videoUrl</code> and <code class=\"language-text\">coverUrl</code>, right? Patience, my sweet padawan, we’ll get there.</p>\n<p>After the container is created, we need to check its status. We need to wait until the video is fully downloaded by Instagram.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getStatusOfUpload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span> igContainerId</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.facebook.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">GRAPH_API_VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>igContainerId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">access_token</span><span class=\"token operator\">:</span> accessToken<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">fields</span><span class=\"token operator\">:</span> <span class=\"token string\">'status_code'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>status_code<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If the status is <code class=\"language-text\">FINISHED</code>, then we can proceed to the next step, which is finally publishing the video, or as Meta calls it: <code class=\"language-text\">media publishing</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">publishMediaContainer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span> instagramAccountId<span class=\"token punctuation\">,</span> creationId</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.facebook.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">GRAPH_API_VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>instagramAccountId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/media_publish</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">access_token</span><span class=\"token operator\">:</span> accessToken<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">creation_id</span><span class=\"token operator\">:</span> creationId <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And what is the point of posting it and getting all these weird IDs? What we actually want is the Instagram post URL, right? For that, we need to get the <code class=\"language-text\">permalink_url</code> from the response.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchPermalink</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span> mediaId</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.facebook.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">GRAPH_API_VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mediaId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">access_token</span><span class=\"token operator\">:</span> accessToken<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">fields</span><span class=\"token operator\">:</span> <span class=\"token string\">'permalink'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"lets-stitch-it-all-together\" style=\"position:relative;\"><a href=\"#lets-stitch-it-all-together\" aria-label=\"lets stitch it all together permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’s stitch it all together</h2>\n<p>I’ve been postponing this part for a while, but now it’s time to explain how to get the <code class=\"language-text\">videoUrl</code> and <code class=\"language-text\">coverUrl</code>, and this is where <code class=\"language-text\">ngrok</code> comes into play. We need to create a local <code class=\"language-text\">express</code> server that will serve our video and cover, and then expose it to the world using <code class=\"language-text\">ngrok</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">expressApp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\nexpressApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/video'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>videoFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nexpressApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/cover'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>thumbnailFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With this code, we will serve our video and cover on <code class=\"language-text\">http://localhost:3000/video</code> and <code class=\"language-text\">http://localhost:3000/cover</code>, respectively. The variables <code class=\"language-text\">videoFilePath</code> and <code class=\"language-text\">thumbnailFilePath</code> should contain a local path to the video and cover files.</p>\n<p>Now we’ll expose it to the world using <code class=\"language-text\">ngrok</code>. This will give us a URL that we can use to upload our video to Instagram.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> listener <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ngrok<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> listener<span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> videoUrl <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/video</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> coverUrl <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/cover</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And now putting it all together:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">postInstagramReel</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span>\r\n  pageId<span class=\"token punctuation\">,</span>\r\n  description<span class=\"token punctuation\">,</span>\r\n  thumbnailFilePath<span class=\"token punctuation\">,</span>\r\n  videoFilePath</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> expressApp <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  expressApp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  expressApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/video'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>videoFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  expressApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/cover'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>thumbnailFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> listener <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ngrok<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> listener<span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> containerId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">uploadReelsToContainer</span><span class=\"token punctuation\">(</span>\r\n    accessToken<span class=\"token punctuation\">,</span>\r\n    pageId<span class=\"token punctuation\">,</span>\r\n    description<span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/video</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/cover</span><span class=\"token template-punctuation string\">`</span></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">TWO_MINUTES</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> startTime <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>status <span class=\"token operator\">!==</span> <span class=\"token string\">'FINISHED'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> startTime <span class=\"token operator\">></span> <span class=\"token constant\">TWO_MINUTES</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">await</span> ngrok<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Upload took longer than 2 minutes.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    status <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getStatusOfUpload</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">,</span> containerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> creationId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">publishMediaContainer</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">,</span> pageId<span class=\"token punctuation\">,</span> containerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> permalink <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchPermalink</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">,</span> creationId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> ngrok<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> creationId<span class=\"token punctuation\">,</span> permalink <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This function will start the <code class=\"language-text\">express</code> server and set the <code class=\"language-text\">ngrok</code> URL. Then it will “upload” the video to Instagram, and wait until the video is fully downloaded. After that, it will publish the video and return the Instagram post URL.</p>\n<p>And that’s it! Now you can post videos to Instagram using Node.js. I hope you liked it.</p>\n<p>Wait, what? Ah… you want to know why I made you install <code class=\"language-text\">ffmpeg</code>? Ok sure, let’s talk about it.</p>\n<h2 id=\"making-sure-the-video-is-instagram-ready\" style=\"position:relative;\"><a href=\"#making-sure-the-video-is-instagram-ready\" aria-label=\"making sure the video is instagram ready permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Making sure the video is Instagram-ready</h2>\n<p>Everything is good and the code is nice and dandy, but there’s one more thing we need to do before we can post our video to Instagram. We need to make sure the video is in the right format. Instagram has some <a href=\"https://developers.facebook.com/docs/video-api/guides/publishing\" target=\"_blank\" rel=\"noreferrer\">requirements</a> for videos, and we need to make sure our video meets these requirements. For that, we’ll use <code class=\"language-text\">ffmpeg</code>.</p>\n<p>There are two very nice NPM packages that allow us to use <code class=\"language-text\">ffmpeg</code> in Node.js: <code class=\"language-text\">fluent-ffmpeg</code> and <code class=\"language-text\">ffmpeg-static</code>. The first one is a wrapper around <code class=\"language-text\">ffmpeg</code>, and the second one is a static build of <code class=\"language-text\">ffmpeg</code> that we can use in our code.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">processVideo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">inputPath<span class=\"token punctuation\">,</span> outputPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">ffmpeg</span><span class=\"token punctuation\">(</span>inputPath<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">toFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mp4'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1080x1920'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">aspect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'9:16'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">videoCodec</span><span class=\"token punctuation\">(</span><span class=\"token string\">'libx264'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">audioCodec</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aac'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">audioChannels</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">audioFrequency</span><span class=\"token punctuation\">(</span><span class=\"token number\">48000</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">audioBitrate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'128k'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Processing finished. Output saved to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error processing video: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>outputPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This code will make sure that the video is in the right format. It will convert the video to <code class=\"language-text\">mp4</code>, resize it to <code class=\"language-text\">1080x1920</code>, and make sure the aspect ratio is <code class=\"language-text\">9:16</code>. It will also make sure the video codec is <code class=\"language-text\">libx264</code>, and the audio codec is <code class=\"language-text\">aac</code>. It will also make sure the audio has 2 channels, a frequency of <code class=\"language-text\">48000</code>, and a bitrate of <code class=\"language-text\">128k</code>.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>And that’s it, with a little bit of code and trickery, we can now post videos to Instagram using Node.js. Was it worth the hours I’ve spent researching and coding this? Probably not, but I had fun, and I learned a lot, so I guess it was worth it then. Uhmn…</p>\n<p>Ah, and don’t forget to follow me on Instagram at <a href=\"https://www.instagram.com/thepiratepablo/\" target=\"_blank\" rel=\"noreferrer\">@thepiratepablo</a> and help me become an influencer. I promise I’ll post often. I’m just a bit lazy, but I’ll get there.</p>\n<p>I hope you liked it and that this was useful to you somehow. See you next time! Cheers!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEwLTE0VDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-10-14-posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations.en/","path":"/blog/coding/posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations/","locale":"en"},"rawMarkdownBody":"Hey guys! It's hard to be a geek these days, so many events are exclusive to media people and influencers - [even E3 was a trade-only show for many years](https://www.ign.com/articles/2017/02/08/e3-2017-open-to-the-public-tickets-on-sale-next-week). So let's say you're already happy with your job, and you don't really want to become a journalist, so your best bet is to become an influencer, and then maybe get invited to the next `[insert name of gaming franchise]` release event, right?\r\n\r\nI'm pretty lucky to have worked as a freelancer journalist for various media outlets in Brazil, but since I moved to the Netherlands, I can't go to these events anymore, since I have no media contacts here, and also don't speak Dutch. One of the things I've already missed this year was the [The Last of Us release event in Amsterdam](https://www.youtube.com/watch?v=rkeZx_wDLKs) and recently (just last week) the [Marvel Spider-Man 2 event in Hilversum](https://playsense.nl/558031/prijsvraag-ga-mee-naar-de-marvels-spider-man-2-launchparty/).\r\n\r\nOk so now what? Well, I've decided to become an influencer, and I've started posting on Instagram, but I don't really enjoy posting stuff on Instagram, I'd rather spend my time coding, and of course, becoming an Instagram celebrity these days is not an easy task, so I decided to automate some parts of it, after all, Meta provides an API that allows us to do many things, including posting Stories, Reels, or photos, so what could go wrong?\r\n\r\n![Instagram automation](../../uploads/blog/2023/10/auto-post-instagram.png)\r\n\r\n## The Instagram API\r\nAwesome, so we simply `npm install axios` and start posting on Instagram, right? Well... for some reason, you can't upload videos to Instagram directly via the API, you need to provide an URL which then they will download your video from... like... what? I mean, [we've sent people to Mars](https://www.dailymail.co.uk/news/article-3263921/What-mean-no-one-Mars-Scores-people-believe-blockbuster-movie-Martian-based-true-story.html), but we can't send a video to Instagram without a link?\r\n\r\nBut fear not, I am here to help you solve this problem, my fellow developer. I've created a Node.js script that will allow you to post videos to Instagram, and I'll explain how it works.\r\n\r\n## The Instagram video posting dilemma\r\nBefore we dive deep, let's get our tools ready. Install the necessary libraries:\r\n\r\n```bash\r\nnpm install axios @ngrok/ngrok express fluent-ffmpeg ffmpeg-static\r\n```\r\n\r\nNow, let's break down the code and understand the magic behind it.\r\n\r\nFirst, we need to set up our environment. We're using `axios` for HTTP requests, `ngrok` to expose our local server to the world (because, you know, Instagram needs a link), and express to serve our video.\r\n\r\n```javascript\r\nconst axios = require('axios');\r\nconst ngrok = require('@ngrok/ngrok');\r\nconst express = require('express');\r\n\r\nconst GRAPH_API_VERSION = 'v18.0';\r\nconst PORT = 3000;\r\nconst expressApp = express();\r\n```\r\n\r\nNow, let's get to the fun part. We need to upload our video to a container on Instagram. But remember, we're not actually uploading the video. We're just telling Instagram where to find it. So we need to create a container, and then upload the video to it.\r\n\r\n```javascript\r\nconst uploadReelsToContainer = async (\r\n  accessToken,\r\n  instagramAccountId,\r\n  caption,\r\n  videoUrl,\r\n  coverUrl\r\n) => {\r\n  const response = await axios.post(\r\n    `https://graph.facebook.com/${GRAPH_API_VERSION}/${instagramAccountId}/media`,\r\n    {\r\n      access_token: accessToken,\r\n      caption,\r\n      media_type: 'REELS',\r\n      video_url: videoUrl,\r\n      cover_url: coverUrl,\r\n    }\r\n  );\r\n\r\n  return response.data;\r\n};\r\n```\r\n\r\nThis code simply makes a `POST` request to the Instagram API to create a container and \"upload\" the video to it.\r\n\r\nThe \"upload\" is in quotes because we're not actually uploading the video, we're just telling Instagram where to find it.\r\n\r\nCool, but you must be thinking, \"where do I get the `accessToken` and `instagramAccountId` from?\" Well, you need to create a Facebook app, and then create an Instagram account, and then link your Instagram account to your Facebook app. You can find more information about this [here](https://developers.facebook.com/docs/instagram-api/getting-started). To be honest, this is the hardest part of the process, but once you get it working, you're good to go.\r\n\r\nAh, wait, you also want to know how to get the `videoUrl` and `coverUrl`, right? Patience, my sweet padawan, we'll get there.\r\n\r\nAfter the container is created, we need to check its status. We need to wait until the video is fully downloaded by Instagram.\r\n\r\n```javascript\r\nconst getStatusOfUpload = async (accessToken, igContainerId) => {\r\n  const response = await axios.get(\r\n    `https://graph.facebook.com/${GRAPH_API_VERSION}/${igContainerId}`,\r\n    { params: { access_token: accessToken, fields: 'status_code' } }\r\n  );\r\n\r\n  return response.data.status_code;\r\n};\r\n```\r\n\r\nIf the status is `FINISHED`, then we can proceed to the next step, which is finally publishing the video, or as Meta calls it: `media publishing`.\r\n\r\n```javascript\r\nconst publishMediaContainer = async (accessToken, instagramAccountId, creationId) => {\r\n  const response = await axios.post(\r\n    `https://graph.facebook.com/${GRAPH_API_VERSION}/${instagramAccountId}/media_publish`,\r\n    { access_token: accessToken, creation_id: creationId }\r\n  );\r\n\r\n  return response.data;\r\n};\r\n```\r\n\r\nAnd what is the point of posting it and getting all these weird IDs? What we actually want is the Instagram post URL, right? For that, we need to get the `permalink_url` from the response.\r\n\r\n```javascript\r\nconst fetchPermalink = async (accessToken, mediaId) => {\r\n  const response = await axios.get(\r\n    `https://graph.facebook.com/${GRAPH_API_VERSION}/${mediaId}`,\r\n    { params: { access_token: accessToken, fields: 'permalink' } }\r\n  );\r\n\r\n  return response.data;\r\n};\r\n```\r\n\r\n## Let's stitch it all together\r\nI've been postponing this part for a while, but now it's time to explain how to get the `videoUrl` and `coverUrl`, and this is where `ngrok` comes into play. We need to create a local `express` server that will serve our video and cover, and then expose it to the world using `ngrok`.\r\n\r\n```javascript\r\nexpressApp.listen(port);\r\n\r\nexpressApp.get('/video', (req, res) => res.sendFile(videoFilePath));\r\nexpressApp.get('/cover', (req, res) => res.sendFile(thumbnailFilePath));\r\n```\r\n\r\nWith this code, we will serve our video and cover on `http://localhost:3000/video` and `http://localhost:3000/cover`, respectively. The variables `videoFilePath` and `thumbnailFilePath` should contain a local path to the video and cover files.\r\n\r\nNow we'll expose it to the world using `ngrok`. This will give us a URL that we can use to upload our video to Instagram.\r\n\r\n```javascript\r\nconst listener = await ngrok.connect(port);\r\nconst url = listener.url();\r\n\r\nconst videoUrl = `${url}/video`;\r\nconst coverUrl = `${url}/cover`;\r\n```\r\n\r\nAnd now putting it all together:\r\n\r\n```javascript\r\nconst postInstagramReel = async (\r\n  accessToken,\r\n  pageId,\r\n  description,\r\n  thumbnailFilePath,\r\n  videoFilePath\r\n) => {\r\n  const expressApp = express();\r\n  expressApp.listen(PORT);\r\n\r\n  expressApp.get('/video', (req, res) => res.sendFile(videoFilePath));\r\n  expressApp.get('/cover', (req, res) => res.sendFile(thumbnailFilePath));\r\n\r\n  const listener = await ngrok.connect(PORT);\r\n  const url = listener.url();\r\n\r\n  const { id: containerId } = await uploadReelsToContainer(\r\n    accessToken,\r\n    pageId,\r\n    description,\r\n    `${url}/video`,\r\n    `${url}/cover`\r\n  );\r\n\r\n  let status = null;\r\n  const TWO_MINUTES = 2 * 60 * 1000;\r\n  const startTime = Date.now();\r\n\r\n  while (status !== 'FINISHED') {\r\n    if (Date.now() - startTime > TWO_MINUTES) {\r\n      await ngrok.disconnect();\r\n      throw new Error('Upload took longer than 2 minutes.');\r\n    }\r\n\r\n    status = await getStatusOfUpload(accessToken, containerId);\r\n    await new Promise((r) => setTimeout(r, 1000));\r\n  }\r\n\r\n  const { id: creationId } = await publishMediaContainer(accessToken, pageId, containerId);\r\n\r\n  const { permalink } = await fetchPermalink(accessToken, creationId);\r\n\r\n  await ngrok.disconnect();\r\n\r\n  return { creationId, permalink };\r\n};\r\n```\r\n\r\nThis function will start the `express` server and set the `ngrok` URL. Then it will \"upload\" the video to Instagram, and wait until the video is fully downloaded. After that, it will publish the video and return the Instagram post URL.\r\n\r\nAnd that's it! Now you can post videos to Instagram using Node.js. I hope you liked it. \r\n\r\nWait, what? Ah... you want to know why I made you install `ffmpeg`? Ok sure, let's talk about it.\r\n\r\n## Making sure the video is Instagram-ready\r\nEverything is good and the code is nice and dandy, but there's one more thing we need to do before we can post our video to Instagram. We need to make sure the video is in the right format. Instagram has some [requirements](https://developers.facebook.com/docs/video-api/guides/publishing) for videos, and we need to make sure our video meets these requirements. For that, we'll use `ffmpeg`.\r\n\r\nThere are two very nice NPM packages that allow us to use `ffmpeg` in Node.js: `fluent-ffmpeg` and `ffmpeg-static`. The first one is a wrapper around `ffmpeg`, and the second one is a static build of `ffmpeg` that we can use in our code.\r\n\r\n```javascript\r\nconst processVideo = (inputPath, outputPath) => {\r\n  return new Promise((resolve, reject) => {\r\n    ffmpeg(inputPath)\r\n      .toFormat('mp4')\r\n      .size('1080x1920')\r\n      .aspect('9:16')\r\n      .videoCodec('libx264')\r\n      .audioCodec('aac')\r\n      .audioChannels(2)\r\n      .audioFrequency(48000)\r\n      .audioBitrate('128k')\r\n      .on('end', () => resolve(`Processing finished. Output saved to ${outputPath}`))\r\n      .on('error', (err) => reject(new Error(`Error processing video: ${err.message}`)))\r\n      .save(outputPath);\r\n  });\r\n};\r\n```\r\n\r\nThis code will make sure that the video is in the right format. It will convert the video to `mp4`, resize it to `1080x1920`, and make sure the aspect ratio is `9:16`. It will also make sure the video codec is `libx264`, and the audio codec is `aac`. It will also make sure the audio has 2 channels, a frequency of `48000`, and a bitrate of `128k`.\r\n\r\n## Conclusion\r\nAnd that's it, with a little bit of code and trickery, we can now post videos to Instagram using Node.js. Was it worth the hours I've spent researching and coding this? Probably not, but I had fun, and I learned a lot, so I guess it was worth it then. Uhmn...\r\n\r\nAh, and don't forget to follow me on Instagram at [@thepiratepablo](https://www.instagram.com/thepiratepablo/) and help me become an influencer. I promise I'll post often. I'm just a bit lazy, but I'll get there.\r\n\r\nI hope you liked it and that this was useful to you somehow. See you next time! Cheers!","frontmatter":{"tags":["instagram","node","nodejs","javascript","axios","ngrok","ffmpeg","automation"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-10-14T00:00:00.000Z","id":null,"path":"posting-instagram-reels-using-nodejs-and-the-art-of-overcoming-limitations","show":true,"title":"Posting Instagram Reels using Node.js and the art of overcoming limitations","hideExcerpt":false,"subtitle":"After all, why spend 30 seconds doing something manually when you can spend 30 hours automating it?"}}},{"node":{"excerpt":"Fala aí, pessoal! É difícil ser nerd nos dias de hoje…","html":"<p>Fala aí, pessoal! É difícil ser nerd nos dias de hoje, tantos eventos são exclusivos para pessoas da mídia e influenceres - <a href=\"https://www.ign.com/articles/2017/02/08/e3-2017-open-to-the-public-tickets-on-sale-next-week\" target=\"_blank\" rel=\"noreferrer\">até a E3 foi um evento apenas para o comércio por muitos anos</a>. Então, digamos que você já esteja feliz com o seu trabalho e realmente não queira se tornar um jornalista. A sua melhor aposta é se tornar um influencer e talvez ser convidado para o próximo evento de lançamento do <code class=\"language-text\">[insira o nome da franquia de jogos]</code>, certo?</p>\n<p>Tenho muita sorte de ter trabalhado como jornalista freelancer para vários meios de comunicação no Brasil, mas desde que me mudei para a Holanda, não posso mais ir a esses eventos, pois não tenho contatos na mídia aqui e também não falo holandês. Uma das coisas que perdi este ano foi o <a href=\"https://www.youtube.com/watch?v=rkeZx_wDLKs\" target=\"_blank\" rel=\"noreferrer\">evento de lançamento de The Last of Us em Amsterdam</a> e recentemente (semana passada) o <a href=\"https://playsense.nl/558031/prijsvraag-ga-mee-naar-de-marvels-spider-man-2-launchparty/\" target=\"_blank\" rel=\"noreferrer\">evento de Marvel Spider-Man 2 em Hilversum</a>.</p>\n<p>Ok, e agora? Bem, decidi me tornar um influencer e comecei a postar no Instagram, mas realmente não gosto de postar coisas no Instagram. Prefiro passar o meu tempo programando e, claro, se tornar uma celebridade do Instagram hoje em dia não é uma tarefa fácil. Então decidi automatizar algumas partes disso, afinal, a Meta oferece uma API que nos permite fazer muitas coisas, incluindo postar Stories, Reels ou fotos. O que poderia dar errado?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqklEQVQozwGfAmD9AB4DGR8HJSENLiERNCAVOiAaQCAdRSAhSSAlTh0lTiIwVz9RcjM/ZBgcRRsaRCAYPiETNiENLx8HJR4DGQAeBB0gCyshEjUgFjsfHEMfIkofJ08dKlIcL1cbNFxZb5Bxgqt5jadjdJA3N1gbHUYcGD8iFDcgDCweBB4AHwYiIQ4wIRU5IBpBHyBJHidPHS1VIjtjKEVwO1qDX3qsYHeoTFmMVFFoOCA1UUheOC5MHBQ7Ig8xHwYkAB8HJCERMyAYPh8eRh4kTB4vVy1LdC5ReUFeiEd+tWir42mm2ExTky42Vyg5V08xOjgzUBsXPyIRNB8HJQAfCCYhEjYgG0IfIkkfL1Y3TnQ2U3sxXIZLirxHndVdrN5IbKkmOmxKfZ2Dm60tKEMaJ1EhHkUhFDgfCScAHwkoIRU6IB9GHSdNJj1sMlGCQGKWdqrhgL/yWK3kRIa1OnCXUomnc5u1QztTGTNXHi5VHyJJIRY8HwopACALKyEXPB8hSCUxVTFReCFMbV1ep7uB5cyb6naUyidljSxXfV1vkE0/VjJAVBg+Yh4xVh8mTCEZPiAMLAAhDjAhG0AdJ00cNVY/U3JAWn+Uc4P9gpzRbclKZqAjZIMmWX4bJEkwGS85VGoWRWYbOVodLFEgHUIhDzEAIh9BIjRWJkZlK118OEZmSGGBi7S39tKyzYS5Up24S5qtQHWVOk6DLSFCZ09TPnOMLWJ/J1BuIzhaISBDACY9XTNfeUZ/mz5cmDZHY02Bs06Lz2amynOuzlmdz2m20kZefjJDeiMjSjwcKFhkcEeIokF0jTJcdyU7WwAlMVIuTWw6Z4Q+aYY+ZoxUj7pqrc1UkclEeLlRispknsZdkbRKeKA7WoQtQms1R2gvTm8tR2gpPl4kLE2TfspoXO4w5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Automatização\"\n        title=\"Automatização\"\n        src=\"/static/275b237567c6ae515dbfdcf11f91ffc4/42a19/auto-post-instagram.png\"\n        srcset=\"/static/275b237567c6ae515dbfdcf11f91ffc4/e3135/auto-post-instagram.png 256w,\n/static/275b237567c6ae515dbfdcf11f91ffc4/06341/auto-post-instagram.png 512w,\n/static/275b237567c6ae515dbfdcf11f91ffc4/42a19/auto-post-instagram.png 1024w,\n/static/275b237567c6ae515dbfdcf11f91ffc4/e8464/auto-post-instagram.png 1536w,\n/static/275b237567c6ae515dbfdcf11f91ffc4/445c6/auto-post-instagram.png 1792w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Automatização</figcaption>\n  </figure></p>\n<h2 id=\"a-api-do-instagram\" style=\"position:relative;\"><a href=\"#a-api-do-instagram\" aria-label=\"a api do instagram permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A API do Instagram</h2>\n<p>Show, então simplesmente <code class=\"language-text\">npm install axios</code> e começamos a postar no Instagram, certo? Bem… por algum motivo, você não pode enviar vídeos para o Instagram diretamente via API, você precisa fornecer uma URL de onde eles baixarão o seu vídeo… tipo… sério? Quer dizer, <a href=\"https://www.dailymail.co.uk/news/article-3263921/What-mean-no-one-Mars-Scores-people-believe-blockbuster-movie-Martian-based-true-story.html\" target=\"_blank\" rel=\"noreferrer\">enviamos pessoas para Marte</a>, mas não podemos enviar um vídeo para o Instagram sem um link?</p>\n<p>Mas não tema, estou aqui para ajudá-lo a resolver esse problema, caro desenvolvedor. Criei um script Node.js que permitirá que você publique vídeos no Instagram, e vou explicar como funciona.</p>\n<h2 id=\"o-dilema-de-postar-video-no-instagram\" style=\"position:relative;\"><a href=\"#o-dilema-de-postar-video-no-instagram\" aria-label=\"o dilema de postar video no instagram permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O dilema de postar vídeo no Instagram</h2>\n<p>Antes de mergulharmos de cabeça, vamos preparar as nossas ferramentas. Instale as bibliotecas necessárias:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> axios @ngrok/ngrok express fluent-ffmpeg ffmpeg-static</code></pre></div>\n<p>Agora, vamos destrinchar o código e entender a mágica por trás dele.</p>\n<p>Primeiro, precisamos configurar o nosso ambiente. Estamos usando <code class=\"language-text\">axios</code> para solicitações HTTP, <code class=\"language-text\">ngrok</code> para expor o nosso servidor local ao mundo (porque, você sabe, o Instagram precisa de um link) e express para servir o nosso vídeo.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> ngrok <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@ngrok/ngrok'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">GRAPH_API_VERSION</span> <span class=\"token operator\">=</span> <span class=\"token string\">'v18.0'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> expressApp <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Este código simplesmente faz uma requisição <code class=\"language-text\">POST</code> para a API do Instagram para criar um container e “fazer o upload” do vídeo para ele.</p>\n<p>O termo “fazer o upload” está entre aspas porque nós não estamos realmente fazendo o upload do vídeo, nós estamos apenas dizendo ao Instagram onde encontrá-lo.</p>\n<p>Agora, vamos para a parte divertida. Precisamos enviar o nosso vídeo para um contêiner no Instagram. Mas lembre-se, não estamos realmente enviando o vídeo. Estamos apenas dizendo ao Instagram onde encontrá-lo. Então, precisamos criar um contêiner e depois enviar o vídeo para ele.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">uploadReelsToContainer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span>\r\n  instagramAccountId<span class=\"token punctuation\">,</span>\r\n  caption<span class=\"token punctuation\">,</span>\r\n  videoUrl<span class=\"token punctuation\">,</span>\r\n  coverUrl</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.facebook.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">GRAPH_API_VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>instagramAccountId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/media</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">access_token</span><span class=\"token operator\">:</span> accessToken<span class=\"token punctuation\">,</span>\r\n      caption<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">media_type</span><span class=\"token operator\">:</span> <span class=\"token string\">'REELS'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">video_url</span><span class=\"token operator\">:</span> videoUrl<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">cover_url</span><span class=\"token operator\">:</span> coverUrl<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Legal, mas você deve estar pensando, “de onde eu consigo o <code class=\"language-text\">accessToken</code> e <code class=\"language-text\">instagramAccountId</code>?” Bem, você precisa criar um aplicativo no Facebook e depois criar uma conta no Instagram e vincular a sua conta do Instagram ao seu aplicativo do Facebook. Você pode encontrar mais informações sobre isso <a href=\"https://developers.facebook.com/docs/instagram-api/getting-started\" target=\"_blank\" rel=\"noreferrer\">aqui</a>. Para ser honesto, esta é a parte mais difícil do processo, mas uma vez que você consiga fazer funcionar, está tudo certo.</p>\n<p>Ah, espere, você também quer saber como conseguir o <code class=\"language-text\">videoUrl</code> e <code class=\"language-text\">coverUrl</code>, certo? Paciência, meu doce padawan, chegaremos lá.</p>\n<p>Depois que o contêiner é criado, precisamos verificar o seu status. Precisamos esperar até que o vídeo seja totalmente baixado pelo Instagram.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getStatusOfUpload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span> igContainerId</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.facebook.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">GRAPH_API_VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>igContainerId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">access_token</span><span class=\"token operator\">:</span> accessToken<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">fields</span><span class=\"token operator\">:</span> <span class=\"token string\">'status_code'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>status_code<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Se o status for <code class=\"language-text\">FINISHED</code>, então podemos prosseguir para a próxima etapa, que é finalmente publicar o vídeo, ou como a Meta chama: <code class=\"language-text\">publicação de mídia</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">publishMediaContainer</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span> instagramAccountId<span class=\"token punctuation\">,</span> creationId</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.facebook.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">GRAPH_API_VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>instagramAccountId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/media_publish</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">access_token</span><span class=\"token operator\">:</span> accessToken<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">creation_id</span><span class=\"token operator\">:</span> creationId <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>E qual é o propósito de postar isso e obter todos esses IDs estranhos? O que realmente queremos é a URL da postagem do Instagram, certo? Para isso, precisamos obter o <code class=\"language-text\">permalink_url</code> da resposta.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchPermalink</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span> mediaId</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.facebook.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">GRAPH_API_VERSION</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>mediaId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">access_token</span><span class=\"token operator\">:</span> accessToken<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">fields</span><span class=\"token operator\">:</span> <span class=\"token string\">'permalink'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"vamos-ajuntar-tudo\" style=\"position:relative;\"><a href=\"#vamos-ajuntar-tudo\" aria-label=\"vamos ajuntar tudo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vamos “ajuntar” tudo</h2>\n<p>Eu tenho adiado essa parte por um tempo, mas agora é hora de explicar como obter o <code class=\"language-text\">videoUrl</code> e <code class=\"language-text\">coverUrl</code>, e é aqui que o <code class=\"language-text\">ngrok</code> entra em jogo. Precisamos criar um servidor local <code class=\"language-text\">express</code> que fornecerá o nosso vídeo e capa, e então expô-lo ao mundo usando <code class=\"language-text\">ngrok</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">expressApp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\nexpressApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/video'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>videoFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nexpressApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/cover'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>thumbnailFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Com este código, serviremos o nosso vídeo e capa em <code class=\"language-text\">http://localhost:3000/video</code> e <code class=\"language-text\">http://localhost:3000/cover</code>, respectivamente. As variáveis <code class=\"language-text\">videoFilePath</code> e <code class=\"language-text\">thumbnailFilePath</code> devem conter um caminho local para os arquivos de vídeo e capa.</p>\n<p>Agora vamos expor isso ao mundo usando <code class=\"language-text\">ngrok</code>. Isso nos dará uma URL que podemos usar para fazer upload do nosso vídeo no Instagram.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> listener <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ngrok<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> listener<span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> videoUrl <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/video</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> coverUrl <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/cover</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>E agora juntando tudo:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">postInstagramReel</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\">accessToken<span class=\"token punctuation\">,</span>\r\n  pageId<span class=\"token punctuation\">,</span>\r\n  description<span class=\"token punctuation\">,</span>\r\n  thumbnailFilePath<span class=\"token punctuation\">,</span>\r\n  videoFilePath</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> expressApp <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  expressApp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  expressApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/video'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>videoFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  expressApp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/cover'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>thumbnailFilePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> listener <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ngrok<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> listener<span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> containerId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">uploadReelsToContainer</span><span class=\"token punctuation\">(</span>\r\n    accessToken<span class=\"token punctuation\">,</span>\r\n    pageId<span class=\"token punctuation\">,</span>\r\n    description<span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/video</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/cover</span><span class=\"token template-punctuation string\">`</span></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">TWO_MINUTES</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> startTime <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>status <span class=\"token operator\">!==</span> <span class=\"token string\">'FINISHED'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> startTime <span class=\"token operator\">></span> <span class=\"token constant\">TWO_MINUTES</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">await</span> ngrok<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Upload took longer than 2 minutes.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    status <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getStatusOfUpload</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">,</span> containerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> creationId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">publishMediaContainer</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">,</span> pageId<span class=\"token punctuation\">,</span> containerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> permalink <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchPermalink</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">,</span> creationId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">await</span> ngrok<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> creationId<span class=\"token punctuation\">,</span> permalink <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Esta função iniciará o servidor do <code class=\"language-text\">express</code> e definirá a URL do <code class=\"language-text\">ngrok</code>. Em seguida, ele “fará o upload” do vídeo para o Instagram e aguardará até que o vídeo seja totalmente baixado. Depois disso, ele publicará o vídeo e retornará a URL da postagem do Instagram.</p>\n<p>E é isso! Agora você pode postar vídeos no Instagram usando Node.js. Espero que tenha gostado.</p>\n<p>Espere, o quê? Ah… você quer saber por que fiz você instalar o <code class=\"language-text\">ffmpeg</code>? Ok, vamos falar sobre isso.</p>\n<h2 id=\"garantindo-que-o-video-esteja-pronto-para-o-instagram\" style=\"position:relative;\"><a href=\"#garantindo-que-o-video-esteja-pronto-para-o-instagram\" aria-label=\"garantindo que o video esteja pronto para o instagram permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Garantindo que o vídeo esteja pronto para o Instagram</h2>\n<p>Tudo está bom e o código está bonito e elegante, mas há mais uma coisa que precisamos fazer antes de postar nosso vídeo no Instagram. Precisamos garantir que o vídeo esteja no formato correto. O Instagram tem alguns <a href=\"https://developers.facebook.com/docs/video-api/guides/publishing\" target=\"_blank\" rel=\"noreferrer\">requisitos</a> para vídeos, e precisamos garantir que nosso vídeo atenda a esses requisitos. Para isso, usaremos o <code class=\"language-text\">ffmpeg</code>.</p>\n<p>Existem dois pacotes do NPM ótimos que nos permitem usar o <code class=\"language-text\">ffmpeg</code> no Node.js: <code class=\"language-text\">fluent-ffmpeg</code> e <code class=\"language-text\">ffmpeg-static</code>. O primeiro é um wrapper em torno do <code class=\"language-text\">ffmpeg</code>, e o segundo é uma compilação estática do <code class=\"language-text\">ffmpeg</code> que podemos usar no nosso código.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">processVideo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">inputPath<span class=\"token punctuation\">,</span> outputPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">ffmpeg</span><span class=\"token punctuation\">(</span>inputPath<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">toFormat</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mp4'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1080x1920'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">aspect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'9:16'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">videoCodec</span><span class=\"token punctuation\">(</span><span class=\"token string\">'libx264'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">audioCodec</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aac'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">audioChannels</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">audioFrequency</span><span class=\"token punctuation\">(</span><span class=\"token number\">48000</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">audioBitrate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'128k'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Processing finished. Output saved to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>outputPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Error processing video: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token punctuation\">.</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>outputPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Este código garantirá que o vídeo esteja no formato correto. Ele converterá o vídeo para <code class=\"language-text\">mp4</code>, redimensionará para <code class=\"language-text\">1080x1920</code> e garantirá que a proporção seja <code class=\"language-text\">9:16</code>. Também garantirá que o codec de vídeo seja <code class=\"language-text\">libx264</code> e que o codec de áudio seja <code class=\"language-text\">aac</code>. Além disso, garantirá que o áudio tenha 2 canais, uma frequência de <code class=\"language-text\">48000</code> e uma taxa de bits de <code class=\"language-text\">128k</code>.</p>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>E é isso, com um pouco de código e astúcia, agora podemos postar vídeos no Instagram usando Node.js. Valeu a pena as horas que passei pesquisando e codificando isso? Provavelmente não, mas me diverti e aprendi muito, então acho que valeu a pena. Uhmn…</p>\n<p>Ah, e não se esqueça de me seguir no Instagram em <a href=\"https://www.instagram.com/opablopirata/\" target=\"_blank\" rel=\"noreferrer\">@opablopirata</a> e me ajude a me tornar um influencer. Eu prometo que vou postar com frequência. Eu sou apenas um pouco preguiçoso, mas vou chegar lá.</p>\n<p>Espero que tenha gostado e que isso tenha sido útil para você de alguma forma. Até a próxima! Saúde!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTEwLTE0VDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-10-14-publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes.pt-br/","path":"/blog/coding/publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes/","locale":"pt-br"},"rawMarkdownBody":"Fala aí, pessoal! É difícil ser nerd nos dias de hoje, tantos eventos são exclusivos para pessoas da mídia e influenceres - [até a E3 foi um evento apenas para o comércio por muitos anos](https://www.ign.com/articles/2017/02/08/e3-2017-open-to-the-public-tickets-on-sale-next-week). Então, digamos que você já esteja feliz com o seu trabalho e realmente não queira se tornar um jornalista. A sua melhor aposta é se tornar um influencer e talvez ser convidado para o próximo evento de lançamento do `[insira o nome da franquia de jogos]`, certo?\r\n\r\nTenho muita sorte de ter trabalhado como jornalista freelancer para vários meios de comunicação no Brasil, mas desde que me mudei para a Holanda, não posso mais ir a esses eventos, pois não tenho contatos na mídia aqui e também não falo holandês. Uma das coisas que perdi este ano foi o [evento de lançamento de The Last of Us em Amsterdam](https://www.youtube.com/watch?v=rkeZx_wDLKs) e recentemente (semana passada) o [evento de Marvel Spider-Man 2 em Hilversum](https://playsense.nl/558031/prijsvraag-ga-mee-naar-de-marvels-spider-man-2-launchparty/).\r\n\r\nOk, e agora? Bem, decidi me tornar um influencer e comecei a postar no Instagram, mas realmente não gosto de postar coisas no Instagram. Prefiro passar o meu tempo programando e, claro, se tornar uma celebridade do Instagram hoje em dia não é uma tarefa fácil. Então decidi automatizar algumas partes disso, afinal, a Meta oferece uma API que nos permite fazer muitas coisas, incluindo postar Stories, Reels ou fotos. O que poderia dar errado?\r\n\r\n![Automatização](../../uploads/blog/2023/10/auto-post-instagram.png)\r\n\r\n## A API do Instagram\r\nShow, então simplesmente `npm install axios` e começamos a postar no Instagram, certo? Bem... por algum motivo, você não pode enviar vídeos para o Instagram diretamente via API, você precisa fornecer uma URL de onde eles baixarão o seu vídeo... tipo... sério? Quer dizer, [enviamos pessoas para Marte](https://www.dailymail.co.uk/news/article-3263921/What-mean-no-one-Mars-Scores-people-believe-blockbuster-movie-Martian-based-true-story.html), mas não podemos enviar um vídeo para o Instagram sem um link?\r\n\r\nMas não tema, estou aqui para ajudá-lo a resolver esse problema, caro desenvolvedor. Criei um script Node.js que permitirá que você publique vídeos no Instagram, e vou explicar como funciona.\r\n\r\n## O dilema de postar vídeo no Instagram\r\nAntes de mergulharmos de cabeça, vamos preparar as nossas ferramentas. Instale as bibliotecas necessárias:\r\n\r\n```bash\r\nnpm install axios @ngrok/ngrok express fluent-ffmpeg ffmpeg-static\r\n```\r\n\r\nAgora, vamos destrinchar o código e entender a mágica por trás dele.\r\n\r\nPrimeiro, precisamos configurar o nosso ambiente. Estamos usando `axios` para solicitações HTTP, `ngrok` para expor o nosso servidor local ao mundo (porque, você sabe, o Instagram precisa de um link) e express para servir o nosso vídeo.\r\n\r\n```javascript\r\nconst axios = require('axios');\r\nconst ngrok = require('@ngrok/ngrok');\r\nconst express = require('express');\r\n\r\nconst GRAPH_API_VERSION = 'v18.0';\r\nconst PORT = 3000;\r\nconst expressApp = express();\r\n```\r\n\r\nEste código simplesmente faz uma requisição `POST` para a API do Instagram para criar um container e \"fazer o upload\" do vídeo para ele.\r\n\r\nO termo \"fazer o upload\" está entre aspas porque nós não estamos realmente fazendo o upload do vídeo, nós estamos apenas dizendo ao Instagram onde encontrá-lo.\r\n\r\nAgora, vamos para a parte divertida. Precisamos enviar o nosso vídeo para um contêiner no Instagram. Mas lembre-se, não estamos realmente enviando o vídeo. Estamos apenas dizendo ao Instagram onde encontrá-lo. Então, precisamos criar um contêiner e depois enviar o vídeo para ele.\r\n\r\n```javascript\r\nconst uploadReelsToContainer = async (\r\n  accessToken,\r\n  instagramAccountId,\r\n  caption,\r\n  videoUrl,\r\n  coverUrl\r\n) => {\r\n  const response = await axios.post(\r\n    `https://graph.facebook.com/${GRAPH_API_VERSION}/${instagramAccountId}/media`,\r\n    {\r\n      access_token: accessToken,\r\n      caption,\r\n      media_type: 'REELS',\r\n      video_url: videoUrl,\r\n      cover_url: coverUrl,\r\n    }\r\n  );\r\n\r\n  return response.data;\r\n};\r\n```\r\n\r\nLegal, mas você deve estar pensando, \"de onde eu consigo o `accessToken` e `instagramAccountId`?\" Bem, você precisa criar um aplicativo no Facebook e depois criar uma conta no Instagram e vincular a sua conta do Instagram ao seu aplicativo do Facebook. Você pode encontrar mais informações sobre isso [aqui](https://developers.facebook.com/docs/instagram-api/getting-started). Para ser honesto, esta é a parte mais difícil do processo, mas uma vez que você consiga fazer funcionar, está tudo certo.\r\n\r\nAh, espere, você também quer saber como conseguir o `videoUrl` e `coverUrl`, certo? Paciência, meu doce padawan, chegaremos lá.\r\n\r\nDepois que o contêiner é criado, precisamos verificar o seu status. Precisamos esperar até que o vídeo seja totalmente baixado pelo Instagram.\r\n\r\n```javascript\r\nconst getStatusOfUpload = async (accessToken, igContainerId) => {\r\n  const response = await axios.get(\r\n    `https://graph.facebook.com/${GRAPH_API_VERSION}/${igContainerId}`,\r\n    { params: { access_token: accessToken, fields: 'status_code' } }\r\n  );\r\n\r\n  return response.data.status_code;\r\n};\r\n```\r\n\r\nSe o status for `FINISHED`, então podemos prosseguir para a próxima etapa, que é finalmente publicar o vídeo, ou como a Meta chama: `publicação de mídia`.\r\n\r\n```javascript\r\nconst publishMediaContainer = async (accessToken, instagramAccountId, creationId) => {\r\n  const response = await axios.post(\r\n    `https://graph.facebook.com/${GRAPH_API_VERSION}/${instagramAccountId}/media_publish`,\r\n    { access_token: accessToken, creation_id: creationId }\r\n  );\r\n\r\n  return response.data;\r\n};\r\n```\r\n\r\nE qual é o propósito de postar isso e obter todos esses IDs estranhos? O que realmente queremos é a URL da postagem do Instagram, certo? Para isso, precisamos obter o `permalink_url` da resposta.\r\n\r\n```javascript\r\nconst fetchPermalink = async (accessToken, mediaId) => {\r\n  const response = await axios.get(\r\n    `https://graph.facebook.com/${GRAPH_API_VERSION}/${mediaId}`,\r\n    { params: { access_token: accessToken, fields: 'permalink' } }\r\n  );\r\n\r\n  return response.data;\r\n};\r\n```\r\n\r\n## Vamos \"ajuntar\" tudo\r\nEu tenho adiado essa parte por um tempo, mas agora é hora de explicar como obter o `videoUrl` e `coverUrl`, e é aqui que o `ngrok` entra em jogo. Precisamos criar um servidor local `express` que fornecerá o nosso vídeo e capa, e então expô-lo ao mundo usando `ngrok`.\r\n\r\n```javascript\r\nexpressApp.listen(port);\r\n\r\nexpressApp.get('/video', (req, res) => res.sendFile(videoFilePath));\r\nexpressApp.get('/cover', (req, res) => res.sendFile(thumbnailFilePath));\r\n```\r\n\r\nCom este código, serviremos o nosso vídeo e capa em `http://localhost:3000/video` e `http://localhost:3000/cover`, respectivamente. As variáveis `videoFilePath` e `thumbnailFilePath` devem conter um caminho local para os arquivos de vídeo e capa.\r\n\r\nAgora vamos expor isso ao mundo usando `ngrok`. Isso nos dará uma URL que podemos usar para fazer upload do nosso vídeo no Instagram.\r\n\r\n```javascript\r\nconst listener = await ngrok.connect(port);\r\nconst url = listener.url();\r\n\r\nconst videoUrl = `${url}/video`;\r\nconst coverUrl = `${url}/cover`;\r\n```\r\n\r\nE agora juntando tudo:\r\n\r\n```javascript\r\nconst postInstagramReel = async (\r\n  accessToken,\r\n  pageId,\r\n  description,\r\n  thumbnailFilePath,\r\n  videoFilePath\r\n) => {\r\n  const expressApp = express();\r\n  expressApp.listen(PORT);\r\n\r\n  expressApp.get('/video', (req, res) => res.sendFile(videoFilePath));\r\n  expressApp.get('/cover', (req, res) => res.sendFile(thumbnailFilePath));\r\n\r\n  const listener = await ngrok.connect(PORT);\r\n  const url = listener.url();\r\n\r\n  const { id: containerId } = await uploadReelsToContainer(\r\n    accessToken,\r\n    pageId,\r\n    description,\r\n    `${url}/video`,\r\n    `${url}/cover`\r\n  );\r\n\r\n  let status = null;\r\n  const TWO_MINUTES = 2 * 60 * 1000;\r\n  const startTime = Date.now();\r\n\r\n  while (status !== 'FINISHED') {\r\n    if (Date.now() - startTime > TWO_MINUTES) {\r\n      await ngrok.disconnect();\r\n      throw new Error('Upload took longer than 2 minutes.');\r\n    }\r\n\r\n    status = await getStatusOfUpload(accessToken, containerId);\r\n    await new Promise((r) => setTimeout(r, 1000));\r\n  }\r\n\r\n  const { id: creationId } = await publishMediaContainer(accessToken, pageId, containerId);\r\n\r\n  const { permalink } = await fetchPermalink(accessToken, creationId);\r\n\r\n  await ngrok.disconnect();\r\n\r\n  return { creationId, permalink };\r\n};\r\n```\r\n\r\nEsta função iniciará o servidor do `express` e definirá a URL do `ngrok`. Em seguida, ele \"fará o upload\" do vídeo para o Instagram e aguardará até que o vídeo seja totalmente baixado. Depois disso, ele publicará o vídeo e retornará a URL da postagem do Instagram.\r\n\r\nE é isso! Agora você pode postar vídeos no Instagram usando Node.js. Espero que tenha gostado.\r\n\r\nEspere, o quê? Ah... você quer saber por que fiz você instalar o `ffmpeg`? Ok, vamos falar sobre isso.\r\n\r\n## Garantindo que o vídeo esteja pronto para o Instagram\r\nTudo está bom e o código está bonito e elegante, mas há mais uma coisa que precisamos fazer antes de postar nosso vídeo no Instagram. Precisamos garantir que o vídeo esteja no formato correto. O Instagram tem alguns [requisitos](https://developers.facebook.com/docs/video-api/guides/publishing) para vídeos, e precisamos garantir que nosso vídeo atenda a esses requisitos. Para isso, usaremos o `ffmpeg`.\r\n\r\nExistem dois pacotes do NPM ótimos que nos permitem usar o `ffmpeg` no Node.js: `fluent-ffmpeg` e `ffmpeg-static`. O primeiro é um wrapper em torno do `ffmpeg`, e o segundo é uma compilação estática do `ffmpeg` que podemos usar no nosso código.\r\n\r\n```javascript\r\nconst processVideo = (inputPath, outputPath) => {\r\n  return new Promise((resolve, reject) => {\r\n    ffmpeg(inputPath)\r\n      .toFormat('mp4')\r\n      .size('1080x1920')\r\n      .aspect('9:16')\r\n      .videoCodec('libx264')\r\n      .audioCodec('aac')\r\n      .audioChannels(2)\r\n      .audioFrequency(48000)\r\n      .audioBitrate('128k')\r\n      .on('end', () => resolve(`Processing finished. Output saved to ${outputPath}`))\r\n      .on('error', (err) => reject(new Error(`Error processing video: ${err.message}`)))\r\n      .save(outputPath);\r\n  });\r\n};\r\n```\r\n\r\nEste código garantirá que o vídeo esteja no formato correto. Ele converterá o vídeo para `mp4`, redimensionará para `1080x1920` e garantirá que a proporção seja `9:16`. Também garantirá que o codec de vídeo seja `libx264` e que o codec de áudio seja `aac`. Além disso, garantirá que o áudio tenha 2 canais, uma frequência de `48000` e uma taxa de bits de `128k`.\r\n\r\n## Conclusão\r\nE é isso, com um pouco de código e astúcia, agora podemos postar vídeos no Instagram usando Node.js. Valeu a pena as horas que passei pesquisando e codificando isso? Provavelmente não, mas me diverti e aprendi muito, então acho que valeu a pena. Uhmn...\r\n\r\nAh, e não se esqueça de me seguir no Instagram em [@opablopirata](https://www.instagram.com/opablopirata/) e me ajude a me tornar um influencer. Eu prometo que vou postar com frequência. Eu sou apenas um pouco preguiçoso, mas vou chegar lá.\r\n\r\n\r\nEspero que tenha gostado e que isso tenha sido útil para você de alguma forma. Até a próxima! Saúde!\r\n","frontmatter":{"tags":["instagram","node","nodejs","javascript","axios","ngrok","ffmpeg","automação"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-10-14T00:00:00.000Z","id":null,"path":"publicando-reels-no-instagram-usando-nodejs-e-a-arte-de-superar-limitacoes","show":true,"title":"Publicando Reels no Instagram usando Node.js e a arte de superar limitações","hideExcerpt":false,"subtitle":"Afinal, por que gastar 30 segundos fazendo algo manualmente quando você pode gastar 30 horas automatizando-o?"}}},{"node":{"excerpt":"Num mundo dominado por plataformas de mídia social, onde…","html":"<p>Num mundo dominado por plataformas de mídia social, onde Stories se tornaram um recurso omnipresente, eu me peguei pensando - o meu blog realmente precisa de Stories? A resposta, claro, é um sonoro “não, né?“. Mas aqui estamos, o meu blog agora tem Stories, e eu não tenho totalmente certeza do porquê.</p>\n<p><img src=\"/4cdd7b249c219b923c1baef9632ccdbc/stories-on-my-blog.gif\" alt=\"Stories\"></p>\n<h2 id=\"o-nascimento-de-uma-ideia-desnecessaria\" style=\"position:relative;\"><a href=\"#o-nascimento-de-uma-ideia-desnecessaria\" aria-label=\"o nascimento de uma ideia desnecessaria permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O nascimento de uma ideia desnecessária</h2>\n<p>Tudo começou quando eu estava usando o aplicativo do meu provedor de internet para celular e, para minha surpresa, eles haviam adicionado Stories no aplicativo deles. Isso foi simplesmente demais para mim. Uma mistura de alegria, admiração e confusão me dominou. Quer dizer, por que um aplicativo de provedor de internet precisaria de Stories? Foi nesse momento que decidi, se eles podem fazer, por que eu não posso? E assim, a jornada começou.</p>\n<p>Naturalmente, como um desenvolvedor com uma inclinação para o absurdo, abri o meu editor de código e comecei a programar, e o meu objetivo era adicionar Stories ao meu blog. A razão por trás disso? Me pergunte semana que vem.</p>\n<h2 id=\"a-jornada-tecnica\" style=\"position:relative;\"><a href=\"#a-jornada-tecnica\" aria-label=\"a jornada tecnica permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A jornada técnica</h2>\n<p>O processo de adicionar Stories ao meu blog foi surpreendentemente simples, graças ao poder do <del>comunismo</del> código aberto. Ferramentas e bibliotecas de código aberto são uma bênção para os desenvolvedores. Elas economizam tempo, esforço e muitas vezes levam a soluções melhores do que as que poderíamos criar sozinhos. Após um pouco de pesquisa, eu me deparei com um pacote fantástico que parecia ser a resposta para todas as minhas orações - <a href=\"https://www.npmjs.com/package/react-insta-stories\" target=\"_blank\" rel=\"noreferrer\">react-insta-stories</a>. Este pacote é projetado para criar Stories estilo Instagram no React, que era exatamente o que eu estava procurando.</p>\n<p>O pacote <code class=\"language-text\">react-insta-stories</code> é incrivelmente versátil e personalizável. Ele permite que você crie stories com imagens, vídeos e até componentes personalizados. Você pode personalizar a duração de cada Story, adicionar botões de ação e muito mais. Era quase bom demais para ser verdade. Com este pacote, consegui adicionar Stories ao meu blog em pouco tempo e com o mínimo de esforço.</p>\n<h2 id=\"decidindo-o-que-mostrar-nos-stories\" style=\"position:relative;\"><a href=\"#decidindo-o-que-mostrar-nos-stories\" aria-label=\"decidindo o que mostrar nos stories permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Decidindo o que mostrar nos Stories</h2>\n<p>Inicialmente, pensei em criar vídeos personalizados usando fundos padrão de sites de “stock videos”. Cheguei até a criar um script usando FFmpeg e Node.js para automatizar o processo. No entanto, após alguma consideração, decidi abandonar essa ideia. Para a primeira iteração, decidi criar um Story para cada um dos últimos cinco posts do meu blog.</p>\n<p>Para o conteúdo dos Stories, decidi mantê-lo simples. Eu decidi usar uma “stock photo” relacionada à categoria do post do blog, sobreporia o título do post do blog e incluiria um link para acessá-lo. Dessa forma, os Stories não serviriam apenas como um teaser visual, mas também como um portal funcional para o conteúdo completo do post do blog.</p>\n<p>Para torná-lo mais organizado, agrupei esses Stories pela categoria do post do blog. Por exemplo, se dos últimos cinco posts do blog, três estavam na categoria “programação” e dois na categoria “jogos”, eu exibiria duas prévias de Stories diferentes - aqueles pequenos círculos de imagem que você clica para ver os Stories. Então, “dentro” de cada um desses círculos agrupados, você clicaria e veria esses Stories.</p>\n<p>Essa abordagem parecia mais gerenciável e, vamos ser honestos, exigia menos esforço da minha parte. Também proporcionava uma maneira dos visitantes se atualizarem rapidamente sobre os meus últimos posts de uma maneira mais interativa e envolvente. Não que eu esteja particularmente preocupado com a retenção ou engajamento dos visitantes. Estou apenas adicionando esse recurso porque, bem, por que não?</p>\n<h2 id=\"partiu-programar\" style=\"position:relative;\"><a href=\"#partiu-programar\" aria-label=\"partiu programar permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Partiu programar</h2>\n<p>Após a decisão (meio que no “ah, por que não, né”), era hora de mergulhar de cabeça no mundo da programação. Aqui vai um resumo dos passos que segui, ou melhor, do buraco de coelho que me enfiei:</p>\n<ol>\n<li><strong>Criando o componente StoriesPreview</strong>: Este componente é responsável por exibir a pré-visualização dos Stories na página principal do blog.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> useStyles <span class=\"token operator\">=</span> <span class=\"token function\">makeStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">theme</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">circleImage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">borderRadius</span><span class=\"token operator\">:</span> <span class=\"token string\">'50%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">cursor</span><span class=\"token operator\">:</span> <span class=\"token string\">'pointer'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">objectFit</span><span class=\"token operator\">:</span> <span class=\"token string\">'cover'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">marginLeft</span><span class=\"token operator\">:</span> <span class=\"token string\">'5px'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'relative'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">storyImage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">objectFit</span><span class=\"token operator\">:</span> <span class=\"token string\">'cover'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">objectPosition</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">storiesWrapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'15px 0'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">previewWrapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'15px 0'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">StoriesPreview</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>\r\n    graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\r\n      query {\r\n        allMarkdownRemark(\r\n          filter: { frontmatter: { show: { eq: true } } }\r\n          sort: { fields: [frontmatter___date], order: DESC }\r\n          limit: 10\r\n        ) {\r\n          edges {\r\n            node {\r\n              excerpt(pruneLength: 60)\r\n              fields {\r\n                path\r\n                locale\r\n                postHashId\r\n              }\r\n              frontmatter {\r\n                title\r\n                categories\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    </span><span class=\"token template-punctuation string\">`</span></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> intl <span class=\"token operator\">=</span> <span class=\"token function\">useIntl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>locale <span class=\"token operator\">===</span> intl<span class=\"token punctuation\">.</span>locale<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> classes <span class=\"token operator\">=</span> <span class=\"token function\">useStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>showModal<span class=\"token punctuation\">,</span> setShowModal<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">,</span> setCurrentStoriesIndex<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>seenStories<span class=\"token punctuation\">,</span> setSeenStories<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'seenStories'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>tempSeenStories<span class=\"token punctuation\">,</span> setTempSeenStories<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> stories <span class=\"token operator\">=</span> <span class=\"token function\">useStories</span><span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">,</span> seenStories<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> onStoryEnd <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">currentStoriesIndex<span class=\"token punctuation\">,</span> currentStoryIndex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> newTempSeenStories <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\r\n        <span class=\"token operator\">...</span>tempSeenStories<span class=\"token punctuation\">,</span>\r\n        stories<span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>currentStoryIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>postHashId<span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">setTempSeenStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>newTempSeenStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">[</span>tempSeenStories<span class=\"token punctuation\">,</span> stories<span class=\"token punctuation\">]</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleImageClick <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">setCurrentStoriesIndex</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">setShowModal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleCloseModal <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">setShowModal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> newSeenStories <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>seenStories<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>tempSeenStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">setSeenStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>newSeenStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">setTempSeenStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>seenStories<span class=\"token punctuation\">,</span> setSeenStories<span class=\"token punctuation\">,</span> tempSeenStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleNextStories <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currentStoriesIndex <span class=\"token operator\">&lt;</span> stories<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">setCurrentStoriesIndex</span><span class=\"token punctuation\">(</span>currentStoriesIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">handleCloseModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">,</span> handleCloseModal<span class=\"token punctuation\">,</span> stories<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handlePreviousStories <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currentStoriesIndex <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">setCurrentStoriesIndex</span><span class=\"token punctuation\">(</span>currentStoriesIndex <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">handleCloseModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">,</span> handleCloseModal<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleOnAllStoriesEnd <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">handleNextStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>handleNextStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>storiesWrapper<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>previewWrapper<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">{</span>stories<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">storiesArray<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n            <span class=\"token operator\">&lt;</span>StoryImage\r\n              key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span>\r\n              category<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>storiesArray<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>category<span class=\"token punctuation\">}</span>\r\n              previewImage<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>storiesArray<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>previewImage<span class=\"token punctuation\">}</span>\r\n              unseen<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">isClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> storiesArray<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">story</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>story<span class=\"token punctuation\">.</span>viewed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n              onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">handleImageClick</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>Divider <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token punctuation\">{</span>showModal <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>StoryModal\r\n          stories<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>stories<span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\r\n          onClose<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleCloseModal<span class=\"token punctuation\">}</span>\r\n          onPrevious<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handlePreviousStories<span class=\"token punctuation\">}</span>\r\n          onNext<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleNextStories<span class=\"token punctuation\">}</span>\r\n          showPrevious<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentStoriesIndex <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span>\r\n          showNext<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentStoriesIndex <span class=\"token operator\">&lt;</span> stories<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span>\r\n          currentStoriesIndex<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentStoriesIndex<span class=\"token punctuation\">}</span>\r\n          onAllStoriesEnd<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleOnAllStoriesEnd<span class=\"token punctuation\">}</span>\r\n          onStoryEnd<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">currentStoryIndex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">onStoryEnd</span><span class=\"token punctuation\">(</span>currentStoriesIndex<span class=\"token punctuation\">,</span> currentStoryIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n          onStoryStart<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">currentStoryIndex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">onStoryEnd</span><span class=\"token punctuation\">(</span>currentStoriesIndex<span class=\"token punctuation\">,</span> currentStoryIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"2\">\n<li><strong>Criando o componente StoryImage</strong>: Este componente é responsável por exibir a imagem do Story.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> useStyles <span class=\"token operator\">=</span> <span class=\"token function\">makeStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">theme</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token function-variable function\">circleImage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> unseen <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">borderRadius</span><span class=\"token operator\">:</span> <span class=\"token string\">'50%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">cursor</span><span class=\"token operator\">:</span> <span class=\"token string\">'pointer'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">objectFit</span><span class=\"token operator\">:</span> <span class=\"token string\">'cover'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">marginLeft</span><span class=\"token operator\">:</span> <span class=\"token string\">'5px'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'relative'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">(</span>unseen\r\n      <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span>palette<span class=\"token punctuation\">.</span>secondary<span class=\"token punctuation\">.</span>main<span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">StoryImage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> category<span class=\"token punctuation\">,</span> previewImage<span class=\"token punctuation\">,</span> unseen<span class=\"token punctuation\">,</span> onClick <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> classes <span class=\"token operator\">=</span> <span class=\"token function\">useStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> unseen <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token comment\">// eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions</span>\r\n    <span class=\"token operator\">&lt;</span>img alt<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>category<span class=\"token punctuation\">}</span> src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>previewImage<span class=\"token punctuation\">}</span> className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>circleImage<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onClick<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"3\">\n<li><strong>Criando o componente StoryModal</strong>: Este componente é responsável por exibir o story num modal quando o leitor clica na imagem dos Stories.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> useStyles <span class=\"token operator\">=</span> <span class=\"token function\">makeStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">theme</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">modal</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'fixed'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">top</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">left</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgba(0, 0, 0, 0.5)'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">backdropFilter</span><span class=\"token operator\">:</span> <span class=\"token string\">'blur(5px)'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">justifyContent</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">alignItems</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">zIndex</span><span class=\"token operator\">:</span> <span class=\"token number\">9999</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">modalContent</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'transparent'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">spacing</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">flexDirection</span><span class=\"token operator\">:</span> <span class=\"token string\">'column'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">alignItems</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex-end'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">closeButton</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">marginBottom</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">spacing</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">arrowButton</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'absolute'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">top</span><span class=\"token operator\">:</span> <span class=\"token string\">'50%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">transform</span><span class=\"token operator\">:</span> <span class=\"token string\">'translateY(-50%)'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token string\">'2rem'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">cursor</span><span class=\"token operator\">:</span> <span class=\"token string\">'pointer'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">arrowLeft</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">left</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">spacing</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">arrowRight</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">right</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">spacing</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">StoryModal</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\r\n  stories<span class=\"token punctuation\">,</span>\r\n  onClose<span class=\"token punctuation\">,</span>\r\n  onPrevious<span class=\"token punctuation\">,</span>\r\n  onNext<span class=\"token punctuation\">,</span>\r\n  showPrevious<span class=\"token punctuation\">,</span>\r\n  showNext<span class=\"token punctuation\">,</span>\r\n  currentStoriesIndex<span class=\"token punctuation\">,</span>\r\n  onStoryEnd<span class=\"token punctuation\">,</span>\r\n  onStoryStart<span class=\"token punctuation\">,</span>\r\n  onAllStoriesEnd<span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> classes <span class=\"token operator\">=</span> <span class=\"token function\">useStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> intl <span class=\"token operator\">=</span> <span class=\"token function\">useIntl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> isMobileDevice <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>isMobile<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleKeyDown <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowRight'</span> <span class=\"token operator\">&amp;&amp;</span> showNext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">onNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowLeft'</span> <span class=\"token operator\">&amp;&amp;</span> showPrevious<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">onPrevious</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">[</span>onNext<span class=\"token punctuation\">,</span> onPrevious<span class=\"token punctuation\">,</span> showNext<span class=\"token punctuation\">,</span> showPrevious<span class=\"token punctuation\">]</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keydown'</span><span class=\"token punctuation\">,</span> handleKeyDown<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keydown'</span><span class=\"token punctuation\">,</span> handleKeyDown<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>handleKeyDown<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>modal<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onClose<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>modalContent<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> e<span class=\"token punctuation\">.</span><span class=\"token function\">stopPropagation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>Button className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>closeButton<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onClose<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n          <span class=\"token punctuation\">{</span>intl<span class=\"token punctuation\">.</span><span class=\"token function\">formatMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">'close'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Button<span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>isMobileDevice <span class=\"token operator\">&amp;&amp;</span> showPrevious <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n          <span class=\"token operator\">&lt;</span>ArrowBackIcon\r\n            className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">classNames</span><span class=\"token punctuation\">(</span>classes<span class=\"token punctuation\">.</span>arrowButton<span class=\"token punctuation\">,</span> classes<span class=\"token punctuation\">.</span>arrowLeft<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onPrevious<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>isMobileDevice <span class=\"token operator\">&amp;&amp;</span> showNext <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n          <span class=\"token operator\">&lt;</span>ArrowForwardIcon\r\n            className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">classNames</span><span class=\"token punctuation\">(</span>classes<span class=\"token punctuation\">.</span>arrowButton<span class=\"token punctuation\">,</span> classes<span class=\"token punctuation\">.</span>arrowRight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onNext<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">&lt;</span>Stories\r\n          stories<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>stories<span class=\"token punctuation\">}</span>\r\n          key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentStoriesIndex<span class=\"token punctuation\">}</span>\r\n          currentIndex<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span>\r\n          onStoryEnd<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onStoryEnd<span class=\"token punctuation\">}</span>\r\n          onStoryStart<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onStoryStart<span class=\"token punctuation\">}</span>\r\n          onAllStoriesEnd<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onAllStoriesEnd<span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"4\">\n<li><strong>Criando o hook useLocalStorage</strong>: Este hook personalizado é usado para gerenciar o estado dos Stories visualizadas no armazenamento local.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">useLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span> initialValue</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>storedValue<span class=\"token punctuation\">,</span> setStoredValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">return</span> item <span class=\"token operator\">?</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> initialValue<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">return</span> initialValue<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setValue</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> valueToStore <span class=\"token operator\">=</span> value <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Function</span> <span class=\"token operator\">?</span> <span class=\"token function\">value</span><span class=\"token punctuation\">(</span>storedValue<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> value<span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">setStoredValue</span><span class=\"token punctuation\">(</span>valueToStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      window<span class=\"token punctuation\">.</span>localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>valueToStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>storedValue<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"5\">\n<li><strong>Criando o hook useStories</strong>: Este hook personalizado é usado para gerenciar o estado dos Stories.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> useStyles <span class=\"token operator\">=</span> <span class=\"token function\">makeStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">theme</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">seeMore</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span>palette<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span>primary<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">textTransform</span><span class=\"token operator\">:</span> <span class=\"token string\">'uppercase'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">textDecoration</span><span class=\"token operator\">:</span> <span class=\"token string\">'inherit'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgb(0 0 0 / 40%)'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> <span class=\"token string\">'10px 0'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">textAlign</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'absolute'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'auto'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">bottom</span><span class=\"token operator\">:</span> <span class=\"token string\">'0px'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">zIndex</span><span class=\"token operator\">:</span> <span class=\"token string\">'9999'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'auto'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">contentWrapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">alignItems</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">justifyContent</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'#333'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">contentTextWrapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token string-property property\">'&amp; h1, p, a'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgb(0 0 0 / 40%)'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> <span class=\"token string\">'10px 25px'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useStories</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">posts<span class=\"token punctuation\">,</span> seenStories</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> intl <span class=\"token operator\">=</span> <span class=\"token function\">useIntl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> classes <span class=\"token operator\">=</span> <span class=\"token function\">useStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> imagesData <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\r\n    query {\r\n      allFile(filter: { relativeDirectory: { eq: \"categories\" }, extension: { eq: \"jpg\" } }) {\r\n        edges {\r\n          node {\r\n            base\r\n            childImageSharp {\r\n              gatsbyImageData\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> storiesMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    posts<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> frontmatter<span class=\"token punctuation\">,</span> fields<span class=\"token punctuation\">,</span> excerpt <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">,</span> categories <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> frontmatter<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> category <span class=\"token operator\">=</span> categories<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">,</span> postHashId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> fields<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> imageNode <span class=\"token operator\">=</span> imagesData<span class=\"token punctuation\">.</span>allFile<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">edge</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>base<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> gatsbyImageData <span class=\"token operator\">=</span> <span class=\"token function\">getImage</span><span class=\"token punctuation\">(</span>imageNode<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>childImageSharp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> categoryImage <span class=\"token operator\">=</span> gatsbyImageData<span class=\"token punctuation\">.</span>images<span class=\"token punctuation\">.</span>fallback<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">;</span>\r\n\r\n      <span class=\"token keyword\">const</span> story <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        category<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">previewImage</span><span class=\"token operator\">:</span> categoryImage<span class=\"token punctuation\">,</span>\r\n        postHashId<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">duration</span><span class=\"token operator\">:</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">viewed</span><span class=\"token operator\">:</span> seenStories<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>postHashId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token function-variable function\">content</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> action<span class=\"token punctuation\">,</span> isPaused <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\r\n          <span class=\"token operator\">&lt;</span>div\r\n            className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>contentWrapper<span class=\"token punctuation\">}</span>\r\n            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n              <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">linear-gradient(rgba(51, 51, 51, 0.5), rgba(51, 51, 51, 0.5)), url(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>categoryImage<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">) no-repeat center center</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>contentTextWrapper<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>excerpt<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>path<span class=\"token punctuation\">}</span> className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>seeMore<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n              <span class=\"token punctuation\">{</span>intl<span class=\"token punctuation\">.</span><span class=\"token function\">formatMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">'go_to_post'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n      <span class=\"token keyword\">const</span> categoryStories <span class=\"token operator\">=</span> storiesMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n      categoryStories<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>story<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      storiesMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">,</span> categoryStories<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>storiesMap<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> aHasFalse <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>item<span class=\"token punctuation\">.</span>viewed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> bHasFalse <span class=\"token operator\">=</span> b<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>item<span class=\"token punctuation\">.</span>viewed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>aHasFalse <span class=\"token operator\">&amp;&amp;</span> bHasFalse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>aHasFalse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\r\n    posts<span class=\"token punctuation\">,</span>\r\n    imagesData<span class=\"token punctuation\">.</span>allFile<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">,</span>\r\n    seenStories<span class=\"token punctuation\">,</span>\r\n    classes<span class=\"token punctuation\">.</span>contentWrapper<span class=\"token punctuation\">,</span>\r\n    classes<span class=\"token punctuation\">.</span>contentTextWrapper<span class=\"token punctuation\">,</span>\r\n    classes<span class=\"token punctuation\">.</span>seeMore<span class=\"token punctuation\">,</span>\r\n    intl<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>O processo de adicionar Stories ao meu blog foi surpreendentemente simples, graças ao pacote de código aberto <code class=\"language-text\">react-insta-stories</code>.</p>\n<p>Eu estava adicionando Stories ao meu blog para melhorar a experiência do leitor? hahaha não. Eu me arrependo? Bem… não também. Num mundo onde somos constantemente bombardeados com novos recursos, atualizações e inovações, que até parece um episódio de Black Mirror.</p>\n<p>Então, aqui estamos. Meu blog agora tem Stories, uma adição completamente desnecessária, mas que não posso deixar de achar divertida. Espero que você goste desta adição completamente desnecessária, mas estranhamente satisfatória ao meu blog.</p>\n<p>Até a próxima, galera!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTA5LTA0VDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-09-04-meu-blog-tem-stories-agora-mas-nao-me-pergunte-por-que.pt-br/","path":"/blog/coding/meu-blog-tem-stories-agora-mas-nao-me-pergunte-por-que/","locale":"pt-br"},"rawMarkdownBody":"Num mundo dominado por plataformas de mídia social, onde Stories se tornaram um recurso omnipresente, eu me peguei pensando - o meu blog realmente precisa de Stories? A resposta, claro, é um sonoro \"não, né?\". Mas aqui estamos, o meu blog agora tem Stories, e eu não tenho totalmente certeza do porquê.\r\n\r\n![Stories](../../uploads/blog/2023/09/stories-on-my-blog.gif)\r\n\r\n## O nascimento de uma ideia desnecessária\r\nTudo começou quando eu estava usando o aplicativo do meu provedor de internet para celular e, para minha surpresa, eles haviam adicionado Stories no aplicativo deles. Isso foi simplesmente demais para mim. Uma mistura de alegria, admiração e confusão me dominou. Quer dizer, por que um aplicativo de provedor de internet precisaria de Stories? Foi nesse momento que decidi, se eles podem fazer, por que eu não posso? E assim, a jornada começou.\r\n\r\nNaturalmente, como um desenvolvedor com uma inclinação para o absurdo, abri o meu editor de código e comecei a programar, e o meu objetivo era adicionar Stories ao meu blog. A razão por trás disso? Me pergunte semana que vem.\r\n\r\n\r\n## A jornada técnica\r\nO processo de adicionar Stories ao meu blog foi surpreendentemente simples, graças ao poder do ~~comunismo~~ código aberto. Ferramentas e bibliotecas de código aberto são uma bênção para os desenvolvedores. Elas economizam tempo, esforço e muitas vezes levam a soluções melhores do que as que poderíamos criar sozinhos. Após um pouco de pesquisa, eu me deparei com um pacote fantástico que parecia ser a resposta para todas as minhas orações - [react-insta-stories](https://www.npmjs.com/package/react-insta-stories). Este pacote é projetado para criar Stories estilo Instagram no React, que era exatamente o que eu estava procurando.\r\n\r\nO pacote `react-insta-stories` é incrivelmente versátil e personalizável. Ele permite que você crie stories com imagens, vídeos e até componentes personalizados. Você pode personalizar a duração de cada Story, adicionar botões de ação e muito mais. Era quase bom demais para ser verdade. Com este pacote, consegui adicionar Stories ao meu blog em pouco tempo e com o mínimo de esforço.\r\n\r\n## Decidindo o que mostrar nos Stories\r\nInicialmente, pensei em criar vídeos personalizados usando fundos padrão de sites de \"stock videos\". Cheguei até a criar um script usando FFmpeg e Node.js para automatizar o processo. No entanto, após alguma consideração, decidi abandonar essa ideia. Para a primeira iteração, decidi criar um Story para cada um dos últimos cinco posts do meu blog.\r\n\r\nPara o conteúdo dos Stories, decidi mantê-lo simples. Eu decidi usar uma \"stock photo\" relacionada à categoria do post do blog, sobreporia o título do post do blog e incluiria um link para acessá-lo. Dessa forma, os Stories não serviriam apenas como um teaser visual, mas também como um portal funcional para o conteúdo completo do post do blog.\r\n\r\nPara torná-lo mais organizado, agrupei esses Stories pela categoria do post do blog. Por exemplo, se dos últimos cinco posts do blog, três estavam na categoria \"programação\" e dois na categoria \"jogos\", eu exibiria duas prévias de Stories diferentes - aqueles pequenos círculos de imagem que você clica para ver os Stories. Então, \"dentro\" de cada um desses círculos agrupados, você clicaria e veria esses Stories.\r\n\r\nEssa abordagem parecia mais gerenciável e, vamos ser honestos, exigia menos esforço da minha parte. Também proporcionava uma maneira dos visitantes se atualizarem rapidamente sobre os meus últimos posts de uma maneira mais interativa e envolvente. Não que eu esteja particularmente preocupado com a retenção ou engajamento dos visitantes. Estou apenas adicionando esse recurso porque, bem, por que não?\r\n\r\n## Partiu programar\r\nApós a decisão (meio que no \"ah, por que não, né\"), era hora de mergulhar de cabeça no mundo da programação. Aqui vai um resumo dos passos que segui, ou melhor, do buraco de coelho que me enfiei:\r\n\r\n1. **Criando o componente StoriesPreview**: Este componente é responsável por exibir a pré-visualização dos Stories na página principal do blog.\r\n\r\n```javascript\r\nconst useStyles = makeStyles((theme) => ({\r\n  circleImage: {\r\n    width: 80,\r\n    height: 80,\r\n    borderRadius: '50%',\r\n    cursor: 'pointer',\r\n    objectFit: 'cover',\r\n    marginLeft: '5px',\r\n    position: 'relative',\r\n  },\r\n  storyImage: {\r\n    width: '100%',\r\n    height: '100%',\r\n    objectFit: 'cover',\r\n    objectPosition: 'center',\r\n  },\r\n  storiesWrapper: {\r\n    margin: '15px 0',\r\n  },\r\n  previewWrapper: {\r\n    margin: '15px 0',\r\n  },\r\n}));\r\n\r\nconst StoriesPreview = () => {\r\n  const data = useStaticQuery(\r\n    graphql`\r\n      query {\r\n        allMarkdownRemark(\r\n          filter: { frontmatter: { show: { eq: true } } }\r\n          sort: { fields: [frontmatter___date], order: DESC }\r\n          limit: 10\r\n        ) {\r\n          edges {\r\n            node {\r\n              excerpt(pruneLength: 60)\r\n              fields {\r\n                path\r\n                locale\r\n                postHashId\r\n              }\r\n              frontmatter {\r\n                title\r\n                categories\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    `\r\n  );\r\n\r\n  const intl = useIntl();\r\n  const posts = data.allMarkdownRemark.edges.filter(({ node }) => node.fields.locale === intl.locale);\r\n  const classes = useStyles();\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [currentStoriesIndex, setCurrentStoriesIndex] = useState(0);\r\n  const [seenStories, setSeenStories] = useLocalStorage('seenStories', []);\r\n  const [tempSeenStories, setTempSeenStories] = useState([]);\r\n  const stories = useStories(posts, seenStories);\r\n\r\n  const onStoryEnd = useCallback(\r\n    (currentStoriesIndex, currentStoryIndex) => {\r\n      const newTempSeenStories = new Set([\r\n        ...tempSeenStories,\r\n        stories[currentStoriesIndex][currentStoryIndex].postHashId,\r\n      ]);\r\n      setTempSeenStories([...newTempSeenStories]);\r\n    },\r\n    [tempSeenStories, stories]\r\n  );\r\n\r\n  const handleImageClick = useCallback((index) => {\r\n    setCurrentStoriesIndex(index);\r\n    setShowModal(true);\r\n  }, []);\r\n\r\n  const handleCloseModal = useCallback(() => {\r\n    setShowModal(false);\r\n    const newSeenStories = new Set([...seenStories, ...tempSeenStories]);\r\n    setSeenStories([...newSeenStories]);\r\n    setTempSeenStories([]);\r\n  }, [seenStories, setSeenStories, tempSeenStories]);\r\n\r\n  const handleNextStories = useCallback(() => {\r\n    if (currentStoriesIndex < stories.length - 1) {\r\n      setCurrentStoriesIndex(currentStoriesIndex + 1);\r\n    } else {\r\n      handleCloseModal();\r\n    }\r\n  }, [currentStoriesIndex, handleCloseModal, stories.length]);\r\n\r\n  const handlePreviousStories = useCallback(() => {\r\n    if (currentStoriesIndex > 0) {\r\n      setCurrentStoriesIndex(currentStoriesIndex - 1);\r\n    } else {\r\n      handleCloseModal();\r\n    }\r\n  }, [currentStoriesIndex, handleCloseModal]);\r\n\r\n  const handleOnAllStoriesEnd = useCallback(() => {\r\n    handleNextStories();\r\n  }, [handleNextStories]);\r\n\r\n  return (\r\n    <div className={classes.storiesWrapper}>\r\n      <div className={classes.previewWrapper}>\r\n        {stories.map((storiesArray, index) => {\r\n          return (\r\n            <StoryImage\r\n              key={index}\r\n              category={storiesArray[0].category}\r\n              previewImage={storiesArray[0].previewImage}\r\n              unseen={isClient() && storiesArray.some((story) => !story.viewed)}\r\n              onClick={() => handleImageClick(index)}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n      <Divider />\r\n      {showModal && (\r\n        <StoryModal\r\n          stories={stories[currentStoriesIndex]}\r\n          onClose={handleCloseModal}\r\n          onPrevious={handlePreviousStories}\r\n          onNext={handleNextStories}\r\n          showPrevious={currentStoriesIndex > 0}\r\n          showNext={currentStoriesIndex < stories.length - 1}\r\n          currentStoriesIndex={currentStoriesIndex}\r\n          onAllStoriesEnd={handleOnAllStoriesEnd}\r\n          onStoryEnd={(currentStoryIndex) => onStoryEnd(currentStoriesIndex, currentStoryIndex)}\r\n          onStoryStart={(currentStoryIndex) => onStoryEnd(currentStoriesIndex, currentStoryIndex)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n```\r\n\r\n2. **Criando o componente StoryImage**: Este componente é responsável por exibir a imagem do Story.\r\n\r\n```javascript\r\nconst useStyles = makeStyles((theme) => ({\r\n  circleImage: ({ unseen }) => ({\r\n    width: 80,\r\n    height: 80,\r\n    borderRadius: '50%',\r\n    cursor: 'pointer',\r\n    objectFit: 'cover',\r\n    marginLeft: '5px',\r\n    position: 'relative',\r\n    ...(unseen\r\n      ? {\r\n        padding: 4,\r\n        background: theme.palette.secondary.main,\r\n      }\r\n      : {}),\r\n  }),\r\n}));\r\n\r\nconst StoryImage = ({ category, previewImage, unseen, onClick }) => {\r\n  const classes = useStyles({ unseen });\r\n\r\n  return (\r\n    // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\r\n    <img alt={category} src={previewImage} className={classes.circleImage} onClick={onClick} />\r\n  );\r\n};\r\n```\r\n\r\n3. **Criando o componente StoryModal**: Este componente é responsável por exibir o story num modal quando o leitor clica na imagem dos Stories.\r\n\r\n```javascript\r\nconst useStyles = makeStyles((theme) => ({\r\n  modal: {\r\n    position: 'fixed',\r\n    top: 0,\r\n    left: 0,\r\n    width: '100%',\r\n    height: '100%',\r\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n    backdropFilter: 'blur(5px)',\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    zIndex: 9999,\r\n  },\r\n  modalContent: {\r\n    backgroundColor: 'transparent',\r\n    padding: theme.spacing(2),\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'flex-end',\r\n  },\r\n  closeButton: {\r\n    marginBottom: theme.spacing(1),\r\n  },\r\n  arrowButton: {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    transform: 'translateY(-50%)',\r\n    fontSize: '2rem',\r\n    cursor: 'pointer',\r\n  },\r\n  arrowLeft: {\r\n    left: theme.spacing(1),\r\n  },\r\n  arrowRight: {\r\n    right: theme.spacing(1),\r\n  },\r\n}));\r\n\r\nconst StoryModal = ({\r\n  stories,\r\n  onClose,\r\n  onPrevious,\r\n  onNext,\r\n  showPrevious,\r\n  showNext,\r\n  currentStoriesIndex,\r\n  onStoryEnd,\r\n  onStoryStart,\r\n  onAllStoriesEnd,\r\n}) => {\r\n  const classes = useStyles();\r\n  const intl = useIntl();\r\n  const isMobileDevice = useMemo(isMobile, []);\r\n\r\n  const handleKeyDown = useCallback(\r\n    (event) => {\r\n      if (event.key === 'ArrowRight' && showNext) {\r\n        onNext();\r\n      } else if (event.key === 'ArrowLeft' && showPrevious) {\r\n        onPrevious();\r\n      }\r\n    },\r\n    [onNext, onPrevious, showNext, showPrevious]\r\n  );\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [handleKeyDown]);\r\n\r\n  return (\r\n    <div className={classes.modal} onClick={onClose}>\r\n      <div className={classes.modalContent} onClick={(e) => e.stopPropagation()}>\r\n        <Button className={classes.closeButton} onClick={onClose}>\r\n          {intl.formatMessage({ id: 'close' })}\r\n        </Button>\r\n        {!isMobileDevice && showPrevious && (\r\n          <ArrowBackIcon\r\n            className={classNames(classes.arrowButton, classes.arrowLeft)}\r\n            onClick={onPrevious}\r\n          />\r\n        )}\r\n        {!isMobileDevice && showNext && (\r\n          <ArrowForwardIcon\r\n            className={classNames(classes.arrowButton, classes.arrowRight)}\r\n            onClick={onNext}\r\n          />\r\n        )}\r\n        <Stories\r\n          stories={stories}\r\n          key={currentStoriesIndex}\r\n          currentIndex={0}\r\n          onStoryEnd={onStoryEnd}\r\n          onStoryStart={onStoryStart}\r\n          onAllStoriesEnd={onAllStoriesEnd}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n```\r\n\r\n4. **Criando o hook useLocalStorage**: Este hook personalizado é usado para gerenciar o estado dos Stories visualizadas no armazenamento local.\r\n\r\n```javascript\r\nfunction useLocalStorage(key, initialValue) {\r\n  const [storedValue, setStoredValue] = useState(() => {\r\n    try {\r\n      const item = window.localStorage.getItem(key);\r\n      return item ? JSON.parse(item) : initialValue;\r\n    } catch (error) {\r\n      console.log(error);\r\n      return initialValue;\r\n    }\r\n  });\r\n\r\n  const setValue = (value) => {\r\n    try {\r\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\r\n      setStoredValue(valueToStore);\r\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  return [storedValue, setValue];\r\n}\r\n```\r\n\r\n5. **Criando o hook useStories**: Este hook personalizado é usado para gerenciar o estado dos Stories.\r\n\r\n```javascript\r\nconst useStyles = makeStyles((theme) => ({\r\n  seeMore: {\r\n    color: theme.palette.text.primary,\r\n    textTransform: 'uppercase',\r\n    textDecoration: 'inherit',\r\n    background: 'rgb(0 0 0 / 40%)',\r\n    padding: '10px 0',\r\n    textAlign: 'center',\r\n    position: 'absolute',\r\n    margin: 'auto',\r\n    bottom: '0px',\r\n    zIndex: '9999',\r\n    width: '100%',\r\n    height: 'auto',\r\n  },\r\n  contentWrapper: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    background: '#333',\r\n    width: '100%',\r\n    color: 'white',\r\n    height: '100%',\r\n  },\r\n  contentTextWrapper: {\r\n    '& h1, p, a': {\r\n      background: 'rgb(0 0 0 / 40%)',\r\n      padding: '10px 25px',\r\n      margin: 0,\r\n    },\r\n  },\r\n}));\r\n\r\nconst useStories = (posts, seenStories) => {\r\n  const intl = useIntl();\r\n  const classes = useStyles();\r\n  const imagesData = useStaticQuery(graphql`\r\n    query {\r\n      allFile(filter: { relativeDirectory: { eq: \"categories\" }, extension: { eq: \"jpg\" } }) {\r\n        edges {\r\n          node {\r\n            base\r\n            childImageSharp {\r\n              gatsbyImageData\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  `);\r\n\r\n  return useMemo(() => {\r\n    const storiesMap = new Map();\r\n    posts.forEach(({ node }) => {\r\n      const { frontmatter, fields, excerpt } = node;\r\n      const { title, categories } = frontmatter;\r\n      const category = categories[0];\r\n      const { path, postHashId } = fields;\r\n      const imageNode = imagesData.allFile.edges.find((edge) => edge.node.base.includes(category));\r\n      const gatsbyImageData = getImage(imageNode.node.childImageSharp);\r\n      const categoryImage = gatsbyImageData.images.fallback.src;\r\n\r\n      const story = {\r\n        category,\r\n        previewImage: categoryImage,\r\n        postHashId,\r\n        duration: 5000,\r\n        viewed: seenStories.includes(postHashId),\r\n        content: ({ action, isPaused }) => (\r\n          <div\r\n            className={classes.contentWrapper}\r\n            style={{\r\n              background: `linear-gradient(rgba(51, 51, 51, 0.5), rgba(51, 51, 51, 0.5)), url(${categoryImage}) no-repeat center center`,\r\n            }}\r\n          >\r\n            <div className={classes.contentTextWrapper}>\r\n              <h1>{title}</h1>\r\n              <p>{excerpt}</p>\r\n            </div>\r\n            <Link to={path} className={classes.seeMore}>\r\n              {intl.formatMessage({ id: 'go_to_post' })}\r\n            </Link>\r\n          </div>\r\n        ),\r\n      };\r\n\r\n      const categoryStories = storiesMap.get(category) || [];\r\n      categoryStories.push(story);\r\n      storiesMap.set(category, categoryStories);\r\n    });\r\n\r\n    return Array.from(storiesMap.values()).sort((a, b) => {\r\n      const aHasFalse = a.some((item) => !item.viewed);\r\n      const bHasFalse = b.some((item) => !item.viewed);\r\n\r\n      if (aHasFalse && bHasFalse) {\r\n        return 0;\r\n      } else if (aHasFalse) {\r\n        return -1;\r\n      } else {\r\n        return 1;\r\n      }\r\n    });\r\n  }, [\r\n    posts,\r\n    imagesData.allFile.edges,\r\n    seenStories,\r\n    classes.contentWrapper,\r\n    classes.contentTextWrapper,\r\n    classes.seeMore,\r\n    intl,\r\n  ]);\r\n};\r\n```\r\n\r\n## Conclusão\r\nO processo de adicionar Stories ao meu blog foi surpreendentemente simples, graças ao pacote de código aberto `react-insta-stories`.\r\n\r\nEu estava adicionando Stories ao meu blog para melhorar a experiência do leitor? hahaha não. Eu me arrependo? Bem... não também. Num mundo onde somos constantemente bombardeados com novos recursos, atualizações e inovações, que até parece um episódio de Black Mirror.\r\n\r\nEntão, aqui estamos. Meu blog agora tem Stories, uma adição completamente desnecessária, mas que não posso deixar de achar divertida. Espero que você goste desta adição completamente desnecessária, mas estranhamente satisfatória ao meu blog.\r\n\r\nAté a próxima, galera!\r\n","frontmatter":{"tags":["instagram","instagram stories","invenções desnecessárias","gatsby","react","javascript"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-09-04T00:00:00.000Z","id":null,"path":"meu-blog-tem-stories-agora-mas-nao-me-pergunte-por-que","show":true,"title":"Meu blog tem Stories agora, mas não me pergunte por quê","hideExcerpt":false,"subtitle":"Quem disse que tédio não é produtivo?"}}},{"node":{"excerpt":"In a world dominated by social media platforms, where…","html":"<p>In a world dominated by social media platforms, where ‘Stories’ have become an omnipresent feature, I found myself pondering - does my blog really need Stories? The answer, of course, is a resounding ‘fuck no’. But here we are, my blog now has Stories, and I’m not entirely sure why.</p>\n<p><img src=\"/4cdd7b249c219b923c1baef9632ccdbc/stories-on-my-blog.gif\" alt=\"Stories\"></p>\n<h2 id=\"the-genesis-of-an-unnecessary-idea\" style=\"position:relative;\"><a href=\"#the-genesis-of-an-unnecessary-idea\" aria-label=\"the genesis of an unnecessary idea permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The genesis of an unnecessary idea</h2>\n<p>It all started when I was using my mobile internet provider app, and to my surprise, they had added Stories to their app. This was simply too much for me to handle. A mix of joy, wonder, and confusion overtook me. I mean, why would an internet provider app need Stories? It was at this moment that I decided, if they can do it, why can’t I? And so, the journey began.</p>\n<p>Naturally, as a developer with a penchant for the absurd, I fired up my code editor and started coding, and my goal was to Stories to my blog. The reasoning behind it? That’s still a work in progress.</p>\n<h2 id=\"the-technical-journey\" style=\"position:relative;\"><a href=\"#the-technical-journey\" aria-label=\"the technical journey permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The technical journey</h2>\n<p>The process of adding Stories to my blog was surprisingly straightforward, thanks to the power of <del>communism</del> open-source. Open-source tools and libraries are a blessing for developers. They save time, effort, and often lead to better solutions than one could come up with on their own. After a bit of research, I stumbled upon a fantastic package that seemed to be the answer to all my prayers - <a href=\"https://www.npmjs.com/package/react-insta-stories\" target=\"_blank\" rel=\"noreferrer\">react-insta-stories</a>. This package is designed to create Instagram-like Stories on React, which was exactly what I was looking for.</p>\n<p>The <code class=\"language-text\">react-insta-stories</code> package is incredibly versatile and customizable. It allows you to create stories with images, videos, and even custom components. You can customize the duration of each story, add action buttons, and much more. It was almost too good to be true. With this package, I was able to add Stories to my blog in no time, and with minimal effort.</p>\n<h2 id=\"deciding-what-to-show-in-the-stories\" style=\"position:relative;\"><a href=\"#deciding-what-to-show-in-the-stories\" aria-label=\"deciding what to show in the stories permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deciding what to show in the stories</h2>\n<p>Initially, I thought about creating custom videos using default backgrounds from stock video websites. I even went as far as creating a script using FFmpeg and Node.js to automate the process. However, after some consideration, I decided to drop that idea. For the first iteration, I decided to create a story for each of the last five blog posts on my website.</p>\n<p>For the stories content, I decided to keep it simple. I would display a background image from a stock photo related to the category of the blog post, overlay the title of the blog post, and include a link to access it. This way, the stories would not only serve as a visual teaser but also as a functional gateway to the full content of the blog post.</p>\n<p>To make it more organized, I grouped these stories by the category of the blog post. For example, if out of the past five blog posts, three were in the “coding” category and two in the “games” category, I would display two different story previews - those little image circles that you click to see the stories. Then, “inside” each of these grouped circles, you would click and see those stories.</p>\n<p>This approach seemed more manageable and, let’s be honest, required less effort on my part. It also provided a way for visitors to quickly catch up on my latest posts in a more interactive and engaging manner. Not that I’m particularly concerned about visitor retention or engagement. I’m just adding this feature because, well, why not?</p>\n<h2 id=\"lets-get-coding\" style=\"position:relative;\"><a href=\"#lets-get-coding\" aria-label=\"lets get coding permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’s get coding</h2>\n<p>Once the decision was made (with a shrug and a “why not”), it was time to dive into the deep end of the coding pool. Here’s a brief overview of the steps I took, or rather, the rabbit hole I went down:</p>\n<ol>\n<li><strong>Creating the StoriesPreview component</strong>: This component is responsible for displaying the preview of the stories on the main page of the blog.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> useStyles <span class=\"token operator\">=</span> <span class=\"token function\">makeStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">theme</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">circleImage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">borderRadius</span><span class=\"token operator\">:</span> <span class=\"token string\">'50%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">cursor</span><span class=\"token operator\">:</span> <span class=\"token string\">'pointer'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">objectFit</span><span class=\"token operator\">:</span> <span class=\"token string\">'cover'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">marginLeft</span><span class=\"token operator\">:</span> <span class=\"token string\">'5px'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'relative'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">storyImage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">objectFit</span><span class=\"token operator\">:</span> <span class=\"token string\">'cover'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">objectPosition</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">storiesWrapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'15px 0'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">previewWrapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'15px 0'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">StoriesPreview</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>\r\n    graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\r\n      query {\r\n        allMarkdownRemark(\r\n          filter: { frontmatter: { show: { eq: true } } }\r\n          sort: { fields: [frontmatter___date], order: DESC }\r\n          limit: 10\r\n        ) {\r\n          edges {\r\n            node {\r\n              excerpt(pruneLength: 60)\r\n              fields {\r\n                path\r\n                locale\r\n                postHashId\r\n              }\r\n              frontmatter {\r\n                title\r\n                categories\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    </span><span class=\"token template-punctuation string\">`</span></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> intl <span class=\"token operator\">=</span> <span class=\"token function\">useIntl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>locale <span class=\"token operator\">===</span> intl<span class=\"token punctuation\">.</span>locale<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> classes <span class=\"token operator\">=</span> <span class=\"token function\">useStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>showModal<span class=\"token punctuation\">,</span> setShowModal<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">,</span> setCurrentStoriesIndex<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>seenStories<span class=\"token punctuation\">,</span> setSeenStories<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'seenStories'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>tempSeenStories<span class=\"token punctuation\">,</span> setTempSeenStories<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> stories <span class=\"token operator\">=</span> <span class=\"token function\">useStories</span><span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">,</span> seenStories<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> onStoryEnd <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">currentStoriesIndex<span class=\"token punctuation\">,</span> currentStoryIndex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> newTempSeenStories <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\r\n        <span class=\"token operator\">...</span>tempSeenStories<span class=\"token punctuation\">,</span>\r\n        stories<span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>currentStoryIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>postHashId<span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">setTempSeenStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>newTempSeenStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">[</span>tempSeenStories<span class=\"token punctuation\">,</span> stories<span class=\"token punctuation\">]</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleImageClick <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">setCurrentStoriesIndex</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">setShowModal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleCloseModal <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">setShowModal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> newSeenStories <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>seenStories<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>tempSeenStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">setSeenStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>newSeenStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">setTempSeenStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>seenStories<span class=\"token punctuation\">,</span> setSeenStories<span class=\"token punctuation\">,</span> tempSeenStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleNextStories <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currentStoriesIndex <span class=\"token operator\">&lt;</span> stories<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">setCurrentStoriesIndex</span><span class=\"token punctuation\">(</span>currentStoriesIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">handleCloseModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">,</span> handleCloseModal<span class=\"token punctuation\">,</span> stories<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handlePreviousStories <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currentStoriesIndex <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">setCurrentStoriesIndex</span><span class=\"token punctuation\">(</span>currentStoriesIndex <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">handleCloseModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">,</span> handleCloseModal<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleOnAllStoriesEnd <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">handleNextStories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>handleNextStories<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>storiesWrapper<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>previewWrapper<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">{</span>stories<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">storiesArray<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n            <span class=\"token operator\">&lt;</span>StoryImage\r\n              key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span>\r\n              category<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>storiesArray<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>category<span class=\"token punctuation\">}</span>\r\n              previewImage<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>storiesArray<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>previewImage<span class=\"token punctuation\">}</span>\r\n              unseen<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">isClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> storiesArray<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">story</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>story<span class=\"token punctuation\">.</span>viewed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n              onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">handleImageClick</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>Divider <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token punctuation\">{</span>showModal <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>StoryModal\r\n          stories<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>stories<span class=\"token punctuation\">[</span>currentStoriesIndex<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\r\n          onClose<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleCloseModal<span class=\"token punctuation\">}</span>\r\n          onPrevious<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handlePreviousStories<span class=\"token punctuation\">}</span>\r\n          onNext<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleNextStories<span class=\"token punctuation\">}</span>\r\n          showPrevious<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentStoriesIndex <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span>\r\n          showNext<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentStoriesIndex <span class=\"token operator\">&lt;</span> stories<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span>\r\n          currentStoriesIndex<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentStoriesIndex<span class=\"token punctuation\">}</span>\r\n          onAllStoriesEnd<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleOnAllStoriesEnd<span class=\"token punctuation\">}</span>\r\n          onStoryEnd<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">currentStoryIndex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">onStoryEnd</span><span class=\"token punctuation\">(</span>currentStoriesIndex<span class=\"token punctuation\">,</span> currentStoryIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n          onStoryStart<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">currentStoryIndex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">onStoryEnd</span><span class=\"token punctuation\">(</span>currentStoriesIndex<span class=\"token punctuation\">,</span> currentStoryIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"2\">\n<li><strong>Creating the StoryImage component</strong>: This component is responsible for displaying the image of the story.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> useStyles <span class=\"token operator\">=</span> <span class=\"token function\">makeStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">theme</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token function-variable function\">circleImage</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> unseen <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">borderRadius</span><span class=\"token operator\">:</span> <span class=\"token string\">'50%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">cursor</span><span class=\"token operator\">:</span> <span class=\"token string\">'pointer'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">objectFit</span><span class=\"token operator\">:</span> <span class=\"token string\">'cover'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">marginLeft</span><span class=\"token operator\">:</span> <span class=\"token string\">'5px'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'relative'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token operator\">...</span><span class=\"token punctuation\">(</span>unseen\r\n      <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span>palette<span class=\"token punctuation\">.</span>secondary<span class=\"token punctuation\">.</span>main<span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">StoryImage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> category<span class=\"token punctuation\">,</span> previewImage<span class=\"token punctuation\">,</span> unseen<span class=\"token punctuation\">,</span> onClick <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> classes <span class=\"token operator\">=</span> <span class=\"token function\">useStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> unseen <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token comment\">// eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions</span>\r\n    <span class=\"token operator\">&lt;</span>img alt<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>category<span class=\"token punctuation\">}</span> src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>previewImage<span class=\"token punctuation\">}</span> className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>circleImage<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onClick<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"3\">\n<li><strong>Creating the StoryModal component</strong>: This component is responsible for displaying the story in a modal when the user clicks on the story image.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> useStyles <span class=\"token operator\">=</span> <span class=\"token function\">makeStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">theme</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">modal</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'fixed'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">top</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">left</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgba(0, 0, 0, 0.5)'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">backdropFilter</span><span class=\"token operator\">:</span> <span class=\"token string\">'blur(5px)'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">justifyContent</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">alignItems</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">zIndex</span><span class=\"token operator\">:</span> <span class=\"token number\">9999</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">modalContent</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'transparent'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">spacing</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">flexDirection</span><span class=\"token operator\">:</span> <span class=\"token string\">'column'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">alignItems</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex-end'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">closeButton</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">marginBottom</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">spacing</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">arrowButton</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'absolute'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">top</span><span class=\"token operator\">:</span> <span class=\"token string\">'50%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">transform</span><span class=\"token operator\">:</span> <span class=\"token string\">'translateY(-50%)'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token string\">'2rem'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">cursor</span><span class=\"token operator\">:</span> <span class=\"token string\">'pointer'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">arrowLeft</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">left</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">spacing</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">arrowRight</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">right</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span><span class=\"token function\">spacing</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">StoryModal</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\r\n  stories<span class=\"token punctuation\">,</span>\r\n  onClose<span class=\"token punctuation\">,</span>\r\n  onPrevious<span class=\"token punctuation\">,</span>\r\n  onNext<span class=\"token punctuation\">,</span>\r\n  showPrevious<span class=\"token punctuation\">,</span>\r\n  showNext<span class=\"token punctuation\">,</span>\r\n  currentStoriesIndex<span class=\"token punctuation\">,</span>\r\n  onStoryEnd<span class=\"token punctuation\">,</span>\r\n  onStoryStart<span class=\"token punctuation\">,</span>\r\n  onAllStoriesEnd<span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> classes <span class=\"token operator\">=</span> <span class=\"token function\">useStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> intl <span class=\"token operator\">=</span> <span class=\"token function\">useIntl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> isMobileDevice <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>isMobile<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> handleKeyDown <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowRight'</span> <span class=\"token operator\">&amp;&amp;</span> showNext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">onNext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowLeft'</span> <span class=\"token operator\">&amp;&amp;</span> showPrevious<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">onPrevious</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">[</span>onNext<span class=\"token punctuation\">,</span> onPrevious<span class=\"token punctuation\">,</span> showNext<span class=\"token punctuation\">,</span> showPrevious<span class=\"token punctuation\">]</span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keydown'</span><span class=\"token punctuation\">,</span> handleKeyDown<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keydown'</span><span class=\"token punctuation\">,</span> handleKeyDown<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>handleKeyDown<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>modal<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onClose<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>modalContent<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> e<span class=\"token punctuation\">.</span><span class=\"token function\">stopPropagation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>Button className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>closeButton<span class=\"token punctuation\">}</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onClose<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n          <span class=\"token punctuation\">{</span>intl<span class=\"token punctuation\">.</span><span class=\"token function\">formatMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">'close'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Button<span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>isMobileDevice <span class=\"token operator\">&amp;&amp;</span> showPrevious <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n          <span class=\"token operator\">&lt;</span>ArrowBackIcon\r\n            className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">classNames</span><span class=\"token punctuation\">(</span>classes<span class=\"token punctuation\">.</span>arrowButton<span class=\"token punctuation\">,</span> classes<span class=\"token punctuation\">.</span>arrowLeft<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onPrevious<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>isMobileDevice <span class=\"token operator\">&amp;&amp;</span> showNext <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n          <span class=\"token operator\">&lt;</span>ArrowForwardIcon\r\n            className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">classNames</span><span class=\"token punctuation\">(</span>classes<span class=\"token punctuation\">.</span>arrowButton<span class=\"token punctuation\">,</span> classes<span class=\"token punctuation\">.</span>arrowRight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onNext<span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">&lt;</span>Stories\r\n          stories<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>stories<span class=\"token punctuation\">}</span>\r\n          key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentStoriesIndex<span class=\"token punctuation\">}</span>\r\n          currentIndex<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span>\r\n          onStoryEnd<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onStoryEnd<span class=\"token punctuation\">}</span>\r\n          onStoryStart<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onStoryStart<span class=\"token punctuation\">}</span>\r\n          onAllStoriesEnd<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>onAllStoriesEnd<span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"4\">\n<li><strong>Creating the useLocalStorage hook</strong>: This custom hook is used to manage the state of the seen stories in the local storage.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">useLocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span> initialValue</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>storedValue<span class=\"token punctuation\">,</span> setStoredValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">return</span> item <span class=\"token operator\">?</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> initialValue<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">return</span> initialValue<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setValue</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> valueToStore <span class=\"token operator\">=</span> value <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Function</span> <span class=\"token operator\">?</span> <span class=\"token function\">value</span><span class=\"token punctuation\">(</span>storedValue<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> value<span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">setStoredValue</span><span class=\"token punctuation\">(</span>valueToStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      window<span class=\"token punctuation\">.</span>localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>valueToStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>storedValue<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"5\">\n<li><strong>Creating the useStories hook</strong>: This custom hook is used to manage the state of the stories.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> useStyles <span class=\"token operator\">=</span> <span class=\"token function\">makeStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">theme</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">seeMore</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> theme<span class=\"token punctuation\">.</span>palette<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">.</span>primary<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">textTransform</span><span class=\"token operator\">:</span> <span class=\"token string\">'uppercase'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">textDecoration</span><span class=\"token operator\">:</span> <span class=\"token string\">'inherit'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgb(0 0 0 / 40%)'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> <span class=\"token string\">'10px 0'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">textAlign</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'absolute'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'auto'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">bottom</span><span class=\"token operator\">:</span> <span class=\"token string\">'0px'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">zIndex</span><span class=\"token operator\">:</span> <span class=\"token string\">'9999'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'auto'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">contentWrapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">alignItems</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">justifyContent</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'#333'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">contentTextWrapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token string-property property\">'&amp; h1, p, a'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgb(0 0 0 / 40%)'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">padding</span><span class=\"token operator\">:</span> <span class=\"token string\">'10px 25px'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useStories</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">posts<span class=\"token punctuation\">,</span> seenStories</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> intl <span class=\"token operator\">=</span> <span class=\"token function\">useIntl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> classes <span class=\"token operator\">=</span> <span class=\"token function\">useStyles</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> imagesData <span class=\"token operator\">=</span> <span class=\"token function\">useStaticQuery</span><span class=\"token punctuation\">(</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\r\n    query {\r\n      allFile(filter: { relativeDirectory: { eq: \"categories\" }, extension: { eq: \"jpg\" } }) {\r\n        edges {\r\n          node {\r\n            base\r\n            childImageSharp {\r\n              gatsbyImageData\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> storiesMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    posts<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> frontmatter<span class=\"token punctuation\">,</span> fields<span class=\"token punctuation\">,</span> excerpt <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">,</span> categories <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> frontmatter<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> category <span class=\"token operator\">=</span> categories<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">,</span> postHashId <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> fields<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> imageNode <span class=\"token operator\">=</span> imagesData<span class=\"token punctuation\">.</span>allFile<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">edge</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>base<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> gatsbyImageData <span class=\"token operator\">=</span> <span class=\"token function\">getImage</span><span class=\"token punctuation\">(</span>imageNode<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>childImageSharp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> categoryImage <span class=\"token operator\">=</span> gatsbyImageData<span class=\"token punctuation\">.</span>images<span class=\"token punctuation\">.</span>fallback<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">;</span>\r\n\r\n      <span class=\"token keyword\">const</span> story <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        category<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">previewImage</span><span class=\"token operator\">:</span> categoryImage<span class=\"token punctuation\">,</span>\r\n        postHashId<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">duration</span><span class=\"token operator\">:</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">viewed</span><span class=\"token operator\">:</span> seenStories<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>postHashId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token function-variable function\">content</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> action<span class=\"token punctuation\">,</span> isPaused <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\r\n          <span class=\"token operator\">&lt;</span>div\r\n            className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>contentWrapper<span class=\"token punctuation\">}</span>\r\n            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n              <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">linear-gradient(rgba(51, 51, 51, 0.5), rgba(51, 51, 51, 0.5)), url(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>categoryImage<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">) no-repeat center center</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>contentTextWrapper<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>excerpt<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>path<span class=\"token punctuation\">}</span> className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>classes<span class=\"token punctuation\">.</span>seeMore<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n              <span class=\"token punctuation\">{</span>intl<span class=\"token punctuation\">.</span><span class=\"token function\">formatMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token string\">'go_to_post'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n      <span class=\"token keyword\">const</span> categoryStories <span class=\"token operator\">=</span> storiesMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n      categoryStories<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>story<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      storiesMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">,</span> categoryStories<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>storiesMap<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> aHasFalse <span class=\"token operator\">=</span> a<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>item<span class=\"token punctuation\">.</span>viewed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">const</span> bHasFalse <span class=\"token operator\">=</span> b<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>item<span class=\"token punctuation\">.</span>viewed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>aHasFalse <span class=\"token operator\">&amp;&amp;</span> bHasFalse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>aHasFalse<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\r\n    posts<span class=\"token punctuation\">,</span>\r\n    imagesData<span class=\"token punctuation\">.</span>allFile<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">,</span>\r\n    seenStories<span class=\"token punctuation\">,</span>\r\n    classes<span class=\"token punctuation\">.</span>contentWrapper<span class=\"token punctuation\">,</span>\r\n    classes<span class=\"token punctuation\">.</span>contentTextWrapper<span class=\"token punctuation\">,</span>\r\n    classes<span class=\"token punctuation\">.</span>seeMore<span class=\"token punctuation\">,</span>\r\n    intl<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>The process of adding Stories to my blog was surprisingly straightforward, thanks to the open-source package <code class=\"language-text\">react-insta-stories</code>.</p>\n<p>Was I adding Stories to my blog to enhance the user experience? lol no. Do I regret it? Well… no really. In a world where we are constantly bombarded with new features, updates, and innovations, it’s easy to get caught up in the whirlwind of “keeping up with the JS” 🥁.</p>\n<p>So, here we are. My blog now has Stories, a completely unnecessary addition, but one that I can’t help but find amusing. I hope you enjoy this completely unnecessary, yet oddly satisfying addition to my blog.</p>\n<p>See you in the next post!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTA5LTA0VDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-09-04-my-blog-now-has-stories-and-im-not-sure-why.en/","path":"/blog/coding/my-blog-now-has-stories-and-im-not-sure-why/","locale":"en"},"rawMarkdownBody":"In a world dominated by social media platforms, where 'Stories' have become an omnipresent feature, I found myself pondering - does my blog really need Stories? The answer, of course, is a resounding 'fuck no'. But here we are, my blog now has Stories, and I'm not entirely sure why.\r\n\r\n![Stories](../../uploads/blog/2023/09/stories-on-my-blog.gif)\r\n\r\n## The genesis of an unnecessary idea\r\nIt all started when I was using my mobile internet provider app, and to my surprise, they had added Stories to their app. This was simply too much for me to handle. A mix of joy, wonder, and confusion overtook me. I mean, why would an internet provider app need Stories? It was at this moment that I decided, if they can do it, why can't I? And so, the journey began.\r\n\r\nNaturally, as a developer with a penchant for the absurd, I fired up my code editor and started coding, and my goal was to Stories to my blog. The reasoning behind it? That's still a work in progress.\r\n\r\n## The technical journey\r\nThe process of adding Stories to my blog was surprisingly straightforward, thanks to the power of ~~communism~~ open-source. Open-source tools and libraries are a blessing for developers. They save time, effort, and often lead to better solutions than one could come up with on their own. After a bit of research, I stumbled upon a fantastic package that seemed to be the answer to all my prayers - [react-insta-stories](https://www.npmjs.com/package/react-insta-stories). This package is designed to create Instagram-like Stories on React, which was exactly what I was looking for.\r\n\r\nThe `react-insta-stories` package is incredibly versatile and customizable. It allows you to create stories with images, videos, and even custom components. You can customize the duration of each story, add action buttons, and much more. It was almost too good to be true. With this package, I was able to add Stories to my blog in no time, and with minimal effort.\r\n\r\n## Deciding what to show in the stories\r\nInitially, I thought about creating custom videos using default backgrounds from stock video websites. I even went as far as creating a script using FFmpeg and Node.js to automate the process. However, after some consideration, I decided to drop that idea. For the first iteration, I decided to create a story for each of the last five blog posts on my website.\r\n\r\nFor the stories content, I decided to keep it simple. I would display a background image from a stock photo related to the category of the blog post, overlay the title of the blog post, and include a link to access it. This way, the stories would not only serve as a visual teaser but also as a functional gateway to the full content of the blog post.\r\n\r\nTo make it more organized, I grouped these stories by the category of the blog post. For example, if out of the past five blog posts, three were in the \"coding\" category and two in the \"games\" category, I would display two different story previews - those little image circles that you click to see the stories. Then, \"inside\" each of these grouped circles, you would click and see those stories.\r\n\r\nThis approach seemed more manageable and, let's be honest, required less effort on my part. It also provided a way for visitors to quickly catch up on my latest posts in a more interactive and engaging manner. Not that I'm particularly concerned about visitor retention or engagement. I'm just adding this feature because, well, why not?\r\n\r\n## Let's get coding\r\nOnce the decision was made (with a shrug and a \"why not\"), it was time to dive into the deep end of the coding pool. Here's a brief overview of the steps I took, or rather, the rabbit hole I went down:\r\n\r\n1. **Creating the StoriesPreview component**: This component is responsible for displaying the preview of the stories on the main page of the blog.\r\n\r\n```javascript\r\nconst useStyles = makeStyles((theme) => ({\r\n  circleImage: {\r\n    width: 80,\r\n    height: 80,\r\n    borderRadius: '50%',\r\n    cursor: 'pointer',\r\n    objectFit: 'cover',\r\n    marginLeft: '5px',\r\n    position: 'relative',\r\n  },\r\n  storyImage: {\r\n    width: '100%',\r\n    height: '100%',\r\n    objectFit: 'cover',\r\n    objectPosition: 'center',\r\n  },\r\n  storiesWrapper: {\r\n    margin: '15px 0',\r\n  },\r\n  previewWrapper: {\r\n    margin: '15px 0',\r\n  },\r\n}));\r\n\r\nconst StoriesPreview = () => {\r\n  const data = useStaticQuery(\r\n    graphql`\r\n      query {\r\n        allMarkdownRemark(\r\n          filter: { frontmatter: { show: { eq: true } } }\r\n          sort: { fields: [frontmatter___date], order: DESC }\r\n          limit: 10\r\n        ) {\r\n          edges {\r\n            node {\r\n              excerpt(pruneLength: 60)\r\n              fields {\r\n                path\r\n                locale\r\n                postHashId\r\n              }\r\n              frontmatter {\r\n                title\r\n                categories\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    `\r\n  );\r\n\r\n  const intl = useIntl();\r\n  const posts = data.allMarkdownRemark.edges.filter(({ node }) => node.fields.locale === intl.locale);\r\n  const classes = useStyles();\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [currentStoriesIndex, setCurrentStoriesIndex] = useState(0);\r\n  const [seenStories, setSeenStories] = useLocalStorage('seenStories', []);\r\n  const [tempSeenStories, setTempSeenStories] = useState([]);\r\n  const stories = useStories(posts, seenStories);\r\n\r\n  const onStoryEnd = useCallback(\r\n    (currentStoriesIndex, currentStoryIndex) => {\r\n      const newTempSeenStories = new Set([\r\n        ...tempSeenStories,\r\n        stories[currentStoriesIndex][currentStoryIndex].postHashId,\r\n      ]);\r\n      setTempSeenStories([...newTempSeenStories]);\r\n    },\r\n    [tempSeenStories, stories]\r\n  );\r\n\r\n  const handleImageClick = useCallback((index) => {\r\n    setCurrentStoriesIndex(index);\r\n    setShowModal(true);\r\n  }, []);\r\n\r\n  const handleCloseModal = useCallback(() => {\r\n    setShowModal(false);\r\n    const newSeenStories = new Set([...seenStories, ...tempSeenStories]);\r\n    setSeenStories([...newSeenStories]);\r\n    setTempSeenStories([]);\r\n  }, [seenStories, setSeenStories, tempSeenStories]);\r\n\r\n  const handleNextStories = useCallback(() => {\r\n    if (currentStoriesIndex < stories.length - 1) {\r\n      setCurrentStoriesIndex(currentStoriesIndex + 1);\r\n    } else {\r\n      handleCloseModal();\r\n    }\r\n  }, [currentStoriesIndex, handleCloseModal, stories.length]);\r\n\r\n  const handlePreviousStories = useCallback(() => {\r\n    if (currentStoriesIndex > 0) {\r\n      setCurrentStoriesIndex(currentStoriesIndex - 1);\r\n    } else {\r\n      handleCloseModal();\r\n    }\r\n  }, [currentStoriesIndex, handleCloseModal]);\r\n\r\n  const handleOnAllStoriesEnd = useCallback(() => {\r\n    handleNextStories();\r\n  }, [handleNextStories]);\r\n\r\n  return (\r\n    <div className={classes.storiesWrapper}>\r\n      <div className={classes.previewWrapper}>\r\n        {stories.map((storiesArray, index) => {\r\n          return (\r\n            <StoryImage\r\n              key={index}\r\n              category={storiesArray[0].category}\r\n              previewImage={storiesArray[0].previewImage}\r\n              unseen={isClient() && storiesArray.some((story) => !story.viewed)}\r\n              onClick={() => handleImageClick(index)}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n      <Divider />\r\n      {showModal && (\r\n        <StoryModal\r\n          stories={stories[currentStoriesIndex]}\r\n          onClose={handleCloseModal}\r\n          onPrevious={handlePreviousStories}\r\n          onNext={handleNextStories}\r\n          showPrevious={currentStoriesIndex > 0}\r\n          showNext={currentStoriesIndex < stories.length - 1}\r\n          currentStoriesIndex={currentStoriesIndex}\r\n          onAllStoriesEnd={handleOnAllStoriesEnd}\r\n          onStoryEnd={(currentStoryIndex) => onStoryEnd(currentStoriesIndex, currentStoryIndex)}\r\n          onStoryStart={(currentStoryIndex) => onStoryEnd(currentStoriesIndex, currentStoryIndex)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n```\r\n\r\n2. **Creating the StoryImage component**: This component is responsible for displaying the image of the story.\r\n\r\n```javascript\r\nconst useStyles = makeStyles((theme) => ({\r\n  circleImage: ({ unseen }) => ({\r\n    width: 80,\r\n    height: 80,\r\n    borderRadius: '50%',\r\n    cursor: 'pointer',\r\n    objectFit: 'cover',\r\n    marginLeft: '5px',\r\n    position: 'relative',\r\n    ...(unseen\r\n      ? {\r\n        padding: 4,\r\n        background: theme.palette.secondary.main,\r\n      }\r\n      : {}),\r\n  }),\r\n}));\r\n\r\nconst StoryImage = ({ category, previewImage, unseen, onClick }) => {\r\n  const classes = useStyles({ unseen });\r\n\r\n  return (\r\n    // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\r\n    <img alt={category} src={previewImage} className={classes.circleImage} onClick={onClick} />\r\n  );\r\n};\r\n```\r\n\r\n3. **Creating the StoryModal component**: This component is responsible for displaying the story in a modal when the user clicks on the story image.\r\n\r\n```javascript\r\nconst useStyles = makeStyles((theme) => ({\r\n  modal: {\r\n    position: 'fixed',\r\n    top: 0,\r\n    left: 0,\r\n    width: '100%',\r\n    height: '100%',\r\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n    backdropFilter: 'blur(5px)',\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    zIndex: 9999,\r\n  },\r\n  modalContent: {\r\n    backgroundColor: 'transparent',\r\n    padding: theme.spacing(2),\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'flex-end',\r\n  },\r\n  closeButton: {\r\n    marginBottom: theme.spacing(1),\r\n  },\r\n  arrowButton: {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    transform: 'translateY(-50%)',\r\n    fontSize: '2rem',\r\n    cursor: 'pointer',\r\n  },\r\n  arrowLeft: {\r\n    left: theme.spacing(1),\r\n  },\r\n  arrowRight: {\r\n    right: theme.spacing(1),\r\n  },\r\n}));\r\n\r\nconst StoryModal = ({\r\n  stories,\r\n  onClose,\r\n  onPrevious,\r\n  onNext,\r\n  showPrevious,\r\n  showNext,\r\n  currentStoriesIndex,\r\n  onStoryEnd,\r\n  onStoryStart,\r\n  onAllStoriesEnd,\r\n}) => {\r\n  const classes = useStyles();\r\n  const intl = useIntl();\r\n  const isMobileDevice = useMemo(isMobile, []);\r\n\r\n  const handleKeyDown = useCallback(\r\n    (event) => {\r\n      if (event.key === 'ArrowRight' && showNext) {\r\n        onNext();\r\n      } else if (event.key === 'ArrowLeft' && showPrevious) {\r\n        onPrevious();\r\n      }\r\n    },\r\n    [onNext, onPrevious, showNext, showPrevious]\r\n  );\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [handleKeyDown]);\r\n\r\n  return (\r\n    <div className={classes.modal} onClick={onClose}>\r\n      <div className={classes.modalContent} onClick={(e) => e.stopPropagation()}>\r\n        <Button className={classes.closeButton} onClick={onClose}>\r\n          {intl.formatMessage({ id: 'close' })}\r\n        </Button>\r\n        {!isMobileDevice && showPrevious && (\r\n          <ArrowBackIcon\r\n            className={classNames(classes.arrowButton, classes.arrowLeft)}\r\n            onClick={onPrevious}\r\n          />\r\n        )}\r\n        {!isMobileDevice && showNext && (\r\n          <ArrowForwardIcon\r\n            className={classNames(classes.arrowButton, classes.arrowRight)}\r\n            onClick={onNext}\r\n          />\r\n        )}\r\n        <Stories\r\n          stories={stories}\r\n          key={currentStoriesIndex}\r\n          currentIndex={0}\r\n          onStoryEnd={onStoryEnd}\r\n          onStoryStart={onStoryStart}\r\n          onAllStoriesEnd={onAllStoriesEnd}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n```\r\n\r\n4. **Creating the useLocalStorage hook**: This custom hook is used to manage the state of the seen stories in the local storage.\r\n\r\n```javascript\r\nfunction useLocalStorage(key, initialValue) {\r\n  const [storedValue, setStoredValue] = useState(() => {\r\n    try {\r\n      const item = window.localStorage.getItem(key);\r\n      return item ? JSON.parse(item) : initialValue;\r\n    } catch (error) {\r\n      console.log(error);\r\n      return initialValue;\r\n    }\r\n  });\r\n\r\n  const setValue = (value) => {\r\n    try {\r\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\r\n      setStoredValue(valueToStore);\r\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  return [storedValue, setValue];\r\n}\r\n```\r\n\r\n5. **Creating the useStories hook**: This custom hook is used to manage the state of the stories.\r\n\r\n```javascript\r\nconst useStyles = makeStyles((theme) => ({\r\n  seeMore: {\r\n    color: theme.palette.text.primary,\r\n    textTransform: 'uppercase',\r\n    textDecoration: 'inherit',\r\n    background: 'rgb(0 0 0 / 40%)',\r\n    padding: '10px 0',\r\n    textAlign: 'center',\r\n    position: 'absolute',\r\n    margin: 'auto',\r\n    bottom: '0px',\r\n    zIndex: '9999',\r\n    width: '100%',\r\n    height: 'auto',\r\n  },\r\n  contentWrapper: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    background: '#333',\r\n    width: '100%',\r\n    color: 'white',\r\n    height: '100%',\r\n  },\r\n  contentTextWrapper: {\r\n    '& h1, p, a': {\r\n      background: 'rgb(0 0 0 / 40%)',\r\n      padding: '10px 25px',\r\n      margin: 0,\r\n    },\r\n  },\r\n}));\r\n\r\nconst useStories = (posts, seenStories) => {\r\n  const intl = useIntl();\r\n  const classes = useStyles();\r\n  const imagesData = useStaticQuery(graphql`\r\n    query {\r\n      allFile(filter: { relativeDirectory: { eq: \"categories\" }, extension: { eq: \"jpg\" } }) {\r\n        edges {\r\n          node {\r\n            base\r\n            childImageSharp {\r\n              gatsbyImageData\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  `);\r\n\r\n  return useMemo(() => {\r\n    const storiesMap = new Map();\r\n    posts.forEach(({ node }) => {\r\n      const { frontmatter, fields, excerpt } = node;\r\n      const { title, categories } = frontmatter;\r\n      const category = categories[0];\r\n      const { path, postHashId } = fields;\r\n      const imageNode = imagesData.allFile.edges.find((edge) => edge.node.base.includes(category));\r\n      const gatsbyImageData = getImage(imageNode.node.childImageSharp);\r\n      const categoryImage = gatsbyImageData.images.fallback.src;\r\n\r\n      const story = {\r\n        category,\r\n        previewImage: categoryImage,\r\n        postHashId,\r\n        duration: 5000,\r\n        viewed: seenStories.includes(postHashId),\r\n        content: ({ action, isPaused }) => (\r\n          <div\r\n            className={classes.contentWrapper}\r\n            style={{\r\n              background: `linear-gradient(rgba(51, 51, 51, 0.5), rgba(51, 51, 51, 0.5)), url(${categoryImage}) no-repeat center center`,\r\n            }}\r\n          >\r\n            <div className={classes.contentTextWrapper}>\r\n              <h1>{title}</h1>\r\n              <p>{excerpt}</p>\r\n            </div>\r\n            <Link to={path} className={classes.seeMore}>\r\n              {intl.formatMessage({ id: 'go_to_post' })}\r\n            </Link>\r\n          </div>\r\n        ),\r\n      };\r\n\r\n      const categoryStories = storiesMap.get(category) || [];\r\n      categoryStories.push(story);\r\n      storiesMap.set(category, categoryStories);\r\n    });\r\n\r\n    return Array.from(storiesMap.values()).sort((a, b) => {\r\n      const aHasFalse = a.some((item) => !item.viewed);\r\n      const bHasFalse = b.some((item) => !item.viewed);\r\n\r\n      if (aHasFalse && bHasFalse) {\r\n        return 0;\r\n      } else if (aHasFalse) {\r\n        return -1;\r\n      } else {\r\n        return 1;\r\n      }\r\n    });\r\n  }, [\r\n    posts,\r\n    imagesData.allFile.edges,\r\n    seenStories,\r\n    classes.contentWrapper,\r\n    classes.contentTextWrapper,\r\n    classes.seeMore,\r\n    intl,\r\n  ]);\r\n};\r\n```\r\n\r\n## Conclusion\r\nThe process of adding Stories to my blog was surprisingly straightforward, thanks to the open-source package `react-insta-stories`.\r\n\r\nWas I adding Stories to my blog to enhance the user experience? lol no. Do I regret it? Well... no really. In a world where we are constantly bombarded with new features, updates, and innovations, it's easy to get caught up in the whirlwind of \"keeping up with the JS\" 🥁.\r\n\r\nSo, here we are. My blog now has Stories, a completely unnecessary addition, but one that I can't help but find amusing. I hope you enjoy this completely unnecessary, yet oddly satisfying addition to my blog.\r\n\r\nSee you in the next post!\r\n","frontmatter":{"tags":["instagram","instagram stories","unnecessary inventions","gatsby","react","javascript"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-09-04T00:00:00.000Z","id":null,"path":"my-blog-now-has-stories-and-im-not-sure-why","show":true,"title":"My blog now has Stories, and I'm not sure why","hideExcerpt":false,"subtitle":"The saga of \"Well, It's here now\""}}},{"node":{"excerpt":"Quer alcançar os seus objetivos de fitness, como perder peso…","html":"<p>Quer alcançar os seus objetivos de fitness, como perder peso ou ganhar músculos? Tudo se resume a saber quantas calorias você queima em um dia, o que é chamado de Gasto Energético Diário Total (TDEE).</p>\n<p>Pense no TDEE como o número dourado que guia as suas escolhas de alimentação e treino. Você precisa conhecê-lo para descobrir quanto comer se quiser manter, ganhar alguns quilos ou emagrecer.</p>\n<p>Agora, existem várias ferramentas online que podem estimar o seu TDEE, mas obter dados do seu próprio corpo lhe dará o valor real.</p>\n<p>Eu entendo, calcular esses números pode ser chato, especialmente se a matemática não for a sua praia. Mas ei, a Google Fitness API está aqui para te ajudar nessa!</p>\n<p>Neste post, mostraremos como usar a Google Fitness API para calcular o seu TDEE e acompanhar o seu progresso ao longo do tempo.</p>\n<p>Claro, para que isso funcione, você precisa monitorar consistentemente o seu peso e ingestão de alimentos. Eu recomendo obter uma balança de bioimpedância, que pode medir o seu peso, percentual de gordura corporal e massa muscular e o aplicativo <a href=\"https://lifesum.com/\" target=\"_blank\" rel=\"noreferrer\">Lifesum</a> para rastrear a sua alimentação.</p>\n<h2 id=\"usando-a-google-fitness-api\" style=\"position:relative;\"><a href=\"#usando-a-google-fitness-api\" aria-label=\"usando a google fitness api permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usando a Google Fitness API</h2>\n<p>Já entendeu o básico sobre o TDEE? Show, agora vamos mergulhar em como podemos obter essas informações usando a Google Fitness API. Essa ferramenta bacana permite que programadores obtenham dados do Google Fit – esse é o aplicativo que coleta informações de saúde do seu telefone, smartwatches e outros aplicativos.</p>\n<p>Para começar com a Google Fitness API, primeiro, vá ao Google Cloud Console e ative a Fitness API. Depois, precisaremos criar credenciais para o nosso projeto, para podermos acessar a API. Para obter mais detalhes, consulte o <a href=\"https://developers.google.com/fit/rest/v1/get-started?hl=pt-br\" target=\"_blank\" rel=\"noreferrer\">Guia de primeiros passos</a>.</p>\n<p>Uma vez que tudo esteja configurado, é só usar a API para colocar as mãos em alguns dados suculentos do Google Fit. Estamos falando de estatísticas de peso e alimentação, que nos ajudarão a acertar o cálculo do nosso TDEE.</p>\n<h2 id=\"recuperando-e-analisando-os-dados\" style=\"position:relative;\"><a href=\"#recuperando-e-analisando-os-dados\" aria-label=\"recuperando e analisando os dados permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recuperando e Analisando os Dados</h2>\n<p>Agora que temos a nossa Google Fitness API configurada e pronta para usar, é hora de começar a recuperar e analisar os dados de que precisamos para calcular o nosso TDEE. O primeiro passo é fazer uma solicitação à API, pedindo os nossos dados de peso e nutrição dos últimos 30 dias.</p>\n<p>Aqui está um exemplo de como essa solicitação pode ser feita:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> google <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'googleapis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchData</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> auth <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> google<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span><span class=\"token function\">fromJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TOKEN_TYPE</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">client_id</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CLIENT_ID</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">client_secret</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CLIENT_SECRET</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">refresh_token</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">REFRESH_TOKEN</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  auth<span class=\"token punctuation\">.</span>scopes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token string\">'https://www.googleapis.com/auth/fitness.nutrition.read'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'https://www.googleapis.com/auth/fitness.body.read'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n  <span class=\"token keyword\">const</span> endDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> startDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  startDate<span class=\"token punctuation\">.</span><span class=\"token function\">setDate</span><span class=\"token punctuation\">(</span>startDate<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// past 30 days</span>\r\n  <span class=\"token keyword\">const</span> startTimeNs <span class=\"token operator\">=</span> startDate<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> endTimeNs <span class=\"token operator\">=</span> endDate<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> weightData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchDataForDataSource</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'derived:com.google.weight:com.google.android.gms:merge_weight'</span><span class=\"token punctuation\">,</span>\r\n    auth<span class=\"token punctuation\">,</span>\r\n    startTimeNs<span class=\"token punctuation\">,</span>\r\n    endTimeNs\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> fatPercentageData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchDataForDataSource</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'derived:com.google.body.fat.percentage:com.google.android.gms:merged'</span><span class=\"token punctuation\">,</span>\r\n    auth<span class=\"token punctuation\">,</span>\r\n    startTimeNs<span class=\"token punctuation\">,</span>\r\n    endTimeNs\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> nutritionData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchDataForDataSource</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'derived:com.google.nutrition:com.google.android.gms:merged'</span><span class=\"token punctuation\">,</span>\r\n    auth<span class=\"token punctuation\">,</span>\r\n    startTimeNs<span class=\"token punctuation\">,</span>\r\n    endTimeNs\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A função <code class=\"language-text\">google.auth.fromJSON</code> é usada para criar um objeto de autenticação que pode ser utilizado para fazer solicitações à Google Fitness API. Em seguida, definimos os escopos para os quais queremos solicitar dados, que neste caso são <code class=\"language-text\">https://www.googleapis.com/auth/fitness.nutrition.read</code> e <code class=\"language-text\">https://www.googleapis.com/auth/fitness.body.read</code>. Depois disso, definimos a data de início e a data de término para a nossa solicitação, que são 30 dias atrás e hoje, respectivamente. Finalmente, chamamos a função <code class=\"language-text\">fetchDataForDataSource</code> três vezes, uma para os dados de peso, uma para os dados de percentual de gordura e uma para os dados de nutrição.</p>\n<p>Mas o que a função <code class=\"language-text\">fetchDataForDataSource</code> faz? Vamos dar uma olhada:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fitness <span class=\"token operator\">=</span> google<span class=\"token punctuation\">.</span><span class=\"token function\">fitness</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchDataForDataSource</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">dataSourceId<span class=\"token punctuation\">,</span> auth<span class=\"token punctuation\">,</span> startTimeNs<span class=\"token punctuation\">,</span> endTimeNs</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> fitness<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">.</span>dataSources<span class=\"token punctuation\">.</span>datasets<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">userId</span><span class=\"token operator\">:</span> <span class=\"token string\">'me'</span><span class=\"token punctuation\">,</span>\r\n    dataSourceId<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">datasetId</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>startTimeNs<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>endTimeNs<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    auth<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Com a API de fitness do <code class=\"language-text\">googleapis</code>, podemos fazer solicitações à Google Fitness API. Neste caso, estamos usando o método <code class=\"language-text\">users.dataSources.datasets.get</code> para obter dados de uma fonte de dados específica. Passamos o <code class=\"language-text\">userId</code> como <code class=\"language-text\">me</code> para obter dados do usuário atual, o <code class=\"language-text\">dataSourceId</code> que queremos obter dados, e o <code class=\"language-text\">datasetId</code>, que é uma combinação do horário de início e término em nanossegundos. Finalmente, passamos o objeto de autenticação que criamos anteriormente.</p>\n<h2 id=\"agregando-os-dados\" style=\"position:relative;\"><a href=\"#agregando-os-dados\" aria-label=\"agregando os dados permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Agregando os Dados</h2>\n<p>Vamos dar uma olhada nos dados que recebemos da Google Fitness API:</p>\n<h3 id=\"weight\" style=\"position:relative;\"><a href=\"#weight\" aria-label=\"weight permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Weight</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"minStartTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690662651313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"maxEndTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1691008251313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"dataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"derived:com.google.weight:com.google.android.gms:merge_weight\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"point\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token property\">\"startTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"endTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"dataTypeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"com.google.weight\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"originDataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"raw:com.google.weight:cn.fitdays.fitdays:\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">77.59</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"modifiedTimeMillis\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690963181330\"</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"fat-percentage\" style=\"position:relative;\"><a href=\"#fat-percentage\" aria-label=\"fat percentage permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fat Percentage</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"minStartTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690662651313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"maxEndTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1691008251313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"dataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"derived:com.google.body.fat.percentage:com.google.android.gms:merged\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"point\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token property\">\"startTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"endTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"dataTypeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"com.google.body.fat.percentage\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"originDataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"raw:com.google.body.fat.percentage:cn.fitdays.fitdays:\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"modifiedTimeMillis\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690963181468\"</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"nutrition\" style=\"position:relative;\"><a href=\"#nutrition\" aria-label=\"nutrition permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nutrition</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"minStartTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690662651313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"maxEndTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1691008251313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"dataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"derived:com.google.nutrition:com.google.android.gms:merged\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"point\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token property\">\"startTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"endTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"dataTypeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"com.google.nutrition\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"originDataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"raw:com.google.nutrition:com.sillens.shapeupclub:health_platform\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fat.total\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">16.349998474121094</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sodium\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"potassium\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fat.unsaturated\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fat.saturated\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">13.34999942779541</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"protein\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5.25</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"carbs.total\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">60.45000076293945</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cholesterol\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"calories\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">412.5</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sugar\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">42.599998474121094</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dietary_fiber\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span>\r\n          <span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"intVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"stringVal\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Salted caramel cornetto\"</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"modifiedTimeMillis\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690805813623\"</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Como você pode ver, os dados estão num formato que não é muito fácil de trabalhar. Precisamos analisar esses dados e agregá-los num formato utilizável.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> curatedWeightData <span class=\"token operator\">=</span> <span class=\"token function\">extractBodyData</span><span class=\"token punctuation\">(</span>weightData<span class=\"token punctuation\">,</span> <span class=\"token string\">'weight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> curatedFatPercentageData <span class=\"token operator\">=</span> <span class=\"token function\">extractBodyData</span><span class=\"token punctuation\">(</span>fatPercentageData<span class=\"token punctuation\">,</span> <span class=\"token string\">'fatPercentage'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> curatedNutritionData <span class=\"token operator\">=</span> <span class=\"token function\">aggregateNutritionData</span><span class=\"token punctuation\">(</span><span class=\"token function\">extractNutritionData</span><span class=\"token punctuation\">(</span>nutritionData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Após usar essas funções misteriosas, os seus dados ficarão assim:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>curatedWeightData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// [{ date: '02/08/2023', weight: 77.5999984741211 }]</span>\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>curatedFatPercentageData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// [{ date: '02/08/2023', fatPercentage: 20 }]</span>\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>curatedNutritionData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// [{ date: '02/08/2023', foods: ['Salted caramel cornetto'], protein: 5.25, fat: 16.349998474121094, carbs: 60.45000076293945, fiber: 0, sugar: 42.599998474121094 }]</span></code></pre></div>\n<p>Ok, agora vamos escrever as funções que fazem essa mágica, ou melhor, vamos pedir ao Chat GPT para fazer isso para nós.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">nanosToDateString</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nanos</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> milliseconds <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>nanos<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>milliseconds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleDateString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'en-GB'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">extractBodyData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">jsonArray<span class=\"token punctuation\">,</span> type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">return</span> jsonArray<span class=\"token punctuation\">.</span>point<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dataPoint</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> date <span class=\"token operator\">=</span> <span class=\"token function\">nanosToDateString</span><span class=\"token punctuation\">(</span>dataPoint<span class=\"token punctuation\">.</span>startTimeNanos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> dataPoint<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>fpVal<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> date<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>E para a agregação de dados nutricionais:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">aggregateNutritionData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nutritionArray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> aggregatedData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  nutritionArray<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nutrition</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> date<span class=\"token punctuation\">,</span> foodName<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>nutritionValues <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> nutrition<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>aggregatedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      aggregatedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        date<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">foods</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>foodName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token operator\">...</span>nutritionValues<span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      aggregatedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>foods<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>foodName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n      Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>nutritionValues<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>nutritionValues<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n          aggregatedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> nutritionValues<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>aggregatedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A última coisa a fazer é mesclar essas 3 matrizes em uma e classificá-la por data.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">mergeDataArrays</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>arrays</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> mergedData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  arrays<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    array<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> date<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> item<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mergedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        mergedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> date<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>mergedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> rest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>mergedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">mergeDataArrays</span><span class=\"token punctuation\">(</span>curatedWeightData<span class=\"token punctuation\">,</span> curatedFatPercentageData<span class=\"token punctuation\">,</span> curatedNutritionData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// [{\"date\":\"02/08/2023\",\"weight\":77.5999984741211,\"fatPercentage\":20,\"foods\":[\"Salted caramel cornetto\"],\"protein\":5.25,\"fat\":16.349998474121094,\"carbs\":60.45000076293945,\"fiber\":0,\"sugar\":42.599998474121094}]</span></code></pre></div>\n<p><del>Tudo bem, é hora de usar esses dados para obter algumas informações.</del> Na verdade, precisamos de mais uma coisa antes de podermos fazer isso.</p>\n<h2 id=\"massa-muscular-e-composicao-de-gordura-corporal\" style=\"position:relative;\"><a href=\"#massa-muscular-e-composicao-de-gordura-corporal\" aria-label=\"massa muscular e composicao de gordura corporal permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Massa muscular e composição de gordura corporal</h2>\n<p>Antes de mergulhar nos cálculos, precisamos entender como o músculo e a gordura estão distribuídos no corpo.</p>\n<p>Eu queria descobrir quantas calorias existem em 1kg de músculo e 1kg de gordura, então comecei a procurar livros no <a href=\"https://www.google.com/books\" target=\"_blank\" rel=\"noreferrer\">Google Books</a> para encontrar a composição exata do tecido muscular e da gordura, e encontrei algumas informações em <a href=\"https://www.google.com/books/edition/The_Nutritionist/olIsBgAAQBAJ?hl=en&#x26;gbpv=1&#x26;pg=PA148&#x26;printsec=frontcover\" target=\"_blank\" rel=\"noreferrer\">The Nutritionist Food, Nutrition, and Optimal Health By Robert Wildman</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.71875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzElEQVQoz3WRS4+iUBSE+xebuCBR4/PvTFy4cKkhKkZU5KmJROV1CQJyLxcQFAkyaXWc6emZ2n+nqk59IISWy6XjOOfzeTwe/3hoNBrFcRxFkeu6zEOLxcIwDIxxlmXFL31cr1eO4wzDgBDOZrPhcDgYDCaTSRiGURQBAEiSpCiKJElZlk+nU5IkRVHc7/cXzDAMAMDzPEmSeJ7nOI7n+SAI4jg+HA6NRqNarRIEQdO07/uXy+W38+12kyTJMAzXdS3Lwhj7vg8A8H3/CbdarXq9XqlU5vM5xphhGFEUdV2PougjTVOO4wAAjuNgjJ8nEULfYZqmMcbT6XS1WgmC4HneK7Zpmn/Cnuf90xkhJMvydrsVRfETfju7rvuGIYQY4yRJFEVpt9tv2Pd9lmUlSbIsKwzDz87fY0MI/9eZZdn1eg0hfMGCIPwV+w0ritLpdJrNZq1We8Z+fvs1VZZlm81G13XbtiGEeZ5nWeY4DkIojuPdbkcQRLlcLpVKFEUhhJ47v6YqikJVVQAAxtg0TU3TVFU1DCMMwyAIbNvu9/u9Xq/b7SqKghBK0/QLnOd5URRxHMuyrGna4aEoip5v3+/3CCHXdY/HY/FVPwEsxGsqnk8+zAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"muscle and fat composition\"\n        title=\"muscle and fat composition\"\n        src=\"/static/78e0682ff9af97a8ebc8b291b53f97a9/42a19/muscle-and-fat-composition.png\"\n        srcset=\"/static/78e0682ff9af97a8ebc8b291b53f97a9/e3135/muscle-and-fat-composition.png 256w,\n/static/78e0682ff9af97a8ebc8b291b53f97a9/06341/muscle-and-fat-composition.png 512w,\n/static/78e0682ff9af97a8ebc8b291b53f97a9/42a19/muscle-and-fat-composition.png 1024w,\n/static/78e0682ff9af97a8ebc8b291b53f97a9/775e3/muscle-and-fat-composition.png 1189w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Mas eu ainda precisava saber qual é o custo energético para construir esse 1kg de músculo e 1kg de gordura, então, para isso, perguntei ao ChatGPT (em inglês e traduzido para essa postagem).</p>\n<blockquote>\n<p>Olá. Qual é a composição exata em porcentagens de 1kg de músculo esquelético e 1kg de tecido adiposo? Além disso, forneça a fonte da informação. Por favor, me dê uma resposta curta, obrigado.</p>\n</blockquote>\n<blockquote>\n<p>Claro! Aqui está uma resposta curta para a composição geral de 1kg de músculo esquelético e 1kg de tecido adiposo:</p>\n<p>Músculo Esquelético (1kg):</p>\n<ul>\n<li>Água: ~75%</li>\n<li>Proteína: ~20%</li>\n<li>Gorduras: ~5%</li>\n<li>Outros (minerais, glicogênio, etc.): Quantidades vestigiais</li>\n</ul>\n<p>Tecido Adiposo (1kg):</p>\n<ul>\n<li>Lipídios: ~80-90%</li>\n<li>Água: ~10-20%</li>\n<li>Proteína: ~2%</li>\n<li>Outros (minerais, etc.): Quantidades vestigiais</li>\n</ul>\n<p>Por favor, note que esses valores podem variar dependendo de fatores como idade, sexo, dieta e saúde geral. A informação é baseada no entendimento científico geral e pode ser encontrada em vários livros de fisiologia e anatomia humana, como “Human Anatomy &#x26; Physiology” de Elaine N. Marieb e Katja Hoehn.</p>\n</blockquote>\n<blockquote>\n<p>E qual é a eficiência de síntese em porcentagem para construir 1 grama de proteína muscular e 1 grama de lipídios? Além disso, forneça a fonte da informação. Por favor, me dê uma resposta curta, obrigado.</p>\n</blockquote>\n<blockquote>\n<p>A eficiência de síntese para construir proteína muscular e lipídios varia amplamente dependendo de fatores como espécie, dieta, idade e saúde. No entanto, uma estimativa geral pode ser fornecida:</p>\n<ul>\n<li>Para proteína muscular, a eficiência é geralmente em torno de 20-25%. Isso significa que apenas cerca de 20-25% dos aminoácidos consumidos são incorporados à proteína muscular.</li>\n<li>Para lipídios, a eficiência de conversão de gorduras dietéticas pode ser maior, em torno de 90-95%.</li>\n</ul>\n<p>Esses números são estimativas aproximadas e podem variar significativamente. A informação é derivada do conhecimento geral em bioquímica nutricional e pode ser encontrada em livros como “Biochemical, Physiological, and Molecular Aspects of Human Nutrition” de Martha H. Stipanuk e Marie A. Caudill, e artigos científicos sobre o assunto. Sempre consulte pesquisas específicas ou um profissional da área para informações mais precisas adaptadas a uma situação particular.</p>\n</blockquote>\n<p>Legal. Vamos fazer alguns cálculos agora!</p>\n<h3 id=\"calculo-do-musculo\" style=\"position:relative;\"><a href=\"#calculo-do-musculo\" aria-label=\"calculo do musculo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cálculo do músculo</h3>\n<p>Agora que sabemos que um quilograma de músculo é composto por 20% de proteína e 5% de gordura. Com 1g de proteína tendo 4 calorias e 1g de gordura contendo 9 calorias, isso significa que 1kg de músculo tem 800 calorias de proteína e 450 de gordura, totalizando 1250 calorias.</p>\n<h3 id=\"calculo-de-gordura\" style=\"position:relative;\"><a href=\"#calculo-de-gordura\" aria-label=\"calculo de gordura permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cálculo de gordura</h3>\n<p>Quanto à gordura, um quilograma é composto por 85% de lipídios e 2% de proteína. Com 1g de lipídios tendo 9 calorias, 1g de proteína tendo 4 calorias, isso significa que 1kg de gordura tem 7650 calorias de lipídios e 80 calorias de proteína, totalizando 7730 calorias.</p>\n<h3 id=\"custo-de-sintese\" style=\"position:relative;\"><a href=\"#custo-de-sintese\" aria-label=\"custo de sintese permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Custo de síntese</h3>\n<p>Quando se trata de construir os componentes essenciais do nosso corpo, a eficiência varia para diferentes substâncias.</p>\n<p>Para proteínas, a eficiência do nosso corpo é de cerca de ~23%. Isso significa que para cada 1g de proteína, que tem 4kcal, precisamos de cerca de ~17kcal para produzi-la. Pense assim: 4kcal vão para os aminoácidos reais na proteína, e as outras 13kcal são a energia usada no processo de construção.</p>\n<p>Agora, os lipídios são uma história diferente. Nosso corpo é um pouco mais eficiente aqui, em ~93%. Então, para 1g de lipídios, que tem 9kcal, só leva cerca de 10kcal para produzi-lo. São 9kcal para os aminoácidos nos lipídios, e apenas 1kcal para a síntese.</p>\n<h3 id=\"calculando-o-custo-energetico\" style=\"position:relative;\"><a href=\"#calculando-o-custo-energetico\" aria-label=\"calculando o custo energetico permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Calculando o custo energético</h3>\n<p>Então, vamos entender todos esses números e ver o que eles significam para o custo energético de construir músculo e gordura.</p>\n<p>Para o músculo, temos 1kg com 200g de proteína e 50g de lipídios. Como leva cerca de 17kcal para fazer 1g de proteína e 10kcal para 1g de lipídios, o custo energético total para 1kg de músculo é:</p>\n<ul>\n<li>Proteína: 200 x 17 = 3400kcal</li>\n<li>Gordura: 50 x 10 = 500kcal</li>\n<li>Total Geral: 3400 + 500 = 3900kcal</li>\n</ul>\n<p>Agora, para a gordura corporal, com 1kg tendo 850g de lipídios e 20g de proteína, o custo energético total é:</p>\n<ul>\n<li>Lipídios: 850 x 10 = 8500kcal</li>\n<li>Proteína: 20 x 17 = 340kcal</li>\n<li>Total Geral: 8500 + 340 = 8840kcal</li>\n</ul>\n<p>Então, aí está! Com esses números, vou adicionar as seguintes constantes ao meu código:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">CALORIES_STORED_KG_FAT</span> <span class=\"token operator\">=</span> <span class=\"token number\">7730</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CALORIES_BUILD_KG_FAT</span> <span class=\"token operator\">=</span> <span class=\"token number\">8840</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CALORIES_STORED_KG_MUSCLE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1250</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CALORIES_BUILD_KG_MUSCLE</span> <span class=\"token operator\">=</span> <span class=\"token number\">3900</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Lembrete rápido de que essas são todas estimativas, e os números reais podem variar dependendo da composição do seu corpo, dieta e outros fatores. Além disso, eu não sou médico nem nutricionista, então, por favor, não tome isso como um conselho médico.</p>\n<h2 id=\"calculando-o-tdee\" style=\"position:relative;\"><a href=\"#calculando-o-tdee\" aria-label=\"calculando o tdee permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Calculando o TDEE</h2>\n<p>Agora que temos os nossos dados de peso e percentual de gordura analisados e agregados em um formato utilizável, podemos começar a calcular o nosso TDEE.</p>\n<p>Para calcular o seu TDEE, siga estas etapas:</p>\n<ol>\n<li>Obtenha o número total de calorias consumidas durante o período de 30 dias.</li>\n<li>Calcule a diferença de peso entre o início e o fim do período de 30 dias.</li>\n<li>Converta a diferença de peso em calorias multiplicando-a pelo número de músculo/gordura ganho/perdido.</li>\n<li>Subtraia o resultado da etapa 3 do total de calorias consumidas no período de 30 dias.</li>\n<li>Divida o resultado da etapa 4 por 30 para obter a sua ingestão média diária de calorias, que deve ser o seu TDEE.</li>\n</ol>\n<p>Aqui está o código para calcular o TDEE e mais usando o código:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">calculateStatistics</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dataArray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> totalDays <span class=\"token operator\">=</span> dataArray<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\r\n    totalFat<span class=\"token punctuation\">,</span>\r\n    totalFiber<span class=\"token punctuation\">,</span>\r\n    totalCarbs<span class=\"token punctuation\">,</span>\r\n    finalWeight<span class=\"token punctuation\">,</span>\r\n    totalProtein<span class=\"token punctuation\">,</span>\r\n    totalCalories<span class=\"token punctuation\">,</span>\r\n    initialWeight<span class=\"token punctuation\">,</span>\r\n    initialFatPercentage<span class=\"token punctuation\">,</span>\r\n    finalFatPercentage<span class=\"token punctuation\">,</span>\r\n    initialDate<span class=\"token punctuation\">,</span>\r\n    finalDate<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">accumulateData</span><span class=\"token punctuation\">(</span>dataArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\r\n    fatDifference<span class=\"token punctuation\">,</span>\r\n    weightDifference<span class=\"token punctuation\">,</span>\r\n    muscleDifference<span class=\"token punctuation\">,</span>\r\n    fatDifferencePercentage<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">calculateWeightDifference</span><span class=\"token punctuation\">(</span>initialWeight<span class=\"token punctuation\">,</span> finalWeight<span class=\"token punctuation\">,</span> initialFatPercentage<span class=\"token punctuation\">,</span> finalFatPercentage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> muscleCalories<span class=\"token punctuation\">,</span> fatCalories <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">calculateMuscleAndFatCalories</span><span class=\"token punctuation\">(</span>muscleDifference<span class=\"token punctuation\">,</span> fatDifference<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> tdee <span class=\"token operator\">=</span> <span class=\"token function\">calculateTDEE</span><span class=\"token punctuation\">(</span>totalCalories<span class=\"token punctuation\">,</span> muscleCalories<span class=\"token punctuation\">,</span> fatCalories<span class=\"token punctuation\">,</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">*From </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>initialDate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>finalDate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">*\\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Days Range: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>totalDays<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">TDEE: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>tdee<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kcal</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Calories: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalCalories <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kcal</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Protein: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalProtein <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> g</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Carbs: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalCarbs <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> g</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Fat: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalFat <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> g</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Fiber: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalFiber <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> g</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Weight Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>weightDifference <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'+'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>weightDifference<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kg (</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>initialWeight<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>finalWeight<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fat Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fatDifference <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'+'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fatDifference<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kg</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Non-Fat Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>muscleDifference <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'+'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>muscleDifference<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kg</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fat Percentage Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fatDifferencePercentage <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'+'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fatDifferencePercentage<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">%  (</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>initialFatPercentage<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>finalFatPercentage<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Esta função retorna uma <code class=\"language-text\">string</code> com detalhes para um período de 30 dias, incluindo o número de dias, TDEE, ingestão média diária de calorias, proteínas, carboidratos, gordura e fibras, bem como as diferenças de peso, gordura, não gordura e percentual de gordura entre o início e o fim do período.</p>\n<p>Quanto às funções ausentes <code class=\"language-text\">accumulateData</code>, <code class=\"language-text\">calculateWeightDifference</code> e <code class=\"language-text\">calculateTDEE</code>, aqui estão elas:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">accumulateData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dataArray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> lastOccurrence <span class=\"token operator\">=</span> dataArray<span class=\"token punctuation\">[</span>dataArray<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> firstOccurrence <span class=\"token operator\">=</span> dataArray<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> accumulator <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">totalCalories</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">totalProtein</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">totalCarbs</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">totalFat</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">totalFiber</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">initialWeight</span><span class=\"token operator\">:</span> firstOccurrence<span class=\"token operator\">?.</span>weight<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">finalWeight</span><span class=\"token operator\">:</span> lastOccurrence<span class=\"token operator\">?.</span>weight<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">initialFatPercentage</span><span class=\"token operator\">:</span> firstOccurrence<span class=\"token operator\">?.</span>fatPercentage<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">finalFatPercentage</span><span class=\"token operator\">:</span> lastOccurrence<span class=\"token operator\">?.</span>fatPercentage<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">initialDate</span><span class=\"token operator\">:</span> firstOccurrence<span class=\"token operator\">?.</span>date <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">finalDate</span><span class=\"token operator\">:</span> lastOccurrence<span class=\"token operator\">?.</span>date <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  dataArray<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalCalories <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>caloriesConsumed<span class=\"token punctuation\">;</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalProtein <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>protein<span class=\"token punctuation\">;</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalCarbs <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>carbs<span class=\"token punctuation\">;</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalFat <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>fat<span class=\"token punctuation\">;</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalFiber <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>fiber<span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> accumulator<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">calculateWeightDifference</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">initialWeight<span class=\"token punctuation\">,</span> finalWeight<span class=\"token punctuation\">,</span> initialFatPercentage<span class=\"token punctuation\">,</span> finalFatPercentage</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> weightDifference <span class=\"token operator\">=</span> finalWeight <span class=\"token operator\">-</span> initialWeight<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> initialFat <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>initialFatPercentage <span class=\"token operator\">*</span> initialWeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> finalFat <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>finalFatPercentage <span class=\"token operator\">*</span> finalWeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> fatDifference <span class=\"token operator\">=</span> finalFat <span class=\"token operator\">-</span> initialFat<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> muscleDifference <span class=\"token operator\">=</span> weightDifference <span class=\"token operator\">-</span> fatDifference<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> fatDifferencePercentage <span class=\"token operator\">=</span> finalFatPercentage <span class=\"token operator\">-</span> initialFatPercentage<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> weightDifference<span class=\"token punctuation\">,</span> fatDifference<span class=\"token punctuation\">,</span> muscleDifference<span class=\"token punctuation\">,</span> fatDifferencePercentage <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">calculateTDEE</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">totalCalories<span class=\"token punctuation\">,</span> muscleCalories<span class=\"token punctuation\">,</span> fatCalories<span class=\"token punctuation\">,</span> totalDays</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> caloriesDifference <span class=\"token operator\">=</span> fatCalories <span class=\"token operator\">+</span> muscleCalories<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>totalCalories <span class=\"token operator\">-</span> caloriesDifference<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Como você pode ver, a função <code class=\"language-text\">calculateStatistics</code> chama a função <code class=\"language-text\">accumulateData</code> para obter o total de calorias, proteínas, carboidratos, gordura e fibras consumidas durante o período de 30 dias, bem como o peso inicial e final e o percentual de gordura.</p>\n<p>Em seguida, ela chama a função <code class=\"language-text\">calculateWeightDifference</code> para calcular as diferenças de peso, gordura, não gordura e percentual de gordura entre o início e o fim do período.</p>\n<p>Finalmente, ela chama a função <code class=\"language-text\">calculateTDEE</code> para calcular o TDEE.</p>\n<h2 id=\"enviar-os-dados-para-o-telegram\" style=\"position:relative;\"><a href=\"#enviar-os-dados-para-o-telegram\" aria-label=\"enviar os dados para o telegram permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enviar os dados para o Telegram</h2>\n<p>Após calcular o seu TDEE, você pode querer compartilhar essa informação com outras pessoas, como um personal trainer ou um amigo. Uma maneira fácil de fazer isso é enviando os dados para um grupo de chat no Telegram. Isso pode ser feito usando a API do Bot do Telegram.</p>\n<p>Aqui está um exemplo de trecho de código que envia o resultado do TDEE para um grupo de chat no Telegram:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token function\">calculateStatistics</span><span class=\"token punctuation\">(</span>agragatedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">nodeFetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://api.telegram.org/bot</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TELEGRAM_BOT_ID</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/sendMessage</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  text<span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">chat_id</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TELEGRAM_GROUP_ID</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">parse_mode</span><span class=\"token operator\">:</span> <span class=\"token string\">'markdown'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Neste código, estamos usando o pacote <code class=\"language-text\">node-fetch</code> para fazer uma requisição HTTP POST ao método sendMessage da API do Bot do Telegram. Passamos o resultado do TDEE como o campo de texto no corpo da requisição, junto com o chat_id do grupo do Telegram para o qual queremos enviar a mensagem. Também definimos o campo <code class=\"language-text\">parse_mode</code> como <code class=\"language-text\">markdown</code> para habilitar a formatação na mensagem.</p>\n<p>Note que, para usar esse código, você precisará definir as variáveis de ambiente <code class=\"language-text\">TELEGRAM_BOT_ID</code> e <code class=\"language-text\">TELEGRAM_GROUP_ID</code> com os valores apropriados.</p>\n<h2 id=\"bonus\" style=\"position:relative;\"><a href=\"#bonus\" aria-label=\"bonus permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bônus</h2>\n<p>Você pode copiar o texto que obteve deste script e enviá-lo para o ChatGPT para obter ainda mais insights 👀.</p>\n<blockquote>\n<p>Olá. O que você acha desses dados do meu acompanhamento de saúde pessoal dos últimos 30 dias ou mais? Você pode me dar uma análise curta e concisa sobre o que estou fazendo bem e onde devo melhorar? Obrigado\r\n&#x3C;- Meus Dados em Texto -></p>\n</blockquote>\n<blockquote>\n<p>Claro! Com base nos dados que você forneceu, aqui está uma análise breve:</p>\n<p>O Que Você Está Fazendo Bem:\r\nEquilíbrio Calórico: A sua ingestão calórica média está muito próxima do seu Gasto Energético Diário Total (TDEE), o que sugere que você está mantendo seu peso efetivamente.\r\nPerda de Peso: Você perdeu 0,80 kg no último mês, o que é uma taxa de perda de peso saudável e sustentável, se esse for o seu objetivo.\r\nIngestão de Proteína: A sua ingestão média de proteína parece estar em uma boa faixa, especialmente se você está praticando atividades físicas que requerem reparo e crescimento muscular.</p>\n<p>Áreas para Melhoria:\r\nAumento da Porcentagem de Gordura: O aumento na porcentagem de gordura e na massa gorda pode ser uma preocupação se você estiver buscando reduzir a gordura corporal. Isso pode estar relacionado ao tipo de alimentos que você está consumindo ou ao equilíbrio de macronutrientes.\r\nIngestão de Fibras: Sua ingestão média de fibras está um pouco baixa. Aumentar a ingestão de fibras consumindo mais grãos integrais, frutas e vegetais pode auxiliar na digestão e pode ajudar no controle do peso.</p>\n<p>Lembre-se, esses insights são baseados nos dados fornecidos e nas diretrizes gerais. As necessidades individuais podem variar amplamente, então é sempre uma boa ideia consultar um profissional de saúde ou nutricionista para obter orientação personalizada.</p>\n</blockquote>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Pronto, agora você sempre saberá exatamente qual é o seu TDEE. Você pode usar essa informação para ajustar a sua dieta e rotina de exercícios para alcançar os seus objetivos de fitness, você pode até colocar este script num fluxo de trabalho do GitHub Actions para executá-lo automaticamente todos os dias e enviar os resultados para um grupo de chat no Telegram.</p>\n<p>Se você quiser ver o código completo, <a href=\"https://github.com/blopa/google-fit-telegram/\" target=\"_blank\" rel=\"noreferrer\">você pode encontrá-lo no meu GitHub</a>, que inclui um workflow do GitHub Action que executa o script diariamente e envia os resultados para um chat do Telegram, portanto, sinta-se à vontade para simplesmente clonar o repositório e usá-lo.</p>\n<p>Espero que você tenha achado este artigo útil. Se tiver alguma dúvida ou comentário, fique à vontade para <a href=\"/pt-br/contact\">entrar em contato</a> ou deixar o sua opinião na seção de comentários abaixo.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTA4LTAyVDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-08-02-usando-google-fitness-api-para-calcular-meu-tdee-e-mais.pt-br/","path":"/blog/coding/usando-google-fitness-api-para-calcular-meu-tdee-e-mais/","locale":"pt-br"},"rawMarkdownBody":"Quer alcançar os seus objetivos de fitness, como perder peso ou ganhar músculos? Tudo se resume a saber quantas calorias você queima em um dia, o que é chamado de Gasto Energético Diário Total (TDEE).\r\n\r\nPense no TDEE como o número dourado que guia as suas escolhas de alimentação e treino. Você precisa conhecê-lo para descobrir quanto comer se quiser manter, ganhar alguns quilos ou emagrecer.\r\n\r\nAgora, existem várias ferramentas online que podem estimar o seu TDEE, mas obter dados do seu próprio corpo lhe dará o valor real.\r\n\r\nEu entendo, calcular esses números pode ser chato, especialmente se a matemática não for a sua praia. Mas ei, a Google Fitness API está aqui para te ajudar nessa!\r\n\r\nNeste post, mostraremos como usar a Google Fitness API para calcular o seu TDEE e acompanhar o seu progresso ao longo do tempo.\r\n\r\nClaro, para que isso funcione, você precisa monitorar consistentemente o seu peso e ingestão de alimentos. Eu recomendo obter uma balança de bioimpedância, que pode medir o seu peso, percentual de gordura corporal e massa muscular e o aplicativo [Lifesum](https://lifesum.com/) para rastrear a sua alimentação.\r\n\r\n## Usando a Google Fitness API\r\nJá entendeu o básico sobre o TDEE? Show, agora vamos mergulhar em como podemos obter essas informações usando a Google Fitness API. Essa ferramenta bacana permite que programadores obtenham dados do Google Fit – esse é o aplicativo que coleta informações de saúde do seu telefone, smartwatches e outros aplicativos.\r\n\r\nPara começar com a Google Fitness API, primeiro, vá ao Google Cloud Console e ative a Fitness API. Depois, precisaremos criar credenciais para o nosso projeto, para podermos acessar a API. Para obter mais detalhes, consulte o [Guia de primeiros passos](https://developers.google.com/fit/rest/v1/get-started?hl=pt-br).\r\n\r\nUma vez que tudo esteja configurado, é só usar a API para colocar as mãos em alguns dados suculentos do Google Fit. Estamos falando de estatísticas de peso e alimentação, que nos ajudarão a acertar o cálculo do nosso TDEE.\r\n\r\n## Recuperando e Analisando os Dados\r\nAgora que temos a nossa Google Fitness API configurada e pronta para usar, é hora de começar a recuperar e analisar os dados de que precisamos para calcular o nosso TDEE. O primeiro passo é fazer uma solicitação à API, pedindo os nossos dados de peso e nutrição dos últimos 30 dias.\r\n\r\nAqui está um exemplo de como essa solicitação pode ser feita:\r\n\r\n```javascript\r\nconst { google } = require('googleapis');\r\n\r\nconst fetchData = async () => {\r\n  const auth = await google.auth.fromJSON({\r\n    type: process.env.TOKEN_TYPE,\r\n    client_id: process.env.CLIENT_ID,\r\n    client_secret: process.env.CLIENT_SECRET,\r\n    refresh_token: process.env.REFRESH_TOKEN,\r\n  });\r\n\r\n  auth.scopes = [\r\n    'https://www.googleapis.com/auth/fitness.nutrition.read',\r\n    'https://www.googleapis.com/auth/fitness.body.read',\r\n  ];\r\n\r\n\r\n  const endDate = new Date();\r\n  const startDate = new Date();\r\n  startDate.setDate(startDate.getDate() - 30); // past 30 days\r\n  const startTimeNs = startDate.getTime() * 1000000;\r\n  const endTimeNs = endDate.getTime() * 1000000;\r\n\r\n  const weightData = await fetchDataForDataSource(\r\n    'derived:com.google.weight:com.google.android.gms:merge_weight',\r\n    auth,\r\n    startTimeNs,\r\n    endTimeNs\r\n  );\r\n\r\n  const fatPercentageData = await fetchDataForDataSource(\r\n    'derived:com.google.body.fat.percentage:com.google.android.gms:merged',\r\n    auth,\r\n    startTimeNs,\r\n    endTimeNs\r\n  );\r\n\r\n  const nutritionData = await fetchDataForDataSource(\r\n    'derived:com.google.nutrition:com.google.android.gms:merged',\r\n    auth,\r\n    startTimeNs,\r\n    endTimeNs\r\n  );\r\n};\r\n```\r\n\r\nA função `google.auth.fromJSON` é usada para criar um objeto de autenticação que pode ser utilizado para fazer solicitações à Google Fitness API. Em seguida, definimos os escopos para os quais queremos solicitar dados, que neste caso são `https://www.googleapis.com/auth/fitness.nutrition.read` e `https://www.googleapis.com/auth/fitness.body.read`. Depois disso, definimos a data de início e a data de término para a nossa solicitação, que são 30 dias atrás e hoje, respectivamente. Finalmente, chamamos a função `fetchDataForDataSource` três vezes, uma para os dados de peso, uma para os dados de percentual de gordura e uma para os dados de nutrição.\r\n\r\nMas o que a função `fetchDataForDataSource` faz? Vamos dar uma olhada:\r\n\r\n```javascript\r\nconst fitness = google.fitness('v1');\r\n\r\nconst fetchDataForDataSource = async (dataSourceId, auth, startTimeNs, endTimeNs) => {\r\n  const response = await fitness.users.dataSources.datasets.get({\r\n    userId: 'me',\r\n    dataSourceId,\r\n    datasetId: `${startTimeNs}-${endTimeNs}`,\r\n    auth,\r\n  });\r\n\r\n  return response.data;\r\n};\r\n```\r\n\r\nCom a API de fitness do `googleapis`, podemos fazer solicitações à Google Fitness API. Neste caso, estamos usando o método `users.dataSources.datasets.get` para obter dados de uma fonte de dados específica. Passamos o `userId` como `me` para obter dados do usuário atual, o `dataSourceId` que queremos obter dados, e o `datasetId`, que é uma combinação do horário de início e término em nanossegundos. Finalmente, passamos o objeto de autenticação que criamos anteriormente.\r\n\r\n## Agregando os Dados\r\nVamos dar uma olhada nos dados que recebemos da Google Fitness API:\r\n\r\n### Weight\r\n```json\r\n{\r\n  \"minStartTimeNs\": \"1690662651313000000\",\r\n  \"maxEndTimeNs\": \"1691008251313000000\",\r\n  \"dataSourceId\": \"derived:com.google.weight:com.google.android.gms:merge_weight\",\r\n  \"point\": [\r\n    {\r\n      \"startTimeNanos\": \"1690961397000000000\",\r\n      \"endTimeNanos\": \"1690961397000000000\",\r\n      \"dataTypeName\": \"com.google.weight\",\r\n      \"originDataSourceId\": \"raw:com.google.weight:cn.fitdays.fitdays:\",\r\n      \"value\": [\r\n        {\r\n          \"fpVal\": 77.59,\r\n          \"mapVal\": []\r\n        }\r\n      ],\r\n      \"modifiedTimeMillis\": \"1690963181330\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n### Fat Percentage\r\n```json\r\n{\r\n  \"minStartTimeNs\": \"1690662651313000000\",\r\n  \"maxEndTimeNs\": \"1691008251313000000\",\r\n  \"dataSourceId\": \"derived:com.google.body.fat.percentage:com.google.android.gms:merged\",\r\n  \"point\": [\r\n    {\r\n      \"startTimeNanos\": \"1690961397000000000\",\r\n      \"endTimeNanos\": \"1690961397000000000\",\r\n      \"dataTypeName\": \"com.google.body.fat.percentage\",\r\n      \"originDataSourceId\": \"raw:com.google.body.fat.percentage:cn.fitdays.fitdays:\",\r\n      \"value\": [\r\n        {\r\n          \"fpVal\": 20,\r\n          \"mapVal\": []\r\n        }\r\n      ],\r\n      \"modifiedTimeMillis\": \"1690963181468\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n### Nutrition\r\n```json\r\n{\r\n  \"minStartTimeNs\": \"1690662651313000000\",\r\n  \"maxEndTimeNs\": \"1691008251313000000\",\r\n  \"dataSourceId\": \"derived:com.google.nutrition:com.google.android.gms:merged\",\r\n  \"point\": [\r\n    {\r\n      \"startTimeNanos\": \"1690961397000000000\",\r\n      \"endTimeNanos\": \"1690961397000000000\",\r\n      \"dataTypeName\": \"com.google.nutrition\",\r\n      \"originDataSourceId\": \"raw:com.google.nutrition:com.sillens.shapeupclub:health_platform\",\r\n      \"value\": [\r\n        {\r\n          \"mapVal\": [\r\n            {\r\n              \"key\": \"fat.total\",\r\n              \"value\": {\r\n                \"fpVal\": 16.349998474121094\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"sodium\",\r\n              \"value\": {\r\n                \"fpVal\": 0\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"potassium\",\r\n              \"value\": {\r\n                \"fpVal\": 0\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"fat.unsaturated\",\r\n              \"value\": {\r\n                \"fpVal\": 3\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"fat.saturated\",\r\n              \"value\": {\r\n                \"fpVal\": 13.34999942779541\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"protein\",\r\n              \"value\": {\r\n                \"fpVal\": 5.25\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"carbs.total\",\r\n              \"value\": {\r\n                \"fpVal\": 60.45000076293945\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"cholesterol\",\r\n              \"value\": {\r\n                \"fpVal\": 0\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"calories\",\r\n              \"value\": {\r\n                \"fpVal\": 412.5\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"sugar\",\r\n              \"value\": {\r\n                \"fpVal\": 42.599998474121094\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"dietary_fiber\",\r\n              \"value\": {\r\n                \"fpVal\": 0\r\n              }\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"intVal\": 1,\r\n          \"mapVal\": []\r\n        },\r\n        {\r\n          \"stringVal\": \"Salted caramel cornetto\",\r\n          \"mapVal\": []\r\n        }\r\n      ],\r\n      \"modifiedTimeMillis\": \"1690805813623\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nComo você pode ver, os dados estão num formato que não é muito fácil de trabalhar. Precisamos analisar esses dados e agregá-los num formato utilizável.\r\n\r\n```javascript\r\nconst curatedWeightData = extractBodyData(weightData, 'weight');\r\nconst curatedFatPercentageData = extractBodyData(fatPercentageData, 'fatPercentage');\r\nconst curatedNutritionData = aggregateNutritionData(extractNutritionData(nutritionData));\r\n```\r\n\r\nApós usar essas funções misteriosas, os seus dados ficarão assim:\r\n\r\n```javascript\r\nconsole.log(curatedWeightData);\r\n// [{ date: '02/08/2023', weight: 77.5999984741211 }]\r\nconsole.log(curatedFatPercentageData);\r\n// [{ date: '02/08/2023', fatPercentage: 20 }]\r\nconsole.log(curatedNutritionData);\r\n// [{ date: '02/08/2023', foods: ['Salted caramel cornetto'], protein: 5.25, fat: 16.349998474121094, carbs: 60.45000076293945, fiber: 0, sugar: 42.599998474121094 }]\r\n```\r\n\r\nOk, agora vamos escrever as funções que fazem essa mágica, ou melhor, vamos pedir ao Chat GPT para fazer isso para nós.\r\n\r\n```javascript\r\nfunction nanosToDateString(nanos) {\r\n  const milliseconds = parseInt(nanos, 10) / 1000000;\r\n  return new Date(milliseconds).toLocaleDateString('en-GB');\r\n}\r\n\r\nfunction extractBodyData(jsonArray, type) {\r\n  return jsonArray.point.map((dataPoint) => {\r\n    const date = nanosToDateString(dataPoint.startTimeNanos);\r\n    const data = dataPoint.value[0].fpVal;\r\n    return { date, [type]: data };\r\n  });\r\n}\r\n```\r\n\r\nE para a agregação de dados nutricionais:\r\n\r\n```javascript\r\nfunction aggregateNutritionData(nutritionArray) {\r\n  const aggregatedData = {};\r\n\r\n  nutritionArray.forEach((nutrition) => {\r\n    const { date, foodName, ...nutritionValues } = nutrition;\r\n\r\n    if (!aggregatedData[date]) {\r\n      aggregatedData[date] = {\r\n        date,\r\n        foods: [foodName],\r\n        ...nutritionValues,\r\n      };\r\n    } else {\r\n      aggregatedData[date].foods.push(foodName);\r\n\r\n      Object.keys(nutritionValues).forEach((key) => {\r\n        if (Object.prototype.hasOwnProperty.call(nutritionValues, key)) {\r\n          aggregatedData[date][key] += nutritionValues[key];\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  return Object.values(aggregatedData);\r\n}\r\n```\r\n\r\nA última coisa a fazer é mesclar essas 3 matrizes em uma e classificá-la por data.\r\n\r\n```javascript\r\nfunction mergeDataArrays(...arrays) {\r\n  const mergedData = {};\r\n\r\n  arrays.forEach((array) => {\r\n    array.forEach((item) => {\r\n      const { date, ...rest } = item;\r\n      if (!mergedData[date]) {\r\n        mergedData[date] = { date, ...rest };\r\n      } else {\r\n        Object.assign(mergedData[date], rest);\r\n      }\r\n    });\r\n  });\r\n\r\n  return Object.values(mergedData);\r\n}\r\n\r\nconsole.log(mergeDataArrays(curatedWeightData, curatedFatPercentageData, curatedNutritionData));\r\n// [{\"date\":\"02/08/2023\",\"weight\":77.5999984741211,\"fatPercentage\":20,\"foods\":[\"Salted caramel cornetto\"],\"protein\":5.25,\"fat\":16.349998474121094,\"carbs\":60.45000076293945,\"fiber\":0,\"sugar\":42.599998474121094}]\r\n```\r\n\r\n~Tudo bem, é hora de usar esses dados para obter algumas informações.~ Na verdade, precisamos de mais uma coisa antes de podermos fazer isso.\r\n\r\n## Massa muscular e composição de gordura corporal\r\nAntes de mergulhar nos cálculos, precisamos entender como o músculo e a gordura estão distribuídos no corpo.\r\n\r\nEu queria descobrir quantas calorias existem em 1kg de músculo e 1kg de gordura, então comecei a procurar livros no [Google Books](https://www.google.com/books) para encontrar a composição exata do tecido muscular e da gordura, e encontrei algumas informações em [The Nutritionist Food, Nutrition, and Optimal Health By Robert Wildman](https://www.google.com/books/edition/The_Nutritionist/olIsBgAAQBAJ?hl=en&gbpv=1&pg=PA148&printsec=frontcover).\r\n\r\n![](../../uploads/blog/2023/08/muscle-and-fat-composition.png)\r\n\r\nMas eu ainda precisava saber qual é o custo energético para construir esse 1kg de músculo e 1kg de gordura, então, para isso, perguntei ao ChatGPT (em inglês e traduzido para essa postagem).\r\n\r\n> Olá. Qual é a composição exata em porcentagens de 1kg de músculo esquelético e 1kg de tecido adiposo? Além disso, forneça a fonte da informação. Por favor, me dê uma resposta curta, obrigado.\r\n\r\n> Claro! Aqui está uma resposta curta para a composição geral de 1kg de músculo esquelético e 1kg de tecido adiposo:\r\n>\r\n> Músculo Esquelético (1kg):\r\n>\r\n> - Água: ~75%\r\n> - Proteína: ~20%\r\n> - Gorduras: ~5%\r\n> - Outros (minerais, glicogênio, etc.): Quantidades vestigiais\r\n>\r\n> Tecido Adiposo (1kg):\r\n>\r\n> - Lipídios: ~80-90%\r\n> - Água: ~10-20%\r\n> - Proteína: ~2%\r\n> - Outros (minerais, etc.): Quantidades vestigiais\r\n>\r\n> Por favor, note que esses valores podem variar dependendo de fatores como idade, sexo, dieta e saúde geral. A informação é baseada no entendimento científico geral e pode ser encontrada em vários livros de fisiologia e anatomia humana, como \"Human Anatomy & Physiology\" de Elaine N. Marieb e Katja Hoehn.\r\n\r\n> E qual é a eficiência de síntese em porcentagem para construir 1 grama de proteína muscular e 1 grama de lipídios? Além disso, forneça a fonte da informação. Por favor, me dê uma resposta curta, obrigado.\r\n\r\n> A eficiência de síntese para construir proteína muscular e lipídios varia amplamente dependendo de fatores como espécie, dieta, idade e saúde. No entanto, uma estimativa geral pode ser fornecida:\r\n>\r\n> - Para proteína muscular, a eficiência é geralmente em torno de 20-25%. Isso significa que apenas cerca de 20-25% dos aminoácidos consumidos são incorporados à proteína muscular.\r\n> - Para lipídios, a eficiência de conversão de gorduras dietéticas pode ser maior, em torno de 90-95%.\r\n>\r\n> Esses números são estimativas aproximadas e podem variar significativamente. A informação é derivada do conhecimento geral em bioquímica nutricional e pode ser encontrada em livros como \"Biochemical, Physiological, and Molecular Aspects of Human Nutrition\" de Martha H. Stipanuk e Marie A. Caudill, e artigos científicos sobre o assunto. Sempre consulte pesquisas específicas ou um profissional da área para informações mais precisas adaptadas a uma situação particular.\r\n\r\nLegal. Vamos fazer alguns cálculos agora!\r\n\r\n### Cálculo do músculo\r\nAgora que sabemos que um quilograma de músculo é composto por 20% de proteína e 5% de gordura. Com 1g de proteína tendo 4 calorias e 1g de gordura contendo 9 calorias, isso significa que 1kg de músculo tem 800 calorias de proteína e 450 de gordura, totalizando 1250 calorias.\r\n\r\n### Cálculo de gordura\r\nQuanto à gordura, um quilograma é composto por 85% de lipídios e 2% de proteína. Com 1g de lipídios tendo 9 calorias, 1g de proteína tendo 4 calorias, isso significa que 1kg de gordura tem 7650 calorias de lipídios e 80 calorias de proteína, totalizando 7730 calorias.\r\n\r\n### Custo de síntese\r\nQuando se trata de construir os componentes essenciais do nosso corpo, a eficiência varia para diferentes substâncias.\r\n\r\nPara proteínas, a eficiência do nosso corpo é de cerca de ~23%. Isso significa que para cada 1g de proteína, que tem 4kcal, precisamos de cerca de ~17kcal para produzi-la. Pense assim: 4kcal vão para os aminoácidos reais na proteína, e as outras 13kcal são a energia usada no processo de construção.\r\n\r\nAgora, os lipídios são uma história diferente. Nosso corpo é um pouco mais eficiente aqui, em ~93%. Então, para 1g de lipídios, que tem 9kcal, só leva cerca de 10kcal para produzi-lo. São 9kcal para os aminoácidos nos lipídios, e apenas 1kcal para a síntese.\r\n\r\n### Calculando o custo energético\r\nEntão, vamos entender todos esses números e ver o que eles significam para o custo energético de construir músculo e gordura.\r\n\r\nPara o músculo, temos 1kg com 200g de proteína e 50g de lipídios. Como leva cerca de 17kcal para fazer 1g de proteína e 10kcal para 1g de lipídios, o custo energético total para 1kg de músculo é:\r\n\r\n- Proteína: 200 x 17 = 3400kcal\r\n- Gordura: 50 x 10 = 500kcal\r\n- Total Geral: 3400 + 500 = 3900kcal\r\n\r\nAgora, para a gordura corporal, com 1kg tendo 850g de lipídios e 20g de proteína, o custo energético total é:\r\n\r\n- Lipídios: 850 x 10 = 8500kcal\r\n- Proteína: 20 x 17 = 340kcal\r\n- Total Geral: 8500 + 340 = 8840kcal\r\n\r\nEntão, aí está! Com esses números, vou adicionar as seguintes constantes ao meu código:\r\n\r\n```javascript\r\nconst CALORIES_STORED_KG_FAT = 7730;\r\nconst CALORIES_BUILD_KG_FAT = 8840;\r\nconst CALORIES_STORED_KG_MUSCLE = 1250;\r\nconst CALORIES_BUILD_KG_MUSCLE = 3900;\r\n```\r\n\r\nLembrete rápido de que essas são todas estimativas, e os números reais podem variar dependendo da composição do seu corpo, dieta e outros fatores. Além disso, eu não sou médico nem nutricionista, então, por favor, não tome isso como um conselho médico.\r\n\r\n## Calculando o TDEE\r\nAgora que temos os nossos dados de peso e percentual de gordura analisados e agregados em um formato utilizável, podemos começar a calcular o nosso TDEE.\r\n\r\nPara calcular o seu TDEE, siga estas etapas:\r\n\r\n1. Obtenha o número total de calorias consumidas durante o período de 30 dias.\r\n2. Calcule a diferença de peso entre o início e o fim do período de 30 dias.\r\n3. Converta a diferença de peso em calorias multiplicando-a pelo número de músculo/gordura ganho/perdido.\r\n4. Subtraia o resultado da etapa 3 do total de calorias consumidas no período de 30 dias.\r\n5. Divida o resultado da etapa 4 por 30 para obter a sua ingestão média diária de calorias, que deve ser o seu TDEE.\r\n\r\nAqui está o código para calcular o TDEE e mais usando o código:\r\n\r\n```javascript\r\nfunction calculateStatistics(dataArray) {\r\n  const totalDays = dataArray.length;\r\n\r\n  const {\r\n    totalFat,\r\n    totalFiber,\r\n    totalCarbs,\r\n    finalWeight,\r\n    totalProtein,\r\n    totalCalories,\r\n    initialWeight,\r\n    initialFatPercentage,\r\n    finalFatPercentage,\r\n    initialDate,\r\n    finalDate,\r\n  } = accumulateData(dataArray);\r\n\r\n  const {\r\n    fatDifference,\r\n    weightDifference,\r\n    muscleDifference,\r\n    fatDifferencePercentage,\r\n  } = calculateWeightDifference(initialWeight, finalWeight, initialFatPercentage, finalFatPercentage);\r\n\r\n  const { muscleCalories, fatCalories } = calculateMuscleAndFatCalories(muscleDifference, fatDifference);\r\n  const tdee = calculateTDEE(totalCalories, muscleCalories, fatCalories, totalDays);\r\n\r\n  return [\r\n    `*From ${initialDate} to ${finalDate}*\\n`,\r\n    `Days Range: ${totalDays}`,\r\n    `TDEE: ${tdee?.toFixed(2)} kcal`,\r\n    `Average Calories: ${(totalCalories / totalDays)?.toFixed(2)} kcal`,\r\n    `Average Protein: ${(totalProtein / totalDays)?.toFixed(2)} g`,\r\n    `Average Carbs: ${(totalCarbs / totalDays)?.toFixed(2)} g`,\r\n    `Average Fat: ${(totalFat / totalDays)?.toFixed(2)} g`,\r\n    `Average Fiber: ${(totalFiber / totalDays)?.toFixed(2)} g`,\r\n    `Weight Difference: ${weightDifference > 0 ? '+' : ''}${weightDifference?.toFixed(2)} kg (${initialWeight?.toFixed(2)} -> ${finalWeight?.toFixed(2)})`,\r\n    `Fat Difference: ${fatDifference > 0 ? '+' : ''}${fatDifference?.toFixed(2)} kg`,\r\n    `Non-Fat Difference: ${muscleDifference > 0 ? '+' : ''}${muscleDifference?.toFixed(2)} kg`,\r\n    `Fat Percentage Difference: ${fatDifferencePercentage > 0 ? '+' : ''}${fatDifferencePercentage?.toFixed(2)}%  (${initialFatPercentage?.toFixed(2)} -> ${finalFatPercentage?.toFixed(2)})`,\r\n  ].join('\\n');\r\n}\r\n```\r\n\r\nEsta função retorna uma `string` com detalhes para um período de 30 dias, incluindo o número de dias, TDEE, ingestão média diária de calorias, proteínas, carboidratos, gordura e fibras, bem como as diferenças de peso, gordura, não gordura e percentual de gordura entre o início e o fim do período.\r\n\r\nQuanto às funções ausentes `accumulateData`, `calculateWeightDifference` e `calculateTDEE`, aqui estão elas:\r\n\r\n```javascript\r\nfunction accumulateData(dataArray) {\r\n  const lastOccurrence = dataArray[dataArray.length - 1];\r\n  const firstOccurrence = dataArray[0];\r\n\r\n  const accumulator = {\r\n    totalCalories: 0,\r\n    totalProtein: 0,\r\n    totalCarbs: 0,\r\n    totalFat: 0,\r\n    totalFiber: 0,\r\n    initialWeight: firstOccurrence?.weight,\r\n    finalWeight: lastOccurrence?.weight,\r\n    initialFatPercentage: firstOccurrence?.fatPercentage,\r\n    finalFatPercentage: lastOccurrence?.fatPercentage,\r\n    initialDate: firstOccurrence?.date || '',\r\n    finalDate: lastOccurrence?.date || '',\r\n  };\r\n\r\n  dataArray.forEach((data) => {\r\n    accumulator.totalCalories += data.caloriesConsumed;\r\n    accumulator.totalProtein += data.protein;\r\n    accumulator.totalCarbs += data.carbs;\r\n    accumulator.totalFat += data.fat;\r\n    accumulator.totalFiber += data.fiber;\r\n  });\r\n\r\n  return accumulator;\r\n}\r\n\r\nfunction calculateWeightDifference(initialWeight, finalWeight, initialFatPercentage, finalFatPercentage) {\r\n  const weightDifference = finalWeight - initialWeight;\r\n  const initialFat = (initialFatPercentage * initialWeight) / 100;\r\n  const finalFat = (finalFatPercentage * finalWeight) / 100;\r\n  const fatDifference = finalFat - initialFat;\r\n  const muscleDifference = weightDifference - fatDifference;\r\n  const fatDifferencePercentage = finalFatPercentage - initialFatPercentage;\r\n\r\n  return { weightDifference, fatDifference, muscleDifference, fatDifferencePercentage };\r\n}\r\n\r\nfunction calculateTDEE(totalCalories, muscleCalories, fatCalories, totalDays) {\r\n  const caloriesDifference = fatCalories + muscleCalories;\r\n\r\n  return (totalCalories - caloriesDifference) / totalDays;\r\n}\r\n```\r\n\r\nComo você pode ver, a função `calculateStatistics` chama a função `accumulateData` para obter o total de calorias, proteínas, carboidratos, gordura e fibras consumidas durante o período de 30 dias, bem como o peso inicial e final e o percentual de gordura.\r\n\r\nEm seguida, ela chama a função `calculateWeightDifference` para calcular as diferenças de peso, gordura, não gordura e percentual de gordura entre o início e o fim do período.\r\n\r\nFinalmente, ela chama a função `calculateTDEE` para calcular o TDEE.\r\n\r\n## Enviar os dados para o Telegram\r\nApós calcular o seu TDEE, você pode querer compartilhar essa informação com outras pessoas, como um personal trainer ou um amigo. Uma maneira fácil de fazer isso é enviando os dados para um grupo de chat no Telegram. Isso pode ser feito usando a API do Bot do Telegram.\r\n\r\nAqui está um exemplo de trecho de código que envia o resultado do TDEE para um grupo de chat no Telegram:\r\n\r\n```javascript\r\nconst text = calculateStatistics(agragatedData);\r\nawait nodeFetch(`https://api.telegram.org/bot${process.env.TELEGRAM_BOT_ID}/sendMessage`, {\r\n  method: 'POST',\r\n  headers: {\r\n  'Content-Type': 'application/json',\r\n  },\r\n  body: JSON.stringify({\r\n  text,\r\n  chat_id: process.env.TELEGRAM_GROUP_ID,\r\n  parse_mode: 'markdown',\r\n  }),\r\n});\r\n```\r\n\r\nNeste código, estamos usando o pacote `node-fetch` para fazer uma requisição HTTP POST ao método sendMessage da API do Bot do Telegram. Passamos o resultado do TDEE como o campo de texto no corpo da requisição, junto com o chat_id do grupo do Telegram para o qual queremos enviar a mensagem. Também definimos o campo `parse_mode` como `markdown` para habilitar a formatação na mensagem.\r\n\r\nNote que, para usar esse código, você precisará definir as variáveis de ambiente `TELEGRAM_BOT_ID` e `TELEGRAM_GROUP_ID` com os valores apropriados.\r\n\r\n## Bônus\r\nVocê pode copiar o texto que obteve deste script e enviá-lo para o ChatGPT para obter ainda mais insights 👀.\r\n\r\n> Olá. O que você acha desses dados do meu acompanhamento de saúde pessoal dos últimos 30 dias ou mais? Você pode me dar uma análise curta e concisa sobre o que estou fazendo bem e onde devo melhorar? Obrigado\r\n> <- Meus Dados em Texto ->\r\n\r\n> Claro! Com base nos dados que você forneceu, aqui está uma análise breve:\r\n>\r\n> O Que Você Está Fazendo Bem:\r\n> Equilíbrio Calórico: A sua ingestão calórica média está muito próxima do seu Gasto Energético Diário Total (TDEE), o que sugere que você está mantendo seu peso efetivamente.\r\n> Perda de Peso: Você perdeu 0,80 kg no último mês, o que é uma taxa de perda de peso saudável e sustentável, se esse for o seu objetivo.\r\n> Ingestão de Proteína: A sua ingestão média de proteína parece estar em uma boa faixa, especialmente se você está praticando atividades físicas que requerem reparo e crescimento muscular.\r\n>\r\n> Áreas para Melhoria:\r\n> Aumento da Porcentagem de Gordura: O aumento na porcentagem de gordura e na massa gorda pode ser uma preocupação se você estiver buscando reduzir a gordura corporal. Isso pode estar relacionado ao tipo de alimentos que você está consumindo ou ao equilíbrio de macronutrientes.\r\n> Ingestão de Fibras: Sua ingestão média de fibras está um pouco baixa. Aumentar a ingestão de fibras consumindo mais grãos integrais, frutas e vegetais pode auxiliar na digestão e pode ajudar no controle do peso.\r\n>\r\n> Lembre-se, esses insights são baseados nos dados fornecidos e nas diretrizes gerais. As necessidades individuais podem variar amplamente, então é sempre uma boa ideia consultar um profissional de saúde ou nutricionista para obter orientação personalizada.\r\n\r\n## Conclusão\r\nPronto, agora você sempre saberá exatamente qual é o seu TDEE. Você pode usar essa informação para ajustar a sua dieta e rotina de exercícios para alcançar os seus objetivos de fitness, você pode até colocar este script num fluxo de trabalho do GitHub Actions para executá-lo automaticamente todos os dias e enviar os resultados para um grupo de chat no Telegram.\r\n\r\nSe você quiser ver o código completo, [você pode encontrá-lo no meu GitHub](https://github.com/blopa/google-fit-telegram/), que inclui um workflow do GitHub Action que executa o script diariamente e envia os resultados para um chat do Telegram, portanto, sinta-se à vontade para simplesmente clonar o repositório e usá-lo.\r\n\r\nEspero que você tenha achado este artigo útil. Se tiver alguma dúvida ou comentário, fique à vontade para [entrar em contato](/pt-br/contact) ou deixar o sua opinião na seção de comentários abaixo.\r\n","frontmatter":{"tags":["google cloud","fitness api","google fit","nodejs","node","javascript"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-08-02T00:00:00.000Z","id":null,"path":"usando-google-fitness-api-para-calcular-meu-tdee-e-mais","show":true,"title":"Usando Google Fitness API para calcular meu TDEE e mais","hideExcerpt":false,"subtitle":"De calorias para código: Integrando Google Fitness API para insights personalizados de saúde"}}},{"node":{"excerpt":"Looking to achieve your fitness goals, such as losing some…","html":"<p>Looking to achieve your fitness goals, such as losing some weight or building muscle? It’s all about knowing how many calories you burn in a day, which is called your Total Daily Energy Expenditure (TDEE).</p>\n<p>Think of TDEE as the golden number that guides your food and workout choices. You have to know it to figure out how much to eat if you want to maintain, pack on some kilos, or slim down.</p>\n<p>Now, there are a bunch of online tools that can guess your TDEE, but getting data from your own body will give you the real deal.</p>\n<p>I get it, crunching these numbers can be a drag, especially if math isn’t your jam. But hey, the Google Fitness API’s got your back on this one!</p>\n<p>In this blog post, we’ll show you how to use the Google Fitness API to calculate your TDEE and track your progress over time.</p>\n<p>Of course, for this to work you need to consistently track your weight and food intake. I highly recommend getting a bioimpedance scale, which can measure your weight, body fat percentage, and muscle mass and the app <a href=\"https://lifesum.com/\" target=\"_blank\" rel=\"noreferrer\">Lifesum</a> to track your food intake.</p>\n<h2 id=\"using-the-google-fitness-api\" style=\"position:relative;\"><a href=\"#using-the-google-fitness-api\" aria-label=\"using the google fitness api permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using the Google Fitness API</h2>\n<p>Got the basics of TDEE down? Cool, let’s dive into how we can get the scoop using the Google Fitness API. This nifty tool lets coders grab data from Google Fit – that’s the app that gathers health info from your phone, smartwatches, and other apps.</p>\n<p>To get started with the Google Fitness API, first, go to the Google Cloud Console and turn on the Fitness API. Then, we’ll need to create credentials for our project, so we can tap into the API. For more details, check their <a href=\"https://developers.google.com/fit/rest/v1/get-started\" target=\"_blank\" rel=\"noreferrer\">Getting Started guide</a>.</p>\n<p>Once we’re all set up, it’s all about using the API to get our hands on some juicy Google Fit data. We’re talking weight and food stats, which will help us nail down our TDEE calculation.</p>\n<h2 id=\"retrieving-and-parsing-the-data\" style=\"position:relative;\"><a href=\"#retrieving-and-parsing-the-data\" aria-label=\"retrieving and parsing the data permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Retrieving and Parsing the Data</h2>\n<p>Now that we have our Google Fitness API set up and ready to go, it’s time to start retrieving and parsing the data that we need to calculate our TDEE. The first step is to make a request to the API, asking for our weight and nutrition data for the past 30 days.</p>\n<p>Here’s an example of what this request might look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> google <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'googleapis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchData</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> auth <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> google<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span><span class=\"token function\">fromJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TOKEN_TYPE</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">client_id</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CLIENT_ID</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">client_secret</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CLIENT_SECRET</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">refresh_token</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">REFRESH_TOKEN</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  auth<span class=\"token punctuation\">.</span>scopes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token string\">'https://www.googleapis.com/auth/fitness.nutrition.read'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'https://www.googleapis.com/auth/fitness.body.read'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n  <span class=\"token keyword\">const</span> endDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> startDate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  startDate<span class=\"token punctuation\">.</span><span class=\"token function\">setDate</span><span class=\"token punctuation\">(</span>startDate<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// past 30 days</span>\r\n  <span class=\"token keyword\">const</span> startTimeNs <span class=\"token operator\">=</span> startDate<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> endTimeNs <span class=\"token operator\">=</span> endDate<span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> weightData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchDataForDataSource</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'derived:com.google.weight:com.google.android.gms:merge_weight'</span><span class=\"token punctuation\">,</span>\r\n    auth<span class=\"token punctuation\">,</span>\r\n    startTimeNs<span class=\"token punctuation\">,</span>\r\n    endTimeNs\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> fatPercentageData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchDataForDataSource</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'derived:com.google.body.fat.percentage:com.google.android.gms:merged'</span><span class=\"token punctuation\">,</span>\r\n    auth<span class=\"token punctuation\">,</span>\r\n    startTimeNs<span class=\"token punctuation\">,</span>\r\n    endTimeNs\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> nutritionData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchDataForDataSource</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'derived:com.google.nutrition:com.google.android.gms:merged'</span><span class=\"token punctuation\">,</span>\r\n    auth<span class=\"token punctuation\">,</span>\r\n    startTimeNs<span class=\"token punctuation\">,</span>\r\n    endTimeNs\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The function <code class=\"language-text\">google.auth.fromJSON</code> is used to create an authentication object that can be used to make requests to the Google Fitness API. We then set the scopes that we want to request data for, which in this case are <code class=\"language-text\">https://www.googleapis.com/auth/fitness.nutrition.read</code> and <code class=\"language-text\">https://www.googleapis.com/auth/fitness.body.read</code>. After that, we set the start date and end date for our request, which is 30 days ago and today respectively. Finally, we call the <code class=\"language-text\">fetchDataForDataSource</code> function three times, once for weight data, once for fat percentage data, and once for nutrition data.</p>\n<p>But what does the <code class=\"language-text\">fetchDataForDataSource</code> function do? Let’s take a look:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fitness <span class=\"token operator\">=</span> google<span class=\"token punctuation\">.</span><span class=\"token function\">fitness</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchDataForDataSource</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">dataSourceId<span class=\"token punctuation\">,</span> auth<span class=\"token punctuation\">,</span> startTimeNs<span class=\"token punctuation\">,</span> endTimeNs</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> fitness<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">.</span>dataSources<span class=\"token punctuation\">.</span>datasets<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">userId</span><span class=\"token operator\">:</span> <span class=\"token string\">'me'</span><span class=\"token punctuation\">,</span>\r\n    dataSourceId<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">datasetId</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>startTimeNs<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>endTimeNs<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    auth<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With the fitness API from <code class=\"language-text\">googleapis</code> we can make requests to the Google Fitness API. In this case, we’re using the <code class=\"language-text\">users.dataSources.datasets.get</code> method to get data for a specific data source. We pass in the <code class=\"language-text\">userId</code> as <code class=\"language-text\">me</code> to get data for the current user, the <code class=\"language-text\">dataSourceId</code> that we want to get data for, and the <code class=\"language-text\">datasetId</code> which is a combination of the start and end time in nanoseconds. Finally, we pass in the authentication object that we created earlier.</p>\n<h2 id=\"aggregating-the-data\" style=\"position:relative;\"><a href=\"#aggregating-the-data\" aria-label=\"aggregating the data permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Aggregating the Data</h2>\n<p>Let’s take a look at the data we got back from the Google Fitness API:</p>\n<h3 id=\"weight\" style=\"position:relative;\"><a href=\"#weight\" aria-label=\"weight permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Weight</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"minStartTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690662651313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"maxEndTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1691008251313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"dataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"derived:com.google.weight:com.google.android.gms:merge_weight\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"point\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token property\">\"startTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"endTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"dataTypeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"com.google.weight\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"originDataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"raw:com.google.weight:cn.fitdays.fitdays:\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">77.59</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"modifiedTimeMillis\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690963181330\"</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"fat-percentage\" style=\"position:relative;\"><a href=\"#fat-percentage\" aria-label=\"fat percentage permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fat Percentage</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"minStartTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690662651313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"maxEndTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1691008251313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"dataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"derived:com.google.body.fat.percentage:com.google.android.gms:merged\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"point\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token property\">\"startTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"endTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"dataTypeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"com.google.body.fat.percentage\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"originDataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"raw:com.google.body.fat.percentage:cn.fitdays.fitdays:\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"modifiedTimeMillis\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690963181468\"</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"nutrition\" style=\"position:relative;\"><a href=\"#nutrition\" aria-label=\"nutrition permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nutrition</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"minStartTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690662651313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"maxEndTimeNs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1691008251313000000\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"dataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"derived:com.google.nutrition:com.google.android.gms:merged\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"point\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token punctuation\">{</span>\r\n      <span class=\"token property\">\"startTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"endTimeNanos\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690961397000000000\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"dataTypeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"com.google.nutrition\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"originDataSourceId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"raw:com.google.nutrition:com.sillens.shapeupclub:health_platform\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fat.total\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">16.349998474121094</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sodium\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"potassium\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fat.unsaturated\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fat.saturated\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">13.34999942779541</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"protein\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5.25</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"carbs.total\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">60.45000076293945</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cholesterol\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"calories\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">412.5</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sugar\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">42.599998474121094</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">{</span>\r\n              <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dietary_fiber\"</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token property\">\"fpVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\n              <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span>\r\n          <span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"intVal\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">{</span>\r\n          <span class=\"token property\">\"stringVal\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Salted caramel cornetto\"</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token property\">\"mapVal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token property\">\"modifiedTimeMillis\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1690805813623\"</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see, the data is in a format that is not very easy to work with. We need to parse this data and aggregate it into a usable format.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> curatedWeightData <span class=\"token operator\">=</span> <span class=\"token function\">extractBodyData</span><span class=\"token punctuation\">(</span>weightData<span class=\"token punctuation\">,</span> <span class=\"token string\">'weight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> curatedFatPercentageData <span class=\"token operator\">=</span> <span class=\"token function\">extractBodyData</span><span class=\"token punctuation\">(</span>fatPercentageData<span class=\"token punctuation\">,</span> <span class=\"token string\">'fatPercentage'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> curatedNutritionData <span class=\"token operator\">=</span> <span class=\"token function\">aggregateNutritionData</span><span class=\"token punctuation\">(</span><span class=\"token function\">extractNutritionData</span><span class=\"token punctuation\">(</span>nutritionData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After using these mysterious functions, our data will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>curatedWeightData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// [{ date: '02/08/2023', weight: 77.5999984741211 }]</span>\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>curatedFatPercentageData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// [{ date: '02/08/2023', fatPercentage: 20 }]</span>\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>curatedNutritionData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// [{ date: '02/08/2023', foods: ['Salted caramel cornetto'], protein: 5.25, fat: 16.349998474121094, carbs: 60.45000076293945, fiber: 0, sugar: 42.599998474121094 }]</span></code></pre></div>\n<p>Ok now let’s write the functions that do this magic, or better, let’s ask ChatGPT to do it for us.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">nanosToDateString</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nanos</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> milliseconds <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>nanos<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>milliseconds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLocaleDateString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'en-GB'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">extractBodyData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">jsonArray<span class=\"token punctuation\">,</span> type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">return</span> jsonArray<span class=\"token punctuation\">.</span>point<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dataPoint</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> date <span class=\"token operator\">=</span> <span class=\"token function\">nanosToDateString</span><span class=\"token punctuation\">(</span>dataPoint<span class=\"token punctuation\">.</span>startTimeNanos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> dataPoint<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>fpVal<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> date<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And for the nutrition data aggregation:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">aggregateNutritionData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nutritionArray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> aggregatedData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  nutritionArray<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">nutrition</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> date<span class=\"token punctuation\">,</span> foodName<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>nutritionValues <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> nutrition<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>aggregatedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      aggregatedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        date<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">foods</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>foodName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token operator\">...</span>nutritionValues<span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      aggregatedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>foods<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>foodName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n      Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>nutritionValues<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">hasOwnProperty</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>nutritionValues<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n          aggregatedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> nutritionValues<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>aggregatedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The last thing to do is to merge these 3 arrays into one and sort them by date.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">mergeDataArrays</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>arrays</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> mergedData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  arrays<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">array</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    array<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> date<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> item<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mergedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        mergedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> date<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>mergedData<span class=\"token punctuation\">[</span>date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> rest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>mergedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">mergeDataArrays</span><span class=\"token punctuation\">(</span>curatedWeightData<span class=\"token punctuation\">,</span> curatedFatPercentageData<span class=\"token punctuation\">,</span> curatedNutritionData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// [{\"date\":\"02/08/2023\",\"weight\":77.5999984741211,\"fatPercentage\":20,\"foods\":[\"Salted caramel cornetto\"],\"protein\":5.25,\"fat\":16.349998474121094,\"carbs\":60.45000076293945,\"fiber\":0,\"sugar\":42.599998474121094}]</span></code></pre></div>\n<p><del>Alright, time to use this data to get some insights.</del> Actually, we need one more thing before we can do that.</p>\n<h2 id=\"muscle-mass-and-body-fat-composition\" style=\"position:relative;\"><a href=\"#muscle-mass-and-body-fat-composition\" aria-label=\"muscle mass and body fat composition permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Muscle mass and body fat composition</h2>\n<p>Before diving into the calculations, we need to understand how muscle and fat are distributed in the body.</p>\n<p>I wanted to figure out how many calories are in 1kg of muscle and 1kg of fat, so I started looking for books on <a href=\"https://www.google.com/books\" target=\"_blank\" rel=\"noreferrer\">Google Books</a> to find the exact composition of muscle and fat tissue, and I did find some information on <a href=\"https://www.google.com/books/edition/The_Nutritionist/olIsBgAAQBAJ?hl=en&#x26;gbpv=1&#x26;pg=PA148&#x26;printsec=frontcover\" target=\"_blank\" rel=\"noreferrer\">The Nutritionist Food, Nutrition, and Optimal Health By Robert Wildman</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.71875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzElEQVQoz3WRS4+iUBSE+xebuCBR4/PvTFy4cKkhKkZU5KmJROV1CQJyLxcQFAkyaXWc6emZ2n+nqk59IISWy6XjOOfzeTwe/3hoNBrFcRxFkeu6zEOLxcIwDIxxlmXFL31cr1eO4wzDgBDOZrPhcDgYDCaTSRiGURQBAEiSpCiKJElZlk+nU5IkRVHc7/cXzDAMAMDzPEmSeJ7nOI7n+SAI4jg+HA6NRqNarRIEQdO07/uXy+W38+12kyTJMAzXdS3Lwhj7vg8A8H3/CbdarXq9XqlU5vM5xphhGFEUdV2PougjTVOO4wAAjuNgjJ8nEULfYZqmMcbT6XS1WgmC4HneK7Zpmn/Cnuf90xkhJMvydrsVRfETfju7rvuGIYQY4yRJFEVpt9tv2Pd9lmUlSbIsKwzDz87fY0MI/9eZZdn1eg0hfMGCIPwV+w0ritLpdJrNZq1We8Z+fvs1VZZlm81G13XbtiGEeZ5nWeY4DkIojuPdbkcQRLlcLpVKFEUhhJ47v6YqikJVVQAAxtg0TU3TVFU1DCMMwyAIbNvu9/u9Xq/b7SqKghBK0/QLnOd5URRxHMuyrGna4aEoip5v3+/3CCHXdY/HY/FVPwEsxGsqnk8+zAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"muscle and fat composition\"\n        title=\"muscle and fat composition\"\n        src=\"/static/78e0682ff9af97a8ebc8b291b53f97a9/42a19/muscle-and-fat-composition.png\"\n        srcset=\"/static/78e0682ff9af97a8ebc8b291b53f97a9/e3135/muscle-and-fat-composition.png 256w,\n/static/78e0682ff9af97a8ebc8b291b53f97a9/06341/muscle-and-fat-composition.png 512w,\n/static/78e0682ff9af97a8ebc8b291b53f97a9/42a19/muscle-and-fat-composition.png 1024w,\n/static/78e0682ff9af97a8ebc8b291b53f97a9/775e3/muscle-and-fat-composition.png 1189w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>But I still needed to know what is the energy cost to build that 1kg of muscle and 1kg of fat, so for that, I asked ChatGPT.</p>\n<blockquote>\n<p>Hi. What is the exact composition in percentages of 1kg of skeletal muscle and 1kg of adipose tissue? Also, provide the source of the information. Please give me a short answer, thank you.</p>\n</blockquote>\n<blockquote>\n<p>Sure! Here’s a short answer for the general composition of 1kg of skeletal muscle and 1kg of adipose tissue:</p>\n<p>Skeletal Muscle (1kg):</p>\n<ul>\n<li>Water: ~75%</li>\n<li>Protein: ~20%</li>\n<li>Fats: ~5%</li>\n<li>Other (minerals, glycogen, etc.): Trace amounts</li>\n</ul>\n<p>Adipose Tissue (1kg):</p>\n<ul>\n<li>Lipids: ~80-90%</li>\n<li>Water: ~10-20%</li>\n<li>Protein: ~2%</li>\n<li>Other (minerals, etc.): Trace amounts</li>\n</ul>\n<p>Please note that these values can vary depending on factors like age, sex, diet, and overall health. The information is based on general scientific understanding and can be found in various human physiology and anatomy textbooks, such as “Human Anatomy &#x26; Physiology” by Elaine N. Marieb and Katja Hoehn.</p>\n</blockquote>\n<blockquote>\n<p>And what is the synthesis efficiency in percentage to build 1 gram of muscle protein and 1 gram of lipids?  Also, provide the source of the information. Please give me a short answer, thank you.</p>\n</blockquote>\n<blockquote>\n<p>The synthesis efficiency for building muscle protein and lipids varies widely depending on factors like species, diet, age, and health. However, a general estimate can be provided:</p>\n<ul>\n<li>For muscle protein, the efficiency is often around 20-25%. This means that only about 20-25% of the amino acids consumed are incorporated into muscle protein.</li>\n<li>For lipids, the efficiency of conversion from dietary fats can be higher, around 90-95%.</li>\n</ul>\n<p>These numbers are rough estimates and can vary significantly. The information is derived from general knowledge of nutritional biochemistry and can be found in textbooks like “Biochemical, Physiological, and Molecular Aspects of Human Nutrition” by Martha H. Stipanuk and Marie A. Caudill, and scientific papers on the subject. Always consult specific research or a professional in the field for more precise information tailored to a particular situation.</p>\n</blockquote>\n<p>Cool. Let’s do some math now!</p>\n<h3 id=\"muscle-calculation\" style=\"position:relative;\"><a href=\"#muscle-calculation\" aria-label=\"muscle calculation permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Muscle calculation</h3>\n<p>Now that we know a kilogram of muscle is made up of 20% protein and 5% fat. With 1g of protein having 4 calories and 1g of fat containing 9 calories, that means 1kg of muscle has 800 calories from protein and 450 from fat, totaling 1250 calories.</p>\n<h3 id=\"fat-calculation\" style=\"position:relative;\"><a href=\"#fat-calculation\" aria-label=\"fat calculation permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fat calculation</h3>\n<p>As for fat, a kilogram is made up of 85% lipids and 2% protein. With 1g of lipids having 9 calories, and 1g of protein having 4 calories, that means 1kg of fat has 7650 calories from lipids and 80 calories from protein, totaling 7730 calories.</p>\n<h3 id=\"synthesis-cost\" style=\"position:relative;\"><a href=\"#synthesis-cost\" aria-label=\"synthesis cost permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Synthesis cost</h3>\n<p>When it comes to building the essential components of our body, the efficiency varies for different substances.</p>\n<p>For proteins, our body’s efficiency is about ~23%. That means for every 1g of protein, which has 4kcal, we need around ~17kcal to make it. Think of it like this: 4kcal goes into the actual amino acids in the protein, and the other 13kcal is the energy used up in the building process.</p>\n<p>Now, lipids are a different story. Our body’s a bit more efficient here, at ~93%. So for 1g of lipids, which has 9kcal, it only takes about 10kcal to make it. That’s 9kcal for the amino acids in the lipids, and just 1kcal for the synthesis.</p>\n<h3 id=\"calculating-the-energy-cost\" style=\"position:relative;\"><a href=\"#calculating-the-energy-cost\" aria-label=\"calculating the energy cost permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Calculating the energy cost</h3>\n<p>So, let’s wrap our heads around all these numbers and see what they mean for the energy cost of building muscle and fat.</p>\n<p>For muscle, we’ve got 1kg with 200g of protein and 50g of lipids. Since it takes about 17kcal to make 1g of protein and 10kcal for 1g of lipids, the total energy cost for 1kg of muscle is:</p>\n<ul>\n<li>Protein: 200 x 17 = 3400kcal</li>\n<li>Fat: 50 x 10 = 500kcal</li>\n<li>Grand Total: 3400 + 500 = 3900kcal</li>\n</ul>\n<p>Now, for body fat, with 1kg having 850g of lipids and 20g of protein, the total energy cost is:</p>\n<ul>\n<li>Lipids: 850 x 10 = 8500kcal</li>\n<li>Protein: 20 x 17 = 340kcal</li>\n<li>Grand Total: 8500 + 340 = 8840kcal</li>\n</ul>\n<p>So there you go! With these numbers, I will add the following <code class=\"language-text\">consts</code> to my code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">CALORIES_STORED_KG_FAT</span> <span class=\"token operator\">=</span> <span class=\"token number\">7730</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CALORIES_BUILD_KG_FAT</span> <span class=\"token operator\">=</span> <span class=\"token number\">8840</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CALORIES_STORED_KG_MUSCLE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1250</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CALORIES_BUILD_KG_MUSCLE</span> <span class=\"token operator\">=</span> <span class=\"token number\">3900</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A quick reminder that these are all estimates, and the actual numbers may vary depending on your body composition, diet, and other factors. Also, I’m not a doctor or a nutritionist, so please don’t take this as medical advice.</p>\n<h2 id=\"calculating-the-tdee\" style=\"position:relative;\"><a href=\"#calculating-the-tdee\" aria-label=\"calculating the tdee permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Calculating the TDEE</h2>\n<p>Now that we have our parsed weight and fat percentage data and have aggregated it into a usable format, we can start to calculate our TDEE.</p>\n<p>To calculate your TDEE, follow these steps:</p>\n<ol>\n<li>Get the total number of calories consumed during the 30-day period.</li>\n<li>Calculate the weight difference between the start and end of the 30-day period.</li>\n<li>Convert the weight difference to calories by multiplying it by the number of muscle/fat gained/lost.</li>\n<li>Subtract the result from step 3 from the total calories consumed in the 30-day period.</li>\n<li>Divide the result from step 4 by 30 to get your average daily calorie intake, which should be your TDEE.</li>\n</ol>\n<p>Here’s the code to calculate TDEE and more using the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">calculateStatistics</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dataArray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> totalDays <span class=\"token operator\">=</span> dataArray<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\r\n    totalFat<span class=\"token punctuation\">,</span>\r\n    totalFiber<span class=\"token punctuation\">,</span>\r\n    totalCarbs<span class=\"token punctuation\">,</span>\r\n    finalWeight<span class=\"token punctuation\">,</span>\r\n    totalProtein<span class=\"token punctuation\">,</span>\r\n    totalCalories<span class=\"token punctuation\">,</span>\r\n    initialWeight<span class=\"token punctuation\">,</span>\r\n    initialFatPercentage<span class=\"token punctuation\">,</span>\r\n    finalFatPercentage<span class=\"token punctuation\">,</span>\r\n    initialDate<span class=\"token punctuation\">,</span>\r\n    finalDate<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">accumulateData</span><span class=\"token punctuation\">(</span>dataArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\r\n    fatDifference<span class=\"token punctuation\">,</span>\r\n    weightDifference<span class=\"token punctuation\">,</span>\r\n    muscleDifference<span class=\"token punctuation\">,</span>\r\n    fatDifferencePercentage<span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">calculateWeightDifference</span><span class=\"token punctuation\">(</span>initialWeight<span class=\"token punctuation\">,</span> finalWeight<span class=\"token punctuation\">,</span> initialFatPercentage<span class=\"token punctuation\">,</span> finalFatPercentage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> muscleCalories<span class=\"token punctuation\">,</span> fatCalories <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">calculateMuscleAndFatCalories</span><span class=\"token punctuation\">(</span>muscleDifference<span class=\"token punctuation\">,</span> fatDifference<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> tdee <span class=\"token operator\">=</span> <span class=\"token function\">calculateTDEE</span><span class=\"token punctuation\">(</span>totalCalories<span class=\"token punctuation\">,</span> muscleCalories<span class=\"token punctuation\">,</span> fatCalories<span class=\"token punctuation\">,</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">*From </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>initialDate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> to </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>finalDate<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">*\\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Days Range: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>totalDays<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">TDEE: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>tdee<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kcal</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Calories: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalCalories <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kcal</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Protein: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalProtein <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> g</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Carbs: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalCarbs <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> g</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Fat: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalFat <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> g</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Average Fiber: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>totalFiber <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> g</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Weight Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>weightDifference <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'+'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>weightDifference<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kg (</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>initialWeight<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>finalWeight<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fat Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fatDifference <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'+'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fatDifference<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kg</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Non-Fat Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>muscleDifference <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'+'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>muscleDifference<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> kg</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fat Percentage Difference: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fatDifferencePercentage <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'+'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fatDifferencePercentage<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">%  (</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>initialFatPercentage<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>finalFatPercentage<span class=\"token operator\">?.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This function returns a string with details for a 30-day period, including the number of days, TDEE, average daily intake of calories, protein, carbohydrates, fat, and fiber, as well as the weight, fat, non-fat, and fat percentage differences between the start and end of the period.</p>\n<p>As for the missing functions <code class=\"language-text\">accumulateData</code>, <code class=\"language-text\">calculateWeightDifference</code> and <code class=\"language-text\">calculateTDEE</code>, here they are:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">accumulateData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dataArray</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> lastOccurrence <span class=\"token operator\">=</span> dataArray<span class=\"token punctuation\">[</span>dataArray<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> firstOccurrence <span class=\"token operator\">=</span> dataArray<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> accumulator <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">totalCalories</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">totalProtein</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">totalCarbs</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">totalFat</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">totalFiber</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">initialWeight</span><span class=\"token operator\">:</span> firstOccurrence<span class=\"token operator\">?.</span>weight<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">finalWeight</span><span class=\"token operator\">:</span> lastOccurrence<span class=\"token operator\">?.</span>weight<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">initialFatPercentage</span><span class=\"token operator\">:</span> firstOccurrence<span class=\"token operator\">?.</span>fatPercentage<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">finalFatPercentage</span><span class=\"token operator\">:</span> lastOccurrence<span class=\"token operator\">?.</span>fatPercentage<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">initialDate</span><span class=\"token operator\">:</span> firstOccurrence<span class=\"token operator\">?.</span>date <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">finalDate</span><span class=\"token operator\">:</span> lastOccurrence<span class=\"token operator\">?.</span>date <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  dataArray<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalCalories <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>caloriesConsumed<span class=\"token punctuation\">;</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalProtein <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>protein<span class=\"token punctuation\">;</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalCarbs <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>carbs<span class=\"token punctuation\">;</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalFat <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>fat<span class=\"token punctuation\">;</span>\r\n    accumulator<span class=\"token punctuation\">.</span>totalFiber <span class=\"token operator\">+=</span> data<span class=\"token punctuation\">.</span>fiber<span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> accumulator<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">calculateWeightDifference</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">initialWeight<span class=\"token punctuation\">,</span> finalWeight<span class=\"token punctuation\">,</span> initialFatPercentage<span class=\"token punctuation\">,</span> finalFatPercentage</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> weightDifference <span class=\"token operator\">=</span> finalWeight <span class=\"token operator\">-</span> initialWeight<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> initialFat <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>initialFatPercentage <span class=\"token operator\">*</span> initialWeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> finalFat <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>finalFatPercentage <span class=\"token operator\">*</span> finalWeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> fatDifference <span class=\"token operator\">=</span> finalFat <span class=\"token operator\">-</span> initialFat<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> muscleDifference <span class=\"token operator\">=</span> weightDifference <span class=\"token operator\">-</span> fatDifference<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> fatDifferencePercentage <span class=\"token operator\">=</span> finalFatPercentage <span class=\"token operator\">-</span> initialFatPercentage<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> weightDifference<span class=\"token punctuation\">,</span> fatDifference<span class=\"token punctuation\">,</span> muscleDifference<span class=\"token punctuation\">,</span> fatDifferencePercentage <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">calculateTDEE</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">totalCalories<span class=\"token punctuation\">,</span> muscleCalories<span class=\"token punctuation\">,</span> fatCalories<span class=\"token punctuation\">,</span> totalDays</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> caloriesDifference <span class=\"token operator\">=</span> fatCalories <span class=\"token operator\">+</span> muscleCalories<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>totalCalories <span class=\"token operator\">-</span> caloriesDifference<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> totalDays<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see, the <code class=\"language-text\">calculateStatistics</code> function calls the <code class=\"language-text\">accumulateData</code> function to get the total calories, protein, carbohydrates, fat, and fiber consumed during the 30-day period, as well as the initial and final weight and fat percentage.</p>\n<p>Then, it calls the <code class=\"language-text\">calculateWeightDifference</code> function to calculate the weight, fat, non-fat, and fat percentage differences between the start and end of the period.</p>\n<p>Finally, it calls the <code class=\"language-text\">calculateTDEE</code> function to calculate the TDEE.</p>\n<h2 id=\"send-the-data-to-telegram\" style=\"position:relative;\"><a href=\"#send-the-data-to-telegram\" aria-label=\"send the data to telegram permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Send the data to Telegram</h2>\n<p>Once you have calculated your TDEE, you may want to share this information with others, such as a personal trainer or a friend. One easy way to do this is by sending the data to a Telegram group chat. This can be done using the Telegram Bot API.</p>\n<p>Here’s an example code snippet that sends the TDEE result to a Telegram group chat:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token function\">calculateStatistics</span><span class=\"token punctuation\">(</span>agragatedData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">await</span> <span class=\"token function\">nodeFetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://api.telegram.org/bot</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TELEGRAM_BOT_ID</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/sendMessage</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  text<span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">chat_id</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">TELEGRAM_GROUP_ID</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">parse_mode</span><span class=\"token operator\">:</span> <span class=\"token string\">'markdown'</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this code, we are using the <code class=\"language-text\">node-fetch</code> package to make an HTTP POST request to the Telegram Bot API’s sendMessage method. We pass in the TDEE result as the text field in the request body, along with the chat_id of the Telegram group we want to send the message. We also set the <code class=\"language-text\">parse_mode</code> field to <code class=\"language-text\">markdown</code> to enable formatting in the message.</p>\n<p>Note that in order to use this code, you will need to set the <code class=\"language-text\">TELEGRAM_BOT_ID</code> and <code class=\"language-text\">TELEGRAM_GROUP_ID</code> environment variables to the appropriate values.</p>\n<h2 id=\"bonus\" style=\"position:relative;\"><a href=\"#bonus\" aria-label=\"bonus permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bonus</h2>\n<p>You can copy the text you got from this script and send it to ChatGPT for even more insights 👀.</p>\n<blockquote>\n<p>Hi. What do you think of these data from my personal health track from the past 30 days or so? Can you give me a short and concise insight into what I’m doing well and where I should improve? Thanks\r\n&#x3C;- My Text Data -></p>\n</blockquote>\n<blockquote>\n<p>Sure! Based on the data you’ve provided, here’s a brief analysis:</p>\n<p>What You’re Doing Well:\r\nCaloric Balance: Your average caloric intake is very close to your Total Daily Energy Expenditure (TDEE), which suggests that you are maintaining your weight effectively.\r\nWeight Loss: You’ve lost 0.80 kg over the past month, which is a healthy and sustainable rate of weight loss if that’s your goal.\r\nProtein Intake: Your average protein intake seems to be in a good range, especially if you’re engaging in physical activities that require muscle repair and growth.</p>\n<p>Areas for Improvement:\r\nFat Percentage Increase: The increase in fat percentage and fat mass might be a concern if you are aiming to reduce body fat. This could be related to the type of foods you are consuming or the balance of macronutrients.\r\nFiber Intake: Your average fiber intake is a bit on the lower side. Increasing fiber intake by consuming more whole grains, fruits, and vegetables can aid in digestion and may help with weight management.</p>\n<p>Remember, these insights are based on the data provided and general guidelines. Individual needs can vary widely, so it’s always a good idea to consult with a healthcare provider or nutrition professional for personalized advice.</p>\n</blockquote>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>That’s it, now you will always know precisely what your TDEE is. You can use this information to adjust your diet and exercise routine to achieve your fitness goals, you can even put this script into a GitHub Actions workflow to run it automatically every day and send the results to a Telegram group chat.</p>\n<p>If you want to see the full code, <a href=\"https://github.com/blopa/google-fit-telegram/\" target=\"_blank\" rel=\"noreferrer\">you can find it in my GitHub</a>, which includes a GitHub Action workflow that runs the script every day and sends the results to a Telegram chat, so feel free to simply clone the repository and use it.</p>\n<p>I hope you found this article useful. If you have any questions or comments, feel free to <a href=\"/en/contact\">reach out</a> or leave your feedback in the comments section below.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTA4LTAyVDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-08-02-using-google-fitness-api-to-calculate-my-tdee-and-more.en/","path":"/blog/coding/using-google-fitness-api-to-calculate-my-tdee-and-more/","locale":"en"},"rawMarkdownBody":"Looking to achieve your fitness goals, such as losing some weight or building muscle? It's all about knowing how many calories you burn in a day, which is called your Total Daily Energy Expenditure (TDEE).\r\n\r\nThink of TDEE as the golden number that guides your food and workout choices. You have to know it to figure out how much to eat if you want to maintain, pack on some kilos, or slim down.\r\n\r\nNow, there are a bunch of online tools that can guess your TDEE, but getting data from your own body will give you the real deal.\r\n\r\nI get it, crunching these numbers can be a drag, especially if math isn't your jam. But hey, the Google Fitness API's got your back on this one!\r\n\r\nIn this blog post, we'll show you how to use the Google Fitness API to calculate your TDEE and track your progress over time.\r\n\r\nOf course, for this to work you need to consistently track your weight and food intake. I highly recommend getting a bioimpedance scale, which can measure your weight, body fat percentage, and muscle mass and the app [Lifesum](https://lifesum.com/) to track your food intake.\r\n\r\n## Using the Google Fitness API\r\nGot the basics of TDEE down? Cool, let's dive into how we can get the scoop using the Google Fitness API. This nifty tool lets coders grab data from Google Fit – that's the app that gathers health info from your phone, smartwatches, and other apps.\r\n\r\nTo get started with the Google Fitness API, first, go to the Google Cloud Console and turn on the Fitness API. Then, we'll need to create credentials for our project, so we can tap into the API. For more details, check their [Getting Started guide](https://developers.google.com/fit/rest/v1/get-started).\r\n\r\nOnce we're all set up, it's all about using the API to get our hands on some juicy Google Fit data. We're talking weight and food stats, which will help us nail down our TDEE calculation.\r\n\r\n## Retrieving and Parsing the Data\r\nNow that we have our Google Fitness API set up and ready to go, it's time to start retrieving and parsing the data that we need to calculate our TDEE. The first step is to make a request to the API, asking for our weight and nutrition data for the past 30 days.\r\n\r\nHere's an example of what this request might look like:\r\n\r\n```javascript\r\nconst { google } = require('googleapis');\r\n\r\nconst fetchData = async () => {\r\n  const auth = await google.auth.fromJSON({\r\n    type: process.env.TOKEN_TYPE,\r\n    client_id: process.env.CLIENT_ID,\r\n    client_secret: process.env.CLIENT_SECRET,\r\n    refresh_token: process.env.REFRESH_TOKEN,\r\n  });\r\n\r\n  auth.scopes = [\r\n    'https://www.googleapis.com/auth/fitness.nutrition.read',\r\n    'https://www.googleapis.com/auth/fitness.body.read',\r\n  ];\r\n\r\n\r\n  const endDate = new Date();\r\n  const startDate = new Date();\r\n  startDate.setDate(startDate.getDate() - 30); // past 30 days\r\n  const startTimeNs = startDate.getTime() * 1000000;\r\n  const endTimeNs = endDate.getTime() * 1000000;\r\n\r\n  const weightData = await fetchDataForDataSource(\r\n    'derived:com.google.weight:com.google.android.gms:merge_weight',\r\n    auth,\r\n    startTimeNs,\r\n    endTimeNs\r\n  );\r\n\r\n  const fatPercentageData = await fetchDataForDataSource(\r\n    'derived:com.google.body.fat.percentage:com.google.android.gms:merged',\r\n    auth,\r\n    startTimeNs,\r\n    endTimeNs\r\n  );\r\n\r\n  const nutritionData = await fetchDataForDataSource(\r\n    'derived:com.google.nutrition:com.google.android.gms:merged',\r\n    auth,\r\n    startTimeNs,\r\n    endTimeNs\r\n  );\r\n};\r\n```\r\n\r\nThe function `google.auth.fromJSON` is used to create an authentication object that can be used to make requests to the Google Fitness API. We then set the scopes that we want to request data for, which in this case are `https://www.googleapis.com/auth/fitness.nutrition.read` and `https://www.googleapis.com/auth/fitness.body.read`. After that, we set the start date and end date for our request, which is 30 days ago and today respectively. Finally, we call the `fetchDataForDataSource` function three times, once for weight data, once for fat percentage data, and once for nutrition data.\r\n\r\nBut what does the `fetchDataForDataSource` function do? Let's take a look:\r\n\r\n```javascript\r\nconst fitness = google.fitness('v1');\r\n\r\nconst fetchDataForDataSource = async (dataSourceId, auth, startTimeNs, endTimeNs) => {\r\n  const response = await fitness.users.dataSources.datasets.get({\r\n    userId: 'me',\r\n    dataSourceId,\r\n    datasetId: `${startTimeNs}-${endTimeNs}`,\r\n    auth,\r\n  });\r\n\r\n  return response.data;\r\n};\r\n```\r\n\r\nWith the fitness API from `googleapis` we can make requests to the Google Fitness API. In this case, we're using the `users.dataSources.datasets.get` method to get data for a specific data source. We pass in the `userId` as `me` to get data for the current user, the `dataSourceId` that we want to get data for, and the `datasetId` which is a combination of the start and end time in nanoseconds. Finally, we pass in the authentication object that we created earlier.\r\n\r\n## Aggregating the Data\r\nLet's take a look at the data we got back from the Google Fitness API:\r\n\r\n### Weight\r\n```json\r\n{\r\n  \"minStartTimeNs\": \"1690662651313000000\",\r\n  \"maxEndTimeNs\": \"1691008251313000000\",\r\n  \"dataSourceId\": \"derived:com.google.weight:com.google.android.gms:merge_weight\",\r\n  \"point\": [\r\n    {\r\n      \"startTimeNanos\": \"1690961397000000000\",\r\n      \"endTimeNanos\": \"1690961397000000000\",\r\n      \"dataTypeName\": \"com.google.weight\",\r\n      \"originDataSourceId\": \"raw:com.google.weight:cn.fitdays.fitdays:\",\r\n      \"value\": [\r\n        {\r\n          \"fpVal\": 77.59,\r\n          \"mapVal\": []\r\n        }\r\n      ],\r\n      \"modifiedTimeMillis\": \"1690963181330\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n### Fat Percentage\r\n```json\r\n{\r\n  \"minStartTimeNs\": \"1690662651313000000\",\r\n  \"maxEndTimeNs\": \"1691008251313000000\",\r\n  \"dataSourceId\": \"derived:com.google.body.fat.percentage:com.google.android.gms:merged\",\r\n  \"point\": [\r\n    {\r\n      \"startTimeNanos\": \"1690961397000000000\",\r\n      \"endTimeNanos\": \"1690961397000000000\",\r\n      \"dataTypeName\": \"com.google.body.fat.percentage\",\r\n      \"originDataSourceId\": \"raw:com.google.body.fat.percentage:cn.fitdays.fitdays:\",\r\n      \"value\": [\r\n        {\r\n          \"fpVal\": 20,\r\n          \"mapVal\": []\r\n        }\r\n      ],\r\n      \"modifiedTimeMillis\": \"1690963181468\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n### Nutrition\r\n```json\r\n{\r\n  \"minStartTimeNs\": \"1690662651313000000\",\r\n  \"maxEndTimeNs\": \"1691008251313000000\",\r\n  \"dataSourceId\": \"derived:com.google.nutrition:com.google.android.gms:merged\",\r\n  \"point\": [\r\n    {\r\n      \"startTimeNanos\": \"1690961397000000000\",\r\n      \"endTimeNanos\": \"1690961397000000000\",\r\n      \"dataTypeName\": \"com.google.nutrition\",\r\n      \"originDataSourceId\": \"raw:com.google.nutrition:com.sillens.shapeupclub:health_platform\",\r\n      \"value\": [\r\n        {\r\n          \"mapVal\": [\r\n            {\r\n              \"key\": \"fat.total\",\r\n              \"value\": {\r\n                \"fpVal\": 16.349998474121094\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"sodium\",\r\n              \"value\": {\r\n                \"fpVal\": 0\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"potassium\",\r\n              \"value\": {\r\n                \"fpVal\": 0\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"fat.unsaturated\",\r\n              \"value\": {\r\n                \"fpVal\": 3\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"fat.saturated\",\r\n              \"value\": {\r\n                \"fpVal\": 13.34999942779541\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"protein\",\r\n              \"value\": {\r\n                \"fpVal\": 5.25\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"carbs.total\",\r\n              \"value\": {\r\n                \"fpVal\": 60.45000076293945\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"cholesterol\",\r\n              \"value\": {\r\n                \"fpVal\": 0\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"calories\",\r\n              \"value\": {\r\n                \"fpVal\": 412.5\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"sugar\",\r\n              \"value\": {\r\n                \"fpVal\": 42.599998474121094\r\n              }\r\n            },\r\n            {\r\n              \"key\": \"dietary_fiber\",\r\n              \"value\": {\r\n                \"fpVal\": 0\r\n              }\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"intVal\": 1,\r\n          \"mapVal\": []\r\n        },\r\n        {\r\n          \"stringVal\": \"Salted caramel cornetto\",\r\n          \"mapVal\": []\r\n        }\r\n      ],\r\n      \"modifiedTimeMillis\": \"1690805813623\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nAs you can see, the data is in a format that is not very easy to work with. We need to parse this data and aggregate it into a usable format.\r\n\r\n```javascript\r\nconst curatedWeightData = extractBodyData(weightData, 'weight');\r\nconst curatedFatPercentageData = extractBodyData(fatPercentageData, 'fatPercentage');\r\nconst curatedNutritionData = aggregateNutritionData(extractNutritionData(nutritionData));\r\n```\r\n\r\nAfter using these mysterious functions, our data will look like this:\r\n\r\n```javascript\r\nconsole.log(curatedWeightData);\r\n// [{ date: '02/08/2023', weight: 77.5999984741211 }]\r\nconsole.log(curatedFatPercentageData);\r\n// [{ date: '02/08/2023', fatPercentage: 20 }]\r\nconsole.log(curatedNutritionData);\r\n// [{ date: '02/08/2023', foods: ['Salted caramel cornetto'], protein: 5.25, fat: 16.349998474121094, carbs: 60.45000076293945, fiber: 0, sugar: 42.599998474121094 }]\r\n```\r\n\r\nOk now let's write the functions that do this magic, or better, let's ask ChatGPT to do it for us.\r\n\r\n```javascript\r\nfunction nanosToDateString(nanos) {\r\n  const milliseconds = parseInt(nanos, 10) / 1000000;\r\n  return new Date(milliseconds).toLocaleDateString('en-GB');\r\n}\r\n\r\nfunction extractBodyData(jsonArray, type) {\r\n  return jsonArray.point.map((dataPoint) => {\r\n    const date = nanosToDateString(dataPoint.startTimeNanos);\r\n    const data = dataPoint.value[0].fpVal;\r\n    return { date, [type]: data };\r\n  });\r\n}\r\n```\r\n\r\nAnd for the nutrition data aggregation:\r\n\r\n```javascript\r\nfunction aggregateNutritionData(nutritionArray) {\r\n  const aggregatedData = {};\r\n\r\n  nutritionArray.forEach((nutrition) => {\r\n    const { date, foodName, ...nutritionValues } = nutrition;\r\n\r\n    if (!aggregatedData[date]) {\r\n      aggregatedData[date] = {\r\n        date,\r\n        foods: [foodName],\r\n        ...nutritionValues,\r\n      };\r\n    } else {\r\n      aggregatedData[date].foods.push(foodName);\r\n\r\n      Object.keys(nutritionValues).forEach((key) => {\r\n        if (Object.prototype.hasOwnProperty.call(nutritionValues, key)) {\r\n          aggregatedData[date][key] += nutritionValues[key];\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  return Object.values(aggregatedData);\r\n}\r\n```\r\n\r\nThe last thing to do is to merge these 3 arrays into one and sort them by date.\r\n\r\n```javascript\r\nfunction mergeDataArrays(...arrays) {\r\n  const mergedData = {};\r\n\r\n  arrays.forEach((array) => {\r\n    array.forEach((item) => {\r\n      const { date, ...rest } = item;\r\n      if (!mergedData[date]) {\r\n        mergedData[date] = { date, ...rest };\r\n      } else {\r\n        Object.assign(mergedData[date], rest);\r\n      }\r\n    });\r\n  });\r\n\r\n  return Object.values(mergedData);\r\n}\r\n\r\nconsole.log(mergeDataArrays(curatedWeightData, curatedFatPercentageData, curatedNutritionData));\r\n// [{\"date\":\"02/08/2023\",\"weight\":77.5999984741211,\"fatPercentage\":20,\"foods\":[\"Salted caramel cornetto\"],\"protein\":5.25,\"fat\":16.349998474121094,\"carbs\":60.45000076293945,\"fiber\":0,\"sugar\":42.599998474121094}]\r\n```\r\n\r\n~Alright, time to use this data to get some insights.~ Actually, we need one more thing before we can do that.\r\n\r\n## Muscle mass and body fat composition\r\nBefore diving into the calculations, we need to understand how muscle and fat are distributed in the body.\r\n\r\nI wanted to figure out how many calories are in 1kg of muscle and 1kg of fat, so I started looking for books on [Google Books](https://www.google.com/books) to find the exact composition of muscle and fat tissue, and I did find some information on [The Nutritionist Food, Nutrition, and Optimal Health By Robert Wildman](https://www.google.com/books/edition/The_Nutritionist/olIsBgAAQBAJ?hl=en&gbpv=1&pg=PA148&printsec=frontcover).\r\n\r\n![](../../uploads/blog/2023/08/muscle-and-fat-composition.png)\r\n\r\nBut I still needed to know what is the energy cost to build that 1kg of muscle and 1kg of fat, so for that, I asked ChatGPT.\r\n\r\n> Hi. What is the exact composition in percentages of 1kg of skeletal muscle and 1kg of adipose tissue? Also, provide the source of the information. Please give me a short answer, thank you.\r\n\r\n> Sure! Here's a short answer for the general composition of 1kg of skeletal muscle and 1kg of adipose tissue:\r\n>\r\n> Skeletal Muscle (1kg):\r\n>\r\n> - Water: ~75%\r\n> - Protein: ~20%\r\n> - Fats: ~5%\r\n> - Other (minerals, glycogen, etc.): Trace amounts\r\n>\r\n> Adipose Tissue (1kg):\r\n>\r\n> - Lipids: ~80-90%\r\n> - Water: ~10-20%\r\n> - Protein: ~2%\r\n> - Other (minerals, etc.): Trace amounts\r\n>\r\n> Please note that these values can vary depending on factors like age, sex, diet, and overall health. The information is based on general scientific understanding and can be found in various human physiology and anatomy textbooks, such as \"Human Anatomy & Physiology\" by Elaine N. Marieb and Katja Hoehn.\r\n\r\n> And what is the synthesis efficiency in percentage to build 1 gram of muscle protein and 1 gram of lipids?  Also, provide the source of the information. Please give me a short answer, thank you.\r\n\r\n> The synthesis efficiency for building muscle protein and lipids varies widely depending on factors like species, diet, age, and health. However, a general estimate can be provided:\r\n>\r\n> - For muscle protein, the efficiency is often around 20-25%. This means that only about 20-25% of the amino acids consumed are incorporated into muscle protein.\r\n> - For lipids, the efficiency of conversion from dietary fats can be higher, around 90-95%.\r\n>\r\n> These numbers are rough estimates and can vary significantly. The information is derived from general knowledge of nutritional biochemistry and can be found in textbooks like \"Biochemical, Physiological, and Molecular Aspects of Human Nutrition\" by Martha H. Stipanuk and Marie A. Caudill, and scientific papers on the subject. Always consult specific research or a professional in the field for more precise information tailored to a particular situation.\r\n\r\nCool. Let's do some math now!\r\n\r\n### Muscle calculation\r\nNow that we know a kilogram of muscle is made up of 20% protein and 5% fat. With 1g of protein having 4 calories and 1g of fat containing 9 calories, that means 1kg of muscle has 800 calories from protein and 450 from fat, totaling 1250 calories.\r\n\r\n### Fat calculation\r\nAs for fat, a kilogram is made up of 85% lipids and 2% protein. With 1g of lipids having 9 calories, and 1g of protein having 4 calories, that means 1kg of fat has 7650 calories from lipids and 80 calories from protein, totaling 7730 calories.\r\n\r\n### Synthesis cost\r\nWhen it comes to building the essential components of our body, the efficiency varies for different substances.\r\n\r\nFor proteins, our body's efficiency is about ~23%. That means for every 1g of protein, which has 4kcal, we need around ~17kcal to make it. Think of it like this: 4kcal goes into the actual amino acids in the protein, and the other 13kcal is the energy used up in the building process.\r\n\r\nNow, lipids are a different story. Our body's a bit more efficient here, at ~93%. So for 1g of lipids, which has 9kcal, it only takes about 10kcal to make it. That's 9kcal for the amino acids in the lipids, and just 1kcal for the synthesis.\r\n\r\n### Calculating the energy cost\r\nSo, let's wrap our heads around all these numbers and see what they mean for the energy cost of building muscle and fat.\r\n\r\nFor muscle, we've got 1kg with 200g of protein and 50g of lipids. Since it takes about 17kcal to make 1g of protein and 10kcal for 1g of lipids, the total energy cost for 1kg of muscle is:\r\n\r\n- Protein: 200 x 17 = 3400kcal\r\n- Fat: 50 x 10 = 500kcal\r\n- Grand Total: 3400 + 500 = 3900kcal\r\n\r\nNow, for body fat, with 1kg having 850g of lipids and 20g of protein, the total energy cost is:\r\n\r\n- Lipids: 850 x 10 = 8500kcal\r\n- Protein: 20 x 17 = 340kcal\r\n- Grand Total: 8500 + 340 = 8840kcal\r\n\r\nSo there you go! With these numbers, I will add the following `consts` to my code:\r\n\r\n```javascript\r\nconst CALORIES_STORED_KG_FAT = 7730;\r\nconst CALORIES_BUILD_KG_FAT = 8840;\r\nconst CALORIES_STORED_KG_MUSCLE = 1250;\r\nconst CALORIES_BUILD_KG_MUSCLE = 3900;\r\n```\r\n\r\nA quick reminder that these are all estimates, and the actual numbers may vary depending on your body composition, diet, and other factors. Also, I'm not a doctor or a nutritionist, so please don't take this as medical advice.\r\n\r\n## Calculating the TDEE\r\nNow that we have our parsed weight and fat percentage data and have aggregated it into a usable format, we can start to calculate our TDEE.\r\n\r\nTo calculate your TDEE, follow these steps:\r\n\r\n1. Get the total number of calories consumed during the 30-day period.\r\n2. Calculate the weight difference between the start and end of the 30-day period.\r\n3. Convert the weight difference to calories by multiplying it by the number of muscle/fat gained/lost.\r\n4. Subtract the result from step 3 from the total calories consumed in the 30-day period.\r\n5. Divide the result from step 4 by 30 to get your average daily calorie intake, which should be your TDEE.\r\n\r\nHere's the code to calculate TDEE and more using the code:\r\n\r\n```javascript\r\nfunction calculateStatistics(dataArray) {\r\n  const totalDays = dataArray.length;\r\n\r\n  const {\r\n    totalFat,\r\n    totalFiber,\r\n    totalCarbs,\r\n    finalWeight,\r\n    totalProtein,\r\n    totalCalories,\r\n    initialWeight,\r\n    initialFatPercentage,\r\n    finalFatPercentage,\r\n    initialDate,\r\n    finalDate,\r\n  } = accumulateData(dataArray);\r\n\r\n  const {\r\n    fatDifference,\r\n    weightDifference,\r\n    muscleDifference,\r\n    fatDifferencePercentage,\r\n  } = calculateWeightDifference(initialWeight, finalWeight, initialFatPercentage, finalFatPercentage);\r\n\r\n  const { muscleCalories, fatCalories } = calculateMuscleAndFatCalories(muscleDifference, fatDifference);\r\n  const tdee = calculateTDEE(totalCalories, muscleCalories, fatCalories, totalDays);\r\n\r\n  return [\r\n    `*From ${initialDate} to ${finalDate}*\\n`,\r\n    `Days Range: ${totalDays}`,\r\n    `TDEE: ${tdee?.toFixed(2)} kcal`,\r\n    `Average Calories: ${(totalCalories / totalDays)?.toFixed(2)} kcal`,\r\n    `Average Protein: ${(totalProtein / totalDays)?.toFixed(2)} g`,\r\n    `Average Carbs: ${(totalCarbs / totalDays)?.toFixed(2)} g`,\r\n    `Average Fat: ${(totalFat / totalDays)?.toFixed(2)} g`,\r\n    `Average Fiber: ${(totalFiber / totalDays)?.toFixed(2)} g`,\r\n    `Weight Difference: ${weightDifference > 0 ? '+' : ''}${weightDifference?.toFixed(2)} kg (${initialWeight?.toFixed(2)} -> ${finalWeight?.toFixed(2)})`,\r\n    `Fat Difference: ${fatDifference > 0 ? '+' : ''}${fatDifference?.toFixed(2)} kg`,\r\n    `Non-Fat Difference: ${muscleDifference > 0 ? '+' : ''}${muscleDifference?.toFixed(2)} kg`,\r\n    `Fat Percentage Difference: ${fatDifferencePercentage > 0 ? '+' : ''}${fatDifferencePercentage?.toFixed(2)}%  (${initialFatPercentage?.toFixed(2)} -> ${finalFatPercentage?.toFixed(2)})`,\r\n  ].join('\\n');\r\n}\r\n```\r\n\r\nThis function returns a string with details for a 30-day period, including the number of days, TDEE, average daily intake of calories, protein, carbohydrates, fat, and fiber, as well as the weight, fat, non-fat, and fat percentage differences between the start and end of the period.\r\n\r\nAs for the missing functions `accumulateData`, `calculateWeightDifference` and `calculateTDEE`, here they are:\r\n\r\n```javascript\r\nfunction accumulateData(dataArray) {\r\n  const lastOccurrence = dataArray[dataArray.length - 1];\r\n  const firstOccurrence = dataArray[0];\r\n\r\n  const accumulator = {\r\n    totalCalories: 0,\r\n    totalProtein: 0,\r\n    totalCarbs: 0,\r\n    totalFat: 0,\r\n    totalFiber: 0,\r\n    initialWeight: firstOccurrence?.weight,\r\n    finalWeight: lastOccurrence?.weight,\r\n    initialFatPercentage: firstOccurrence?.fatPercentage,\r\n    finalFatPercentage: lastOccurrence?.fatPercentage,\r\n    initialDate: firstOccurrence?.date || '',\r\n    finalDate: lastOccurrence?.date || '',\r\n  };\r\n\r\n  dataArray.forEach((data) => {\r\n    accumulator.totalCalories += data.caloriesConsumed;\r\n    accumulator.totalProtein += data.protein;\r\n    accumulator.totalCarbs += data.carbs;\r\n    accumulator.totalFat += data.fat;\r\n    accumulator.totalFiber += data.fiber;\r\n  });\r\n\r\n  return accumulator;\r\n}\r\n\r\nfunction calculateWeightDifference(initialWeight, finalWeight, initialFatPercentage, finalFatPercentage) {\r\n  const weightDifference = finalWeight - initialWeight;\r\n  const initialFat = (initialFatPercentage * initialWeight) / 100;\r\n  const finalFat = (finalFatPercentage * finalWeight) / 100;\r\n  const fatDifference = finalFat - initialFat;\r\n  const muscleDifference = weightDifference - fatDifference;\r\n  const fatDifferencePercentage = finalFatPercentage - initialFatPercentage;\r\n\r\n  return { weightDifference, fatDifference, muscleDifference, fatDifferencePercentage };\r\n}\r\n\r\nfunction calculateTDEE(totalCalories, muscleCalories, fatCalories, totalDays) {\r\n  const caloriesDifference = fatCalories + muscleCalories;\r\n\r\n  return (totalCalories - caloriesDifference) / totalDays;\r\n}\r\n```\r\n\r\nAs you can see, the `calculateStatistics` function calls the `accumulateData` function to get the total calories, protein, carbohydrates, fat, and fiber consumed during the 30-day period, as well as the initial and final weight and fat percentage.\r\n\r\nThen, it calls the `calculateWeightDifference` function to calculate the weight, fat, non-fat, and fat percentage differences between the start and end of the period.\r\n\r\nFinally, it calls the `calculateTDEE` function to calculate the TDEE.\r\n\r\n## Send the data to Telegram\r\nOnce you have calculated your TDEE, you may want to share this information with others, such as a personal trainer or a friend. One easy way to do this is by sending the data to a Telegram group chat. This can be done using the Telegram Bot API.\r\n\r\nHere's an example code snippet that sends the TDEE result to a Telegram group chat:\r\n\r\n```javascript\r\nconst text = calculateStatistics(agragatedData);\r\nawait nodeFetch(`https://api.telegram.org/bot${process.env.TELEGRAM_BOT_ID}/sendMessage`, {\r\n  method: 'POST',\r\n  headers: {\r\n  'Content-Type': 'application/json',\r\n  },\r\n  body: JSON.stringify({\r\n  text,\r\n  chat_id: process.env.TELEGRAM_GROUP_ID,\r\n  parse_mode: 'markdown',\r\n  }),\r\n});\r\n```\r\n\r\nIn this code, we are using the `node-fetch` package to make an HTTP POST request to the Telegram Bot API's sendMessage method. We pass in the TDEE result as the text field in the request body, along with the chat_id of the Telegram group we want to send the message. We also set the `parse_mode` field to `markdown` to enable formatting in the message.\r\n\r\nNote that in order to use this code, you will need to set the `TELEGRAM_BOT_ID` and `TELEGRAM_GROUP_ID` environment variables to the appropriate values.\r\n\r\n## Bonus\r\nYou can copy the text you got from this script and send it to ChatGPT for even more insights 👀.\r\n\r\n> Hi. What do you think of these data from my personal health track from the past 30 days or so? Can you give me a short and concise insight into what I'm doing well and where I should improve? Thanks\r\n> <- My Text Data ->\r\n\r\n> Sure! Based on the data you've provided, here's a brief analysis:\r\n>\r\n> What You're Doing Well:\r\n> Caloric Balance: Your average caloric intake is very close to your Total Daily Energy Expenditure (TDEE), which suggests that you are maintaining your weight effectively.\r\n> Weight Loss: You've lost 0.80 kg over the past month, which is a healthy and sustainable rate of weight loss if that's your goal.\r\n> Protein Intake: Your average protein intake seems to be in a good range, especially if you're engaging in physical activities that require muscle repair and growth.\r\n>\r\n> Areas for Improvement:\r\n> Fat Percentage Increase: The increase in fat percentage and fat mass might be a concern if you are aiming to reduce body fat. This could be related to the type of foods you are consuming or the balance of macronutrients.\r\n> Fiber Intake: Your average fiber intake is a bit on the lower side. Increasing fiber intake by consuming more whole grains, fruits, and vegetables can aid in digestion and may help with weight management.\r\n>\r\n> Remember, these insights are based on the data provided and general guidelines. Individual needs can vary widely, so it's always a good idea to consult with a healthcare provider or nutrition professional for personalized advice.\r\n\r\n## Conclusion\r\nThat's it, now you will always know precisely what your TDEE is. You can use this information to adjust your diet and exercise routine to achieve your fitness goals, you can even put this script into a GitHub Actions workflow to run it automatically every day and send the results to a Telegram group chat.\r\n\r\nIf you want to see the full code, [you can find it in my GitHub](https://github.com/blopa/google-fit-telegram/), which includes a GitHub Action workflow that runs the script every day and sends the results to a Telegram chat, so feel free to simply clone the repository and use it.\r\n\r\nI hope you found this article useful. If you have any questions or comments, feel free to [reach out](/en/contact) or leave your feedback in the comments section below.\r\n","frontmatter":{"tags":["google cloud","fitness api","google fit","nodejs","node","javascript"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-08-02T00:00:00.000Z","id":null,"path":"using-google-fitness-api-to-calculate-my-tdee-and-more","show":true,"title":"Using Google Fitness API to calculate my TDEE and more","hideExcerpt":false,"subtitle":"From calories to code: Integrating Google Fitness API for personalized health insights"}}},{"node":{"excerpt":"Gatsby is a popular static site generator that is built on…","html":"<p>Gatsby is a popular static site generator that is built on React, and it’s the one that I use to create this blog. With its powerful plugin system, it allows developers to easily add features to their sites.</p>\n<p>One feature that can be added is API endpoints, which can be used to serve JSON data to the client.</p>\n<p>In this post, we will look at how to add API endpoints to Gatsby v3 by modifying the <code class=\"language-text\">gatsby-node.js</code> file.</p>\n<p>First post of 2023, let’s go!!</p>\n<h2 id=\"the-problem\" style=\"position:relative;\"><a href=\"#the-problem\" aria-label=\"the problem permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The problem</h2>\n<p>In a Gatsby site, the data that is used to build pages is typically sourced from a variety of sources, such as <code class=\"language-text\">Markdown</code> files or a headless CMS.</p>\n<p>In my case, all my posts come from <code class=\"language-text\">Markdown</code> files, and I have some custom scripts to match related posts, get the blog post comments, etc.</p>\n<p>Since all my data is stored “offline”, if I want to access it in another application I would have to pretty much scrape my own website, and that’s not good.</p>\n<h2 id=\"the-solution\" style=\"position:relative;\"><a href=\"#the-solution\" aria-label=\"the solution permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The solution</h2>\n<p>If I create an API endpoint for my blog, then I can expose all data that is currently already public and displayed as <code class=\"language-text\">HTML</code>, but provide it as a “raw” JSON data.</p>\n<p>To add API endpoints to a Gatsby site, we need to take advantage of the <code class=\"language-text\">onPostBuild</code> lifecycle method in the <code class=\"language-text\">gatsby-node.js</code> file. This method is called after the site has been built, and allows us to perform additional actions, such as creating JSON files.</p>\n<p>Since I do a lot of custom scripting on all my pages, we are using a global variable called <code class=\"language-text\">jsonFiles</code> that will dynamically populate with data from the <code class=\"language-text\">onCreatePage</code> function.</p>\n<p>This will be used to store the data that we want to use to create the JSON files then loop through each path in the <code class=\"language-text\">jsonFiles</code> object and use the <code class=\"language-text\">createPage</code> action to create a new page for each <code class=\"language-text\">path</code>.</p>\n<p>Here is an example of how I’m doing it:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> writeFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> jsonFiles <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreatePage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    jsonFiles<span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> page<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onPostBuild</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>jsonFiles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">[</span>filePath<span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> fileFullPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>\r\n            __dirname<span class=\"token punctuation\">,</span>\r\n            <span class=\"token string\">'public'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token operator\">...</span>filePath<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">part</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> part<span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>fileFullPath<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"consuming-the-data-from-the-api-endpoints\" style=\"position:relative;\"><a href=\"#consuming-the-data-from-the-api-endpoints\" aria-label=\"consuming the data from the api endpoints permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Consuming the data from the API endpoints</h2>\n<p>Once the API endpoints have been created, the next step is to consume the data from the client side. This can be done by using the <code class=\"language-text\">fetch()</code> function.</p>\n<p>Here is an example of how to use <code class=\"language-text\">fetch()</code> to get the data from the endpoint for this blog post:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://pablo.gg/en/blog/coding/creating-rest-api-endpoints-to-my-gatsby-blog.json'</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token comment\">// { comments: [], html: '&lt;p>..&lt;/p>', language: 'en', path: 'blog-path', postHashId: 'hash', relatedPosts: [], title: 'Post title' }</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Adding API endpoints to a Gatsby site is a simple task, but can enhance the possibilities of your website.</p>\n<p>I will soon (I hope) share what I plan to do with my own API 👀</p>\n<p>That’s all I have for you guys today, see you on the next one!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTAxLTIyVDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-01-22-creating-rest-api-endpoints-to-my-gatsby-blog.en/","path":"/blog/coding/creating-rest-api-endpoints-to-my-gatsby-blog/","locale":"en"},"rawMarkdownBody":"Gatsby is a popular static site generator that is built on React, and it's the one that I use to create this blog. With its powerful plugin system, it allows developers to easily add features to their sites.\r\n\r\nOne feature that can be added is API endpoints, which can be used to serve JSON data to the client.\r\n\r\nIn this post, we will look at how to add API endpoints to Gatsby v3 by modifying the `gatsby-node.js` file.\r\n\r\nFirst post of 2023, let's go!!\r\n\r\n## The problem\r\nIn a Gatsby site, the data that is used to build pages is typically sourced from a variety of sources, such as `Markdown` files or a headless CMS.\r\n\r\nIn my case, all my posts come from `Markdown` files, and I have some custom scripts to match related posts, get the blog post comments, etc.\r\n\r\nSince all my data is stored \"offline\", if I want to access it in another application I would have to pretty much scrape my own website, and that's not good.\r\n\r\n## The solution\r\nIf I create an API endpoint for my blog, then I can expose all data that is currently already public and displayed as `HTML`, but provide it as a \"raw\" JSON data.\r\n\r\nTo add API endpoints to a Gatsby site, we need to take advantage of the `onPostBuild` lifecycle method in the `gatsby-node.js` file. This method is called after the site has been built, and allows us to perform additional actions, such as creating JSON files.\r\n\r\nSince I do a lot of custom scripting on all my pages, we are using a global variable called `jsonFiles` that will dynamically populate with data from the `onCreatePage` function.\r\n\r\nThis will be used to store the data that we want to use to create the JSON files then loop through each path in the `jsonFiles` object and use the `createPage` action to create a new page for each `path`.\r\n\r\nHere is an example of how I'm doing it:\r\n\r\n```javascript\r\nconst { writeFileSync } = require('fs');\r\nconst jsonFiles = {};\r\n\r\nexports.onCreatePage = ({ page }) => {\r\n    jsonFiles[page.path] = page.context.data;\r\n}\r\n\r\nexports.onPostBuild = () => {\r\n    Object.entries(jsonFiles).map(([filePath, content]) => {\r\n        const fileFullPath = path.resolve(\r\n            __dirname,\r\n            'public',\r\n            ...filePath.split('/').filter((part) => part)\r\n        );\r\n\r\n        writeFileSync(fileFullPath, JSON.stringify(content));\r\n    });\r\n}\r\n```\r\n\r\n## Consuming the data from the API endpoints\r\nOnce the API endpoints have been created, the next step is to consume the data from the client side. This can be done by using the `fetch()` function.\r\n\r\nHere is an example of how to use `fetch()` to get the data from the endpoint for this blog post:\r\n\r\n```javascript\r\nfetch('https://pablo.gg/en/blog/coding/creating-rest-api-endpoints-to-my-gatsby-blog.json')\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n      console.log(data);\r\n      // { comments: [], html: '<p>..</p>', language: 'en', path: 'blog-path', postHashId: 'hash', relatedPosts: [], title: 'Post title' }\r\n    })\r\n    .catch((error) => console.log(error))\r\n```\r\n\r\n## Conclusion\r\nAdding API endpoints to a Gatsby site is a simple task, but can enhance the possibilities of your website.\r\n\r\nI will soon (I hope) share what I plan to do with my own API 👀\r\n\r\nThat's all I have for you guys today, see you on the next one!\r\n","frontmatter":{"tags":["gatsby","react","rest api","api"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-01-22T00:00:00.000Z","id":null,"path":"creating-rest-api-endpoints-to-my-gatsby-blog","show":true,"title":"Creating Rest API endpoints to my Gatsby blog","hideExcerpt":false,"subtitle":"Learn how to add API endpoints to Gatsby v3 using the onPostBuild method and create JSON files with a global variable"}}},{"node":{"excerpt":"Gatsby é um gerador de sites estáticos popular que é…","html":"<p>Gatsby é um gerador de sites estáticos popular que é construído com React, e é o que eu uso para criar este blog. Com seu sistema de plugins poderoso, ele permite que os desenvolvedores adicionem facilmente recursos aos seus sites.</p>\n<p>Uma característica que pode ser adicionada são os endpoints da API, que podem ser usados para servir dados JSON ao cliente.</p>\n<p>Neste post, vamos ver como adicionar endpoints da API ao Gatsby v3, modificando o arquivo <code class=\"language-text\">gatsby-node.js</code>.</p>\n<p>Primeiro post de 2023, vamos lá!!</p>\n<h2 id=\"o-problema\" style=\"position:relative;\"><a href=\"#o-problema\" aria-label=\"o problema permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O problema</h2>\n<p>Em um site feito com Gatsby, os dados usados para construir as páginas geralmente são provenientes de uma variedade de fontes, como arquivos <code class=\"language-text\">Markdown</code> ou um headless CMS.</p>\n<p>No meu caso, todos os meus posts vêm de arquivos <code class=\"language-text\">Markdown</code>, e eu tenho alguns scripts personalizados para corresponder a posts relacionados, obter comentários do post do blog, etc.</p>\n<p>Como todos os meus dados estão armazenados “offline”, se eu quiser acessá-los em outra aplicação, eu teria que praticamente raspar o meu próprio site e isso não é bom.</p>\n<h2 id=\"a-solucao\" style=\"position:relative;\"><a href=\"#a-solucao\" aria-label=\"a solucao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A solução</h2>\n<p>Se eu criar um ponto final de API para o meu blog, então posso expor todos os dados que atualmente já são públicos e exibidos como <code class=\"language-text\">HTML</code>, mas fornecer como dados “brutos” JSON.</p>\n<p>Para adicionar endpoints da API a um site feito com Gatsby, precisamos aproveitar o método de ciclo de vida <code class=\"language-text\">onPostBuild</code> no arquivo <code class=\"language-text\">gatsby-node.js</code>. Este método é chamado depois que o site foi construído e nos permite realizar ações adicionais, como criar arquivos JSON.</p>\n<p>Como eu faço muitos scripts personalizados em todas as minhas páginas, estamos usando uma variável global chamada <code class=\"language-text\">jsonFiles</code> que será preenchida dinamicamente com dados da função <code class=\"language-text\">onCreatePage</code>.</p>\n<p>Isso será usado para armazenar os dados que queremos usar para criar os arquivos JSON e, em seguida, percorrer cada caminho no objeto <code class=\"language-text\">jsonFiles</code> e usar a ação createPage para criar uma nova página para cada caminho.</p>\n<p>Aqui está um exemplo de como estou fazendo isso:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> writeFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> jsonFiles <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreatePage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    jsonFiles<span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> page<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onPostBuild</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>jsonFiles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">[</span>filePath<span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> fileFullPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>\r\n            __dirname<span class=\"token punctuation\">,</span>\r\n            <span class=\"token string\">'public'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token operator\">...</span>filePath<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">part</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> part<span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>fileFullPath<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"consumindo-os-dados-dos-endpoints-da-api\" style=\"position:relative;\"><a href=\"#consumindo-os-dados-dos-endpoints-da-api\" aria-label=\"consumindo os dados dos endpoints da api permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Consumindo os dados dos endpoints da API</h2>\n<p>Agora que os endpoints da API foram criados, o próximo passo é consumir os dados do lado do cliente. Isso pode ser feito usando a função <code class=\"language-text\">fetch()</code>.</p>\n<p>Aqui está um exemplo de como usar <code class=\"language-text\">fetch()</code> para obter os dados do ponto final para este post do blog:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://pablo.gg/pt-br/blog/coding/criando-api-endpoints -para-o-meu-blog-em-gatsby.json'</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token comment\">// { comments: [], html: '&lt;p>..&lt;/p>', language: 'pt-br', path: 'blog-path', postHashId: 'hash', relatedPosts: [], title: 'Titulo' }</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Adicionar pontos finais de API a um site Gatsby é uma tarefa simples, mas pode aumentar as possibilidades do seu site.</p>\n<p>Em breve (espero) compartilharei o que planejo fazer com minha própria API 👀</p>\n<p>Isso é tudo que tenho para vocês hoje, até a próxima!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIzLTAxLTIyVDAwOjAwOjAwLjAwMFo=","slug":"/2023/2023-01-22-criando-api-endpoints-para-o-meu-blog-em-gatsby.pt-br/","path":"/blog/coding/criando-api-endpoints-para-o-meu-blog-em-gatsby/","locale":"pt-br"},"rawMarkdownBody":"Gatsby é um gerador de sites estáticos popular que é construído com React, e é o que eu uso para criar este blog. Com seu sistema de plugins poderoso, ele permite que os desenvolvedores adicionem facilmente recursos aos seus sites.\r\n\r\nUma característica que pode ser adicionada são os endpoints da API, que podem ser usados para servir dados JSON ao cliente.\r\n\r\nNeste post, vamos ver como adicionar endpoints da API ao Gatsby v3, modificando o arquivo `gatsby-node.js`.\r\n\r\nPrimeiro post de 2023, vamos lá!!\r\n\r\n## O problema\r\nEm um site feito com Gatsby, os dados usados para construir as páginas geralmente são provenientes de uma variedade de fontes, como arquivos `Markdown` ou um headless CMS.\r\n\r\nNo meu caso, todos os meus posts vêm de arquivos `Markdown`, e eu tenho alguns scripts personalizados para corresponder a posts relacionados, obter comentários do post do blog, etc.\r\n\r\nComo todos os meus dados estão armazenados \"offline\", se eu quiser acessá-los em outra aplicação, eu teria que praticamente raspar o meu próprio site e isso não é bom.\r\n\r\n## A solução\r\nSe eu criar um ponto final de API para o meu blog, então posso expor todos os dados que atualmente já são públicos e exibidos como `HTML`, mas fornecer como dados \"brutos\" JSON.\r\n\r\nPara adicionar endpoints da API a um site feito com Gatsby, precisamos aproveitar o método de ciclo de vida `onPostBuild` no arquivo `gatsby-node.js`. Este método é chamado depois que o site foi construído e nos permite realizar ações adicionais, como criar arquivos JSON.\r\n\r\nComo eu faço muitos scripts personalizados em todas as minhas páginas, estamos usando uma variável global chamada `jsonFiles` que será preenchida dinamicamente com dados da função `onCreatePage`.\r\n\r\nIsso será usado para armazenar os dados que queremos usar para criar os arquivos JSON e, em seguida, percorrer cada caminho no objeto `jsonFiles` e usar a ação createPage para criar uma nova página para cada caminho.\r\n\r\nAqui está um exemplo de como estou fazendo isso:\r\n\r\n```javascript\r\nconst { writeFileSync } = require('fs');\r\nconst jsonFiles = {};\r\n\r\nexports.onCreatePage = ({ page }) => {\r\n    jsonFiles[page.path] = page.context.data;\r\n}\r\n\r\nexports.onPostBuild = () => {\r\n    Object.entries(jsonFiles).map(([filePath, content]) => {\r\n        const fileFullPath = path.resolve(\r\n            __dirname,\r\n            'public',\r\n            ...filePath.split('/').filter((part) => part)\r\n        );\r\n\r\n        writeFileSync(fileFullPath, JSON.stringify(content));\r\n    });\r\n}\r\n```\r\n\r\n## Consumindo os dados dos endpoints da API\r\nAgora que os endpoints da API foram criados, o próximo passo é consumir os dados do lado do cliente. Isso pode ser feito usando a função `fetch()`.\r\n\r\nAqui está um exemplo de como usar `fetch()` para obter os dados do ponto final para este post do blog:\r\n\r\n```javascript\r\nfetch('https://pablo.gg/pt-br/blog/coding/criando-api-endpoints -para-o-meu-blog-em-gatsby.json')\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n      console.log(data);\r\n      // { comments: [], html: '<p>..</p>', language: 'pt-br', path: 'blog-path', postHashId: 'hash', relatedPosts: [], title: 'Titulo' }\r\n    })\r\n    .catch((error) => console.log(error))\r\n```\r\n\r\n## Conclusão\r\nAdicionar pontos finais de API a um site Gatsby é uma tarefa simples, mas pode aumentar as possibilidades do seu site.\r\n\r\nEm breve (espero) compartilharei o que planejo fazer com minha própria API 👀\r\n\r\nIsso é tudo que tenho para vocês hoje, até a próxima!\r\n","frontmatter":{"tags":["gatsby","react","rest api","api"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2023-01-22T00:00:00.000Z","id":null,"path":"criando-api-endpoints-para-o-meu-blog-em-gatsby","show":true,"title":"Criando API endpoints  para o meu blog em Gatsby","hideExcerpt":false,"subtitle":"Aprenda como adicionar endpoints de API ao Gatsby v3 usando o método onPostBuild e criar arquivos JSON com uma variável global"}}},{"node":{"excerpt":"Last year, I wrote a blog post about where to find the best…","html":"<p>Last year, <a href=\"/en/blog/general/a-guide-to-cliff-diving-in-benagil/\">I wrote a blog post about where to find the best cliff diving spots in Benagil</a>, Portugal, and let’s just say I was a little bit hooked. I mean, who wouldn’t be? Cliff diving is the ultimate mix of excitement and adrenaline. So, when I heard that Amsterdam also has some great opportunities for this thrilling activity, I knew I had to check it out.</p>\n<p>Whether you’re a seasoned cliff diver or just looking for a new and exciting activity to try, Amsterdam has plenty of options for all skill levels.</p>\n<p>In this blog post, we’ll provide an overview of the different options for cliff diving in Amsterdam, as well as some important safety considerations.</p>\n<h2 id=\"jumping-from-canals-and-bridges\" style=\"position:relative;\"><a href=\"#jumping-from-canals-and-bridges\" aria-label=\"jumping from canals and bridges permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jumping from canals and bridges</h2>\n<p>Amsterdam’s canals and bridges offer some prime spots for cliff diving, with heights ranging from 1 to 11 meters. The Pythonbrug and Het Stenen Hoofd are two popular locations for this activity.</p>\n<p>Now, it might not be strictly legal, but it’s a common activity among locals and tourists alike. The cool waters of the canals provide a refreshing break from the summer heat, and the views from the top of the bridges are absolutely breathtaking.</p>\n<h2 id=\"diving-from-indoor-pools\" style=\"position:relative;\"><a href=\"#diving-from-indoor-pools\" aria-label=\"diving from indoor pools permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Diving from indoor pools</h2>\n<p>If you’re more of a controlled environment kind of person, don’t worry, Amsterdam has you covered. The Noorderparkbad and Sloterparkbad both have pools that are suitable for diving, and the Sloterparkbad even offers skilled classes through the Indoor Cliff Diving club.</p>\n<p>This club is a great way to learn new techniques and improve your skills in a safe, indoor setting.</p>\n<h2 id=\"indoor-cliff-diving-classes\" style=\"position:relative;\"><a href=\"#indoor-cliff-diving-classes\" aria-label=\"indoor cliff diving classes permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Indoor Cliff Diving classes</h2>\n<p>During the class, you’ll start by learning the basic diving techniques on a trampoline before moving on to the diving platform, which ranges from 3 to 10 meters. The platform is a safe and controlled environment, allowing you to focus on perfecting your dive without the added stress of external factors.</p>\n<p>As you progress through the class, you’ll have the opportunity to try different dives and increase the height of the platform. Before you know it, you’ll be confidently diving from heights of up to 10 meters!</p>\n<p>Not only is indoor diving a thrilling and unique activity, it’s also a great way to challenge yourself and build confidence. Plus, the indoor setting means you can enjoy this activity year-round, regardless of the weather.</p>\n<p>The experienced instructors at Indoor Cliff Diving will teach you the proper techniques for a successful dive.</p>\n<h2 id=\"prices-and-schedule\" style=\"position:relative;\"><a href=\"#prices-and-schedule\" aria-label=\"prices and schedule permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prices and schedule</h2>\n<p>The Indoor Cliff Diving club meets every Friday and Sunday at the Sloterparkbad, and offers a range of classes for all skill levels.</p>\n<p>Whether you’re a beginner looking to try diving for the first time, or an experienced diver looking to perfect your technique, there is a class for you.</p>\n<p><a href=\"https://indoorcliffdiving.com/#pricing\" target=\"_blank\" rel=\"noreferrer\">Prices for classes depend on the package you choose</a>, but trust me, they are very affordable and well worth the experience.</p>\n<h2 id=\"safety-first\" style=\"position:relative;\"><a href=\"#safety-first\" aria-label=\"safety first permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Safety First</h2>\n<p>No matter where you choose to cliff dive in Amsterdam, it’s important to keep safety in mind. Always check the depth of the water before jumping, and be sure to follow any rules or guidelines set by the location where you are diving.</p>\n<p>It’s also a good idea to have a trusted buddy with you to help spot you and ensure your safety.</p>\n<p>With a little bit of caution and common sense, cliff diving can be a thrilling and enjoyable activity in Amsterdam.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Cliff diving in Amsterdam is a unique and thrilling activity that offers a unique way to experience the city and a variety of options for all skill levels.</p>\n<p>Whether you choose to jump from the canals or take a class at the Indoor Cliff Diving club, I hope you have a good time. Just remember to always prioritize safety and follow any rules or guidelines set by the location where you’re diving. With a little bit of caution and common sense, you’ll be able to fully enjoy the excitement of cliff diving in Amsterdam.</p>","fields":{"postHashId":"Z2VuZXJhbHRydWVudWxsMjAyMi0xMi0yOFQwMDowMDowMC4wMDBa","slug":"/2022/2022-12-28-a-guide-to-cliff-diving-in-amsterdam.en/","path":"/blog/general/a-guide-to-cliff-diving-in-amsterdam/","locale":"en"},"rawMarkdownBody":"Last year, [I wrote a blog post about where to find the best cliff diving spots in Benagil](/en/blog/general/a-guide-to-cliff-diving-in-benagil/), Portugal, and let's just say I was a little bit hooked. I mean, who wouldn't be? Cliff diving is the ultimate mix of excitement and adrenaline. So, when I heard that Amsterdam also has some great opportunities for this thrilling activity, I knew I had to check it out.\r\n\r\nWhether you're a seasoned cliff diver or just looking for a new and exciting activity to try, Amsterdam has plenty of options for all skill levels.\r\n\r\nIn this blog post, we'll provide an overview of the different options for cliff diving in Amsterdam, as well as some important safety considerations.\r\n\r\n## Jumping from canals and bridges\r\nAmsterdam's canals and bridges offer some prime spots for cliff diving, with heights ranging from 1 to 11 meters. The Pythonbrug and Het Stenen Hoofd are two popular locations for this activity.\r\n\r\nNow, it might not be strictly legal, but it's a common activity among locals and tourists alike. The cool waters of the canals provide a refreshing break from the summer heat, and the views from the top of the bridges are absolutely breathtaking.\r\n\r\n## Diving from indoor pools\r\nIf you're more of a controlled environment kind of person, don't worry, Amsterdam has you covered. The Noorderparkbad and Sloterparkbad both have pools that are suitable for diving, and the Sloterparkbad even offers skilled classes through the Indoor Cliff Diving club.\r\n\r\nThis club is a great way to learn new techniques and improve your skills in a safe, indoor setting.\r\n\r\n## Indoor Cliff Diving classes\r\nDuring the class, you'll start by learning the basic diving techniques on a trampoline before moving on to the diving platform, which ranges from 3 to 10 meters. The platform is a safe and controlled environment, allowing you to focus on perfecting your dive without the added stress of external factors.\r\n\r\nAs you progress through the class, you'll have the opportunity to try different dives and increase the height of the platform. Before you know it, you'll be confidently diving from heights of up to 10 meters!\r\n\r\nNot only is indoor diving a thrilling and unique activity, it's also a great way to challenge yourself and build confidence. Plus, the indoor setting means you can enjoy this activity year-round, regardless of the weather.\r\n\r\nThe experienced instructors at Indoor Cliff Diving will teach you the proper techniques for a successful dive.\r\n\r\n## Prices and schedule\r\nThe Indoor Cliff Diving club meets every Friday and Sunday at the Sloterparkbad, and offers a range of classes for all skill levels.\r\n\r\nWhether you're a beginner looking to try diving for the first time, or an experienced diver looking to perfect your technique, there is a class for you.\r\n\r\n[Prices for classes depend on the package you choose](https://indoorcliffdiving.com/#pricing), but trust me, they are very affordable and well worth the experience.\r\n\r\n## Safety First\r\nNo matter where you choose to cliff dive in Amsterdam, it's important to keep safety in mind. Always check the depth of the water before jumping, and be sure to follow any rules or guidelines set by the location where you are diving.\r\n\r\nIt's also a good idea to have a trusted buddy with you to help spot you and ensure your safety.\r\n\r\nWith a little bit of caution and common sense, cliff diving can be a thrilling and enjoyable activity in Amsterdam.\r\n\r\n## Conclusion\r\nCliff diving in Amsterdam is a unique and thrilling activity that offers a unique way to experience the city and a variety of options for all skill levels.\r\n\r\nWhether you choose to jump from the canals or take a class at the Indoor Cliff Diving club, I hope you have a good time. Just remember to always prioritize safety and follow any rules or guidelines set by the location where you're diving. With a little bit of caution and common sense, you'll be able to fully enjoy the excitement of cliff diving in Amsterdam.\r\n","frontmatter":{"tags":["cliff","cliff diving","amsterdam","bridge","canals","indoor cliff diving"],"categories":["general"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-12-28T00:00:00.000Z","id":null,"path":"a-guide-to-cliff-diving-in-amsterdam","show":true,"title":"A guide to \"cliff\" diving in Amsterdam","hideExcerpt":false,"subtitle":"A guide to \"cliff\" diving in Amsterdam, including options for jumping from canals and bridges or taking indoor diving classes"}}},{"node":{"excerpt":"No ano passado, eu escrevi um post sobre onde encontrar os…","html":"<p>No ano passado, <a href=\"/pt-br/blog/general/um-guia-para-pular-de-pedras-em-benagil/\">eu escrevi um post sobre onde encontrar os melhores locais para pular de pedras em Benagil</a>, Portugal, e essa viagem despertou em mim o desejo de fazer mais mergulhos em penhascos. Fiquei emocionado ao saber que Amsterdam também oferece muitas oportunidades para essa atividade emocionante.</p>\n<p>Seja você um mergulhador experiente ou apenas procurando uma atividade nova e excitante, Amsterdam tem muitas opções para todos os níveis de habilidade.</p>\n<p>Nesse post, fornecerei uma visão geral das diferentes opções para mergulhar de “pedras” em Amsterdam, bem como algumas considerações importantes sobre segurança.</p>\n<h2 id=\"pulando-de-canais-e-pontes\" style=\"position:relative;\"><a href=\"#pulando-de-canais-e-pontes\" aria-label=\"pulando de canais e pontes permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pulando de canais e pontes</h2>\n<p>Os canais e pontes de Amsterdam oferecem ótimos locais para mergulhar, com alturas que variam de 1 a 11 metros. O Pythonbrug e Het Stenen Hoofd são dois locais populares para esta atividade.</p>\n<p>Embora possa não ser estritamente legal, é uma atividade comum entre moradores e turistas. As águas frescas dos canais proporcionam uma pausa refrescante do calor do verão, e as vistas do topo das pontes são de tirar o fôlego.</p>\n<h2 id=\"mergulho-em-piscinas-cobertas\" style=\"position:relative;\"><a href=\"#mergulho-em-piscinas-cobertas\" aria-label=\"mergulho em piscinas cobertas permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mergulho em piscinas cobertas</h2>\n<p>Se você preferir um ambiente mais controlado, também pode conferir as opções de mergulho interno em Amsterdam. O Noorderparkbad e o Sloterparkbad têm piscinas adequadas para mergulho, e o Sloterparkbad ainda oferece aulas especializadas por meio do clube Indoor Cliff Diving.</p>\n<p>Este clube é uma ótima maneira de aprender novas técnicas e melhorar as suas habilidades num ambiente interno seguro.</p>\n<h2 id=\"aulas-do-indoor-cliff-diving\" style=\"position:relative;\"><a href=\"#aulas-do-indoor-cliff-diving\" aria-label=\"aulas do indoor cliff diving permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Aulas do Indoor Cliff Diving</h2>\n<p>Durante a aula, você vai começar aprendendo as técnicas básicas de mergulho num trampolim antes de passar para a plataforma de mergulho, que varia de 3 a 10 metros. A plataforma é um ambiente seguro e controlado, permitindo que você se concentre em aperfeiçoar o seu mergulho sem o estresse adicional de fatores externos.</p>\n<p>À medida que avança na aula, terá a oportunidade de experimentar diferentes mergulhos e aumentar a altura da plataforma. Antes que você perceba, você estará mergulhando com confiança de alturas de até 10 metros!</p>\n<p>O mergulho interno não é apenas uma atividade emocionante e única, mas também uma ótima maneira de desafiar a si mesmo e ganhar confiança. Além disso, o ambiente interno significa que você pode aproveitar esta atividade o ano todo, independentemente do clima.</p>\n<p>Os instrutores experientes do Indoor Cliff Diving irão ensinar-lhe as técnicas adequadas para um mergulho bem-sucedido.</p>\n<h2 id=\"precos-e-horarios\" style=\"position:relative;\"><a href=\"#precos-e-horarios\" aria-label=\"precos e horarios permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preços e horários</h2>\n<p>O clube Indoor Cliff Diving se reúne todas as sextas e domingos no Sloterparkbad e oferece uma variedade de aulas para todos os níveis de habilidade.</p>\n<p>Se você é um iniciante procurando mergulhar pela primeira vez ou um mergulhador experiente procurando aperfeiçoar sua técnica, há uma aula para você.</p>\n<p><a href=\"https://indoorcliffdiving.com/#pricing\" target=\"_blank\" rel=\"noreferrer\">Os preços das aulas dependem do pacote que você escolher</a>, mas são bem acessíveis e valem a experiência.</p>\n<h2 id=\"seguranca-primeiro\" style=\"position:relative;\"><a href=\"#seguranca-primeiro\" aria-label=\"seguranca primeiro permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Segurança primeiro</h2>\n<p>Não importa onde você escolha mergulhar em Amsterdam, é importante manter a segurança em mente. Sempre verifique a profundidade da água antes de pular e certifique-se de seguir todas as regras ou diretrizes definidas pelo local onde você está mergulhando.</p>\n<p>Também é uma boa ideia ter um amigo de confiança com você para ajudar a localizá-lo e garantir a sua segurança.</p>\n<p>Com um pouco de cautela e bom senso, o mergulhar em Amsterdam pode ser uma atividade emocionante e agradável.</p>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Mergulhar em Amsterdam é uma atividade emocionante e única que oferece uma forma única de conhecer a cidade e uma variedade de opções para todos os níveis de habilidade.</p>\n<p>Caso você escolha pular dos canais ou participar de uma aula no clube Indoor Cliff Diving, espero que você se divirta muito.</p>","fields":{"postHashId":"Z2VuZXJhbHRydWVudWxsMjAyMi0xMi0yOFQwMDowMDowMC4wMDBa","slug":"/2022/2022-12-28-um-guia-para-pular-de-pedras-em-amsterdam.pt-br/","path":"/blog/general/um-guia-para-pular-de-pedras-em-amsterdam/","locale":"pt-br"},"rawMarkdownBody":"No ano passado, [eu escrevi um post sobre onde encontrar os melhores locais para pular de pedras em Benagil](/pt-br/blog/general/um-guia-para-pular-de-pedras-em-benagil/), Portugal, e essa viagem despertou em mim o desejo de fazer mais mergulhos em penhascos. Fiquei emocionado ao saber que Amsterdam também oferece muitas oportunidades para essa atividade emocionante.\r\n\r\nSeja você um mergulhador experiente ou apenas procurando uma atividade nova e excitante, Amsterdam tem muitas opções para todos os níveis de habilidade.\r\n\r\nNesse post, fornecerei uma visão geral das diferentes opções para mergulhar de \"pedras\" em Amsterdam, bem como algumas considerações importantes sobre segurança.\r\n\r\n## Pulando de canais e pontes\r\nOs canais e pontes de Amsterdam oferecem ótimos locais para mergulhar, com alturas que variam de 1 a 11 metros. O Pythonbrug e Het Stenen Hoofd são dois locais populares para esta atividade.\r\n\r\nEmbora possa não ser estritamente legal, é uma atividade comum entre moradores e turistas. As águas frescas dos canais proporcionam uma pausa refrescante do calor do verão, e as vistas do topo das pontes são de tirar o fôlego.\r\n\r\n## Mergulho em piscinas cobertas\r\nSe você preferir um ambiente mais controlado, também pode conferir as opções de mergulho interno em Amsterdam. O Noorderparkbad e o Sloterparkbad têm piscinas adequadas para mergulho, e o Sloterparkbad ainda oferece aulas especializadas por meio do clube Indoor Cliff Diving.\r\n\r\nEste clube é uma ótima maneira de aprender novas técnicas e melhorar as suas habilidades num ambiente interno seguro.\r\n\r\n## Aulas do Indoor Cliff Diving\r\nDurante a aula, você vai começar aprendendo as técnicas básicas de mergulho num trampolim antes de passar para a plataforma de mergulho, que varia de 3 a 10 metros. A plataforma é um ambiente seguro e controlado, permitindo que você se concentre em aperfeiçoar o seu mergulho sem o estresse adicional de fatores externos.\r\n\r\nÀ medida que avança na aula, terá a oportunidade de experimentar diferentes mergulhos e aumentar a altura da plataforma. Antes que você perceba, você estará mergulhando com confiança de alturas de até 10 metros!\r\n\r\nO mergulho interno não é apenas uma atividade emocionante e única, mas também uma ótima maneira de desafiar a si mesmo e ganhar confiança. Além disso, o ambiente interno significa que você pode aproveitar esta atividade o ano todo, independentemente do clima.\r\n\r\nOs instrutores experientes do Indoor Cliff Diving irão ensinar-lhe as técnicas adequadas para um mergulho bem-sucedido.\r\n\r\n## Preços e horários\r\nO clube Indoor Cliff Diving se reúne todas as sextas e domingos no Sloterparkbad e oferece uma variedade de aulas para todos os níveis de habilidade.\r\n\r\nSe você é um iniciante procurando mergulhar pela primeira vez ou um mergulhador experiente procurando aperfeiçoar sua técnica, há uma aula para você.\r\n\r\n[Os preços das aulas dependem do pacote que você escolher](https://indoorcliffdiving.com/#pricing), mas são bem acessíveis e valem a experiência.\r\n\r\n## Segurança primeiro\r\nNão importa onde você escolha mergulhar em Amsterdam, é importante manter a segurança em mente. Sempre verifique a profundidade da água antes de pular e certifique-se de seguir todas as regras ou diretrizes definidas pelo local onde você está mergulhando.\r\n\r\nTambém é uma boa ideia ter um amigo de confiança com você para ajudar a localizá-lo e garantir a sua segurança.\r\n\r\nCom um pouco de cautela e bom senso, o mergulhar em Amsterdam pode ser uma atividade emocionante e agradável.\r\n\r\n## Conclusão\r\nMergulhar em Amsterdam é uma atividade emocionante e única que oferece uma forma única de conhecer a cidade e uma variedade de opções para todos os níveis de habilidade.\r\n\r\nCaso você escolha pular dos canais ou participar de uma aula no clube Indoor Cliff Diving, espero que você se divirta muito.\r\n","frontmatter":{"tags":["penhasco","pular de pedra"],"categories":["general"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-12-28T00:00:00.000Z","id":null,"path":"um-guia-para-pular-de-pedras-em-amsterdam","show":true,"title":"Um guia para pular de \"pedras\" em Amsterdam","hideExcerpt":false,"subtitle":"Um guia para pular de \"pedras\" em Amsterdam, incluindo opções para pular de canais e pontes ou fazer aulas de mergulho interno"}}},{"node":{"excerpt":"Final-fucking-mente, após 3 anos sem evento presencial, a E…","html":"<p>Final-fucking-mente, após 3 anos sem evento presencial, a E3 está voltando em 2023 e eu não consigo conter a minha alegria.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAe7rzGgoEysupa1SEy//xAAfEAACAQMFAQAAAAAAAAAAAAABAgMAITMEEBESIkL/2gAIAQEAAQUCW4UhtvhcnFahvET9ZTIGqTI1A2//xAAXEQEAAwAAAAAAAAAAAAAAAAABABAR/9oACAEDAQE/AQvZ/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAECAQE/AXS//8QAGxAAAQUBAQAAAAAAAAAAAAAAAQACEBEhMXH/2gAIAQEABj8CwrHAxSbweQQEwgVSuBH/xAAcEAADAAMAAwAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hmlEUlI3BpkVp8ONeYM5OyZgW/sgs2scNwiWC4OWx/9oADAMBAAIAAwAAABDcFXH/xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAEDAQE/EKC9I3//xAAXEQEAAwAAAAAAAAAAAAAAAAABABAR/9oACAECAQE/EHCFpZ//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhMXFBsf/aAAgBAQABPxAhsOJiiRwVmDfmQVAUF9CYuSaIG7qa+Zt5lGjNvPzEFNBd9JjiDAiZiYVi7w1gKlnswICM/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Eu enquanto escrevia este post\"\n        title=\"Eu enquanto escrevia este post\"\n        src=\"/static/0e93743a85e03fab3fe678df24268bce/63217/e3_selfie.jpg\"\n        srcset=\"/static/0e93743a85e03fab3fe678df24268bce/db830/e3_selfie.jpg 256w,\n/static/0e93743a85e03fab3fe678df24268bce/8102f/e3_selfie.jpg 512w,\n/static/0e93743a85e03fab3fe678df24268bce/63217/e3_selfie.jpg 1024w,\n/static/0e93743a85e03fab3fe678df24268bce/d58d1/e3_selfie.jpg 1536w,\n/static/0e93743a85e03fab3fe678df24268bce/09658/e3_selfie.jpg 2048w,\n/static/0e93743a85e03fab3fe678df24268bce/869dc/e3_selfie.jpg 2464w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Eu enquanto escrevia este post</figcaption>\n  </figure></p>\n<p>Há alguns meses, foi o aniversário de 10 anos da minha primeira E3, e <a href=\"/pt-br/blog/games/aniversario-de-10-anos-da-minha-primeira-e3/\">escrevi extensivamente sobre toda a minha experiência</a> com eventos passados e o porque eu acho que ainda precisamos da E3.</p>\n<p>A minha principal razão foi que um evento focado em jogos, com todos os principais anúncios de jogos induz o hype em todos, e embora você <a href=\"https://en.wikipedia.org/wiki/Don%27t_Believe_the_Hype\" target=\"_blank\" rel=\"noreferrer\">não deva acreditar no hype</a>, neste caso , o hype é bom, ajuda os jogos a atingir um público mais amplo que de outra forma não conseguiria.</p>\n<p>Eu sei que estou certo porque a Gamescom este ano foi simplesmente a E3, mas na Europa. Eu até estava planejando ir para lá este ano, mas achei que não seria tão legal ir sozinho, etc, e acabei cancelando meus planos, e agora me arrependo miseravelmente.</p>\n<p>ANYWAY</p>\n<p>Então, quando a E3 vai acontecer?</p>\n<h2 id=\"as-datas\" style=\"position:relative;\"><a href=\"#as-datas\" aria-label=\"as datas permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>As datas</h2>\n<p>A E3 2023 acontecerá de 13 a 16 de junho, quatro dias após o evento pela primeira vez - pelo menos nos 10 anos em que eu estou participando.</p>\n<p>Não apenas isso, mas dois desses quatro dias serão dedicados à imprensa e negócios, algo que a ESA provavelmente aprendeu com a Gamescom.</p>\n<p>Os outros dois dias, chamados de “Gamer Days”, serão abertos ao público, e você poderá comprar seus ingressos em breve.</p>\n<p>Óbvio que eu já atualizei o meu <a href=\"https://pablo.gg/pt-br/e3/\" target=\"_blank\" rel=\"noreferrer\">Contador para E3</a> com as datas certas. Um pouco mais de 8 meses pro evento mais foda de videogames do ano.</p>\n<p>Vejo vocês lá!</p>","fields":{"postHashId":"Z2FtZXN0cnVlbnVsbDIwMjItMDktMjdUMDA6MDA6MDAuMDAwWg==","slug":"/2022/2022-09-27-datas-da-e3-2023-sao-reveladas.pt-br/","path":"/blog/games/datas-da-e3-2023-sao-reveladas/","locale":"pt-br"},"rawMarkdownBody":"Final-fucking-mente, após 3 anos sem evento presencial, a E3 está voltando em 2023 e eu não consigo conter a minha alegria.\r\n\r\n![Eu enquanto escrevia este post](../../uploads/blog/2022/09/e3_selfie.jpg)\r\n\r\nHá alguns meses, foi o aniversário de 10 anos da minha primeira E3, e [escrevi extensivamente sobre toda a minha experiência](/pt-br/blog/games/aniversario-de-10-anos-da-minha-primeira-e3/) com eventos passados e o porque eu acho que ainda precisamos da E3.\r\n\r\nA minha principal razão foi que um evento focado em jogos, com todos os principais anúncios de jogos induz o hype em todos, e embora você [não deva acreditar no hype](https://en.wikipedia.org/wiki/Don%27t_Believe_the_Hype), neste caso , o hype é bom, ajuda os jogos a atingir um público mais amplo que de outra forma não conseguiria.\r\n\r\nEu sei que estou certo porque a Gamescom este ano foi simplesmente a E3, mas na Europa. Eu até estava planejando ir para lá este ano, mas achei que não seria tão legal ir sozinho, etc, e acabei cancelando meus planos, e agora me arrependo miseravelmente.\r\n\r\nANYWAY\r\n\r\nEntão, quando a E3 vai acontecer?\r\n\r\n## As datas\r\nA E3 2023 acontecerá de 13 a 16 de junho, quatro dias após o evento pela primeira vez - pelo menos nos 10 anos em que eu estou participando.\r\n\r\nNão apenas isso, mas dois desses quatro dias serão dedicados à imprensa e negócios, algo que a ESA provavelmente aprendeu com a Gamescom.\r\n\r\nOs outros dois dias, chamados de \"Gamer Days\", serão abertos ao público, e você poderá comprar seus ingressos em breve.\r\n\r\nÓbvio que eu já atualizei o meu [Contador para E3](https://pablo.gg/pt-br/e3/) com as datas certas. Um pouco mais de 8 meses pro evento mais foda de videogames do ano.\r\n\r\nVejo vocês lá!\r\n","frontmatter":{"tags":["e3","los angeles","games","nintendo","sony","microsoft"],"categories":["games"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-09-27T00:00:00.000Z","id":null,"path":"datas-da-e3-2023-sao-reveladas","show":true,"title":"Datas da E3 2023 são reveladas","hideExcerpt":false,"subtitle":"BOOOORRRA C*RALHO"}}},{"node":{"excerpt":"It’s happening, it’s finally happening - After 3 years of…","html":"<p>It’s happening, it’s finally happening - After 3 years of hiatus, E3 is finally coming back as a physical event in 2023, and I can’t contain myself.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAe7rzGgoEysupa1SEy//xAAfEAACAQMFAQAAAAAAAAAAAAABAgMAITMEEBESIkL/2gAIAQEAAQUCW4UhtvhcnFahvET9ZTIGqTI1A2//xAAXEQEAAwAAAAAAAAAAAAAAAAABABAR/9oACAEDAQE/AQvZ/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQAQ/9oACAECAQE/AXS//8QAGxAAAQUBAQAAAAAAAAAAAAAAAQACEBEhMXH/2gAIAQEABj8CwrHAxSbweQQEwgVSuBH/xAAcEAADAAMAAwAAAAAAAAAAAAAAAREhMUFRYXH/2gAIAQEAAT8hmlEUlI3BpkVp8ONeYM5OyZgW/sgs2scNwiWC4OWx/9oADAMBAAIAAwAAABDcFXH/xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAEDAQE/EKC9I3//xAAXEQEAAwAAAAAAAAAAAAAAAAABABAR/9oACAECAQE/EHCFpZ//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhMXFBsf/aAAgBAQABPxAhsOJiiRwVmDfmQVAUF9CYuSaIG7qa+Zt5lGjNvPzEFNBd9JjiDAiZiYVi7w1gKlnswICM/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Me while writting this post\"\n        title=\"Me while writting this post\"\n        src=\"/static/0e93743a85e03fab3fe678df24268bce/63217/e3_selfie.jpg\"\n        srcset=\"/static/0e93743a85e03fab3fe678df24268bce/db830/e3_selfie.jpg 256w,\n/static/0e93743a85e03fab3fe678df24268bce/8102f/e3_selfie.jpg 512w,\n/static/0e93743a85e03fab3fe678df24268bce/63217/e3_selfie.jpg 1024w,\n/static/0e93743a85e03fab3fe678df24268bce/d58d1/e3_selfie.jpg 1536w,\n/static/0e93743a85e03fab3fe678df24268bce/09658/e3_selfie.jpg 2048w,\n/static/0e93743a85e03fab3fe678df24268bce/869dc/e3_selfie.jpg 2464w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Me while writting this post</figcaption>\n  </figure></p>\n<p>A few months ago it was the 10 years anniversary of my first E3, and <a href=\"/en/blog/games/10-years-anniversary-of-my-first-e3/\">I extensively wrote about all my experience</a> with past events and why I think we still need E3.</p>\n<p>My main reason was that a focused event with all major game announcements induces hype in everyone, and although you <a href=\"https://en.wikipedia.org/wiki/Don%27t_Believe_the_Hype\" target=\"_blank\" rel=\"noreferrer\">shouldn’t believe the hype</a>, in this case, the hype is good, it helps the games to reach a broader audience that otherwise wouldn’t.</p>\n<p>I know I’m right because Gamescom this year was simply E3 but in Europe. I was even planning to go there this year, but I thought it wouldn’t be as nice to go myself, etc, and I canceled my plans, and now I regret it miserably.</p>\n<p>ANYWAY</p>\n<p>So when is E3 happening?</p>\n<h2 id=\"the-dates\" style=\"position:relative;\"><a href=\"#the-dates\" aria-label=\"the dates permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The dates</h2>\n<p>E3 2023 will happen from June 13th till June 16th, four days after the event for the first time - at least in the 10 years, I’ve been attending it.</p>\n<p>Not only that but two of these four days will be dedicated to media press and business, something that ESA probably learned from Gamescom.</p>\n<p>The two other days, called “Gamer Days”, will be open to the public, and you will be able to buy your tickets soon.</p>\n<p>I already updated my <a href=\"https://pablo.gg/en/e3/\" target=\"_blank\" rel=\"noreferrer\">E3 Countdown</a> page with the update dates. A bit more than 8 months for the best videogames event ever. Can’t wait!!</p>\n<p>See you guys there!</p>","fields":{"postHashId":"Z2FtZXN0cnVlbnVsbDIwMjItMDktMjdUMDA6MDA6MDAuMDAwWg==","slug":"/2022/2022-09-27-e3-2023-dates-revealed.en/","path":"/blog/games/e3-2023-dates-revealed/","locale":"en"},"rawMarkdownBody":"It's happening, it's finally happening - After 3 years of hiatus, E3 is finally coming back as a physical event in 2023, and I can't contain myself.\r\n\r\n![Me while writting this post](../../uploads/blog/2022/09/e3_selfie.jpg)\r\n\r\nA few months ago it was the 10 years anniversary of my first E3, and [I extensively wrote about all my experience](/en/blog/games/10-years-anniversary-of-my-first-e3/) with past events and why I think we still need E3.\r\n\r\nMy main reason was that a focused event with all major game announcements induces hype in everyone, and although you [shouldn't believe the hype](https://en.wikipedia.org/wiki/Don%27t_Believe_the_Hype), in this case, the hype is good, it helps the games to reach a broader audience that otherwise wouldn't.\r\n\r\nI know I'm right because Gamescom this year was simply E3 but in Europe. I was even planning to go there this year, but I thought it wouldn't be as nice to go myself, etc, and I canceled my plans, and now I regret it miserably.\r\n\r\nANYWAY\r\n\r\nSo when is E3 happening?\r\n\r\n## The dates\r\nE3 2023 will happen from June 13th till June 16th, four days after the event for the first time - at least in the 10 years, I've been attending it.\r\n\r\nNot only that but two of these four days will be dedicated to media press and business, something that ESA probably learned from Gamescom.\r\n\r\nThe two other days, called \"Gamer Days\", will be open to the public, and you will be able to buy your tickets soon.\r\n\r\nI already updated my [E3 Countdown](https://pablo.gg/en/e3/) page with the update dates. A bit more than 8 months for the best videogames event ever. Can't wait!!\r\n\r\nSee you guys there!\r\n","frontmatter":{"tags":["e3","los angeles","games","nintendo","sony","microsoft"],"categories":["games"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-09-27T00:00:00.000Z","id":null,"path":"e3-2023-dates-revealed","show":true,"title":"E3 2023 dates revealed","hideExcerpt":false,"subtitle":"LET'S GOOOOOOOO"}}},{"node":{"excerpt":"The housing market in Amsterdam is crazy, so crazy that…","html":"<p>The housing market in Amsterdam is crazy, so crazy that <a href=\"https://www.dutchnews.nl/news/2022/06/dont-come-unless-you-have-a-place-to-live-universities-warn-international-students/\" target=\"_blank\" rel=\"noreferrer\">universities are telling students to not come to Amsterdam unless they already have a place to live here</a>, and it’s only getting worse.</p>\n<p>Rent and property prices are skyrocketing, and as Amsterdam is a tech hub, there’s always a Booking engineer with enough money to overbid you. So what can you do?</p>\n<p>Well, if you’re fast enough you can book a viewing as soon as a house hits the market and then make an offer that is good enough for the property owner to accept it on the spot.</p>\n<p>The best way to get notified as soon as a house is listed is by paying a subscription to one of those rental agencies, and they will let you know when a new house is listed on your email.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.765625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyklEQVQoz0WSSU8TAQCFJzFevGhiCBcTvakXPZH4Fzh4wAuJ4lJDQjQhEMAFoRHBCNRoi8hearFAWwMIpaULVKEL3ehKOzOdTtsprZ2Zzj60wsGAQQ4mL3mX9+UlLw+ACPZUIM6COAOXeJQtZ2kRo/g9kitghSyKgST3P0awKCvm9isgzgD/MAbG6QzNJ9kyFNqNDwwEpFLv5IS/97WrvcM7roK5ClRkIIJO4AxcoIfGLHOr/jQnnsBpWoC4Q0siHyowu2hu077p8wV1PzyyBbkp7ApiQYTkwZPagzRbsdgiHa1fGiSfkxQPgCRvS+QGFRPN9x++15pTwmFW/K0LxGSmzTZtR/OU9GtAG6KOEYKK5NbjRSyGEF3d8z2y5Qy/D+gCqOTeo87mlhmLyxBqL/B7DlAvNz925Hbc7qbo2E2l6oE1at1IRxe9ZxFc9Us8DqF5lBVgkgUieeqbM+zOl2EiFnJd5dJyOzQ6bbwDJp6vgB/CLol7/kbW36C3Dz+brJqzv3OjPCqKKUoACRaASTbDCAh9mEyadN/POD11htVahaamZ+pNl7S+pndMpmns0ao33N1aR6N6ZUKjn3av+MzhBFLiTwZLFClUOIpFjLODF43G851N5+aUV5Y0Er387sLM06GpekVfo2P9ujNSXXTc4jxP4B3TegxFShwA4nSqVLEnzPq1SzvG6rz3Mq85S23dZmgnGG0tC/OukFmx3D+yWquZvaCaq/oZV/qwbIoWQIIBkBIXzJIv+l52tl2T9tQp1N1LE6+W9HLVhm0jrN2MmxAypfOtvNUPd34aX1xUe2Gbbw8DcQYiWCBFC9tQTqk16w2ej5NWrSXeO24dmLINji73j6y1SNVbUawgHhnC2GIEzYh/kqUDpCScvg04tQxfyZUPs0I5zQowTiMUFy9S22DG5k9EcjhMsijFpUociNMQQUMEcwr/BZKnGjZP1yudAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"home finder banner\"\n        title=\"home finder banner\"\n        src=\"/static/fa1bf554d6509ee52be1e8a65cbfc25e/42a19/home_finder_banner.png\"\n        srcset=\"/static/fa1bf554d6509ee52be1e8a65cbfc25e/e3135/home_finder_banner.png 256w,\n/static/fa1bf554d6509ee52be1e8a65cbfc25e/06341/home_finder_banner.png 512w,\n/static/fa1bf554d6509ee52be1e8a65cbfc25e/42a19/home_finder_banner.png 1024w,\n/static/fa1bf554d6509ee52be1e8a65cbfc25e/e8464/home_finder_banner.png 1536w,\n/static/fa1bf554d6509ee52be1e8a65cbfc25e/ac7a9/home_finder_banner.png 1920w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>That’s great, but since I wanted to get notifications on Telegram plus didn’t want to spend any money because <code class=\"language-text\">#frugallife</code>, <a href=\"/en/blog/coding/using-nodejs-and-github-action-to-find-a-house-on-fundanl/\">I wrote a script to scrape funda.nl and find a house for me</a>.</p>\n<p>That worked out great for me, but for people lacking programming skills, setting up a GitHub account, and messing up with GitHub Actions was a bit too much, so I decided to create a free and <a href=\"https://github.com/WeRules/home-finder\" target=\"_blank\" rel=\"noreferrer\">open-source project called Home Finder</a> (a unique name, I know) that uses GitHub Actions and Google Forms to help anyone find a new house.</p>\n<h2 id=\"startup\" style=\"position:relative;\"><a href=\"#startup\" aria-label=\"startup permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Startup?</h2>\n<p>You must be wondering why I call this a Startup, well, <a href=\"https://www.reddit.com/r/Amsterdam/comments/6kvofb/whats_your_experience_been_with_rental_or_room/\" target=\"_blank\" rel=\"noreferrer\">there are plenty of companies providing services like this for a monthly fee</a>, so yeah, I guess you can simply:</p>\n<ol>\n<li>Clone my projects</li>\n<li>Deploy to your own web domain</li>\n<li>????</li>\n<li>Profit</li>\n</ol>\n<p>Why am I making this free and open-source you ask? Well because I’m mad.</p>\n<h2 id=\"the-business-plan\" style=\"position:relative;\"><a href=\"#the-business-plan\" aria-label=\"the business plan permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The business plan</h2>\n<p>Paying rent in Amsterdam is already expensive enough, and with <a href=\"https://www.dutchnews.nl/news/2022/02/average-energy-bills-could-rise-86-as-gas-and-electricity-prices-soar/\" target=\"_blank\" rel=\"noreferrer\">heating prices going up faster than Dogecoin</a>, paying an extra service to find a house is a no-no, but hosting a website with a database and a backend to scrape the web is not free, the cheapest tear on Digital Ocean will cost U$5 per month - still better than most rental agencies, though.</p>\n<p>Thankfully, <a href=\"https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions#included-storage-and-minutes\" target=\"_blank\" rel=\"noreferrer\">GitHub Actions have a 2000 hours free tier</a> for any GitHub account, so that solves the problem of having a script scraping the web in the background, but how can users submit their data so the script can look for houses based on their needs?</p>\n<p><a href=\"https://blog.webjeda.com/google-form-customize/\" target=\"_blank\" rel=\"noreferrer\">There is a workaround to use Google Forms as a form on any website</a>, using any layout you want, and all the form submitted data will be stored in a Google Spreadsheet, that later can be downloaded via the scraping script to get the user data and look for houses.</p>\n<p>So that’s the stack: GitHub Actions, GitHub Pages, Google Spreadsheet, and Google Forms.</p>\n<p>But before doing any code, I started thinking about the business model and use cases and came up with the following use case:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEYUlEQVQ4yzWP2U8bZxTF55/rY6WqAULAILUkaiOqLmmTPqQ0qZTS0DRKAG+z2C5ObWK8jE1Igg2BxMvstsfY4/GCt8/M2J7NQ4CkD6VUrlrp6ujq6J7f0YU8rOZidYSQUULCWMPN6R5Wc/8/LlZHaQVldDenuVn9P5MzRg6rQyijYZmupJmSZnrSLZTsIZTqGZ1qGDf0kt00XwuSdZjWELKPUCrGqP5UdYs5xKgBtM5KPdW4uLg4P//r9PREHihbeYDSqpvVPG/qHqLrz+vr7FGI7fRU47XYRylljZZ9XN/NqJCX6W/ycpjrRrLdKK9s8vpTboT3cLozLaG0ipE9ogxasiobJ21ZCdAdlDOdlIaxOjR6mDGwkR470wJKxJFMDqN0mFT2y308LzuIUYmbHqBk30X3PZzuJuQ4D9aZLuSiB25Kwughmkpt8LZYZSVcsrqJICmCi7/PdfO02JQ2OAll9FGMMxFC/v11YSvbWWckyEVKrtctNPUqIqxGq0i4goRrcFS0xcU/ojm/n+AiefUJLblY1cUM0TTlz7pCAuKm1p3EEeTmTlAiHy5aN6touOzcZtBdBouISKTixKv2QMHuTJIYc+zmTpA0GzxYiVUdURGOVa1eyg85M0drLIzXVzYE2wZvBUm8uRP0U8uRMhwqOiOCI3hgRVOUMyk8zaGbNRivILgI4yKCi3Zonc1SjfhuNsH0dmM5WMk8L+8E7C/uOeKLj/E7zvhirIaEBUe46AyLto2iLZxzhIp2vALjIgyRYF+uv1u6ln2rnQ20xv3UWu1IfFZ2BfjVQG41VLTHqki0DEercELwlguJs3qJLcUCgjVWQaAUiIO28iZWea+bZ2fG5O7jrNrYrvmflhwhAQmW0KCAhNqwd+/xTtD3xGbb9vviibVAyRoUUIg5+KrG+3KZPYF5c9bvdBq1QY86EG/ki/MlYb5Ynsuw17nlR/QD38pvvyze/XL113t3F75ZWp3jha+h49alQc6X2ElmUsm3/F7x+WopsdQvff6+NzFsTiiNJf1Z8NzyfGB99eCH23cXLmHLS1u+lTI59k66Amnty23mUYGgeWJvkNkFuZuH3Bzz8lbjYLySWdPENMjdVHw/H/q3EvijbPLjfhE3hKxSvzoE05AJLL3aVDNpl1Mv8y+WdOZFi/1eZCeGYKxduCeQC2zqg2J+vJGNq9VlA3wol1w1YvOotGB2xyGzOyUL11spa2F7sZm9DnLfdtNekIG7pRvFJzOBHy9XC5NKbaqwjw3qn6nNj0DhYZu/0+Aeaq1JyARTSu3Txj7czs+zL2+A8rjWnpQKt5rEfTq4iCPzcvVKr/JTanO5V7MY7dkq5RjUrxWSC8PODDTsWIbgSoO4k9/7Qu+MmZ1ZE1iOjyaMzvgQWP5UZ0DJEvF+RySuyhWLVPmkTN4e1KeBMH3cnR6FTWAxwLjenjTBrNGxjHDtGbMzO/x3VxrTh/zYcXfKBBa9Na23Lo/oXYvRsfwDMsh076WO9ywAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"youre safe now jamstack\"\n        title=\"youre safe now jamstack\"\n        src=\"/static/067740f521cc1df37c8f23330fbb435c/42a19/youre_safe_now_jamstack.png\"\n        srcset=\"/static/067740f521cc1df37c8f23330fbb435c/e3135/youre_safe_now_jamstack.png 256w,\n/static/067740f521cc1df37c8f23330fbb435c/06341/youre_safe_now_jamstack.png 512w,\n/static/067740f521cc1df37c8f23330fbb435c/42a19/youre_safe_now_jamstack.png 1024w,\n/static/067740f521cc1df37c8f23330fbb435c/e8464/youre_safe_now_jamstack.png 1536w,\n/static/067740f521cc1df37c8f23330fbb435c/2eb59/youre_safe_now_jamstack.png 2048w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"why-not-use-firebase\" style=\"position:relative;\"><a href=\"#why-not-use-firebase\" aria-label=\"why not use firebase permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why not use Firebase?</h2>\n<p>Because.</p>\n<h2 id=\"the-coding\" style=\"position:relative;\"><a href=\"#the-coding\" aria-label=\"the coding permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The coding</h2>\n<p>To build this website I started with my to-go SSG framework, Gatsby. I pretty much just <a href=\"https://github.com/blopa/Resume-Builder\" target=\"_blank\" rel=\"noreferrer\">copy</a> and <a href=\"https://github.com/blopa/gatsby-material-ui-blog-starter\" target=\"_blank\" rel=\"noreferrer\">paste</a> the same code from one Gatsby project to another, and this time was no different.</p>\n<p>The great thing about Gatsby is that I can fetch the data in the <code class=\"language-text\">node.js</code> part of Gatsby, and filter out any data I don’t want to send to the frontend, like the user email, and tcharam, with no data leakage. For this project, I didn’t have to do this, but I do it for this blog - so whenever a user leaves a comment with their email, that email never shows up in the frontend build.</p>\n<p>This project will have 2 different parts, the Gatsby site, which I will build once, <a href=\"https://github.com/WeRules/home-finder/blob/main/src/utils/gatsby-node-helpers.js#L18\" target=\"_blank\" rel=\"noreferrer\">get the form data from Google Forms using Node Fetch</a>, and the script that <a href=\"https://github.com/WeRules/home-finder-script/blob/main/scraper.js#L17\" target=\"_blank\" rel=\"noreferrer\">will download the Google Spreadsheet data</a> and parse it with <a href=\"https://www.npmjs.com/package/xlsx\" target=\"_blank\" rel=\"noreferrer\">xlsx</a>.</p>\n<p>I also want to make sure I won’t send the same house to the same user twice, and for that, I will need a database to persist the houses I already send to that user, for that I will simply use a <code class=\"language-text\">db.json</code> file with the following structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"user@email.com\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://somelink.com\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://otherlink.com\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"user2@email.com\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://linklink.com\"</span><span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To persist this data to the repo, I will use the <a href=\"https://github.com/stefanzweifel/git-auto-commit-action\" target=\"_blank\" rel=\"noreferrer\">git-auto-commit-action</a> GitHub Action. This is problematic because now anyone can go to that repo and see all the users’ emails and links, and I can’t have that, so that repo needs to be private, but you can clone <a href=\"https://github.com/WeRules/home-finder-script\" target=\"_blank\" rel=\"noreferrer\">this one</a> to your own GitHub account if you want.</p>\n<h2 id=\"limitations\" style=\"position:relative;\"><a href=\"#limitations\" aria-label=\"limitations permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Limitations</h2>\n<p>Since I don’t want to use more than the GitHub Actions free tier, I will be running the script every hour, this should be enough to not pass the monthly limit - well, it depends on the number of users, of course.</p>\n<p>I also had to manually write the scraping scripts for <a href=\"https://github.com/WeRules/home-finder-script/blob/main/scraper.js#L133\" target=\"_blank\" rel=\"noreferrer\">various real estate websites</a>, so it’s not like you can get notifications from any website anywhere in the Netherlands.</p>\n<p>That’s why I made this free and open-source and I highly encourage people to deploy their own version and change the frequency of the scraping script to match their needs.</p>\n<p>There’s also a chance that any of the websites can block the user-agent from scraping them, in this case, you need to keep an eye on it and change the user-agent if needed.</p>\n<h2 id=\"deploying-your-own-version\" style=\"position:relative;\"><a href=\"#deploying-your-own-version\" aria-label=\"deploying your own version permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploying your own version</h2>\n<p>To deploy your own version you will need to clone 2 GitHub repos, the <a href=\"https://github.com/WeRules/home-finder\" target=\"_blank\" rel=\"noreferrer\">Home Finder</a> and the <a href=\"https://github.com/WeRules/home-finder-script\" target=\"_blank\" rel=\"noreferrer\">Home Finder Script</a>. If you don’t really need the frontend part, you can just clone the script repo.</p>\n<h3 id=\"the-frontend\" style=\"position:relative;\"><a href=\"#the-frontend\" aria-label=\"the frontend permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The frontend</h3>\n<p>For the <a href=\"https://github.com/WeRules/home-finder\" target=\"_blank\" rel=\"noreferrer\">Home Finder</a> project, you will need to do the following steps:</p>\n<ol>\n<li>Clone the project using the <code class=\"language-text\">Use this template</code> button on GitHub and make sure the project stays public, otherwise you cannot deploy it to GitHub Pages.</li>\n<li>Change the <a href=\"https://github.com/WeRules/home-finder/blob/b79635bf04ed9161c425b37df0d95f5f80c9f449/gatsby-config.js#L13\" target=\"_blank\" rel=\"noreferrer\">siteUrl</a> and the <a href=\"https://github.com/WeRules/home-finder/blob/b79635bf04ed9161c425b37df0d95f5f80c9f449/gatsby-config.js#L6\" target=\"_blank\" rel=\"noreferrer\">pathPrefix</a> properties for Gatsby, so GitHub Actions can deploy the project to <code class=\"language-text\">username.github.io/home-finder</code> properly.</li>\n<li>Create a <a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfNXZrkvG-in6kurmGRQt4SOt2xyDOautibKpC4PAeQElzrgQ/viewform\" target=\"_blank\" rel=\"noreferrer\">Google Forms like this one</a> with the exact same field names and field types.</li>\n<li>Get the Google Forms form ID, for example, <code class=\"language-text\">1FAIpQLSfNXZrkvG-in6kurmGRQt4SOt2xyDOautibKpC4PAeQElzrgQ</code>, and add it to your <a href=\"https://docs.github.com/en/actions/reference/encrypted-secrets\" target=\"_blank\" rel=\"noreferrer\">repo’s secret</a> with the name <code class=\"language-text\">GATSBY_GOOGLE_FORM_ID</code>.</li>\n<li>Push your changes to the <code class=\"language-text\">main</code> branch and the website will build automatically on push.</li>\n</ol>\n<h3 id=\"the-backend\" style=\"position:relative;\"><a href=\"#the-backend\" aria-label=\"the backend permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The backend</h3>\n<p>For the <a href=\"https://github.com/WeRules/home-finder-script\" target=\"_blank\" rel=\"noreferrer\">Home Finder Script</a> project, you will need to do the following steps:</p>\n<ol>\n<li>Clone the project using the <code class=\"language-text\">Use this template</code> button on GitHub and make sure to change the project to private, otherwise you may leak user data.</li>\n<li>Update the <code class=\"language-text\">template.html</code> to use your own website URL\n<ol>\n<li>or if you’re skipping the frontend, you can simply remove the link in the footer of the email.</li>\n</ol>\n</li>\n<li>Get the Google Spreadsheet from the previously created form and make sure to <a href=\"https://support.google.com/a/users/answer/9308870\" target=\"_blank\" rel=\"noreferrer\">publish the Google Spreadsheet to the web</a> and make it available to anyone with the link too.\n<ol>\n<li>or if you’re skipping the frontend any Google Spreadsheet will do, but the spreadsheet needs to have the same header fields as the Google Forms.</li>\n</ol>\n</li>\n<li>Get the Google Spreadsheet <code class=\"language-text\">ID</code> and <code class=\"language-text\">Grid ID</code>, for example, <a href=\"https://docs.google.com/spreadsheets/d/1jRMEvfI6OsWUwnaHgH5UwnoikZA0a3s8wPnCortNJ_A/edit#gid=0\" target=\"_blank\" rel=\"noreferrer\">for this spreadsheet</a>, the <code class=\"language-text\">ID</code> is <code class=\"language-text\">1jRMEvfI6OsWUwnaHgH5UwnoikZA0a3s8wPnCortNJ_A</code> and the <code class=\"language-text\">Grid ID</code> is <code class=\"language-text\">0</code>.</li>\n<li>Add 5 new <a href=\"https://docs.github.com/en/actions/reference/encrypted-secrets\" target=\"_blank\" rel=\"noreferrer\">repo’s secret</a>:\n<ol>\n<li><code class=\"language-text\">EMAIL_USER</code>: The Gmail email that will be used to send emails.</li>\n<li><code class=\"language-text\">EMAIL_PASSWORD</code>: The password of the Gmail account. It’s highly recommended that you <a href=\"https://support.google.com/mail/answer/185833?hl=en-US\" target=\"_blank\" rel=\"noreferrer\">create an App Password</a> for that.</li>\n<li><code class=\"language-text\">GOOGLE_SPREADSHEET_ID</code>: The Google Spreadsheet <code class=\"language-text\">ID</code>.</li>\n<li><code class=\"language-text\">GOOGLE_SPREADSHEET_GID</code>: The Google Spreadsheet <code class=\"language-text\">Grid ID</code>.</li>\n<li><code class=\"language-text\">USER_AGENT</code>: The user-agent to be used by the scraper script. You can use <a href=\"https://www.whatismybrowser.com/detect/what-is-my-user-agent/\" target=\"_blank\" rel=\"noreferrer\">your own user-agent</a> if you want.</li>\n</ol>\n</li>\n<li>Update <a href=\"https://github.com/WeRules/home-finder-script/blob/main/.github/workflows/run-task.yml#L5\" target=\"_blank\" rel=\"noreferrer\">the cron job frequency</a> to match your needs.</li>\n<li>Push your changes to the <code class=\"language-text\">main</code> branch and the script will automatically run accordingly with the cron job settings.</li>\n</ol>\n<h2 id=\"how-to-use-the-website\" style=\"position:relative;\"><a href=\"#how-to-use-the-website\" aria-label=\"how to use the website permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to use the website</h2>\n<p>Go to the <a href=\"https://werules.github.io/home-finder/en/form\" target=\"_blank\" rel=\"noreferrer\">form page in the Home Finder website</a>, and fill the form with your email and all the links from the real estate websites with your search parameters, for example <a href=\"https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/\" target=\"_blank\" rel=\"noreferrer\">https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/</a>, and click submit. After that simply wait for the script to find new houses and send them directly to your email.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.04687499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABC0lEQVQoz5WOz0vDMBiGs9687OT/6kVED20duE1mxZP4Z3gqaBlanHofDBFtl/4Ky5JsSb6MTeIuFlHWh4eP9/Lxvmj/ZtC+Pm8FHgpc59JvBZ5z1XEuPNQ//kune9LuH+0NDpAXhW4UHoa3fhz1Xh/Pnh96L/b6o6E/Gp5+6z9Z3Tja6sdRN77vxHfoYzzBb+/JeCIKsmICKNOU6Rkzc75iwlAOlNkwF5v1elMH5YRm5SwnFBckzao0qxJcJVmZ4HKakzS3eZoTXJCFVFLrnyIhuDEGQBsD/wmg6mitEcYZAOgdgF8gzrnWWjXHNifJp5RLO3yn+toQVFaEC8UXIJbQFCSlUgq2Nn3+AvUADjHqpB6FAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"home finder form page\"\n        title=\"home finder form page\"\n        src=\"/static/bc9c639baec65c912d862fee2d78adae/42a19/home_finder_form_page.png\"\n        srcset=\"/static/bc9c639baec65c912d862fee2d78adae/e3135/home_finder_form_page.png 256w,\n/static/bc9c639baec65c912d862fee2d78adae/06341/home_finder_form_page.png 512w,\n/static/bc9c639baec65c912d862fee2d78adae/42a19/home_finder_form_page.png 1024w,\n/static/bc9c639baec65c912d862fee2d78adae/b0f6f/home_finder_form_page.png 1042w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>As the time of this writing, the websites supported by this project are: <a href=\"https://funda.nl\" target=\"_blank\" rel=\"noreferrer\">funda.nl</a>, <a href=\"https://vbo.nl\" target=\"_blank\" rel=\"noreferrer\">vbo.nl</a>, <a href=\"https://huislijn.nl\" target=\"_blank\" rel=\"noreferrer\">huislijn.nl</a>, <a href=\"https://zah.nl\" target=\"_blank\" rel=\"noreferrer\">zah.nl</a>, <a href=\"https://pararius.nl\" target=\"_blank\" rel=\"noreferrer\">pararius.nl</a>, <a href=\"https://jaap.nl\" target=\"_blank\" rel=\"noreferrer\">jaap.nl</a> and <a href=\"https://hoekstraenvaneck.nl\" target=\"_blank\" rel=\"noreferrer\">hoekstraenvaneck.nl</a>, so go ahead to these websites, add your filters and add them to <a href=\"https://werules.github.io/home-finder/en/\" target=\"_blank\" rel=\"noreferrer\">Home Finder</a>.</p>\n<p><strong>Please remember that</strong> this website is only <strong>half of the work</strong>, you will be notified when a new house is listed, but it’s up to you to take action fast to be the first one to book a viewing for that house.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>With a combination of GitHub Actions, creativity, and some hacking you can do pretty much anything without any budget, and then if needed scale from there.</p>\n<p>If you have a nice idea, deploy it to GitHub Pages, use GitHub Actions, use Google Spreadsheet (ok ok, or Firebase) and start your project from there, if you use more than the free tier it’s probably a good time to start scaling, and maybe thinking about making some revenue or find partners or investors for your idea.</p>\n<p>Good luck, and if you’re looking for a house in the Netherlands, don’t forget to use <a href=\"https://werules.github.io/home-finder/en/\" target=\"_blank\" rel=\"noreferrer\">Home Finder</a> and recommend it to your friends.</p>\n<p>See you in the next one.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA5LTEzVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-09-13-creating-a-startup-with-github-actions-and-google-forms.en/","path":"/blog/coding/creating-a-startup-with-github-actions-and-google-forms/","locale":"en"},"rawMarkdownBody":"The housing market in Amsterdam is crazy, so crazy that [universities are telling students to not come to Amsterdam unless they already have a place to live here](https://www.dutchnews.nl/news/2022/06/dont-come-unless-you-have-a-place-to-live-universities-warn-international-students/), and it's only getting worse.\r\n\r\nRent and property prices are skyrocketing, and as Amsterdam is a tech hub, there's always a Booking engineer with enough money to overbid you. So what can you do?\r\n\r\nWell, if you're fast enough you can book a viewing as soon as a house hits the market and then make an offer that is good enough for the property owner to accept it on the spot.\r\n\r\nThe best way to get notified as soon as a house is listed is by paying a subscription to one of those rental agencies, and they will let you know when a new house is listed on your email.\r\n\r\n![](../../uploads/blog/2022/09/home_finder_banner.png)\r\n\r\nThat's great, but since I wanted to get notifications on Telegram plus didn't want to spend any money because `#frugallife`, [I wrote a script to scrape funda.nl and find a house for me](/en/blog/coding/using-nodejs-and-github-action-to-find-a-house-on-fundanl/).\r\n\r\nThat worked out great for me, but for people lacking programming skills, setting up a GitHub account, and messing up with GitHub Actions was a bit too much, so I decided to create a free and [open-source project called Home Finder](https://github.com/WeRules/home-finder) (a unique name, I know) that uses GitHub Actions and Google Forms to help anyone find a new house.\r\n\r\n## Startup?\r\nYou must be wondering why I call this a Startup, well, [there are plenty of companies providing services like this for a monthly fee](https://www.reddit.com/r/Amsterdam/comments/6kvofb/whats_your_experience_been_with_rental_or_room/), so yeah, I guess you can simply:\r\n\r\n1. Clone my projects\r\n2. Deploy to your own web domain\r\n3. ????\r\n4. Profit\r\n\r\nWhy am I making this free and open-source you ask? Well because I'm mad.\r\n\r\n## The business plan\r\nPaying rent in Amsterdam is already expensive enough, and with [heating prices going up faster than Dogecoin](https://www.dutchnews.nl/news/2022/02/average-energy-bills-could-rise-86-as-gas-and-electricity-prices-soar/), paying an extra service to find a house is a no-no, but hosting a website with a database and a backend to scrape the web is not free, the cheapest tear on Digital Ocean will cost U$5 per month - still better than most rental agencies, though.\r\n\r\nThankfully, [GitHub Actions have a 2000 hours free tier](https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions#included-storage-and-minutes) for any GitHub account, so that solves the problem of having a script scraping the web in the background, but how can users submit their data so the script can look for houses based on their needs?\r\n\r\n[There is a workaround to use Google Forms as a form on any website](https://blog.webjeda.com/google-form-customize/), using any layout you want, and all the form submitted data will be stored in a Google Spreadsheet, that later can be downloaded via the scraping script to get the user data and look for houses.\r\n\r\nSo that's the stack: GitHub Actions, GitHub Pages, Google Spreadsheet, and Google Forms.\r\n\r\nBut before doing any code, I started thinking about the business model and use cases and came up with the following use case:\r\n\r\n![](../../uploads/blog/2022/09/youre_safe_now_jamstack.png)\r\n\r\n## Why not use Firebase?\r\nBecause.\r\n\r\n## The coding\r\nTo build this website I started with my to-go SSG framework, Gatsby. I pretty much just [copy](https://github.com/blopa/Resume-Builder) and [paste](https://github.com/blopa/gatsby-material-ui-blog-starter) the same code from one Gatsby project to another, and this time was no different.\r\n\r\nThe great thing about Gatsby is that I can fetch the data in the `node.js` part of Gatsby, and filter out any data I don't want to send to the frontend, like the user email, and tcharam, with no data leakage. For this project, I didn't have to do this, but I do it for this blog - so whenever a user leaves a comment with their email, that email never shows up in the frontend build.\r\n\r\nThis project will have 2 different parts, the Gatsby site, which I will build once, [get the form data from Google Forms using Node Fetch](https://github.com/WeRules/home-finder/blob/main/src/utils/gatsby-node-helpers.js#L18), and the script that [will download the Google Spreadsheet data](https://github.com/WeRules/home-finder-script/blob/main/scraper.js#L17) and parse it with [xlsx](https://www.npmjs.com/package/xlsx).\r\n\r\nI also want to make sure I won't send the same house to the same user twice, and for that, I will need a database to persist the houses I already send to that user, for that I will simply use a `db.json` file with the following structure:\r\n\r\n```json\r\n{\r\n  \"user@email.com\": [\"https://somelink.com\", \"https://otherlink.com\"],\r\n  \"user2@email.com\": [\"https://linklink.com\"]\r\n}\r\n```\r\n\r\nTo persist this data to the repo, I will use the [git-auto-commit-action](https://github.com/stefanzweifel/git-auto-commit-action) GitHub Action. This is problematic because now anyone can go to that repo and see all the users' emails and links, and I can't have that, so that repo needs to be private, but you can clone [this one](https://github.com/WeRules/home-finder-script) to your own GitHub account if you want.\r\n\r\n## Limitations\r\nSince I don't want to use more than the GitHub Actions free tier, I will be running the script every hour, this should be enough to not pass the monthly limit - well, it depends on the number of users, of course.\r\n\r\nI also had to manually write the scraping scripts for [various real estate websites](https://github.com/WeRules/home-finder-script/blob/main/scraper.js#L133), so it's not like you can get notifications from any website anywhere in the Netherlands.\r\n\r\nThat's why I made this free and open-source and I highly encourage people to deploy their own version and change the frequency of the scraping script to match their needs.\r\n\r\nThere's also a chance that any of the websites can block the user-agent from scraping them, in this case, you need to keep an eye on it and change the user-agent if needed.\r\n\r\n## Deploying your own version\r\nTo deploy your own version you will need to clone 2 GitHub repos, the [Home Finder](https://github.com/WeRules/home-finder) and the [Home Finder Script](https://github.com/WeRules/home-finder-script). If you don't really need the frontend part, you can just clone the script repo.\r\n\r\n### The frontend\r\nFor the [Home Finder](https://github.com/WeRules/home-finder) project, you will need to do the following steps:\r\n\r\n1. Clone the project using the `Use this template` button on GitHub and make sure the project stays public, otherwise you cannot deploy it to GitHub Pages.\r\n2. Change the [siteUrl](https://github.com/WeRules/home-finder/blob/b79635bf04ed9161c425b37df0d95f5f80c9f449/gatsby-config.js#L13) and the [pathPrefix](https://github.com/WeRules/home-finder/blob/b79635bf04ed9161c425b37df0d95f5f80c9f449/gatsby-config.js#L6) properties for Gatsby, so GitHub Actions can deploy the project to `username.github.io/home-finder` properly.\r\n3. Create a [Google Forms like this one](https://docs.google.com/forms/d/e/1FAIpQLSfNXZrkvG-in6kurmGRQt4SOt2xyDOautibKpC4PAeQElzrgQ/viewform) with the exact same field names and field types.\r\n4. Get the Google Forms form ID, for example, `1FAIpQLSfNXZrkvG-in6kurmGRQt4SOt2xyDOautibKpC4PAeQElzrgQ`, and add it to your [repo's secret](https://docs.github.com/en/actions/reference/encrypted-secrets) with the name `GATSBY_GOOGLE_FORM_ID`.\r\n5. Push your changes to the `main` branch and the website will build automatically on push.\r\n\r\n### The backend\r\nFor the [Home Finder Script](https://github.com/WeRules/home-finder-script) project, you will need to do the following steps:\r\n\r\n1. Clone the project using the `Use this template` button on GitHub and make sure to change the project to private, otherwise you may leak user data.\r\n2. Update the `template.html` to use your own website URL\r\n    1. or if you're skipping the frontend, you can simply remove the link in the footer of the email.\r\n3. Get the Google Spreadsheet from the previously created form and make sure to [publish the Google Spreadsheet to the web](https://support.google.com/a/users/answer/9308870) and make it available to anyone with the link too.\r\n    1. or if you're skipping the frontend any Google Spreadsheet will do, but the spreadsheet needs to have the same header fields as the Google Forms.\r\n4. Get the Google Spreadsheet `ID` and `Grid ID`, for example, [for this spreadsheet](https://docs.google.com/spreadsheets/d/1jRMEvfI6OsWUwnaHgH5UwnoikZA0a3s8wPnCortNJ_A/edit#gid=0), the `ID` is `1jRMEvfI6OsWUwnaHgH5UwnoikZA0a3s8wPnCortNJ_A` and the `Grid ID` is `0`.\r\n5. Add 5 new [repo's secret](https://docs.github.com/en/actions/reference/encrypted-secrets):\r\n    1. `EMAIL_USER`: The Gmail email that will be used to send emails.\r\n    2. `EMAIL_PASSWORD`: The password of the Gmail account. It's highly recommended that you [create an App Password](https://support.google.com/mail/answer/185833?hl=en-US) for that.\r\n    3. `GOOGLE_SPREADSHEET_ID`: The Google Spreadsheet `ID`.\r\n    4. `GOOGLE_SPREADSHEET_GID`: The Google Spreadsheet `Grid ID`.\r\n    5. `USER_AGENT`: The user-agent to be used by the scraper script. You can use [your own user-agent](https://www.whatismybrowser.com/detect/what-is-my-user-agent/) if you want.\r\n6. Update [the cron job frequency](https://github.com/WeRules/home-finder-script/blob/main/.github/workflows/run-task.yml#L5) to match your needs.\r\n7. Push your changes to the `main` branch and the script will automatically run accordingly with the cron job settings.\r\n\r\n## How to use the website\r\nGo to the [form page in the Home Finder website](https://werules.github.io/home-finder/en/form), and fill the form with your email and all the links from the real estate websites with your search parameters, for example [https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/](https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/), and click submit. After that simply wait for the script to find new houses and send them directly to your email.\r\n\r\n![](../../uploads/blog/2022/09/home_finder_form_page.png)\r\n\r\nAs the time of this writing, the websites supported by this project are: [funda.nl](https://funda.nl), [vbo.nl](https://vbo.nl), [huislijn.nl](https://huislijn.nl), [zah.nl](https://zah.nl), [pararius.nl](https://pararius.nl), [jaap.nl](https://jaap.nl) and [hoekstraenvaneck.nl](https://hoekstraenvaneck.nl), so go ahead to these websites, add your filters and add them to [Home Finder](https://werules.github.io/home-finder/en/).\r\n\r\n**Please remember that** this website is only **half of the work**, you will be notified when a new house is listed, but it's up to you to take action fast to be the first one to book a viewing for that house.\r\n\r\n## Conclusion\r\nWith a combination of GitHub Actions, creativity, and some hacking you can do pretty much anything without any budget, and then if needed scale from there.\r\n\r\nIf you have a nice idea, deploy it to GitHub Pages, use GitHub Actions, use Google Spreadsheet (ok ok, or Firebase) and start your project from there, if you use more than the free tier it's probably a good time to start scaling, and maybe thinking about making some revenue or find partners or investors for your idea.\r\n\r\nGood luck, and if you're looking for a house in the Netherlands, don't forget to use [Home Finder](https://werules.github.io/home-finder/en/) and recommend it to your friends.\r\n\r\nSee you in the next one.\r\n","frontmatter":{"tags":["startup","jamstack","google forms","github actions","react","gatsby","javascript","funda","netherlands","housing market","scraping","puppeteer.js","github"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-09-13T00:00:00.000Z","id":null,"path":"creating-a-startup-with-github-actions-and-google-forms","show":true,"title":"Creating a Startup with GitHub Actions and Google Forms","hideExcerpt":false,"subtitle":"How to use JAMStack to kickstart your own Startup"}}},{"node":{"excerpt":"O mercado imobiliário em Amsterdam é doideira, tão doideira…","html":"<p>O mercado imobiliário em Amsterdam é doideira, tão doideira que <a href=\"https://www-dutchnews-nl.translate.goog/news/2022/06/dont-come-unless-you-have-a-place-to-live-universities-warn-international-students/?_x_tr_sl=en&#x26;_x_tr_tl=pt&#x26;_x_tr_hl=en&#x26;_x_tr_pto=wapp\" target=\"_blank\" rel=\"noreferrer\">as universidades estão dizendo aos estudantes para não virem para Amsterdam, a menos que já tenham um lugar para morar aqui</a>, e as coisas estão só piorando.</p>\n<p>Os preços dos aluguéis e compra de imóveis estão subindo como se não houvesse amanhã e, como Amsterdam é um centro de tecnologia, sempre tem um(a) programador(a) do Booking.com com dinheiro suficiente para qualquer valor no imóvel. O que fazer então?</p>\n<p>Bom, se você for bem rápido, pode marcar uma visita na casa assim que ela for listada online e, em seguida, fazer uma oferta que seja boa o suficiente para o proprietário aceitá-la antes de outras pessoas poderem ofertar também.</p>\n<p>A melhor maneira de ficar sabendo assim que uma casa for listada online é pagando uma assinatura a uma dessas agências de aluguel, e elas informarão quando uma nova casa for listada no seu e-mail.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.765625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyklEQVQoz0WSSU8TAQCFJzFevGhiCBcTvakXPZH4Fzh4wAuJ4lJDQjQhEMAFoRHBCNRoi8hearFAWwMIpaULVKEL3ehKOzOdTtsprZ2Zzj60wsGAQQ4mL3mX9+UlLw+ACPZUIM6COAOXeJQtZ2kRo/g9kitghSyKgST3P0awKCvm9isgzgD/MAbG6QzNJ9kyFNqNDwwEpFLv5IS/97WrvcM7roK5ClRkIIJO4AxcoIfGLHOr/jQnnsBpWoC4Q0siHyowu2hu077p8wV1PzyyBbkp7ApiQYTkwZPagzRbsdgiHa1fGiSfkxQPgCRvS+QGFRPN9x++15pTwmFW/K0LxGSmzTZtR/OU9GtAG6KOEYKK5NbjRSyGEF3d8z2y5Qy/D+gCqOTeo87mlhmLyxBqL/B7DlAvNz925Hbc7qbo2E2l6oE1at1IRxe9ZxFc9Us8DqF5lBVgkgUieeqbM+zOl2EiFnJd5dJyOzQ6bbwDJp6vgB/CLol7/kbW36C3Dz+brJqzv3OjPCqKKUoACRaASTbDCAh9mEyadN/POD11htVahaamZ+pNl7S+pndMpmns0ao33N1aR6N6ZUKjn3av+MzhBFLiTwZLFClUOIpFjLODF43G851N5+aUV5Y0Er387sLM06GpekVfo2P9ujNSXXTc4jxP4B3TegxFShwA4nSqVLEnzPq1SzvG6rz3Mq85S23dZmgnGG0tC/OukFmx3D+yWquZvaCaq/oZV/qwbIoWQIIBkBIXzJIv+l52tl2T9tQp1N1LE6+W9HLVhm0jrN2MmxAypfOtvNUPd34aX1xUe2Gbbw8DcQYiWCBFC9tQTqk16w2ej5NWrSXeO24dmLINji73j6y1SNVbUawgHhnC2GIEzYh/kqUDpCScvg04tQxfyZUPs0I5zQowTiMUFy9S22DG5k9EcjhMsijFpUociNMQQUMEcwr/BZKnGjZP1yudAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"home finder banner\"\n        title=\"home finder banner\"\n        src=\"/static/fa1bf554d6509ee52be1e8a65cbfc25e/42a19/home_finder_banner.png\"\n        srcset=\"/static/fa1bf554d6509ee52be1e8a65cbfc25e/e3135/home_finder_banner.png 256w,\n/static/fa1bf554d6509ee52be1e8a65cbfc25e/06341/home_finder_banner.png 512w,\n/static/fa1bf554d6509ee52be1e8a65cbfc25e/42a19/home_finder_banner.png 1024w,\n/static/fa1bf554d6509ee52be1e8a65cbfc25e/e8464/home_finder_banner.png 1536w,\n/static/fa1bf554d6509ee52be1e8a65cbfc25e/ac7a9/home_finder_banner.png 1920w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Isso é ótimo, mas como eu queria receber notificações no Telegram e não queria gastar dinheiro porque <code class=\"language-text\">#frugallife</code>, <a href=\"/pt-br/blog/coding/usando-nodejs-e-github-action-para-encontrar-uma-casa-no-fundanl/\">eu escrevi um script para visitar o funda.nl e encontrar uma casa para mim</a>.</p>\n<p>Isso funcionou muito bem para mim, mas para pessoas sem habilidades de programação, configurar uma conta no GitHub e mexer com o GitHub Actions não é simples, então decidi criar um <a href=\"https://github.com/WeRules/home-finder\" target=\"_blank\" rel=\"noreferrer\">projeto gratuito e de código aberto chamado Home Finder</a> (um nome muito criativo, eu sei) que usa GitHub Actions e Google Forms para ajudar qualquer pessoa a encontrar uma nova casa.</p>\n<h2 id=\"startup\" style=\"position:relative;\"><a href=\"#startup\" aria-label=\"startup permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Startup?</h2>\n<p>Você deve estar se perguntando por que eu chamo isso de Startup, bem, <a href=\"https://www.reddit.com/r/Amsterdam/comments/6kvofb/whats_your_experience_been_with_rental_or_room/\" target=\"_blank\" rel=\"noreferrer\">existem várias empresas que prestam serviços como esse por uma taxa mensal</a>, então sim, acho que você pode simplesmente:</p>\n<ol>\n<li>Clonar meus projetos</li>\n<li>Implementa-los em seu próprio site</li>\n<li>????</li>\n<li>Profit</li>\n</ol>\n<p>Por que estou deixando isso gratuito e de código aberto, você pergunta? Bom, programar é divertido e eu fico feliz de estar ajudando outras pessoas.</p>\n<h2 id=\"o-plano-de-negocios\" style=\"position:relative;\"><a href=\"#o-plano-de-negocios\" aria-label=\"o plano de negocios permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O plano de negócios</h2>\n<p>Pagar aluguel em Amsterdam já é caro pra caramba, e com <a href=\"https://www.cnnbrasil.com.br/business/precos-do-gas-natural-sobem-a-medida-que-crise-energetica-da-europa-se-agrava/\" target=\"_blank\" rel=\"noreferrer\">os preços de aquecimento subindo mais rápido que Dogecoin</a>, pagar um serviço extra para encontrar uma casa é um custo a mais que seria melhor se fosse evitado, mas hospedar um site com um banco de dados e um backend para fazer o scraping não é grátis, o Droplet mais barato do Digital Ocean custa U$5 por mês - ainda assim mais barato do que a maioria das agências de aluguel.</p>\n<p>Felizmente, <a href=\"https://docs.github.com/pt/billing/managing-billing-for-github-actions/about-billing-for-github-actions#included-storage-and-minutes\" target=\"_blank\" rel=\"noreferrer\">GitHub Actions tem um nível gratuito de 2000 horas</a> para qualquer conta do GitHub, o que resolve o problema de ter um script fazendo o scraping de outros sites, show. Mas como os usuários podem enviar seus dados para que o script possa fazer o scraping para eles?</p>\n<p><a href=\"https://blog.webjeda.com/google-form-customize/\" target=\"_blank\" rel=\"noreferrer\">Existe uma gambiarra para usar o Google Forms como um formulário em qualquer site</a>, usando qualquer layout que você quiser, e todos os dados enviados nesse formulário serão armazenados em uma planilha do Google, que posteriormente pode ser baixada através do script de scraping para obter os dados do usuário e procurar casas. Maravilha!</p>\n<p>Então essa é a stack da Startup: GitHub Actions, GitHub Pages, Google Spreadsheet e Google Forms.</p>\n<p>Mas antes de fazer qualquer código, comecei a pensar no modelo de negócios e nos casos de uso e cheguei ao seguinte:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEYUlEQVQ4yzWP2U8bZxTF55/rY6WqAULAILUkaiOqLmmTPqQ0qZTS0DRKAG+z2C5ObWK8jE1Igg2BxMvstsfY4/GCt8/M2J7NQ4CkD6VUrlrp6ujq6J7f0YU8rOZidYSQUULCWMPN6R5Wc/8/LlZHaQVldDenuVn9P5MzRg6rQyijYZmupJmSZnrSLZTsIZTqGZ1qGDf0kt00XwuSdZjWELKPUCrGqP5UdYs5xKgBtM5KPdW4uLg4P//r9PREHihbeYDSqpvVPG/qHqLrz+vr7FGI7fRU47XYRylljZZ9XN/NqJCX6W/ycpjrRrLdKK9s8vpTboT3cLozLaG0ipE9ogxasiobJ21ZCdAdlDOdlIaxOjR6mDGwkR470wJKxJFMDqN0mFT2y308LzuIUYmbHqBk30X3PZzuJuQ4D9aZLuSiB25Kwughmkpt8LZYZSVcsrqJICmCi7/PdfO02JQ2OAll9FGMMxFC/v11YSvbWWckyEVKrtctNPUqIqxGq0i4goRrcFS0xcU/ojm/n+AiefUJLblY1cUM0TTlz7pCAuKm1p3EEeTmTlAiHy5aN6touOzcZtBdBouISKTixKv2QMHuTJIYc+zmTpA0GzxYiVUdURGOVa1eyg85M0drLIzXVzYE2wZvBUm8uRP0U8uRMhwqOiOCI3hgRVOUMyk8zaGbNRivILgI4yKCi3Zonc1SjfhuNsH0dmM5WMk8L+8E7C/uOeKLj/E7zvhirIaEBUe46AyLto2iLZxzhIp2vALjIgyRYF+uv1u6ln2rnQ20xv3UWu1IfFZ2BfjVQG41VLTHqki0DEercELwlguJs3qJLcUCgjVWQaAUiIO28iZWea+bZ2fG5O7jrNrYrvmflhwhAQmW0KCAhNqwd+/xTtD3xGbb9vviibVAyRoUUIg5+KrG+3KZPYF5c9bvdBq1QY86EG/ki/MlYb5Ynsuw17nlR/QD38pvvyze/XL113t3F75ZWp3jha+h49alQc6X2ElmUsm3/F7x+WopsdQvff6+NzFsTiiNJf1Z8NzyfGB99eCH23cXLmHLS1u+lTI59k66Amnty23mUYGgeWJvkNkFuZuH3Bzz8lbjYLySWdPENMjdVHw/H/q3EvijbPLjfhE3hKxSvzoE05AJLL3aVDNpl1Mv8y+WdOZFi/1eZCeGYKxduCeQC2zqg2J+vJGNq9VlA3wol1w1YvOotGB2xyGzOyUL11spa2F7sZm9DnLfdtNekIG7pRvFJzOBHy9XC5NKbaqwjw3qn6nNj0DhYZu/0+Aeaq1JyARTSu3Txj7czs+zL2+A8rjWnpQKt5rEfTq4iCPzcvVKr/JTanO5V7MY7dkq5RjUrxWSC8PODDTsWIbgSoO4k9/7Qu+MmZ1ZE1iOjyaMzvgQWP5UZ0DJEvF+RySuyhWLVPmkTN4e1KeBMH3cnR6FTWAxwLjenjTBrNGxjHDtGbMzO/x3VxrTh/zYcXfKBBa9Na23Lo/oXYvRsfwDMsh076WO9ywAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"youre safe now jamstack\"\n        title=\"youre safe now jamstack\"\n        src=\"/static/067740f521cc1df37c8f23330fbb435c/42a19/youre_safe_now_jamstack.png\"\n        srcset=\"/static/067740f521cc1df37c8f23330fbb435c/e3135/youre_safe_now_jamstack.png 256w,\n/static/067740f521cc1df37c8f23330fbb435c/06341/youre_safe_now_jamstack.png 512w,\n/static/067740f521cc1df37c8f23330fbb435c/42a19/youre_safe_now_jamstack.png 1024w,\n/static/067740f521cc1df37c8f23330fbb435c/e8464/youre_safe_now_jamstack.png 1536w,\n/static/067740f521cc1df37c8f23330fbb435c/2eb59/youre_safe_now_jamstack.png 2048w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"por-que-nao-usar-o-firebase\" style=\"position:relative;\"><a href=\"#por-que-nao-usar-o-firebase\" aria-label=\"por que nao usar o firebase permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Por que não usar o Firebase?</h2>\n<p>Porque não.</p>\n<h2 id=\"a-programacao\" style=\"position:relative;\"><a href=\"#a-programacao\" aria-label=\"a programacao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A programação</h2>\n<p>Para construir este site, comecei com o meu framework JAMStack favorito, o Gatsby. Eu praticamente apenas <a href=\"https://github.com/blopa/Resume-Builder\" target=\"_blank\" rel=\"noreferrer\">copio</a> e <a href=\"https://github.com/blopa/gatsby-material-ui-blog-starter\" target=\"_blank\" rel=\"noreferrer\">colo</a> o mesmo código de um projeto de Gatsby que eu já tenho para outro, e desta vez não foi diferente.</p>\n<p>O melhor do Gatsby é que posso buscar os dados na parte <code class=\"language-text\">node.js</code> do Gatsby e filtrar quaisquer dados que não queira enviar para o frontend, como o e-mail do usuário e o tcharam, sem vazamento de dados. Para este projeto, não precisei fazer isso, mas faço para este blog - então, sempre que um usuário deixa um comentário com seu e-mail em um post desse blo, esse e-mail nunca aparece na compilação do frontend.</p>\n<p>Este projeto terá 2 partes diferentes, o site feito em Gatsby, que durante o seu build vai pegar <a href=\"https://github.com/WeRules/home-finder/blob/main/src/utils/gatsby-node-helpers.js#L18\" target=\"_blank\" rel=\"noreferrer\">os dados do formulário do Google Forms usando o Node Fetch</a> e o script que <a href=\"https://github.com/WeRules/home-finder-script/blob/main/scraper.js#L17\" target=\"_blank\" rel=\"noreferrer\">baixará os dados da planilha do Google</a> e converte-los para uma Array com o <a href=\"https://www.npmjs.com/package/xlsx\" target=\"_blank\" rel=\"noreferrer\">xlsx</a>.</p>\n<p>Eu também quero ter certeza de que não enviarei duas vezes a mesma casa para o mesmo usuário, e para isso precisarei de um banco de dados para persistir as casas que já foram enviadas para esse usuário, para isso usarei simplesmente um <code class=\"language-text\">db. json</code> com a seguinte estrutura:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token property\">\"user@email.com\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://somelink.com\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://otherlink.com\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token property\">\"user2@email.com\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://linklink.com\"</span><span class=\"token punctuation\">]</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para persistir esses dados no repositório, usarei a <a href=\"https://github.com/stefanzweifel/git-auto-commit-action\" target=\"_blank\" rel=\"noreferrer\">GitHub Action git-auto-commit-action</a>. Isso é problemático porque agora qualquer pessoa pode acessar esse repositório e ver todos os e-mails e links dos usuários, e eu não posso deixar isso assim, então esse repositório precisa ser privado, mas você pode clonar <a href=\"https://github.com/WeRules/home-finder-script\" target=\"_blank\" rel=\"noreferrer\">este repositório</a> para sua própria conta do GitHub, se desejar.</p>\n<h2 id=\"limitacoes\" style=\"position:relative;\"><a href=\"#limitacoes\" aria-label=\"limitacoes permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Limitações</h2>\n<p>Como não quero usar mais do que o nível gratuito do GitHub Actions, estarei executando o script a cada hora, isso deve ser suficiente para não ultrapassar o limite mensal - bem, depende do número de usuários, é claro.</p>\n<p>Eu também tive que escrever manualmente os scripts de scraping para <a href=\"https://github.com/WeRules/home-finder-script/blob/main/scraper.js#L133\" target=\"_blank\" rel=\"noreferrer\">vários sites imobiliários diferentes</a>, então não é como se você pudesse receber notificações de qualquer site em qualquer lugar da Holanda.</p>\n<p>É por isso que fiz esse projeto ser grátis e de código aberto, para que pessoas possam implementar suas próprias versões e alterar a frequência do script de scraping para atender às suas necessidades.</p>\n<p>Há também uma chance de que qualquer um dos sites possa bloquear o user agent de raspá-los; nesse caso, você precisa ficar de olho nele e alterar o user agent, se necessário.</p>\n<h2 id=\"fazendo-o-deploy-de-sua-propria-versao\" style=\"position:relative;\"><a href=\"#fazendo-o-deploy-de-sua-propria-versao\" aria-label=\"fazendo o deploy de sua propria versao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fazendo o deploy de sua própria versão</h2>\n<p>Para fazer o deploy da sua própria versão, você precisará clonar 2 repositórios do GitHub, o <a href=\"https://github.com/WeRules/home-finder\" target=\"_blank\" rel=\"noreferrer\">Home Finder</a> e o <a href=\"https://github.com/WeRules/home-finder-script\" target=\"_blank\" rel=\"noreferrer\">Home Finder Script</a>. Se você realmente não precisa da parte do frontend, basta clonar o repositório do script.</p>\n<h3 id=\"o-frontend\" style=\"position:relative;\"><a href=\"#o-frontend\" aria-label=\"o frontend permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O frontend</h3>\n<p>Para o projeto <a href=\"https://github.com/WeRules/home-finder\" target=\"_blank\" rel=\"noreferrer\">Home Finder</a>, você precisará seguir as seguintes etapas:</p>\n<ol>\n<li>Clone o projeto usando o botão <code class=\"language-text\">Use this template</code> no GitHub e certifique-se de que o projeto permaneça público, caso contrário você não poderá fazer o deploy no GitHub Pages.</li>\n<li>Altere o <a href=\"https://github.com/WeRules/home-finder/blob/b79635bf04ed9161c425b37df0d95f5f80c9f449/gatsby-config.js#L13\" target=\"_blank\" rel=\"noreferrer\">siteUrl</a> e o <a href=\"https://github.com/WeRules/home-finder/blob/b79635bf04ed9161c425b37df0d95f5f80c9f449/gatsby-config.js#L6\" target=\"_blank\" rel=\"noreferrer\">pathPrefix</a> no Gatsby, para que o GitHub Actions possa fazer o deploy do projeto em <code class=\"language-text\">usuario.github.io/home-finder</code> corretamente.</li>\n<li>Crie um <a href=\"https://docs.google.com/forms/d/e/1FAIpQLSfNXZrkvG-in6kurmGRQt4SOt2xyDOautibKpC4PAeQElzrgQ/viewform\" target=\"_blank\" rel=\"noreferrer\">Formulários Google como este</a> com exatamente os mesmos nomes e tipos de campo.</li>\n<li>Obtenha o ID do formulário do Google Forms, por exemplo, <code class=\"language-text\">1FAIpQLSfNXZrkvG-in6kurmGRQt4SOt2xyDOautibKpC4PAeQElzrgQ</code> e adicione-o ao seu <a href=\"https://docs.github.com/pt/actions/reference/encrypted-secrets\" target=\"_blank\" rel=\"noreferrer\">secret do repositório</a> com o nome <code class=\"language-text\">GATSBY_GOOGLE_FORM_ID</code>.</li>\n<li>Envie suas alterações para o branch <code class=\"language-text\">main</code> e o site será buildado automaticamente ao dar push com git.</li>\n</ol>\n<h3 id=\"o-backend\" style=\"position:relative;\"><a href=\"#o-backend\" aria-label=\"o backend permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O backend</h3>\n<p>Para o projeto <a href=\"https://github.com/WeRules/home-finder-script\" target=\"_blank\" rel=\"noreferrer\">Home Finder Script</a>, você precisará seguir as seguintes etapas:</p>\n<ol>\n<li>Clone o projeto usando o botão <code class=\"language-text\">Use this template</code> no GitHub e certifique-se de alterar o projeto para privado, caso contrário você pode vazar dados do usuário.</li>\n<li>Atualize o <code class=\"language-text\">template.html</code> para usar o URL do seu próprio site\n<ol>\n<li>ou se você so quiser usar o script sem o site, você pode simplesmente remover o link no rodapé do e-mail.</li>\n</ol>\n</li>\n<li>Obtenha a planilha do Google do formulário criado anteriormente e certifique-se de <a href=\"https://support.google.com/a/users/answer/9308870\" target=\"_blank\" rel=\"noreferrer\">publicar a planilha do Google na web</a> e disponibilizá-la para qualquer pessoa com a ligação também.\n<ol>\n<li>ou se você so quiser usar o script sem o site, qualquer planilha do Google servirá, mas a planilha precisa ter os mesmos campos de cabeçalho que o formulário do Google Forms.</li>\n</ol>\n</li>\n<li>Obtenha o <code class=\"language-text\">ID</code> e o <code class=\"language-text\">Grid ID</code> da planilha do Google, por exemplo, <a href=\"https://docs.google.com/spreadsheets/d/1jRMEvfI6OsWUwnaHgH5UwnoikZA0a3s8wPnCortNJ_A/edit#gid=0\" target=\"_blank\" rel=\"noreferrer\">para esta planilha</a>, o <code class=\"language-text\">ID </code> é <code class=\"language-text\">1jRMEvfI6OsWUwnaHgH5UwnoikZA0a3s8wPnCortNJ_A</code> e o <code class=\"language-text\">Grid ID</code> é <code class=\"language-text\">0</code>.</li>\n<li>Adicione 5 novos <a href=\"https://docs.github.com/pt/actions/reference/encrypted-secrets\" target=\"_blank\" rel=\"noreferrer\">secret do repositório</a>:\n<ol>\n<li><code class=\"language-text\">EMAIL_USER</code>: O e-mail do Gmail que será usado para enviar e-mails.</li>\n<li><code class=\"language-text\">EMAIL_PASSWORD</code>: A senha da conta do Gmail. É altamente recomendável que você <a href=\"https://support.google.com/mail/answer/185833?hl=pt-BR\" target=\"_blank\" rel=\"noreferrer\">crie uma senha de aplicativo</a> para isso.</li>\n<li><code class=\"language-text\">GOOGLE_SPREADSHEET_ID</code>: O <code class=\"language-text\">ID</code> da planilha do Google.</li>\n<li><code class=\"language-text\">GOOGLE_SPREADSHEET_GID</code>: O <code class=\"language-text\">Grid ID</code> da Planilha Google.</li>\n<li><code class=\"language-text\">USER_AGENT</code>: O user-agent a ser usado pelo script scraper. Você pode usar <a href=\"https://www.whatismybrowser.com/detect/what-is-my-user-agent/\" target=\"_blank\" rel=\"noreferrer\">o seu próprio user-agent</a> se quiser.</li>\n</ol>\n</li>\n<li>Atualize <a href=\"https://github.com/WeRules/home-finder-script/blob/main/.github/workflows/run-task.yml#L5\" target=\"_blank\" rel=\"noreferrer\">a frequência do cron job</a> para atender às suas necessidades.</li>\n<li>Envie suas alterações para o branch <code class=\"language-text\">main</code> e o script será executado automaticamente conforme as configurações do cron job.</li>\n</ol>\n<h2 id=\"como-usar-o-site\" style=\"position:relative;\"><a href=\"#como-usar-o-site\" aria-label=\"como usar o site permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Como usar o site</h2>\n<p>Vá para a <a href=\"https://werules.github.io/home-finder/pt-br/form\" target=\"_blank\" rel=\"noreferrer\">página do formulário no site Home Finder</a>, e preencha o formulário com seu e-mail e todos os links dos sites imobiliários com seus parâmetros de pesquisa, por exemplo <a href=\"https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/\" target=\"_blank\" rel=\"noreferrer\">https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/</a> e clique em enviar. Depois disso, basta aguardar o script encontrar novas casas e enviá-las diretamente para o seu e-mail.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.04687499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABC0lEQVQoz5WOz0vDMBiGs9687OT/6kVED20duE1mxZP4Z3gqaBlanHofDBFtl/4Ky5JsSb6MTeIuFlHWh4eP9/Lxvmj/ZtC+Pm8FHgpc59JvBZ5z1XEuPNQ//kune9LuH+0NDpAXhW4UHoa3fhz1Xh/Pnh96L/b6o6E/Gp5+6z9Z3Tja6sdRN77vxHfoYzzBb+/JeCIKsmICKNOU6Rkzc75iwlAOlNkwF5v1elMH5YRm5SwnFBckzao0qxJcJVmZ4HKakzS3eZoTXJCFVFLrnyIhuDEGQBsD/wmg6mitEcYZAOgdgF8gzrnWWjXHNifJp5RLO3yn+toQVFaEC8UXIJbQFCSlUgq2Nn3+AvUADjHqpB6FAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"home finder form page\"\n        title=\"home finder form page\"\n        src=\"/static/bc9c639baec65c912d862fee2d78adae/42a19/home_finder_form_page.png\"\n        srcset=\"/static/bc9c639baec65c912d862fee2d78adae/e3135/home_finder_form_page.png 256w,\n/static/bc9c639baec65c912d862fee2d78adae/06341/home_finder_form_page.png 512w,\n/static/bc9c639baec65c912d862fee2d78adae/42a19/home_finder_form_page.png 1024w,\n/static/bc9c639baec65c912d862fee2d78adae/b0f6f/home_finder_form_page.png 1042w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Atualmente os sites suportados pelo meu projeto são: <a href=\"https://funda.nl\" target=\"_blank\" rel=\"noreferrer\">funda.nl</a>, <a href=\"https://vbo.nl\" target=\"_blank\" rel=\"noreferrer\">vbo.nl</a>, <a href=\"https://huislijn.nl\" target=\"_blank\" rel=\"noreferrer\">huislijn.nl</a>, <a href=\"https://zah.nl\" target=\"_blank\" rel=\"noreferrer\">zah.nl</a>, <a href=\"https://pararius.nl\" target=\"_blank\" rel=\"noreferrer\">pararius.nl</a>, <a href=\"https://jaap.nl\" target=\"_blank\" rel=\"noreferrer\">jaap.nl</a> e <a href=\"https://hoekstraenvaneck.nl\" target=\"_blank\" rel=\"noreferrer\">hoekstraenvaneck.nl</a>, então vá em frente e acesse esses sites, adicione seus filtros e adicione-os ao <a href=\"https://werules.github.io/home-finder/pt-br/\" target=\"_blank\" rel=\"noreferrer\">Home Finder</a>.</p>\n<p><strong>Lembre-se que</strong> este site é apenas <strong>metade do trabalho</strong>, você será notificado quando uma nova casa for anunciada, mas cabe a você agir rápido para ser o primeiro a reservar uma visita para aquela casa.</p>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Com uma combinação de GitHub Actions, criatividade e algumas gambiarras, você pode fazer praticamente qualquer coisa sem gastar nenhum dinheiro inicialmente e se você ver que o seu projeto está dando certo, migrar ele para um servidor próprio com possibilidade de aguentar demandas maiores de usuários.</p>\n<p>Se você tiver uma boa ideia, faça o deploy dela no GitHub Pages, use o GitHub Actions, use o Google Spreadsheet (ok ok, ou Firebase) e inicie seu projeto a partir daí, se você usar mais do que o nível gratuito, provavelmente é um bom momento para começar a dimensionar, e talvez pensando em gerar alguma receita ou encontrar parceiros ou investidores para sua ideia.</p>\n<p>Boa sorte, e se você está procurando uma casa na Holanda, não se esqueça de usar o <a href=\"https://werules.github.io/home-finder/pt-br/\" target=\"_blank\" rel=\"noreferrer\">Home Finder</a> e recomendá-lo aos seus amigos.</p>\n<p>Nos vemos na próxima.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA5LTEzVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-09-13-criando-uma-startup-com-github-actions-e-google-forms.pt-br/","path":"/blog/coding/criando-uma-startup-com-github-actions-e-google-forms/","locale":"pt-br"},"rawMarkdownBody":"O mercado imobiliário em Amsterdam é doideira, tão doideira que [as universidades estão dizendo aos estudantes para não virem para Amsterdam, a menos que já tenham um lugar para morar aqui](https://www-dutchnews-nl.translate.goog/news/2022/06/dont-come-unless-you-have-a-place-to-live-universities-warn-international-students/?_x_tr_sl=en&_x_tr_tl=pt&_x_tr_hl=en&_x_tr_pto=wapp), e as coisas estão só piorando.\r\n\r\nOs preços dos aluguéis e compra de imóveis estão subindo como se não houvesse amanhã e, como Amsterdam é um centro de tecnologia, sempre tem um(a) programador(a) do Booking.com com dinheiro suficiente para qualquer valor no imóvel. O que fazer então?\r\n\r\nBom, se você for bem rápido, pode marcar uma visita na casa assim que ela for listada online e, em seguida, fazer uma oferta que seja boa o suficiente para o proprietário aceitá-la antes de outras pessoas poderem ofertar também.\r\n\r\nA melhor maneira de ficar sabendo assim que uma casa for listada online é pagando uma assinatura a uma dessas agências de aluguel, e elas informarão quando uma nova casa for listada no seu e-mail.\r\n\r\n![](../../uploads/blog/2022/09/home_finder_banner.png)\r\n\r\nIsso é ótimo, mas como eu queria receber notificações no Telegram e não queria gastar dinheiro porque `#frugallife`, [eu escrevi um script para visitar o funda.nl e encontrar uma casa para mim](/pt-br/blog/coding/usando-nodejs-e-github-action-para-encontrar-uma-casa-no-fundanl/).\r\n\r\nIsso funcionou muito bem para mim, mas para pessoas sem habilidades de programação, configurar uma conta no GitHub e mexer com o GitHub Actions não é simples, então decidi criar um [projeto gratuito e de código aberto chamado Home Finder](https://github.com/WeRules/home-finder) (um nome muito criativo, eu sei) que usa GitHub Actions e Google Forms para ajudar qualquer pessoa a encontrar uma nova casa.\r\n\r\n## Startup?\r\nVocê deve estar se perguntando por que eu chamo isso de Startup, bem, [existem várias empresas que prestam serviços como esse por uma taxa mensal](https://www.reddit.com/r/Amsterdam/comments/6kvofb/whats_your_experience_been_with_rental_or_room/), então sim, acho que você pode simplesmente:\r\n\r\n1. Clonar meus projetos\r\n2. Implementa-los em seu próprio site\r\n3. ????\r\n4. Profit\r\n\r\nPor que estou deixando isso gratuito e de código aberto, você pergunta? Bom, programar é divertido e eu fico feliz de estar ajudando outras pessoas.\r\n\r\n## O plano de negócios\r\nPagar aluguel em Amsterdam já é caro pra caramba, e com [os preços de aquecimento subindo mais rápido que Dogecoin](https://www.cnnbrasil.com.br/business/precos-do-gas-natural-sobem-a-medida-que-crise-energetica-da-europa-se-agrava/), pagar um serviço extra para encontrar uma casa é um custo a mais que seria melhor se fosse evitado, mas hospedar um site com um banco de dados e um backend para fazer o scraping não é grátis, o Droplet mais barato do Digital Ocean custa U$5 por mês - ainda assim mais barato do que a maioria das agências de aluguel.\r\n\r\nFelizmente, [GitHub Actions tem um nível gratuito de 2000 horas](https://docs.github.com/pt/billing/managing-billing-for-github-actions/about-billing-for-github-actions#included-storage-and-minutes) para qualquer conta do GitHub, o que resolve o problema de ter um script fazendo o scraping de outros sites, show. Mas como os usuários podem enviar seus dados para que o script possa fazer o scraping para eles?\r\n\r\n[Existe uma gambiarra para usar o Google Forms como um formulário em qualquer site](https://blog.webjeda.com/google-form-customize/), usando qualquer layout que você quiser, e todos os dados enviados nesse formulário serão armazenados em uma planilha do Google, que posteriormente pode ser baixada através do script de scraping para obter os dados do usuário e procurar casas. Maravilha!\r\n\r\nEntão essa é a stack da Startup: GitHub Actions, GitHub Pages, Google Spreadsheet e Google Forms.\r\n\r\nMas antes de fazer qualquer código, comecei a pensar no modelo de negócios e nos casos de uso e cheguei ao seguinte:\r\n\r\n![](../../uploads/blog/2022/09/youre_safe_now_jamstack.png)\r\n\r\n## Por que não usar o Firebase?\r\nPorque não.\r\n\r\n## A programação\r\nPara construir este site, comecei com o meu framework JAMStack favorito, o Gatsby. Eu praticamente apenas [copio](https://github.com/blopa/Resume-Builder) e [colo](https://github.com/blopa/gatsby-material-ui-blog-starter) o mesmo código de um projeto de Gatsby que eu já tenho para outro, e desta vez não foi diferente.\r\n\r\nO melhor do Gatsby é que posso buscar os dados na parte `node.js` do Gatsby e filtrar quaisquer dados que não queira enviar para o frontend, como o e-mail do usuário e o tcharam, sem vazamento de dados. Para este projeto, não precisei fazer isso, mas faço para este blog - então, sempre que um usuário deixa um comentário com seu e-mail em um post desse blo, esse e-mail nunca aparece na compilação do frontend.\r\n\r\nEste projeto terá 2 partes diferentes, o site feito em Gatsby, que durante o seu build vai pegar [os dados do formulário do Google Forms usando o Node Fetch](https://github.com/WeRules/home-finder/blob/main/src/utils/gatsby-node-helpers.js#L18) e o script que [baixará os dados da planilha do Google](https://github.com/WeRules/home-finder-script/blob/main/scraper.js#L17) e converte-los para uma Array com o [xlsx](https://www.npmjs.com/package/xlsx).\r\n\r\nEu também quero ter certeza de que não enviarei duas vezes a mesma casa para o mesmo usuário, e para isso precisarei de um banco de dados para persistir as casas que já foram enviadas para esse usuário, para isso usarei simplesmente um `db. json` com a seguinte estrutura:\r\n\r\n```json\r\n{\r\n  \"user@email.com\": [\"https://somelink.com\", \"https://otherlink.com\"],\r\n  \"user2@email.com\": [\"https://linklink.com\"]\r\n}\r\n```\r\n\r\nPara persistir esses dados no repositório, usarei a [GitHub Action git-auto-commit-action](https://github.com/stefanzweifel/git-auto-commit-action). Isso é problemático porque agora qualquer pessoa pode acessar esse repositório e ver todos os e-mails e links dos usuários, e eu não posso deixar isso assim, então esse repositório precisa ser privado, mas você pode clonar [este repositório](https://github.com/WeRules/home-finder-script) para sua própria conta do GitHub, se desejar.\r\n\r\n## Limitações\r\nComo não quero usar mais do que o nível gratuito do GitHub Actions, estarei executando o script a cada hora, isso deve ser suficiente para não ultrapassar o limite mensal - bem, depende do número de usuários, é claro.\r\n\r\nEu também tive que escrever manualmente os scripts de scraping para [vários sites imobiliários diferentes](https://github.com/WeRules/home-finder-script/blob/main/scraper.js#L133), então não é como se você pudesse receber notificações de qualquer site em qualquer lugar da Holanda.\r\n\r\nÉ por isso que fiz esse projeto ser grátis e de código aberto, para que pessoas possam implementar suas próprias versões e alterar a frequência do script de scraping para atender às suas necessidades.\r\n\r\nHá também uma chance de que qualquer um dos sites possa bloquear o user agent de raspá-los; nesse caso, você precisa ficar de olho nele e alterar o user agent, se necessário.\r\n\r\n## Fazendo o deploy de sua própria versão\r\nPara fazer o deploy da sua própria versão, você precisará clonar 2 repositórios do GitHub, o [Home Finder](https://github.com/WeRules/home-finder) e o [Home Finder Script](https://github.com/WeRules/home-finder-script). Se você realmente não precisa da parte do frontend, basta clonar o repositório do script.\r\n\r\n### O frontend\r\nPara o projeto [Home Finder](https://github.com/WeRules/home-finder), você precisará seguir as seguintes etapas:\r\n\r\n1. Clone o projeto usando o botão `Use this template` no GitHub e certifique-se de que o projeto permaneça público, caso contrário você não poderá fazer o deploy no GitHub Pages.\r\n2. Altere o [siteUrl](https://github.com/WeRules/home-finder/blob/b79635bf04ed9161c425b37df0d95f5f80c9f449/gatsby-config.js#L13) e o [pathPrefix](https://github.com/WeRules/home-finder/blob/b79635bf04ed9161c425b37df0d95f5f80c9f449/gatsby-config.js#L6) no Gatsby, para que o GitHub Actions possa fazer o deploy do projeto em `usuario.github.io/home-finder` corretamente.\r\n3. Crie um [Formulários Google como este](https://docs.google.com/forms/d/e/1FAIpQLSfNXZrkvG-in6kurmGRQt4SOt2xyDOautibKpC4PAeQElzrgQ/viewform) com exatamente os mesmos nomes e tipos de campo.\r\n4. Obtenha o ID do formulário do Google Forms, por exemplo, `1FAIpQLSfNXZrkvG-in6kurmGRQt4SOt2xyDOautibKpC4PAeQElzrgQ` e adicione-o ao seu [secret do repositório](https://docs.github.com/pt/actions/reference/encrypted-secrets) com o nome `GATSBY_GOOGLE_FORM_ID`.\r\n5. Envie suas alterações para o branch `main` e o site será buildado automaticamente ao dar push com git.\r\n\r\n### O backend\r\nPara o projeto [Home Finder Script](https://github.com/WeRules/home-finder-script), você precisará seguir as seguintes etapas:\r\n\r\n1. Clone o projeto usando o botão `Use this template` no GitHub e certifique-se de alterar o projeto para privado, caso contrário você pode vazar dados do usuário.\r\n2. Atualize o `template.html` para usar o URL do seu próprio site\r\n    1. ou se você so quiser usar o script sem o site, você pode simplesmente remover o link no rodapé do e-mail.\r\n3. Obtenha a planilha do Google do formulário criado anteriormente e certifique-se de [publicar a planilha do Google na web](https://support.google.com/a/users/answer/9308870) e disponibilizá-la para qualquer pessoa com a ligação também.\r\n    1. ou se você so quiser usar o script sem o site, qualquer planilha do Google servirá, mas a planilha precisa ter os mesmos campos de cabeçalho que o formulário do Google Forms.\r\n4. Obtenha o `ID` e o `Grid ID` da planilha do Google, por exemplo, [para esta planilha](https://docs.google.com/spreadsheets/d/1jRMEvfI6OsWUwnaHgH5UwnoikZA0a3s8wPnCortNJ_A/edit#gid=0), o `ID ` é `1jRMEvfI6OsWUwnaHgH5UwnoikZA0a3s8wPnCortNJ_A` e o `Grid ID` é `0`.\r\n5. Adicione 5 novos [secret do repositório](https://docs.github.com/pt/actions/reference/encrypted-secrets):\r\n    1. `EMAIL_USER`: O e-mail do Gmail que será usado para enviar e-mails.\r\n    2. `EMAIL_PASSWORD`: A senha da conta do Gmail. É altamente recomendável que você [crie uma senha de aplicativo](https://support.google.com/mail/answer/185833?hl=pt-BR) para isso.\r\n    3. `GOOGLE_SPREADSHEET_ID`: O `ID` da planilha do Google.\r\n    4. `GOOGLE_SPREADSHEET_GID`: O `Grid ID` da Planilha Google.\r\n    5. `USER_AGENT`: O user-agent a ser usado pelo script scraper. Você pode usar [o seu próprio user-agent](https://www.whatismybrowser.com/detect/what-is-my-user-agent/) se quiser.\r\n6. Atualize [a frequência do cron job](https://github.com/WeRules/home-finder-script/blob/main/.github/workflows/run-task.yml#L5) para atender às suas necessidades.\r\n7. Envie suas alterações para o branch `main` e o script será executado automaticamente conforme as configurações do cron job.\r\n\r\n## Como usar o site\r\nVá para a [página do formulário no site Home Finder](https://werules.github.io/home-finder/pt-br/form), e preencha o formulário com seu e-mail e todos os links dos sites imobiliários com seus parâmetros de pesquisa, por exemplo [https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/](https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/) e clique em enviar. Depois disso, basta aguardar o script encontrar novas casas e enviá-las diretamente para o seu e-mail.\r\n\r\n![](../../uploads/blog/2022/09/home_finder_form_page.png)\r\n\r\nAtualmente os sites suportados pelo meu projeto são: [funda.nl](https://funda.nl), [vbo.nl](https://vbo.nl), [huislijn.nl](https://huislijn.nl), [zah.nl](https://zah.nl), [pararius.nl](https://pararius.nl), [jaap.nl](https://jaap.nl) e [hoekstraenvaneck.nl](https://hoekstraenvaneck.nl), então vá em frente e acesse esses sites, adicione seus filtros e adicione-os ao [Home Finder](https://werules.github.io/home-finder/pt-br/).\r\n\r\n**Lembre-se que** este site é apenas **metade do trabalho**, você será notificado quando uma nova casa for anunciada, mas cabe a você agir rápido para ser o primeiro a reservar uma visita para aquela casa.\r\n\r\n## Conclusão\r\nCom uma combinação de GitHub Actions, criatividade e algumas gambiarras, você pode fazer praticamente qualquer coisa sem gastar nenhum dinheiro inicialmente e se você ver que o seu projeto está dando certo, migrar ele para um servidor próprio com possibilidade de aguentar demandas maiores de usuários.\r\n\r\nSe você tiver uma boa ideia, faça o deploy dela no GitHub Pages, use o GitHub Actions, use o Google Spreadsheet (ok ok, ou Firebase) e inicie seu projeto a partir daí, se você usar mais do que o nível gratuito, provavelmente é um bom momento para começar a dimensionar, e talvez pensando em gerar alguma receita ou encontrar parceiros ou investidores para sua ideia.\r\n\r\nBoa sorte, e se você está procurando uma casa na Holanda, não se esqueça de usar o [Home Finder](https://werules.github.io/home-finder/pt-br/) e recomendá-lo aos seus amigos.\r\n\r\nNos vemos na próxima.\r\n","frontmatter":{"tags":["startup","jamstack","google forms","github actions","react","gatsby","javascript","funda","netherlands","imóveis","scraping","puppeteer.js","github"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-09-13T00:00:00.000Z","id":null,"path":"criando-uma-startup-com-github-actions-e-google-forms","show":true,"title":"Criando uma Startup com GitHub Actions e Google Forms","hideExcerpt":false,"subtitle":"Como usar o JAMStack para iniciar sua própria Startup"}}},{"node":{"excerpt":"Há alguns meses atrás, eu publiquei um post no meu blog…","html":"<p>Há alguns meses atrás, eu publiquei um post no meu blog sobre <a href=\"/pt-br/blog/coding/como-acessar-o-estado-do-redux-de-um-production-build-usando-o-console-do-browser/\">como acessar o state do Redux em um build de produção utilizando o console do navegador</a>. No entanto, com o lançamento recente do React 18, essa técnica não funciona mais.</p>\n<p>Neste blog post, vamos explorar o motivo pelo qual ela deixou de funcionar e como criar um script que ainda permita acessar o state do Redux em produção.</p>\n<h2 id=\"o-que-mudou\" style=\"position:relative;\"><a href=\"#o-que-mudou\" aria-label=\"o que mudou permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O que mudou?</h2>\n<p>No React 17, havia uma propriedade chamada <code class=\"language-text\">_reactRootContainer</code> no container do React, mas essa propriedade não existe mais no React 18. Em vez disso, <a href=\"https://github.com/facebook/react/blob/a724a3b578dce77d427bef313102a4d0e978d9b4/packages/react-dom/src/client/ReactDOMComponentTree.js#L40\" target=\"_blank\" rel=\"noreferrer\">como podemos ver no código-fonte do React</a>, o container do React agora possui uma propriedade prefixada com <code class=\"language-text\">__reactContainer</code> e um número aleatório no final.</p>\n<p>Para encontrar o container do React, podemos procurar por elementos DOM que possuem uma propriedade começando com <code class=\"language-text\">__reactContainer</code>. Primeiro, precisamos encontrar todos os elementos DOM que podem ser potencialmente o container do React.</p>\n<p>A maioria dos aplicativos React usa um <code class=\"language-text\">id</code> HTML para definir o container e, em seguida, usa a função <code class=\"language-text\">getElementById()</code> para recuperá-lo. Portanto, para obter todos os elementos com um “id” no documento, podemos usar <code class=\"language-text\">document.querySelectorAll(\"*[id ]\")</code>.</p>\n<p>Para encontrar todos os containers do React na página, podemos executar o seguinte script:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> internalRoots <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*[id]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">keyName</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> keyName<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__reactContainer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">at</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> el<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pronto! Agora tudo o que temos a fazer é encontrar o <code class=\"language-text\">_internalRoot</code> e pronto, né? Né?!?!</p>\n<h2 id=\"nao\" style=\"position:relative;\"><a href=\"#nao\" aria-label=\"nao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Não</h2>\n<p>Na verdade, descobrir a primeira parte foi relativamente simples. Como não estou muito familiarizado com o código-fonte do React, tentei explorar todas as propriedades disponíveis do container, mas acabei optando pelo caminho mais fácil, ainda que preguiçoso.</p>\n<p><img src=\"/6a9e8f39c841ed588e5798fba7412e92/element-diving.gif\" alt=\"\"></p>\n<p>Já que para obter o state do Redux usamos a função <code class=\"language-text\">getState()</code>, tudo o que precisamos fazer é percorrer a árvore de variáveis do container do React em busca dela.</p>\n<p>Felizmente, <a href=\"https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd\" target=\"_blank\" rel=\"noreferrer\">já existe um Gist do GitHub para isso</a>, então basta adaptá-lo para o nosso caso, examinando uma variável específica em vez da <code class=\"language-text\">window</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> stores <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// code from https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd</span>\r\ninternalRoots<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">let</span> seen <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">search</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>seen<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        seen<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>name <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'getState'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                stores<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>obj<span class=\"token operator\">?.</span>hasOwnProperty<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">search</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token function\">search</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Pronto, e daí podemos acessar os states com <code class=\"language-text\">[...stores].map((store) => store.getState())</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.0625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACy0lEQVQozx2S32tcRRzF758i/Q980zd9C/igFmraRtJak8bE/GBDi0UNsbSb2JD2pWGtIoVIoL9AQcEnLaFVow9pbRqjMWuyye7evTPznbkzc+f33b1Xtm/n5RzO53AiQki9XpdSlmUpZSbjDkOIMpZlMlOq2Wy3mu1WGzXbBJgQUmaZRnGr1Y47CY4QwvsHDSllnnedtS7kzgfnfB5yKWWCEFDgShtrQwh5CN4H50MIwRgTMZ4lhCMQxoayLIte0esVIe+WZWmMTdOUYYZamGBIuQSurTUqU1obrU303Q8/bjx6+Puv63fu37v3YPXxxsbO7oERYv3RTxt/PDbaJjsdvIcIBoThBRCjL/pLqaLNJ38+23r+9NnW5tOt7e3N3fref42WEqJxuLd/8K/ONNnHuIkpYZRRjEGIzFjjnFdKRb1eT2cyBF8Uvf5ESnW7uVRKSuVDbo1F/yTx8zbeRzjG/QCaSiE0T41SUfAhZsq4blmUWmtrXVmWznutdVEU1ji0m+BDzBgDSjkXBCgA5YwbraOVB98uPWysfb96e2156fr8ra+Xb9Zu3Lm7dvubuz+v/+K9RzsdckhI35JiQoFyAIaB9gd77Y23z42ffuvEyyNjg+PDp6fPvDk+MTk6OTs4PHrx0sfWWFLH+AgDoQQ4IgwAGEuFEM656NOpyo0ri+dPnnr/3PnF5VptfuHKpU8uVCqzkxPXFqpWG/R3kvzVAQQIUwIZwoQQIADa6Oh6dXpsbGiuMjr/2Vyt9tWtlS/OjEycnPr8xIfV6sqaNS7ejuGIAE1ZmiqlOecy07r/Ghu9+97A0NnXB46/enXxamV2Zmp8+Ozl1YEvO68s7U7db3W9Ew0ECIBxxrjiqWR9JYX03kcXRodmhgcnPhiZnLk4PfvRS8eOnXrn+FJ17trC5Zu12lGH//akk8R9Ts4lF1kqpOCCcyGE/B8w0X/4WbfnOgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redux state on instagram\"\n        title=\"redux state on instagram\"\n        src=\"/static/532aa2000a29f36e8c59da4250cfcb2f/42a19/redux-state-on-instagram.png\"\n        srcset=\"/static/532aa2000a29f36e8c59da4250cfcb2f/e3135/redux-state-on-instagram.png 256w,\n/static/532aa2000a29f36e8c59da4250cfcb2f/06341/redux-state-on-instagram.png 512w,\n/static/532aa2000a29f36e8c59da4250cfcb2f/42a19/redux-state-on-instagram.png 1024w,\n/static/532aa2000a29f36e8c59da4250cfcb2f/92844/redux-state-on-instagram.png 1032w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Você pode copiar e colar o script completo abaixo.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> internalRoots <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*[id]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">keyName</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> keyName<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__reactContainer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">at</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> el<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> stores <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// code from https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd</span>\r\ninternalRoots<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">let</span> seen <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">search</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>seen<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        seen<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>name <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'getState'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                stores<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>obj<span class=\"token operator\">?.</span>hasOwnProperty<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">search</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token function\">search</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>stores<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">store</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Para concluir, neste post, exploramos o motivo pelo qual o método anterior para acessar o state do Redux em um build de produção deixou de funcionar no React 18 e apresentamos uma solução atualizada que permite acessar o state do Redux em produção.</p>\n<p>Apesar de ter sido um desafio descobrir o novo método, com a ajuda de um script já existente e um pouco de adaptação, conseguimos encontrar uma solução viável.</p>\n<p>Espero que este post tenha sido útil e que você consiga utilizá-lo em seus futuros projetos.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA4LTIxVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-08-21-como-acessar-o-state-do-redux-de-um-build-de-producao-do-react-18.pt-br/","path":"/blog/coding/como-acessar-o-state-do-redux-de-um-build-de-producao-do-react-18/","locale":"pt-br"},"rawMarkdownBody":"Há alguns meses atrás, eu publiquei um post no meu blog sobre [como acessar o state do Redux em um build de produção utilizando o console do navegador](/pt-br/blog/coding/como-acessar-o-estado-do-redux-de-um-production-build-usando-o-console-do-browser/). No entanto, com o lançamento recente do React 18, essa técnica não funciona mais.\r\n\r\nNeste blog post, vamos explorar o motivo pelo qual ela deixou de funcionar e como criar um script que ainda permita acessar o state do Redux em produção.\r\n\r\n## O que mudou?\r\nNo React 17, havia uma propriedade chamada `_reactRootContainer` no container do React, mas essa propriedade não existe mais no React 18. Em vez disso, [como podemos ver no código-fonte do React](https://github.com/facebook/react/blob/a724a3b578dce77d427bef313102a4d0e978d9b4/packages/react-dom/src/client/ReactDOMComponentTree.js#L40), o container do React agora possui uma propriedade prefixada com `__reactContainer` e um número aleatório no final.\r\n\r\nPara encontrar o container do React, podemos procurar por elementos DOM que possuem uma propriedade começando com `__reactContainer`. Primeiro, precisamos encontrar todos os elementos DOM que podem ser potencialmente o container do React.\r\n\r\nA maioria dos aplicativos React usa um `id` HTML para definir o container e, em seguida, usa a função `getElementById()` para recuperá-lo. Portanto, para obter todos os elementos com um \"id\" no documento, podemos usar `document.querySelectorAll(\"*[id ]\")`.\r\n\r\nPara encontrar todos os containers do React na página, podemos executar o seguinte script:\r\n\r\n```javascript\r\nconst internalRoots = Array.from(document.querySelectorAll(\"*[id]\")).map((el) => {\r\n    const key = Object.keys(el).filter((keyName) => keyName.includes('__reactContainer')).at(-1);\r\n\r\n    return el[key];\r\n}).filter((key) => key);\r\n```\r\n\r\nPronto! Agora tudo o que temos a fazer é encontrar o `_internalRoot` e pronto, né? Né?!?!\r\n\r\n## Não\r\nNa verdade, descobrir a primeira parte foi relativamente simples. Como não estou muito familiarizado com o código-fonte do React, tentei explorar todas as propriedades disponíveis do container, mas acabei optando pelo caminho mais fácil, ainda que preguiçoso.\r\n\r\n![](../../uploads/blog/2022/08/element-diving.gif)\r\n\r\nJá que para obter o state do Redux usamos a função `getState()`, tudo o que precisamos fazer é percorrer a árvore de variáveis do container do React em busca dela.\r\n\r\nFelizmente, [já existe um Gist do GitHub para isso](https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd), então basta adaptá-lo para o nosso caso, examinando uma variável específica em vez da `window`.\r\n\r\n```javascript\r\nconst stores = new Set();\r\n// code from https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd\r\ninternalRoots.forEach((root) => {\r\n    let seen = new Map();\r\n    function search(obj) {\r\n        if (seen.has(obj)) {\r\n            return;\r\n        }\r\n\r\n        seen.set(obj, true);\r\n        for (name in obj) {\r\n            if (name === 'getState') {\r\n                stores.add(obj);\r\n            }\r\n\r\n            if ((obj?.hasOwnProperty?.(name)) && (typeof obj[name] === \"object\") && (obj[name] != null)) {\r\n                search(obj[name]);\r\n            }\r\n        }\r\n    }\r\n\r\n    search(root);\r\n});\r\n```\r\n\r\nPronto, e daí podemos acessar os states com `[...stores].map((store) => store.getState())`.\r\n\r\n![](../../uploads/blog/2022/08/redux-state-on-instagram.png)\r\n\r\nVocê pode copiar e colar o script completo abaixo.\r\n\r\n```javascript\r\nconst internalRoots = Array.from(document.querySelectorAll(\"*[id]\")).map((el) => {\r\n    const key = Object.keys(el).filter((keyName) => keyName.includes('__reactContainer')).at(-1);\r\n\r\n    return el[key];\r\n}).filter((key) => key);\r\n\r\nconst stores = new Set();\r\n// code from https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd\r\ninternalRoots.forEach((root) => {\r\n    let seen = new Map();\r\n    function search(obj) {\r\n        if (seen.has(obj)) {\r\n            return;\r\n        }\r\n\r\n        seen.set(obj, true);\r\n        for (name in obj) {\r\n            if (name === 'getState') {\r\n                stores.add(obj);\r\n            }\r\n\r\n            if ((obj?.hasOwnProperty?.(name)) && (typeof obj[name] === \"object\") && (obj[name] != null)) {\r\n                search(obj[name]);\r\n            }\r\n        }\r\n    }\r\n\r\n    search(root);\r\n});\r\n\r\n[...stores].map((store) => store.getState());\r\n```\r\n\r\n## Conclusão\r\nPara concluir, neste post, exploramos o motivo pelo qual o método anterior para acessar o state do Redux em um build de produção deixou de funcionar no React 18 e apresentamos uma solução atualizada que permite acessar o state do Redux em produção.\r\n\r\nApesar de ter sido um desafio descobrir o novo método, com a ajuda de um script já existente e um pouco de adaptação, conseguimos encontrar uma solução viável.\r\n\r\nEspero que este post tenha sido útil e que você consiga utilizá-lo em seus futuros projetos.\r\n\r\n","frontmatter":{"tags":["redux","react","javascript","browser","console","production build","gambiarra","react 18","react 17","redux state"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-08-21T00:00:00.000Z","id":null,"path":"como-acessar-o-state-do-redux-de-um-build-de-producao-do-react-18","show":true,"title":"Como acessar o state do Redux de um build de produção do React 18","hideExcerpt":false,"subtitle":"Solução atualizada para acessar o state do Redux em um build de produção com o React 18"}}},{"node":{"excerpt":"A few months ago, I published a blog post discussing the…","html":"<p>A few months ago, I published a blog post <a href=\"/en/blog/coding/how-to-get-the-redux-state-from-a-production-build-via-the-browsers-console/\">discussing the process of retrieving the Redux state from a production build through the browser’s console</a>. However, this method no longer works after the release of React 18.</p>\n<p>In this article, we will explore the reasons for this change and discuss how to create a new script that works with the latest version of React.</p>\n<h2 id=\"what-changed\" style=\"position:relative;\"><a href=\"#what-changed\" aria-label=\"what changed permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What changed?</h2>\n<p>In React 17, the <code class=\"language-text\">_reactRootContainer</code> property was present in the React container. However, this is no longer the case in React 18. Instead, the <code class=\"language-text\">__reactContainer</code> prefix with a random key at the end is used, <a href=\"https://github.com/facebook/react/blob/a724a3b578dce77d427bef313102a4d0e978d9b4/packages/react-dom/src/client/ReactDOMComponentTree.js#L40\" target=\"_blank\" rel=\"noreferrer\">as shown in the React source code</a>.</p>\n<p>To find the React container in React 18, we can search for DOM elements that contain a property starting with <code class=\"language-text\">__reactContainer</code>. To do this, we first need to find all potential DOM elements that could be the React container.</p>\n<p>In most React apps, the container is set using an HTML <code class=\"language-text\">id</code> and queried with <code class=\"language-text\">getElementById()</code>. To find all elements with an <code class=\"language-text\">id</code> in the document, we can use <code class=\"language-text\">document.querySelectorAll(\"*[id]\")</code>.</p>\n<p>To search for all React containers on the page, we can run the following script:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> internalRoots <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*[id]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">keyName</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> keyName<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__reactContainer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">at</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> el<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Done! Now all we have to do is find the <code class=\"language-text\">_internalRoot</code> and we’re set, right? Right?!?!</p>\n<h2 id=\"no\" style=\"position:relative;\"><a href=\"#no\" aria-label=\"no permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>No</h2>\n<p>To be honest, it wasn’t too difficult to figure out the first part of this problem. However, as I am not very familiar with the React source code, I initially struggled to find a solution. Eventually, I decided to take a lazy approach and simply search through the container element’s properties for the Redux state.</p>\n<p><img src=\"/6a9e8f39c841ed588e5798fba7412e92/element-diving.gif\" alt=\"\"></p>\n<p>As we all know, to retrieve the Redux state we use the <code class=\"language-text\">getState()</code> function. To access this function, we can perform a tree search within the React container variable.</p>\n<p>Fortunately, there is already a <a href=\"https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd\" target=\"_blank\" rel=\"noreferrer\">GitHub Gist available that demonstrates how to do this</a>. We can simply adapt this script to our specific use case, searching within a specific variable rather than at <code class=\"language-text\">window</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> stores <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// code from https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd</span>\r\ninternalRoots<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">let</span> seen <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">search</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>seen<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        seen<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>name <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'getState'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                stores<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>obj<span class=\"token operator\">?.</span>hasOwnProperty<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">search</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token function\">search</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Done, now we can access the states with <code class=\"language-text\">[...stores].map((store) => store.getState())</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.0625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACy0lEQVQozx2S32tcRRzF758i/Q980zd9C/igFmraRtJak8bE/GBDi0UNsbSb2JD2pWGtIoVIoL9AQcEnLaFVow9pbRqjMWuyye7evTPznbkzc+f33b1Xtm/n5RzO53AiQki9XpdSlmUpZSbjDkOIMpZlMlOq2Wy3mu1WGzXbBJgQUmaZRnGr1Y47CY4QwvsHDSllnnedtS7kzgfnfB5yKWWCEFDgShtrQwh5CN4H50MIwRgTMZ4lhCMQxoayLIte0esVIe+WZWmMTdOUYYZamGBIuQSurTUqU1obrU303Q8/bjx6+Puv63fu37v3YPXxxsbO7oERYv3RTxt/PDbaJjsdvIcIBoThBRCjL/pLqaLNJ38+23r+9NnW5tOt7e3N3fref42WEqJxuLd/8K/ONNnHuIkpYZRRjEGIzFjjnFdKRb1eT2cyBF8Uvf5ESnW7uVRKSuVDbo1F/yTx8zbeRzjG/QCaSiE0T41SUfAhZsq4blmUWmtrXVmWznutdVEU1ji0m+BDzBgDSjkXBCgA5YwbraOVB98uPWysfb96e2156fr8ra+Xb9Zu3Lm7dvubuz+v/+K9RzsdckhI35JiQoFyAIaB9gd77Y23z42ffuvEyyNjg+PDp6fPvDk+MTk6OTs4PHrx0sfWWFLH+AgDoQQ4IgwAGEuFEM656NOpyo0ri+dPnnr/3PnF5VptfuHKpU8uVCqzkxPXFqpWG/R3kvzVAQQIUwIZwoQQIADa6Oh6dXpsbGiuMjr/2Vyt9tWtlS/OjEycnPr8xIfV6sqaNS7ejuGIAE1ZmiqlOecy07r/Ghu9+97A0NnXB46/enXxamV2Zmp8+Ozl1YEvO68s7U7db3W9Ew0ECIBxxrjiqWR9JYX03kcXRodmhgcnPhiZnLk4PfvRS8eOnXrn+FJ17trC5Zu12lGH//akk8R9Ts4lF1kqpOCCcyGE/B8w0X/4WbfnOgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redux state on instagram\"\n        title=\"redux state on instagram\"\n        src=\"/static/532aa2000a29f36e8c59da4250cfcb2f/42a19/redux-state-on-instagram.png\"\n        srcset=\"/static/532aa2000a29f36e8c59da4250cfcb2f/e3135/redux-state-on-instagram.png 256w,\n/static/532aa2000a29f36e8c59da4250cfcb2f/06341/redux-state-on-instagram.png 512w,\n/static/532aa2000a29f36e8c59da4250cfcb2f/42a19/redux-state-on-instagram.png 1024w,\n/static/532aa2000a29f36e8c59da4250cfcb2f/92844/redux-state-on-instagram.png 1032w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>You can copy and paste the full script below.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> internalRoots <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*[id]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">keyName</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> keyName<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'__reactContainer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">at</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> el<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> stores <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// code from https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd</span>\r\ninternalRoots<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">root</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">let</span> seen <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">function</span> <span class=\"token function\">search</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>seen<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n        seen<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>name <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'getState'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                stores<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>obj<span class=\"token operator\">?.</span>hasOwnProperty<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">search</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token function\">search</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>stores<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">store</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>To conclude, in this article we explored the reason why the previous method for accessing the Redux state in a production build stopped working in React 18 and presented an updated solution that allows for accessing the Redux state in production.</p>\n<p>Although it was a challenge to discover the new method, with the help of an existing script and some modification, we were able to find a viable solution.</p>\n<p>I hope that this article was helpful and that you will be able to use it in your own projects.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA4LTIxVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-08-21-how-to-get-the-redux-state-from-a-react-18-production-build-via-the-browsers-console.en/","path":"/blog/coding/how-to-get-the-redux-state-from-a-react-18-production-build-via-the-browsers-console/","locale":"en"},"rawMarkdownBody":"A few months ago, I published a blog post [discussing the process of retrieving the Redux state from a production build through the browser's console](/en/blog/coding/how-to-get-the-redux-state-from-a-production-build-via-the-browsers-console/). However, this method no longer works after the release of React 18.\r\n\r\nIn this article, we will explore the reasons for this change and discuss how to create a new script that works with the latest version of React.\r\n\r\n## What changed?\r\nIn React 17, the `_reactRootContainer` property was present in the React container. However, this is no longer the case in React 18. Instead, the `__reactContainer` prefix with a random key at the end is used, [as shown in the React source code](https://github.com/facebook/react/blob/a724a3b578dce77d427bef313102a4d0e978d9b4/packages/react-dom/src/client/ReactDOMComponentTree.js#L40).\r\n\r\nTo find the React container in React 18, we can search for DOM elements that contain a property starting with `__reactContainer`. To do this, we first need to find all potential DOM elements that could be the React container.\r\n\r\nIn most React apps, the container is set using an HTML `id` and queried with `getElementById()`. To find all elements with an `id` in the document, we can use `document.querySelectorAll(\"*[id]\")`.\r\n\r\nTo search for all React containers on the page, we can run the following script:\r\n\r\n```javascript\r\nconst internalRoots = Array.from(document.querySelectorAll(\"*[id]\")).map((el) => {\r\n    const key = Object.keys(el).filter((keyName) => keyName.includes('__reactContainer')).at(-1);\r\n\r\n    return el[key];\r\n}).filter((key) => key);\r\n```\r\n\r\nDone! Now all we have to do is find the `_internalRoot` and we're set, right? Right?!?!\r\n\r\n## No\r\nTo be honest, it wasn't too difficult to figure out the first part of this problem. However, as I am not very familiar with the React source code, I initially struggled to find a solution. Eventually, I decided to take a lazy approach and simply search through the container element's properties for the Redux state.\r\n\r\n![](../../uploads/blog/2022/08/element-diving.gif)\r\n\r\nAs we all know, to retrieve the Redux state we use the `getState()` function. To access this function, we can perform a tree search within the React container variable.\r\n\r\nFortunately, there is already a [GitHub Gist available that demonstrates how to do this](https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd). We can simply adapt this script to our specific use case, searching within a specific variable rather than at `window`.\r\n\r\n```javascript\r\nconst stores = new Set();\r\n// code from https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd\r\ninternalRoots.forEach((root) => {\r\n    let seen = new Map();\r\n    function search(obj) {\r\n        if (seen.has(obj)) {\r\n            return;\r\n        }\r\n\r\n        seen.set(obj, true);\r\n        for (name in obj) {\r\n            if (name === 'getState') {\r\n                stores.add(obj);\r\n            }\r\n\r\n            if ((obj?.hasOwnProperty?.(name)) && (typeof obj[name] === \"object\") && (obj[name] != null)) {\r\n                search(obj[name]);\r\n            }\r\n        }\r\n    }\r\n\r\n    search(root);\r\n});\r\n```\r\n\r\nDone, now we can access the states with `[...stores].map((store) => store.getState())`.\r\n\r\n![](../../uploads/blog/2022/08/redux-state-on-instagram.png)\r\n\r\nYou can copy and paste the full script below.\r\n\r\n```javascript\r\nconst internalRoots = Array.from(document.querySelectorAll(\"*[id]\")).map((el) => {\r\n    const key = Object.keys(el).filter((keyName) => keyName.includes('__reactContainer')).at(-1);\r\n\r\n    return el[key];\r\n}).filter((key) => key);\r\n\r\nconst stores = new Set();\r\n// code from https://gist.github.com/mindplay-dk/1843c267fc633688059dfa5e3b07d0dd\r\ninternalRoots.forEach((root) => {\r\n    let seen = new Map();\r\n    function search(obj) {\r\n        if (seen.has(obj)) {\r\n            return;\r\n        }\r\n\r\n        seen.set(obj, true);\r\n        for (name in obj) {\r\n            if (name === 'getState') {\r\n                stores.add(obj);\r\n            }\r\n\r\n            if ((obj?.hasOwnProperty?.(name)) && (typeof obj[name] === \"object\") && (obj[name] != null)) {\r\n                search(obj[name]);\r\n            }\r\n        }\r\n    }\r\n\r\n    search(root);\r\n});\r\n\r\n[...stores].map((store) => store.getState());\r\n```\r\n\r\n## Conclusion\r\nTo conclude, in this article we explored the reason why the previous method for accessing the Redux state in a production build stopped working in React 18 and presented an updated solution that allows for accessing the Redux state in production.\r\n\r\nAlthough it was a challenge to discover the new method, with the help of an existing script and some modification, we were able to find a viable solution.\r\n\r\nI hope that this article was helpful and that you will be able to use it in your own projects.\r\n","frontmatter":{"tags":["redux","react","javascript","browser","console","production build","hack","react 18","react 17","redux state"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-08-21T00:00:00.000Z","id":null,"path":"how-to-get-the-redux-state-from-a-react-18-production-build-via-the-browsers-console","show":true,"title":"How to get the Redux State in a React 18 production build via the browser's console","hideExcerpt":false,"subtitle":"Updated solution for accessing Redux state in a production build with React 18"}}},{"node":{"excerpt":"I still remember the first time I planned to go to E3 with…","html":"<p>I still remember the first time I planned to go to E3 with some friends, back in 2009. It felt like a distant dream, just the idea of going to E3 was already exciting enough. At the time, I didn’t even realize that E3 was an event for media press only and that I wouldn’t be able to just buy a ticket and attend. Of course, I eventually did get to go to E3, but how?</p>\n<p>As a huge fan of video games, especially Nintendo games, I applied to be an editor for Nintendo Blast, the biggest Brazilian blog about Nintendo. I was accepted and started writing blog posts and making videos for their YouTube channel. A few years later, I received an email from one of the blog managers saying they were looking for people to travel to Los Angeles to cover E3. I was over the moon and applied right away.</p>\n<p>Since Nintendo Blast was a voluntary work, I had to pay for my own trip, but they would offer me something money couldn’t buy: a media badge.</p>\n<p>I had to go through the process of getting a visa to enter the US, which was quite bureaucratic, but fortunately, my visa was approved. The hotel and tickets were booked and our media badges were issued, and all I had to do was wait for the day of the trip. I was so excited that I had trouble sleeping for months.</p>\n<h2 id=\"first-time-in-los-angeles\" style=\"position:relative;\"><a href=\"#first-time-in-los-angeles\" aria-label=\"first time in los angeles permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>First time in Los Angeles</h2>\n<p>Attending E3 had an unexpected side effect: I fell in love with Los Angeles. It’s cliché, I know, but LA is not only the home of E3, but also the home of many famous skate spots that I had seen in skate videos my whole life. Being able to visit these spots in person was very emotional for me, and I even bought a Plan B deck while I was there. Downtown LA is practically filled with famous skate spots from 90s skate parts.</p>\n<p>This was also my first time in the US, so I experienced many new things, like extra-large meals at McDonald’s, shopping at Target, receiving massive receipts from CVS, going to a GameStop, buying Old Spice products, going to White Castle, and, as a Forest Gump fan, finally visiting a Bubba Gump restaurant.</p>\n<p>We were a group of seven young video game enthusiasts, ready to cover the biggest video game event in the world. We had lots of things we wanted to do in LA, but we had no time to waste as E3 was starting just two days after we arrived.</p>\n<h2 id=\"a-little-help-from-the-veterans\" style=\"position:relative;\"><a href=\"#a-little-help-from-the-veterans\" aria-label=\"a little help from the veterans permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A little help from the veterans</h2>\n<p>Despite being a small team, we were fortunate enough to be staying at the same hotel as several veteran editors from Nintendo World, the official Nintendo magazine in Brazil. As someone who has been a fan of Nintendo World since childhood, it was a surreal experience to be there with these legends.</p>\n<p>In fact, some of us were even given the opportunity to write a guest article for the magazine - although unfortunately, I was not selected. Nevertheless, just being considered for the opportunity was one of the greatest achievements of my life so far.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 132.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMCBAUB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAD/9oADAMBAAIQAxAAAAFk7Cy+kSmprCw1zFHn/8QAHhAAAQQBBQAAAAAAAAAAAAAAAgABAxIhBBETICL/2gAIAQEAAQUCIarjwEQkzPYpjCkWnxM+4j6TH0//xAAZEQEAAgMAAAAAAAAAAAAAAAAAERMBUWH/2gAIAQMBAT8BlOdrF3H/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEhD/2gAIAQIBAT8ByUP/xAAiEAACAgEBCQAAAAAAAAAAAAAAAQIRUSISEyAhMjNBYYH/2gAIAQEABj8C1RR2zoj9JbyK0tUSjtVY78vI45KnzXtFY4P/xAAeEAACAgICAwAAAAAAAAAAAAABEQAhMUEQYYGRof/aAAgBAQABPyFpkeVDl9mYwP8AuU3iw1CljXkw4MewdILKNSgEjdaogAESoL4V8f/aAAwDAQACAAMAAAAQoOi9/8QAGREBAQADAQAAAAAAAAAAAAAAAQARQWHw/9oACAEDAQE/EM3d5McSxn//xAAaEQEBAAIDAAAAAAAAAAAAAAABABEhMVFh/9oACAECAQE/EACwdT6jTm//xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAhMUFxUWH/2gAIAQEAAT8QJutMitmpqVyN9groe8Y1IL0UaO+z3Gu/pkTzvt4xLqLZC0rZrg/MrzaRVQTBGG8iIH1+76xwZeIeOcnww0eIfuAQ0YjqYhXRn//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Nintendo World #159\"\n        title=\"Nintendo World #159\"\n        src=\"/static/1bd637a064f5ba27be82ffab40d2d631/63217/nintendo_world_159.jpg\"\n        srcset=\"/static/1bd637a064f5ba27be82ffab40d2d631/db830/nintendo_world_159.jpg 256w,\n/static/1bd637a064f5ba27be82ffab40d2d631/8102f/nintendo_world_159.jpg 512w,\n/static/1bd637a064f5ba27be82ffab40d2d631/63217/nintendo_world_159.jpg 1024w,\n/static/1bd637a064f5ba27be82ffab40d2d631/d58d1/nintendo_world_159.jpg 1536w,\n/static/1bd637a064f5ba27be82ffab40d2d631/d7bd3/nintendo_world_159.jpg 1933w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Nintendo World #159</figcaption>\n  </figure></p>\n<p>In addition, we participated in several meetings on how to make the most of our time at E3, which proved to be extremely valuable and have proven useful at every E3 I’ve attended since then.</p>\n<h2 id=\"wait-when-does-e3-starts\" style=\"position:relative;\"><a href=\"#wait-when-does-e3-starts\" aria-label=\"wait when does e3 starts permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wait, when does E3 starts?</h2>\n<p>Every E3, I would see articles stating when the event was supposed to start, only to have the Sony, Microsoft, and Nintendo conferences happen a few days earlier.</p>\n<p>These conferences, while not technically part of E3, are still closely associated with the event. E3, organized by the Entertainment Software Association (ESA), is a trade show where gaming companies can showcase their products and new game releases to media and traders.</p>\n<p>During this time, the entire gaming industry is focused on E3, leading major companies to schedule press conferences a few days beforehand to give attendees an idea of what to expect at the event.</p>\n<p>However, for those of us watching from home, it can be confusing as E3 seems to begin with the start of the conferences and end after the final conference.</p>\n<p>I remember being surprised when I was told that the Sony conference was being held at a location far from the Los Angeles Convention Center (LACC), as I had assumed all conferences were held at the LACC as part of E3. It was a shock to me, and in the years since, I’ve noticed that many other E3 attendees have had similar confusion.</p>\n<h2 id=\"the-conferences\" style=\"position:relative;\"><a href=\"#the-conferences\" aria-label=\"the conferences permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The conferences</h2>\n<p>Typically, access to the highly sought-after E3 conferences requires an invitation. However, many media professionals still make the journey to the conference location in the hope of securing a last-minute spot. In my experience, I have always been able to attend the conferences, even if it meant making phone calls and reaching out to PR professionals to try and secure a spot. On one occasion, I didn’t even try to attend a conference, only to later learn that it was the last year that Nintendo held a traditional E3 conference.</p>\n<p>The conferences are typically scheduled at specific times and locations to allow attendees to move from one to the next. A typical conference day might include a Microsoft conference in the morning, followed by Ubisoft, a lunch break, and finally, Sony. There are even special buses that provide transportation between the conferences for free - I’m not sure where these buses come from, but they are incredibly helpful.</p>\n<p>Many conferences also provide attendees with souvenirs such as pins, t-shirts, and action figures. These items can often be found for sale on eBay for hundreds of dollars later the same day. Personally, I have kept all of the souvenirs I have received and still wear at least one E3 t-shirt every week.</p>\n<p>The locations of the conferences are always iconic places in Los Angeles, such as the Dolby Theater on Hollywood Boulevard where the Bethesda conferences were held in 2015, or the LA Memorial Sports Arena and Galen Center, where Sony and Microsoft conferences are typically held.</p>\n<h2 id=\"the-event\" style=\"position:relative;\"><a href=\"#the-event\" aria-label=\"the event permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Event</h2>\n<p>E3 typically takes place over the course of three days, from Tuesday to Thursday. However, if you want to see everything, three days is not enough. Attending the event is an incredible experience, but it’s easy to miss out on a lot of things due to the sheer size of the Los Angeles Convention Center (LACC) and the time it takes to walk from booth to booth.</p>\n<p>To make the most of our time at E3, our team split up into smaller groups and booked slots for hands-on demos, interviews, and presentations with various publishers in advance. This allowed us to skip the long lines and go straight to the hands-on experiences. As I mentioned before, three days is not a lot of time to see everything, so it’s important to try to avoid wasting time waiting in lines.</p>\n<p>During my first year at E3, I was a bit lost and wasn’t sure what to do, but I still managed to play a lot of games for the Wii U and PS3, including ZombiU, Nintendo Land, LittleBigPlanet Karting, and PlayStation All-Stars Battle Royale. My favorite game from that year, however, was not playable - Dead Space 3. That’s when I became a fan of the series and received a nice beanie, which I still have to this day.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 612px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAgP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAV66GDeAwHLrUJlt0jgf/8QAHhABAAEEAgMAAAAAAAAAAAAAAgEAAwQTERIUIjP/2gAIAQEAAQUCxQLqjjY0u+sePgL31qUkrdByEeyN/wCU1tfH/8QAFxEBAQEBAAAAAAAAAAAAAAAAAAECEf/aAAgBAwEBPwFxU2//xAAZEQEAAgMAAAAAAAAAAAAAAAAAAQIREjH/2gAIAQIBAT8BZV41l//EAB8QAAICAQQDAAAAAAAAAAAAAAABAhExEBIhQSIycf/aAAgBAQAGPwLyVUhOLVX0S47JbMoaJfSUVhlx4Llli09j/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBcWH/2gAIAQEAAT8hS1i52hgadUVHelIlIqwta+yjnFHPs4je57iL7mMPMZmDTJtX5BrAwWyf/9oADAMBAAIAAwAAABB0Jr//xAAXEQEBAQEAAAAAAAAAAAAAAAABABFx/9oACAEDAQE/EDW5mjkABf/EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8QMnDdRR2//8QAIBABAAMAAgAHAAAAAAAAAAAAAQARITFBUWGBkaHB8P/aAAgBAQABPxDia9cyFPhALEZ4YGvvkQAAI8dsu4v5RaF/HUC2s5GD+MvRXmjfcIv5iGHnH1jgiVcaPPcOOwg1eYvnCEBT6QAIBqBRhwM//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Dead Space beenie\"\n        title=\"Dead Space beenie\"\n        src=\"/static/ab69ba0d7bcc1956e599f91a725c55b5/6c4e2/dead_space_beenie.jpg\"\n        srcset=\"/static/ab69ba0d7bcc1956e599f91a725c55b5/db830/dead_space_beenie.jpg 256w,\n/static/ab69ba0d7bcc1956e599f91a725c55b5/8102f/dead_space_beenie.jpg 512w,\n/static/ab69ba0d7bcc1956e599f91a725c55b5/6c4e2/dead_space_beenie.jpg 612w\"\n        sizes=\"(max-width: 612px) 100vw, 612px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Dead Space beenie</figcaption>\n  </figure></p>\n<p>The LACC is divided into two main areas where you can find booths from various companies, as well as several meeting rooms where companies often have VIP areas with closed presentations and demos. These two main areas are connected by a large open area that is open to the public and also full of activities, including exclusive games to play. It takes about 10 minutes to walk from one main area to the other, so it’s important to try to book appointments that are close to each other to avoid getting stuck in the middle of the open area.</p>\n<p>There is also a special room for media with computers and high-speed internet, allowing journalists to quickly edit and publish their articles and videos. Additionally, there is a “chill” room where we could relax and get a free lunch around noon.</p>\n<p>During our free time, we could explore and find interesting things to cover. Personally, I spent most of my free time at Nintendo’s booth, trying to play as many games as possible and collect as many souvenirs (also known as “swag”) as I could. One of the best things about E3 is the opportunity to receive a wide variety of free items, such as keychains, t-shirts, and action figures.</p>\n<h2 id=\"the-swags\" style=\"position:relative;\"><a href=\"#the-swags\" aria-label=\"the swags permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The swags</h2>\n<p>One of the most exciting aspects of E3 is collecting “swags”, or free souvenirs. Each company booth has its own unique swags and ways to obtain them, which change from year to year. At the Nintendo booth during my first E3, for example, we could earn a pin for each mini-game we played in Nintendo Land, with the goal of collecting them all (which I was able to do).</p>\n<p>Some swags required playing a game against other attendees and winning in order to obtain them, such as the 2014 Smash shirt - although I’m not very good at Smash, my friend Danilo from Hyrule Legends was able to secure one for me. Other swags could be obtained simply by asking, although they could also “sell out” quickly and need to be waited for the next day to obtain.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwAEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABzOS6uVHR/8QAGxAAAgIDAQAAAAAAAAAAAAAAAQIAAwQQERL/2gAIAQEAAQUCoStpagOsdOIynwTP/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAS/9oACAEDAQE/AZK//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bp//EABwQAAEEAwEAAAAAAAAAAAAAAAABAjFREBEhIv/aAAgBAQAGPwJXKR28bsd6IP/EABkQAAIDAQAAAAAAAAAAAAAAAAERACFBMf/aAAgBAQABPyEoK0UsgOgQVwpWqKOtvIWxiioJ3H//2gAMAwEAAgADAAAAEDT/AP/EABcRAAMBAAAAAAAAAAAAAAAAAAABEUH/2gAIAQMBAT8Q2SKf/8QAFxEBAAMAAAAAAAAAAAAAAAAAARARMf/aAAgBAgEBPxAGXH//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhQTFx0f/aAAgBAQABPxAwQkXUvi7ypHUXDcTuJ7BXcTIg9itRon7j2hs4Ehm1BoN+mf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Nintendo Land pins\"\n        title=\"Nintendo Land pins\"\n        src=\"/static/bcbc5e01cc243731110599099965072c/63217/nintendo_land_swags.jpg\"\n        srcset=\"/static/bcbc5e01cc243731110599099965072c/db830/nintendo_land_swags.jpg 256w,\n/static/bcbc5e01cc243731110599099965072c/8102f/nintendo_land_swags.jpg 512w,\n/static/bcbc5e01cc243731110599099965072c/63217/nintendo_land_swags.jpg 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Nintendo Land pins</figcaption>\n  </figure></p>\n<p>As a collector, I always appreciate receiving swags, but the ones that are most useful are the ones that can be worn. I wear a different E3 t-shirt almost every week, and my favorite is probably the Lego Dimensions t-shirt from 2015, which I was able to convince the booth staff to give me, even though it wasn’t technically a swag.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.734375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAUB/8QAFwEAAwEAAAAAAAAAAAAAAAAAAgMEAf/aAAwDAQACEAMQAAABzWojvrQAs1/PiwNq5O3lxKVd0Ts//8QAHRAAAQQCAwAAAAAAAAAAAAAAAgABAxIRIjEyM//aAAgBAQABBQLL5qSciZ6YI2qo4BILbGQGOyflRxkcb9lD4//EABYRAAMAAAAAAAAAAAAAAAAAAAARIP/aAAgBAwEBPwEU/wD/xAAZEQACAwEAAAAAAAAAAAAAAAAAAQIQEjH/2gAIAQIBAT8BNqnKNPp//8QAHRAAAgEEAwAAAAAAAAAAAAAAAAECEBEhMRIiYf/aAAgBAQAGPwKmzseibbyO+jArSsOkWuI6Rwf/xAAdEAACAgIDAQAAAAAAAAAAAAAAAREhMWFBUZGB/9oACAEBAAE/IU7K+yPf0jDstiVibSgUiViS8TsSrsDjfTJZUUYH9hMpCRyP6ElaWD//2gAMAwEAAgADAAAAEK8Aw3vf/8QAGBEBAQEBAQAAAAAAAAAAAAAAAQAxIRH/2gAIAQMBAT8QHl7Y5GbEZf/EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8QTsm5JsBRmHV//8QAHRABAAMAAwEBAQAAAAAAAAAAAQARITFBcVGBsf/aAAgBAQABPxAAW1lqSc6mrVhxjlxg1aV370WX7BVTSulnUGMuICuZfdbWgGy3J3INMk8nCrIWevyIBei/s0IIN1Nt3b8jeyggYwFv2m8s/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lego Dimensions t-shirt\"\n        title=\"Lego Dimensions t-shirt\"\n        src=\"/static/74aa085aa80943dabfc4ce90ce0cddea/63217/lego_dimensions_shirt.jpg\"\n        srcset=\"/static/74aa085aa80943dabfc4ce90ce0cddea/db830/lego_dimensions_shirt.jpg 256w,\n/static/74aa085aa80943dabfc4ce90ce0cddea/8102f/lego_dimensions_shirt.jpg 512w,\n/static/74aa085aa80943dabfc4ce90ce0cddea/63217/lego_dimensions_shirt.jpg 1024w,\n/static/74aa085aa80943dabfc4ce90ce0cddea/b37e7/lego_dimensions_shirt.jpg 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Lego Dimensions t-shirt</figcaption>\n  </figure></p>\n<p>I consider “ultimate swags” to be items that are not typically available as souvenirs, but somehow I manage to obtain them through persuasion or other means. For example, I attempted to get a water bottle meant for booth staff at E3 2012 but was unsuccessful. However, the following year, I was able to persuade the staff to give me a water bottle, which I was able to obtain.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABTKKVGJZLJ+yzGVOEkT//xAAbEAADAAMBAQAAAAAAAAAAAAABAgMEERIyIf/aAAgBAQABBQJkpqSl2tPT5Tlp4yOK1kHdjwYa6Y/beZeaUbv/xAAWEQADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQMBAT8BK//EABcRAAMBAAAAAAAAAAAAAAAAAAAQESL/2gAIAQIBAT8BplU//8QAHhAAAgIBBQEAAAAAAAAAAAAAAAERIRICEDFCYUH/2gAIAQEABj8C4cLw0xbTLWJguzH1ZLZLvwvl7Jk/R2f/xAAcEAEBAQADAAMAAAAAAAAAAAABEQAhMUFRYaH/2gAIAQEAAT8hEK1KvTKHeGajdPMxtPBXElA9S6ClnxvsLxjaQ91dCNwB2Pe5fuwQHDf/2gAMAwEAAgADAAAAECjFPf/EABgRAAIDAAAAAAAAAAAAAAAAAAABEBEx/9oACAEDAQE/EEWMj//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8QbUWNGUf/xAAdEAEAAwEAAwEBAAAAAAAAAAABABEhMUFRYZFx/9oACAEBAAE/EKpKSoe6r/Cc3+6WVpKcYHH9mtsEKAN38gxK3QV/D7caCUG25O7JaXDJpsb645CIHieIMg6cmRaMtB4sA9ZP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Booth staff water bottle\"\n        title=\"Booth staff water bottle\"\n        src=\"/static/72c94af053f2053c72db23db62ec96e3/63217/nintendo_staff_water_bottle.jpg\"\n        srcset=\"/static/72c94af053f2053c72db23db62ec96e3/db830/nintendo_staff_water_bottle.jpg 256w,\n/static/72c94af053f2053c72db23db62ec96e3/8102f/nintendo_staff_water_bottle.jpg 512w,\n/static/72c94af053f2053c72db23db62ec96e3/63217/nintendo_staff_water_bottle.jpg 1024w,\n/static/72c94af053f2053c72db23db62ec96e3/d58d1/nintendo_staff_water_bottle.jpg 1536w,\n/static/72c94af053f2053c72db23db62ec96e3/09658/nintendo_staff_water_bottle.jpg 2048w,\n/static/72c94af053f2053c72db23db62ec96e3/78fc5/nintendo_staff_water_bottle.jpg 2736w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Booth staff water bottle</figcaption>\n  </figure></p>\n<p>At the end of each day at E3, my friends and I would meet up for a nice dinner and discuss the swags we collected and how we obtained them, as well as the games we played and our overall experiences for the day.</p>\n<p>I typically leave my last day at E3 fairly open, allowing me to walk around and collect any remaining swags or replay my favorite games. Afterwards, we would gather all of our swags and game-related purchases for an epic group photo.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAv/aAAwDAQACEAMQAAABj0WEvNXLP//EABsQAQACAgMAAAAAAAAAAAAAAAIAAQMREiEy/9oACAEBAAEFAsQWkJ2Ziauhd8n6/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AcR//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQACEf/aAAgBAgEBPwF1PBv/xAAbEAACAgMBAAAAAAAAAAAAAAAAMQERAhAhUf/aAAgBAQAGPwJMpeFZM7JOv//EABoQAQACAwEAAAAAAAAAAAAAAAEAIRExkWH/2gAIAQEAAT8hWR4RANzSYGRqeTI8jN6lnb2f/9oADAMBAAIAAwAAABBAL//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8QWSmqf//EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPxCA8DP/xAAbEAEBAAIDAQAAAAAAAAAAAAABEQAhMXGhYf/aAAgBAQABPxDaAXLSE8xktcDnrzG4TxCvcQtpK9mKVphtPuHd06NjP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"E3 2017 swags\"\n        title=\"E3 2017 swags\"\n        src=\"/static/cde3a8668d9d6f594f53d323de0fcdf3/63217/e3_swags_2017.jpg\"\n        srcset=\"/static/cde3a8668d9d6f594f53d323de0fcdf3/db830/e3_swags_2017.jpg 256w,\n/static/cde3a8668d9d6f594f53d323de0fcdf3/8102f/e3_swags_2017.jpg 512w,\n/static/cde3a8668d9d6f594f53d323de0fcdf3/63217/e3_swags_2017.jpg 1024w,\n/static/cde3a8668d9d6f594f53d323de0fcdf3/33266/e3_swags_2017.jpg 1440w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">E3 2017 swags</figcaption>\n  </figure></p>\n<h2 id=\"the-food\" style=\"position:relative;\"><a href=\"#the-food\" aria-label=\"the food permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The food</h2>\n<p>There are several options for obtaining food at E3. Media professionals can get a decent lunch for free in the press room, while others can purchase overpriced food at the various cafeterias within the convention center.</p>\n<p>If I’m lucky, I don’t even have to stop to eat because some company booths offer snacks while you play their games - this was often my main meal during E3. Why would I stop to eat when I could just power through and play games at the largest gaming convention in the world?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFCgngNYiBP/8QAHBAAAQQDAQAAAAAAAAAAAAAAAgABAxMREiEi/9oACAEBAAEFAo8M4nzdTB5uVpr/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAEDAQE/AVNIf//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAECAQE/AVf/xAAdEAEAAgAHAAAAAAAAAAAAAAABABEQEjFBUWGx/9oACAEBAAY/Akun2G/PWGYjYLNZ/8QAHhAAAgIABwAAAAAAAAAAAAAAAAERQSExUYGRofD/2gAIAQEAAT8hZoZFJxyNlW7EJE6pZjd4sXEHqj//2gAMAwEAAgADAAAAEKc//8QAGBEAAwEBAAAAAAAAAAAAAAAAAAEhEVH/2gAIAQMBAT8QVpBjp//EABcRAAMBAAAAAAAAAAAAAAAAAAEQEUH/2gAIAQIBAT8QNxP/xAAbEAEAAwADAQAAAAAAAAAAAAABABEhMUFR0f/aAAgBAQABPxBwyOJivWHMQDGFbRzDYMxrWooVGY9DuDrmEjAZwdSv6DP/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CD Projekt Red booth snacks\"\n        title=\"CD Projekt Red booth snacks\"\n        src=\"/static/1fa57646e94beba38a37da61486bffb9/63217/e3_booth_food.jpg\"\n        srcset=\"/static/1fa57646e94beba38a37da61486bffb9/db830/e3_booth_food.jpg 256w,\n/static/1fa57646e94beba38a37da61486bffb9/8102f/e3_booth_food.jpg 512w,\n/static/1fa57646e94beba38a37da61486bffb9/63217/e3_booth_food.jpg 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">CD Projekt Red booth snacks</figcaption>\n  </figure></p>\n<h2 id=\"meeting-your-heroes\" style=\"position:relative;\"><a href=\"#meeting-your-heroes\" aria-label=\"meeting your heroes permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Meeting your heroes</h2>\n<p>One of the best things about E3 is the possibility of meeting the people who create the games you love. If you’re media, you might be able to book an interview or assisted hands-on session with them.</p>\n<p>Alternatively, you might simply stumble upon them while walking around the convention. This is how I met Hideo Kojima, and I even managed to get an autograph from Shigeru Miyamoto after running into him returning from the bathroom. (I apologize for the awkward encounter, Miyamoto! 😅).</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwH/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAP/2gAMAwEAAhADEAAAAd5FQLpCFvRFrvjmMV//xAAbEAACAgMBAAAAAAAAAAAAAAABAgASAwQQM//aAAgBAQABBQKq5Ay1aazhJmYsbHg84O//xAAYEQACAwAAAAAAAAAAAAAAAAAAARAREv/aAAgBAwEBPwFOjc//xAAYEQACAwAAAAAAAAAAAAAAAAAAEgEQEf/aAAgBAgEBPwFdEm//xAAbEAACAwADAAAAAAAAAAAAAAABAgAQESBBUf/aAAgBAQAGPwLU7mE1jEgRmG5PKbj/AP/EAB4QAQACAQUBAQAAAAAAAAAAAAEAESExQVFhcYGx/9oACAEBAAE/ITKli/kvCXsbnsErWWHHBxA77Jwvghm0o6lKxV1/ImY4aSp//9oADAMBAAIAAwAAABD8+sz/xAAZEQACAwEAAAAAAAAAAAAAAAAAEQEQIVH/2gAIAQMBAT8QSF4Tlf/EABkRAAMAAwAAAAAAAAAAAAAAAAABESFBUf/aAAgBAgEBPxDI9D6CVRD/xAAeEAEAAgICAwEAAAAAAAAAAAABABEhMUFhUXHBgf/aAAgBAQABPxA0F1gWdo9poIFaNu7iQiTze4fVhKr8i32ziymeCsHyA8D4VHTOCu3RHhk3Kqixn9liXca9zJXEPE//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Me and Kojima\"\n        title=\"Me and Kojima\"\n        src=\"/static/a303cab53d35091c02dfabe70b84abec/63217/me_and_kojima.jpg\"\n        srcset=\"/static/a303cab53d35091c02dfabe70b84abec/db830/me_and_kojima.jpg 256w,\n/static/a303cab53d35091c02dfabe70b84abec/8102f/me_and_kojima.jpg 512w,\n/static/a303cab53d35091c02dfabe70b84abec/63217/me_and_kojima.jpg 1024w,\n/static/a303cab53d35091c02dfabe70b84abec/d58d1/me_and_kojima.jpg 1536w,\n/static/a303cab53d35091c02dfabe70b84abec/09658/me_and_kojima.jpg 2048w,\n/static/a303cab53d35091c02dfabe70b84abec/b6833/me_and_kojima.jpg 3672w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Me and Kojima</figcaption>\n  </figure></p>\n<p>An unconventional way to meet game developers is to wait at the entrance of the Convention Center early in the morning and wait for them to pass by on their way into the event.</p>\n<p>While they are often accompanied by security guards and may not have much time due to their busy schedules, there are occasionally moments when they are able to take a moment to interact with fans. This is how I was able to meet Miyamoto and get my 3DS Zelda Edition signed by him, which is now my most prized possession in my collection.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABY4SqUYFw/8QAGxABAQABBQAAAAAAAAAAAAAAAQIABBITIzL/2gAIAQEAAQUCdUVB55ayRp297Fw//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAAMAAwEAAAAAAAAAAAAAAAABEQIhkaH/2gAIAQEABj8CnozV6KCjtRHif//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExYVH/2gAIAQEAAT8hYaqVDxl79lngYxSGWfJ1qGzUQGs7P//aAAwDAQACAAMAAAAQzz//xAAXEQADAQAAAAAAAAAAAAAAAAAAASEx/9oACAEDAQE/EGmEP//EABYRAQEBAAAAAAAAAAAAAAAAAAEQYf/aAAgBAgEBPxBxn//EABsQAQEAAwEBAQAAAAAAAAAAAAERACExcWGB/9oACAEBAAE/EDqVtk38wVZIEZIgnPt7nIV1ML+O/cI4Ryp7g0HGtFhT0HEBmWhjW5//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Me and Miyamoto\"\n        title=\"Me and Miyamoto\"\n        src=\"/static/a128a6cbf2e50686858bbbd3aaf528ce/63217/me_and_miyamoto.jpg\"\n        srcset=\"/static/a128a6cbf2e50686858bbbd3aaf528ce/db830/me_and_miyamoto.jpg 256w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/8102f/me_and_miyamoto.jpg 512w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/63217/me_and_miyamoto.jpg 1024w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/d58d1/me_and_miyamoto.jpg 1536w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/09658/me_and_miyamoto.jpg 2048w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/08826/me_and_miyamoto.jpg 3264w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Me and Miyamoto</figcaption>\n  </figure></p>\n<p>After I shared my story of obtaining an autograph from Miyamoto with friends, they decided to try the same thing and were able to get autographs as well. Excited about their success, they told their own friends about the method, leading to a large group of Brazilians who didn’t even know each other waiting at the event entrance in hopes of getting photos and autographs from their heroes.</p>\n<p>This became a popular way for fans to meet their idols at E3, with a growing group of people waiting at the entrance each year.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 820px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.828125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADnklEQVQozwGTA2z8AP////7+/vf39f3+/f///8LTzqO5rmKFc5eipK+w14CDaNbIOYipo06EaJKrn8PC0c3O1drb6Pb28////wD///+5usN3eKfNyqHDvqAudkN7l4w4hlsbTVJLQ8ptam3eyTxginwJdkFkkX9eW8BVW7PDv3nLxVf09v8A////xsLYLj2imJw2v7MFJXAtF19RJW5HIHNDJk6EVH1if6QgNm9BIXJKVIZtREu0rqy+5NoXy8aE////AP///4OymxIuVEZ7N1u1KBaORVylIpCeD5aXEVeWNjmxUwenTRWiRiCfQhmhPxybTFiiRKmgEF6aXbjSwgDC4cwem0BAYzcTn01WtTnC0hablD6KXj+1cEq+iV2knlxZmSk1skQVr1IctFEfukwglkRUYEEyYitjoXEAUrlwHJM8aGhOqsEg//8AlZNMFRqpq5Fnsn9YnWdLVCohai8Xz8gJm8scSK04Iq5IKqlKdG9KHpI8ltGpACOnTi+VObGdLMqUOfPsAEtRh0ZIqbOhZoZmRHg+L3k1KKyaa9rTJP/5AP/xALTLC3p4RmqETBitSdPg1AAZlT4jo0ilxxXKnC/CpSCUmoN4dKiPWjZ7RzWRZkSlk1pzdFy1sDX//gDj6gOKlDaWbU4PljdSr29tZGUAd62GF6lHNaVXlrAfu4gxvak4PEaBY0Rrdk4wb29GTk4vBwkLdHJK0L4MZrkqbHdQboldi5V5PEowCgkLAPj5+JSvlpq8nhCYQXuXMb+DO8K2JX12VV06LwAAAAkIBm9hQXdJMFF1IHV5TGZiN4WFWuGNkp5mR1w/LQCflIlVMCRYTT5CnFgTsDp1kTywb0jMthmZbTZtQzZzUDhrNyg2UyZVfkJMajNvKB+SQTGPVjepakjGh4AAs6ahXkM6dl1P7/TtUa90GqVJXnkvo2ZEsnZQomlLm2BFel0+Z2Y4cIlje7+VuMScdEQ8rINlnW1UmFtGAMzFwjgeEwEAAGlrbbyrl5aljXLAh2yFNZ5nSYteRalvUHtVOneeedjw4////9fc1DFBNURLNWBhSlVJNgDa19SflIsxJR8FAQBmRETh1tf////U5eGie160c1C4elinb0zNubH////LraxzGxt6TD9VPjIyKiFNMiQA////2NHMcFhJ39rX7u3s/////Pz7////u5V/tXFMu31avn1aq2hEwqaV9vT2kjtCjCcimUk7jD0xnmBFH7i1SJv1hZIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Hue Hue BR\"\n        title=\"Hue Hue BR\"\n        src=\"/static/64fd508b9c457acf6fdb28cacade5271/0bbcd/hue_hue_br.png\"\n        srcset=\"/static/64fd508b9c457acf6fdb28cacade5271/e3135/hue_hue_br.png 256w,\n/static/64fd508b9c457acf6fdb28cacade5271/06341/hue_hue_br.png 512w,\n/static/64fd508b9c457acf6fdb28cacade5271/0bbcd/hue_hue_br.png 820w\"\n        sizes=\"(max-width: 820px) 100vw, 820px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Hue Hue BR</figcaption>\n  </figure></p>\n<p>However, once E3 became open to the public, famous people and staff began using a different entrance, rendering this “trick” ineffective. Despite this change, the memories and experiences of meeting beloved game developers will always remain with those lucky enough to have had the opportunity.</p>\n<h2 id=\"after-parties\" style=\"position:relative;\"><a href=\"#after-parties\" aria-label=\"after parties permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>After parties</h2>\n<p>During my time at E3, my days were filled with waking up at the crack of dawn and heading over to the convention center. I made sure to get there early to avoid long lines and make the most of my time there. I spent the majority of my day playing games and exploring all that the convention had to offer. It wasn’t uncommon for me to be there until the event ended for the day at 6:00 PM. By that point, I was usually pretty exhausted.</p>\n<p>But the fun didn’t stop there. After a long day at E3, I would often meet up with my friends and gather my gear before heading out to explore the vibrant nightlife of LA. There was always a party happening somewhere, and I was always game to join in on the fun. Some of these parties were exclusive to media professionals, while others were open to any game enthusiast in the area. Some were paid events, while others were free. Some offered free food and drinks, while others had swag to give away. No matter what type of party it was, there was always something for everyone to enjoy.</p>\n<p>The best part of these parties, for me, was getting the chance to meet new people and hang out with my friends. We would spend hours talking about the day’s events and getting hyped about all the new releases that were coming that year. It was a great way to unwind after a long day at E3 and make some lasting memories with like-minded individuals.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.796875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgME/9oADAMBAAIQAxAAAAHOkti/OFQaP//EABsQAQACAgMAAAAAAAAAAAAAAAIBAwAEERIU/9oACAEBAAEFAgEzBtcZS+mvVHpq5z//xAAYEQACAwAAAAAAAAAAAAAAAAAAAQIDEv/aAAgBAwEBPwF2NSNn/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAECAQE/AZiP/8QAHBABAAICAwEAAAAAAAAAAAAAAQIRAAMQIjEy/9oACAEBAAY/AlDzHp48bZVdVkdklGK/PH//xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhMXGx/9oACAEBAAE/Ibu/okD8MUhXXKZto8fpzGVaU0f/2gAMAwEAAgADAAAAEBj/AP/EABYRAAMAAAAAAAAAAAAAAAAAAAEQUf/aAAgBAwEBPxA8if/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EAsP/8QAHRAAAgIDAAMAAAAAAAAAAAAAAREAITFBUWFxgf/aAAgBAQABPxATegrZbC6VX2GQR5nAZCOxGaAq05WnGGKfoX5jN7jZzecjkLGs9Ln/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PC Game Show party\"\n        title=\"PC Game Show party\"\n        src=\"/static/9b7cb544792f5e0a25356d10bd77cf9c/63217/pc_game_show_party.jpg\"\n        srcset=\"/static/9b7cb544792f5e0a25356d10bd77cf9c/db830/pc_game_show_party.jpg 256w,\n/static/9b7cb544792f5e0a25356d10bd77cf9c/8102f/pc_game_show_party.jpg 512w,\n/static/9b7cb544792f5e0a25356d10bd77cf9c/63217/pc_game_show_party.jpg 1024w,\n/static/9b7cb544792f5e0a25356d10bd77cf9c/d58d1/pc_game_show_party.jpg 1536w,\n/static/9b7cb544792f5e0a25356d10bd77cf9c/97b1a/pc_game_show_party.jpg 1576w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">PC Game Show party</figcaption>\n  </figure></p>\n<h2 id=\"post-e3\" style=\"position:relative;\"><a href=\"#post-e3\" aria-label=\"post e3 permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Post E3</h2>\n<p>During my first trip to E3, we barely had time to explore all the other things Los Angeles had to offer - like walking around Santa Monica pier, visiting retro gaming stores like Game Dude, and checking out Universal Studios, the Hollywood Walk of Fame, and the Hollywood Sign. We were only there for a week, which was just enough time to attend the conferences and the main event, and have an extra day for shopping.</p>\n<p>On all my subsequent trips to E3, I made sure to stay for at least two weeks. That gave us plenty of time to fully experience E3, as well as explore all the other things LA has to offer. After the event was over, my friends and I always had a whole week to do things like hunt for game deals, eat as much junk food as we could, and do all the other touristy things. One time, we even took a weekend trip to Las Vegas - it was amazing!</p>\n<h2 id=\"going-back-home\" style=\"position:relative;\"><a href=\"#going-back-home\" aria-label=\"going back home permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Going back home</h2>\n<p>Saying goodbye to E3 was always the saddest moment of the trip, especially during my first year when I was not only saying goodbye to the event, but also to my first trip to LA, which had been an unforgettable experience.</p>\n<p>Returning home was always a bit bittersweet, but at least I knew I would have the opportunity to come back to LA again the following year. At least, that’s what I thought until 2019 😅.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAZc5zElsVKj/xAAZEAEBAQEBAQAAAAAAAAAAAAACAQADEhP/2gAIAQEAAQUCXRSlpGrpu59aKfGq7//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEv/aAAgBAwEBPwGSv//EABYRAQEBAAAAAAAAAAAAAAAAAAEDEP/aAAgBAgEBPwEoZ//EABwQAAEEAwEAAAAAAAAAAAAAAAABESGRAjEyof/aAAgBAQAGPwIjFLOUshRpc34f/8QAHBABAAIBBQAAAAAAAAAAAAAAAQARMVGBkaHR/9oACAEBAAE/ISqcRo7yfAwNbBWrmQUBTekS49J//9oADAMBAAIAAwAAABCsz//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPxCrX//EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQIBAT8Q6Rsb/8QAHhABAQABBAMBAAAAAAAAAAAAAREAITFBcVGx0eH/2gAIAQEAAT8QtS7KuNDkMimIE/HBJJTTVxs8vmEPB1iB2RGye8LNyEn0z//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"See you at E3 2020\"\n        title=\"See you at E3 2020\"\n        src=\"/static/33c1a52743b117b1d6186b1c79d76504/63217/e3_see_you_next_year.jpg\"\n        srcset=\"/static/33c1a52743b117b1d6186b1c79d76504/db830/e3_see_you_next_year.jpg 256w,\n/static/33c1a52743b117b1d6186b1c79d76504/8102f/e3_see_you_next_year.jpg 512w,\n/static/33c1a52743b117b1d6186b1c79d76504/63217/e3_see_you_next_year.jpg 1024w,\n/static/33c1a52743b117b1d6186b1c79d76504/d58d1/e3_see_you_next_year.jpg 1536w,\n/static/33c1a52743b117b1d6186b1c79d76504/09658/e3_see_you_next_year.jpg 2048w,\n/static/33c1a52743b117b1d6186b1c79d76504/e7f75/e3_see_you_next_year.jpg 2592w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">See you at E3 2020</figcaption>\n  </figure></p>\n<p><a href=\"https://www.theverge.com/2020/3/11/21163570/e3-canceled-coronavirus-outbreak-xbox-nintendo\" target=\"_blank\" rel=\"noreferrer\">Yeah…</a></p>\n<h2 id=\"is-e3-still-relevant\" style=\"position:relative;\"><a href=\"#is-e3-still-relevant\" aria-label=\"is e3 still relevant permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Is E3 still relevant?</h2>\n<p>This is a controversial question, but I believe we need E3 to return. The truth is that E3 was already struggling prior to the pandemic, and the pandemic was the final blow that ended the event. E3 could not survive as a media-only event, as it no longer made financial sense for news companies to send journalists to Los Angeles to cover the event when everything could be easily shown on YouTube.</p>\n<p>When E3 opened to the public in 2017, the event was not prepared for such a large audience and it resulted in extremely long lines - for example, there were reportedly 5 hours of wait time to watch the presentation of Cyberpunk 2077, in addition to long lines just to enter the event. The Electronic Software Association (ESA), which organizes E3, was also facing challenges before E3 2020 was canceled, as Geoff Keighley had already announced he would not be attending the event that year.</p>\n<p>While it may seem like there’s no need for E3 anymore, as conferences can be held online and game demos can be made available for everyone to play, there is one thing that cannot be fully replicated in the digital world: the hype. E3 is a great tool for creating buzz and increasing hype around game releases, as all gaming enthusiasts are paying attention to everything that happens at the event. It’s practically a week when all of our gamer dreams come true, as we get to look forward to what’s coming in the next year. It’s like Christmas, but better.</p>\n<p>Without E3, we don’t know what to expect from the gaming industry in the year. This is why even without E3, many companies still used the E3 time frame to announce their new games in 2020, but it’s just not the same without the big in-person event. Plus, there’s something special about being able to physically be at the event and see everything in person. It adds to the excitement and creates a more immersive experience.</p>\n<p>For example, there are still movie trailers shown at Comic-Con. Why do they show trailers at Comic-Con weeks before they are released on YouTube? It’s because this creates anticipation and excitement for finally seeing the trailers, as we know others have already seen it and are reading reactions and comments about it. E3 is the same way, but for games. I attended Gamescom in 2019 and it was a great event, but many of the games that were there had already been announced and the closed presentations were similar to those at E3. Despite being an event that is up to three times larger than E3, it doesn’t create the same level of hype.</p>\n<h2 id=\"what-now\" style=\"position:relative;\"><a href=\"#what-now\" aria-label=\"what now permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What now?</h2>\n<p>It’s still uncertain if E3 2023 will happen or not, but with the pandemic hopefully coming to an end in the near future, there’s a good chance that the Electronic Software Association (ESA) will be able to bring E3 back next year. If that happens, count me in! I always look forward to attending E3, as it’s not only an opportunity for me to play amazing games and meet new people, but it’s also a chance for me to have an awesome trip with my friends. It can be difficult for us to all get together, since we have busy schedules and live in different countries.</p>\n<p>E3 is such a special event for the gaming community, and it’s a shame that it had to be canceled in 2020 and 2021 due to the pandemic. But I have high hopes that it will return in 2023, and I can’t wait to experience all the excitement and hype that comes with it. From the big game announcements to the hands-on demos, there’s just nothing like being at E3 in person.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHmWjUMyX//xAAaEAEBAQADAQAAAAAAAAAAAAABAgADESEx/9oACAEBAAEFAg9IFJlytbj6nP3/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFH/8QAHBAAAQQDAQAAAAAAAAAAAAAAEQABAhADISJB/9oACAEBAAY/AmKDS8W8grqJr//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExUXH/2gAIAQEAAT8hoAJfsBarOvIHfx1ExvhRAi8ObDSn/9oADAMBAAIAAwAAABBY/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxCq/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EMU//8QAHBABAQADAAMBAAAAAAAAAAAAAREAITFhceHw/9oACAEBAAE/EGA7cUlL2esKCNPOL8yQi8jiGggXn6YF1KFpFxQMN2HDP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Team Nintendo Blast\"\n        title=\"Team Nintendo Blast\"\n        src=\"/static/98cc107e7213fa6b104251307e7d5c8a/63217/nintendo_blast_crew.jpg\"\n        srcset=\"/static/98cc107e7213fa6b104251307e7d5c8a/db830/nintendo_blast_crew.jpg 256w,\n/static/98cc107e7213fa6b104251307e7d5c8a/8102f/nintendo_blast_crew.jpg 512w,\n/static/98cc107e7213fa6b104251307e7d5c8a/63217/nintendo_blast_crew.jpg 1024w,\n/static/98cc107e7213fa6b104251307e7d5c8a/d58d1/nintendo_blast_crew.jpg 1536w,\n/static/98cc107e7213fa6b104251307e7d5c8a/09658/nintendo_blast_crew.jpg 2048w,\n/static/98cc107e7213fa6b104251307e7d5c8a/49580/nintendo_blast_crew.jpg 3648w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Team Nintendo Blast</figcaption>\n  </figure></p>\n<p>Let’s hope for an E3 come back in 2023 and see you there!</p>","fields":{"postHashId":"Z2FtZXN0cnVlbnVsbDIwMjItMDYtMDFUMDA6MDA6MDAuMDAwWg==","slug":"/2022/2022-06-01-10-years-anniversary-of-my-first-e3.en/","path":"/blog/games/10-years-anniversary-of-my-first-e3/","locale":"en"},"rawMarkdownBody":"I still remember the first time I planned to go to E3 with some friends, back in 2009. It felt like a distant dream, just the idea of going to E3 was already exciting enough. At the time, I didn't even realize that E3 was an event for media press only and that I wouldn't be able to just buy a ticket and attend. Of course, I eventually did get to go to E3, but how?\r\n\r\nAs a huge fan of video games, especially Nintendo games, I applied to be an editor for Nintendo Blast, the biggest Brazilian blog about Nintendo. I was accepted and started writing blog posts and making videos for their YouTube channel. A few years later, I received an email from one of the blog managers saying they were looking for people to travel to Los Angeles to cover E3. I was over the moon and applied right away.\r\n\r\nSince Nintendo Blast was a voluntary work, I had to pay for my own trip, but they would offer me something money couldn't buy: a media badge.\r\n\r\nI had to go through the process of getting a visa to enter the US, which was quite bureaucratic, but fortunately, my visa was approved. The hotel and tickets were booked and our media badges were issued, and all I had to do was wait for the day of the trip. I was so excited that I had trouble sleeping for months.\r\n\r\n## First time in Los Angeles\r\nAttending E3 had an unexpected side effect: I fell in love with Los Angeles. It's cliché, I know, but LA is not only the home of E3, but also the home of many famous skate spots that I had seen in skate videos my whole life. Being able to visit these spots in person was very emotional for me, and I even bought a Plan B deck while I was there. Downtown LA is practically filled with famous skate spots from 90s skate parts.\r\n\r\nThis was also my first time in the US, so I experienced many new things, like extra-large meals at McDonald's, shopping at Target, receiving massive receipts from CVS, going to a GameStop, buying Old Spice products, going to White Castle, and, as a Forest Gump fan, finally visiting a Bubba Gump restaurant.\r\n\r\nWe were a group of seven young video game enthusiasts, ready to cover the biggest video game event in the world. We had lots of things we wanted to do in LA, but we had no time to waste as E3 was starting just two days after we arrived.\r\n\r\n## A little help from the veterans\r\nDespite being a small team, we were fortunate enough to be staying at the same hotel as several veteran editors from Nintendo World, the official Nintendo magazine in Brazil. As someone who has been a fan of Nintendo World since childhood, it was a surreal experience to be there with these legends.\r\n\r\nIn fact, some of us were even given the opportunity to write a guest article for the magazine - although unfortunately, I was not selected. Nevertheless, just being considered for the opportunity was one of the greatest achievements of my life so far.\r\n\r\n![Nintendo World #159](../../uploads/blog/2022/06/nintendo_world_159.jpg)\r\n\r\nIn addition, we participated in several meetings on how to make the most of our time at E3, which proved to be extremely valuable and have proven useful at every E3 I've attended since then.\r\n\r\n## Wait, when does E3 starts?\r\nEvery E3, I would see articles stating when the event was supposed to start, only to have the Sony, Microsoft, and Nintendo conferences happen a few days earlier.\r\n\r\nThese conferences, while not technically part of E3, are still closely associated with the event. E3, organized by the Entertainment Software Association (ESA), is a trade show where gaming companies can showcase their products and new game releases to media and traders.\r\n\r\nDuring this time, the entire gaming industry is focused on E3, leading major companies to schedule press conferences a few days beforehand to give attendees an idea of what to expect at the event.\r\n\r\nHowever, for those of us watching from home, it can be confusing as E3 seems to begin with the start of the conferences and end after the final conference.\r\n\r\nI remember being surprised when I was told that the Sony conference was being held at a location far from the Los Angeles Convention Center (LACC), as I had assumed all conferences were held at the LACC as part of E3. It was a shock to me, and in the years since, I've noticed that many other E3 attendees have had similar confusion.\r\n\r\n## The conferences\r\nTypically, access to the highly sought-after E3 conferences requires an invitation. However, many media professionals still make the journey to the conference location in the hope of securing a last-minute spot. In my experience, I have always been able to attend the conferences, even if it meant making phone calls and reaching out to PR professionals to try and secure a spot. On one occasion, I didn't even try to attend a conference, only to later learn that it was the last year that Nintendo held a traditional E3 conference.\r\n\r\nThe conferences are typically scheduled at specific times and locations to allow attendees to move from one to the next. A typical conference day might include a Microsoft conference in the morning, followed by Ubisoft, a lunch break, and finally, Sony. There are even special buses that provide transportation between the conferences for free - I'm not sure where these buses come from, but they are incredibly helpful.\r\n\r\nMany conferences also provide attendees with souvenirs such as pins, t-shirts, and action figures. These items can often be found for sale on eBay for hundreds of dollars later the same day. Personally, I have kept all of the souvenirs I have received and still wear at least one E3 t-shirt every week.\r\n\r\nThe locations of the conferences are always iconic places in Los Angeles, such as the Dolby Theater on Hollywood Boulevard where the Bethesda conferences were held in 2015, or the LA Memorial Sports Arena and Galen Center, where Sony and Microsoft conferences are typically held.\r\n\r\n## The Event\r\nE3 typically takes place over the course of three days, from Tuesday to Thursday. However, if you want to see everything, three days is not enough. Attending the event is an incredible experience, but it's easy to miss out on a lot of things due to the sheer size of the Los Angeles Convention Center (LACC) and the time it takes to walk from booth to booth.\r\n\r\nTo make the most of our time at E3, our team split up into smaller groups and booked slots for hands-on demos, interviews, and presentations with various publishers in advance. This allowed us to skip the long lines and go straight to the hands-on experiences. As I mentioned before, three days is not a lot of time to see everything, so it's important to try to avoid wasting time waiting in lines.\r\n\r\nDuring my first year at E3, I was a bit lost and wasn't sure what to do, but I still managed to play a lot of games for the Wii U and PS3, including ZombiU, Nintendo Land, LittleBigPlanet Karting, and PlayStation All-Stars Battle Royale. My favorite game from that year, however, was not playable - Dead Space 3. That's when I became a fan of the series and received a nice beanie, which I still have to this day.\r\n\r\n![Dead Space beenie](../../uploads/blog/2022/06/dead_space_beenie.jpg)\r\n\r\nThe LACC is divided into two main areas where you can find booths from various companies, as well as several meeting rooms where companies often have VIP areas with closed presentations and demos. These two main areas are connected by a large open area that is open to the public and also full of activities, including exclusive games to play. It takes about 10 minutes to walk from one main area to the other, so it's important to try to book appointments that are close to each other to avoid getting stuck in the middle of the open area.\r\n\r\nThere is also a special room for media with computers and high-speed internet, allowing journalists to quickly edit and publish their articles and videos. Additionally, there is a \"chill\" room where we could relax and get a free lunch around noon.\r\n\r\nDuring our free time, we could explore and find interesting things to cover. Personally, I spent most of my free time at Nintendo's booth, trying to play as many games as possible and collect as many souvenirs (also known as \"swag\") as I could. One of the best things about E3 is the opportunity to receive a wide variety of free items, such as keychains, t-shirts, and action figures.\r\n\r\n## The swags\r\nOne of the most exciting aspects of E3 is collecting \"swags\", or free souvenirs. Each company booth has its own unique swags and ways to obtain them, which change from year to year. At the Nintendo booth during my first E3, for example, we could earn a pin for each mini-game we played in Nintendo Land, with the goal of collecting them all (which I was able to do).\r\n\r\nSome swags required playing a game against other attendees and winning in order to obtain them, such as the 2014 Smash shirt - although I'm not very good at Smash, my friend Danilo from Hyrule Legends was able to secure one for me. Other swags could be obtained simply by asking, although they could also \"sell out\" quickly and need to be waited for the next day to obtain.\r\n\r\n![Nintendo Land pins](../../uploads/blog/2022/06/nintendo_land_swags.jpg)\r\n\r\nAs a collector, I always appreciate receiving swags, but the ones that are most useful are the ones that can be worn. I wear a different E3 t-shirt almost every week, and my favorite is probably the Lego Dimensions t-shirt from 2015, which I was able to convince the booth staff to give me, even though it wasn't technically a swag.\r\n\r\n![Lego Dimensions t-shirt](../../uploads/blog/2022/06/lego_dimensions_shirt.jpg)\r\n\r\nI consider \"ultimate swags\" to be items that are not typically available as souvenirs, but somehow I manage to obtain them through persuasion or other means. For example, I attempted to get a water bottle meant for booth staff at E3 2012 but was unsuccessful. However, the following year, I was able to persuade the staff to give me a water bottle, which I was able to obtain.\r\n\r\n![Booth staff water bottle](../../uploads/blog/2022/06/nintendo_staff_water_bottle.jpg)\r\n\r\nAt the end of each day at E3, my friends and I would meet up for a nice dinner and discuss the swags we collected and how we obtained them, as well as the games we played and our overall experiences for the day.\r\n\r\nI typically leave my last day at E3 fairly open, allowing me to walk around and collect any remaining swags or replay my favorite games. Afterwards, we would gather all of our swags and game-related purchases for an epic group photo.\r\n\r\n![E3 2017 swags](../../uploads/blog/2022/06/e3_swags_2017.jpg)\r\n\r\n## The food\r\nThere are several options for obtaining food at E3. Media professionals can get a decent lunch for free in the press room, while others can purchase overpriced food at the various cafeterias within the convention center.\r\n\r\nIf I'm lucky, I don't even have to stop to eat because some company booths offer snacks while you play their games - this was often my main meal during E3. Why would I stop to eat when I could just power through and play games at the largest gaming convention in the world?\r\n\r\n![CD Projekt Red booth snacks](../../uploads/blog/2022/06/e3_booth_food.jpg)\r\n\r\n## Meeting your heroes\r\nOne of the best things about E3 is the possibility of meeting the people who create the games you love. If you're media, you might be able to book an interview or assisted hands-on session with them.\r\n\r\nAlternatively, you might simply stumble upon them while walking around the convention. This is how I met Hideo Kojima, and I even managed to get an autograph from Shigeru Miyamoto after running into him returning from the bathroom. (I apologize for the awkward encounter, Miyamoto! 😅).\r\n\r\n![Me and Kojima](../../uploads/blog/2022/06/me_and_kojima.jpg)\r\n\r\nAn unconventional way to meet game developers is to wait at the entrance of the Convention Center early in the morning and wait for them to pass by on their way into the event.\r\n\r\nWhile they are often accompanied by security guards and may not have much time due to their busy schedules, there are occasionally moments when they are able to take a moment to interact with fans. This is how I was able to meet Miyamoto and get my 3DS Zelda Edition signed by him, which is now my most prized possession in my collection.\r\n\r\n![Me and Miyamoto](../../uploads/blog/2022/06/me_and_miyamoto.jpg)\r\n\r\nAfter I shared my story of obtaining an autograph from Miyamoto with friends, they decided to try the same thing and were able to get autographs as well. Excited about their success, they told their own friends about the method, leading to a large group of Brazilians who didn't even know each other waiting at the event entrance in hopes of getting photos and autographs from their heroes.\r\n\r\nThis became a popular way for fans to meet their idols at E3, with a growing group of people waiting at the entrance each year.\r\n\r\n![Hue Hue BR](../../uploads/blog/2022/06/hue_hue_br.png)\r\n\r\nHowever, once E3 became open to the public, famous people and staff began using a different entrance, rendering this \"trick\" ineffective. Despite this change, the memories and experiences of meeting beloved game developers will always remain with those lucky enough to have had the opportunity.\r\n\r\n## After parties\r\nDuring my time at E3, my days were filled with waking up at the crack of dawn and heading over to the convention center. I made sure to get there early to avoid long lines and make the most of my time there. I spent the majority of my day playing games and exploring all that the convention had to offer. It wasn't uncommon for me to be there until the event ended for the day at 6:00 PM. By that point, I was usually pretty exhausted.\r\n\r\nBut the fun didn't stop there. After a long day at E3, I would often meet up with my friends and gather my gear before heading out to explore the vibrant nightlife of LA. There was always a party happening somewhere, and I was always game to join in on the fun. Some of these parties were exclusive to media professionals, while others were open to any game enthusiast in the area. Some were paid events, while others were free. Some offered free food and drinks, while others had swag to give away. No matter what type of party it was, there was always something for everyone to enjoy.\r\n\r\nThe best part of these parties, for me, was getting the chance to meet new people and hang out with my friends. We would spend hours talking about the day's events and getting hyped about all the new releases that were coming that year. It was a great way to unwind after a long day at E3 and make some lasting memories with like-minded individuals.\r\n\r\n![PC Game Show party](../../uploads/blog/2022/06/pc_game_show_party.jpg)\r\n\r\n## Post E3\r\nDuring my first trip to E3, we barely had time to explore all the other things Los Angeles had to offer - like walking around Santa Monica pier, visiting retro gaming stores like Game Dude, and checking out Universal Studios, the Hollywood Walk of Fame, and the Hollywood Sign. We were only there for a week, which was just enough time to attend the conferences and the main event, and have an extra day for shopping.\r\n\r\nOn all my subsequent trips to E3, I made sure to stay for at least two weeks. That gave us plenty of time to fully experience E3, as well as explore all the other things LA has to offer. After the event was over, my friends and I always had a whole week to do things like hunt for game deals, eat as much junk food as we could, and do all the other touristy things. One time, we even took a weekend trip to Las Vegas - it was amazing!\r\n\r\n## Going back home\r\nSaying goodbye to E3 was always the saddest moment of the trip, especially during my first year when I was not only saying goodbye to the event, but also to my first trip to LA, which had been an unforgettable experience.\r\n\r\nReturning home was always a bit bittersweet, but at least I knew I would have the opportunity to come back to LA again the following year. At least, that's what I thought until 2019 😅.\r\n\r\n![See you at E3 2020](../../uploads/blog/2022/06/e3_see_you_next_year.jpg)\r\n\r\n[Yeah...](https://www.theverge.com/2020/3/11/21163570/e3-canceled-coronavirus-outbreak-xbox-nintendo)\r\n\r\n## Is E3 still relevant?\r\nThis is a controversial question, but I believe we need E3 to return. The truth is that E3 was already struggling prior to the pandemic, and the pandemic was the final blow that ended the event. E3 could not survive as a media-only event, as it no longer made financial sense for news companies to send journalists to Los Angeles to cover the event when everything could be easily shown on YouTube.\r\n\r\nWhen E3 opened to the public in 2017, the event was not prepared for such a large audience and it resulted in extremely long lines - for example, there were reportedly 5 hours of wait time to watch the presentation of Cyberpunk 2077, in addition to long lines just to enter the event. The Electronic Software Association (ESA), which organizes E3, was also facing challenges before E3 2020 was canceled, as Geoff Keighley had already announced he would not be attending the event that year.\r\n\r\nWhile it may seem like there's no need for E3 anymore, as conferences can be held online and game demos can be made available for everyone to play, there is one thing that cannot be fully replicated in the digital world: the hype. E3 is a great tool for creating buzz and increasing hype around game releases, as all gaming enthusiasts are paying attention to everything that happens at the event. It's practically a week when all of our gamer dreams come true, as we get to look forward to what's coming in the next year. It's like Christmas, but better.\r\n\r\nWithout E3, we don't know what to expect from the gaming industry in the year. This is why even without E3, many companies still used the E3 time frame to announce their new games in 2020, but it's just not the same without the big in-person event. Plus, there's something special about being able to physically be at the event and see everything in person. It adds to the excitement and creates a more immersive experience.\r\n\r\nFor example, there are still movie trailers shown at Comic-Con. Why do they show trailers at Comic-Con weeks before they are released on YouTube? It's because this creates anticipation and excitement for finally seeing the trailers, as we know others have already seen it and are reading reactions and comments about it. E3 is the same way, but for games. I attended Gamescom in 2019 and it was a great event, but many of the games that were there had already been announced and the closed presentations were similar to those at E3. Despite being an event that is up to three times larger than E3, it doesn't create the same level of hype.\r\n\r\n## What now?\r\nIt's still uncertain if E3 2023 will happen or not, but with the pandemic hopefully coming to an end in the near future, there's a good chance that the Electronic Software Association (ESA) will be able to bring E3 back next year. If that happens, count me in! I always look forward to attending E3, as it's not only an opportunity for me to play amazing games and meet new people, but it's also a chance for me to have an awesome trip with my friends. It can be difficult for us to all get together, since we have busy schedules and live in different countries.\r\n\r\nE3 is such a special event for the gaming community, and it's a shame that it had to be canceled in 2020 and 2021 due to the pandemic. But I have high hopes that it will return in 2023, and I can't wait to experience all the excitement and hype that comes with it. From the big game announcements to the hands-on demos, there's just nothing like being at E3 in person.\r\n\r\n![Team Nintendo Blast](../../uploads/blog/2022/06/nintendo_blast_crew.jpg)\r\n\r\nLet's hope for an E3 come back in 2023 and see you there!\r\n","frontmatter":{"tags":["e3","e3 2012","games","los angeles","lacc","convention center","nintendo","sony","microsoft","gameblast","media","journalism"],"categories":["games"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-06-01T00:00:00.000Z","id":null,"path":"10-years-anniversary-of-my-first-e3","show":true,"title":"10 years anniversary of my first E3","hideExcerpt":false,"subtitle":"10 years ago today I was embarking on a journey to my first E3 conference."}}},{"node":{"excerpt":"Eu me lembro da primeira vez que planejei ir para a E3 com…","html":"<p>Eu me lembro da primeira vez que planejei ir para a E3 com alguns amigos, em 2009. Parecia um sonho distante, apenas a ideia de ir para a E3 já era emocionante o suficiente e me deixava super animado. Naquela época, eu ainda não sabia que a E3 era um evento apenas para a imprensa e que eu nunca poderia simplesmente comprar um ingresso e ir. Claro que, eventualmente, consegui ir para a E3, mas como?</p>\n<p>Sempre fui apaixonado por videogames, especialmente pelos jogos da Nintendo, então quando o maior blog brasileiro sobre a Nintendo no Brasil, o Nintendo Blast, estava recrutando novos escritores, tive que me inscrever e, para minha surpresa, fui aceito.</p>\n<p>Depois de entrar no blog, comecei a escrever posts e fazer vídeos para o canal do YouTube deles, e alguns anos depois, recebi um e-mail de um dos editores do blog dizendo que estavam procurando pessoas para viajar para Los Angeles para cobrir a E3. Não acreditei que isso estava realmente acontecendo. Apertei o botão de aplicar tão rápido que quase quebrei meu mouse.</p>\n<p>Claro que, como o Nintendo Blast era movido por trabalho voluntário, eu mesmo teria que arcar com todos os custos da viagem, mas eles me ofereceriam o que nenhum dinheiro poderia comprar: um ingresso para a E3!</p>\n<p>Primeiro, tive que conseguir um visto para entrar nos EUA, o que é um processo bastante burocrático, mas felizmente meu visto foi aprovado, o hotel e as passagens foram reservados e nossos crachás de imprensa foram emitidos, e tudo o que eu tinha que fazer era esperar até o dia da viagem. Estava tão ansioso que tive problemas para dormir por meses.</p>\n<h2 id=\"primeira-vez-em-los-angeles\" style=\"position:relative;\"><a href=\"#primeira-vez-em-los-angeles\" aria-label=\"primeira vez em los angeles permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Primeira vez em Los Angeles</h2>\n<p>Ir para a E3 teve um efeito colateral inesperado: me apaixonar por Los Angeles. Sim, eu sei que é super clichê, mas LA não é apenas a casa da E3, mas também de muitos picos famosos de skate que vi em vídeos de skate durante toda a minha vida, e poder visitar esses picos na vida real foi muito emocionante, cheguei até a comprar um deck da Plan B enquanto estava lá, só para saber como era comprar um deck no estado que foi o berço do skate. Praticamente todos os cantos do centro de LA são picos famosos de skate em algum vídeo dos anos 90.</p>\n<p>Essa também foi minha primeira vez nos EUA, então pela primeira vez experimentei refeições extra grandes no McDonald’s, fiz compras na Target, recebi as notas gigantes da CVS, fui a uma GameStop, comprei produtos da Old Spice, fui ao White Castle, e como um fã de Forest Gump, finalmente fui a um restaurante Bubba Gump.</p>\n<p>Éramos um grupo de 7 jovens entusiastas prestes a cobrir o maior evento de videogames do mundo e, embora tivéssemos muitas coisas que queríamos fazer em LA, não tínhamos tempo a perder, pois a E3 estava começando 2 dias depois que desembarcamos.</p>\n<h2 id=\"uma-ajudinha-dos-veteranos\" style=\"position:relative;\"><a href=\"#uma-ajudinha-dos-veteranos\" aria-label=\"uma ajudinha dos veteranos permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Uma ajudinha dos veteranos</h2>\n<p>Éramos uma equipe pequena, mas felizmente estávamos no mesmo hotel que alguns editores veteranos da Nintendo World, a revista oficial da Nintendo no Brasil.</p>\n<p>Eu lia a Nintendo World desde os 10 anos de idade, e estar lá com essas lendas foi surreal. Eles até escolheram alguns de nós para escrever artigos na revista, infelizmente não fui escolhido, mas só a chance de ser escolhido já era uma das maiores conquistas da minha vida até então.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 132.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMCBAUB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAD/9oADAMBAAIQAxAAAAFk7Cy+kSmprCw1zFHn/8QAHhAAAQQBBQAAAAAAAAAAAAAAAgABAxIhBBETICL/2gAIAQEAAQUCIarjwEQkzPYpjCkWnxM+4j6TH0//xAAZEQEAAgMAAAAAAAAAAAAAAAAAERMBUWH/2gAIAQMBAT8BlOdrF3H/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEhD/2gAIAQIBAT8ByUP/xAAiEAACAgEBCQAAAAAAAAAAAAAAAQIRUSISEyAhMjNBYYH/2gAIAQEABj8C1RR2zoj9JbyK0tUSjtVY78vI45KnzXtFY4P/xAAeEAACAgICAwAAAAAAAAAAAAABEQAhMUEQYYGRof/aAAgBAQABPyFpkeVDl9mYwP8AuU3iw1CljXkw4MewdILKNSgEjdaogAESoL4V8f/aAAwDAQACAAMAAAAQoOi9/8QAGREBAQADAQAAAAAAAAAAAAAAAQARQWHw/9oACAEDAQE/EM3d5McSxn//xAAaEQEBAAIDAAAAAAAAAAAAAAABABEhMVFh/9oACAECAQE/EACwdT6jTm//xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAhMUFxUWH/2gAIAQEAAT8QJutMitmpqVyN9groe8Y1IL0UaO+z3Gu/pkTzvt4xLqLZC0rZrg/MrzaRVQTBGG8iIH1+76xwZeIeOcnww0eIfuAQ0YjqYhXRn//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Nintendo World #159\"\n        title=\"Nintendo World #159\"\n        src=\"/static/1bd637a064f5ba27be82ffab40d2d631/63217/nintendo_world_159.jpg\"\n        srcset=\"/static/1bd637a064f5ba27be82ffab40d2d631/db830/nintendo_world_159.jpg 256w,\n/static/1bd637a064f5ba27be82ffab40d2d631/8102f/nintendo_world_159.jpg 512w,\n/static/1bd637a064f5ba27be82ffab40d2d631/63217/nintendo_world_159.jpg 1024w,\n/static/1bd637a064f5ba27be82ffab40d2d631/d58d1/nintendo_world_159.jpg 1536w,\n/static/1bd637a064f5ba27be82ffab40d2d631/d7bd3/nintendo_world_159.jpg 1933w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Nintendo World #159</figcaption>\n  </figure></p>\n<p>Em seguida, tivemos algumas rodadas de reuniões sobre como fazer as coisas na E3, o que acabou sendo super útil e usei em todas as outras edições desde então.</p>\n<h2 id=\"espere-quando-comeca-a-e3\" style=\"position:relative;\"><a href=\"#espere-quando-comeca-a-e3\" aria-label=\"espere quando comeca a e3 permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Espere, quando começa a E3?</h2>\n<p>Ahhh, a confusão. Toda E3 era a mesma coisa, eu via um artigo online dizendo “E3 começa nesta data X bla bla bla” e alguns dias antes, boom conferências da Sony/Microsoft/Nintendo, o quê? Por quê? Depois disso, os próximos dias eram cheios de vídeos de hands-on e posts sobre apresentações secretas de jogos que ainda não tinham gameplay mostrado ao público, etc.</p>\n<p>A questão é que as conferências não fazem oficialmente parte da E3, quer dizer, mais ou menos.</p>\n<p>A E3 é um evento organizado pela ESA que reúne comerciantes e imprensa em um enorme centro de convenções onde as empresas de jogos podem mostrar seus produtos ao mundo, e durante esses dias, todo o mundo dos jogos está de olho na E3, e por isso, todas as grandes empres agendam uma grande coletiva de imprensa alguns dias antes da E3, para que todos os comerciantes e imprensa saibam o que esperar do evento.</p>\n<p>Para nós, que assistimos às conferências da E3 em casa, parece que o evento começa quando as conferências começam e termina após a última conferência. No entanto, o que realmente importa são os anúncios de jogos. Foi uma surpresa para mim descobrir que a conferência da Sony estava localizada a muitos quilômetros do LACC.</p>\n<p>Eu achei que todas as conferências aconteciam na E3. Eu sei que parece bobagem, mas foi um choque para mim e, nos anos seguintes, vi muitos outros participantes da E3 terem a mesma confusão.</p>\n<h2 id=\"as-conferencias\" style=\"position:relative;\"><a href=\"#as-conferencias\" aria-label=\"as conferencias permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>As conferências</h2>\n<p>Para chegar às famosas conferências da E3, você precisa ser convidado, pelo menos de forma convencional. Mesmo que você não tenha sido convidado, muitas pessoas da imprensa ainda iriam ao local da conferência na esperança de que alguns lugares estivessem disponíveis, e em todas as E3 que eu fui, sempre consegui entrar nas conferências. E mesmo se eu não conseguisse, a adrenalina de não saber se eu conseguiria e todos os telefonemas e contatos tentando conseguir um convite de última hora para entrar já faziam valer a pena a aventura. Infelizmente eu não sabia de tudo isso na minha primeira E3, então nem tentei, e foi o último ano que a Nintendo teve uma conferência convencional da E3.</p>\n<p>As conferências da E3 são normalmente agendadas em horários e locais específicos, para que as pessoas em Los Angeles possam ir de uma conferência para outra e chegar a tempo. Por exemplo, um dos dias de conferências começaria com a Microsoft de manhã cedo, depois a Ubisoft, depois uma pausa para o almoço e, finalmente, a Sony.</p>\n<p>Quase todas as conferências ofereciam algum tipo de brinde aos participantes, como pulseiras, camisetas, action figures, etc. Muitos desses itens podiam ser encontrados por centenas de dólares no eBay no mesmo dia. Eu, é claro, ainda tenho todos eles e ainda uso pelo menos uma camiseta da E3 toda semana.</p>\n<p>Os locais das conferências sempre foram em lugares famosos de Los Angeles, como a conferência da Bethesda de 2015, que foi no mesmo local dos Oscars, na Hollywood Blvd. A Sony e a Microsoft costumam estar sempre no mesmo local, a LA Memorial Sports Arena e o Galen Center, respectivamente.</p>\n<h2 id=\"o-evento\" style=\"position:relative;\"><a href=\"#o-evento\" aria-label=\"o evento permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O evento</h2>\n<p>A E3 geralmente acontece de terça a quinta-feira, com duração de 3 dias no total, e vou te falar, se você quiser ver tudo, 3 dias não é suficiente. Estar lá é ótimo, mas perdemos muitas coisas. O LA Convention Center é enorme e você passará metade do seu tempo andando de um estande para outro.</p>\n<p>Durante a cobertura do evento, dividimos nossa equipe em times de duas a três pessoas, e todos agendamos horários para entrevistas, apresentações, e demos de jogos com várias empresas diferentes, então o nosso objetivo era chegar na feira a tempo de cumprir todos os nossos compromissos. Marcar horários com antecedência é uma ótima maneira de pular as filas, que às vezes podem durar horas, e como mencionei antes, 3 dias não são suficientes para ver tudo, então “perder” tempo em filas pode custar não só o seu precioso tempo, mas também impedi-lo de jogar algum jogo.</p>\n<p>No meu primeiro ano, eu estava um pouco perdido e não sabia exatamente o que fazer, mas ainda assim, joguei muitos jogos de WiiU e PS3, incluindo ZombiU, Nintendo Land, LittleBigPlanet Karting e PlayStation All-Stars Battle Royale, apenas para citar alguns. Meu jogo favorito daquele ano na verdade não era jogável: Dead Space 3. Foi nesse ano que comecei a me interessar por Dead Space e nessa E3 eu ganhei uma toca do Isaac Clarke que eu uso até hoje.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 612px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAgP/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/2gAMAwEAAhADEAAAAV66GDeAwHLrUJlt0jgf/8QAHhABAAEEAgMAAAAAAAAAAAAAAgEAAwQTERIUIjP/2gAIAQEAAQUCxQLqjjY0u+sePgL31qUkrdByEeyN/wCU1tfH/8QAFxEBAQEBAAAAAAAAAAAAAAAAAAECEf/aAAgBAwEBPwFxU2//xAAZEQEAAgMAAAAAAAAAAAAAAAAAAQIREjH/2gAIAQIBAT8BZV41l//EAB8QAAICAQQDAAAAAAAAAAAAAAABAhExEBIhQSIycf/aAAgBAQAGPwLyVUhOLVX0S47JbMoaJfSUVhlx4Llli09j/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBcWH/2gAIAQEAAT8hS1i52hgadUVHelIlIqwta+yjnFHPs4je57iL7mMPMZmDTJtX5BrAwWyf/9oADAMBAAIAAwAAABB0Jr//xAAXEQEBAQEAAAAAAAAAAAAAAAABABFx/9oACAEDAQE/EDW5mjkABf/EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8QMnDdRR2//8QAIBABAAMAAgAHAAAAAAAAAAAAAQARITFBUWGBkaHB8P/aAAgBAQABPxDia9cyFPhALEZ4YGvvkQAAI8dsu4v5RaF/HUC2s5GD+MvRXmjfcIv5iGHnH1jgiVcaPPcOOwg1eYvnCEBT6QAIBqBRhwM//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Toca do Dead Space\"\n        title=\"Toca do Dead Space\"\n        src=\"/static/ab69ba0d7bcc1956e599f91a725c55b5/6c4e2/dead_space_beenie.jpg\"\n        srcset=\"/static/ab69ba0d7bcc1956e599f91a725c55b5/db830/dead_space_beenie.jpg 256w,\n/static/ab69ba0d7bcc1956e599f91a725c55b5/8102f/dead_space_beenie.jpg 512w,\n/static/ab69ba0d7bcc1956e599f91a725c55b5/6c4e2/dead_space_beenie.jpg 612w\"\n        sizes=\"(max-width: 612px) 100vw, 612px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Toca do Dead Space</figcaption>\n  </figure></p>\n<p>O LA Convention Center é enorme, e tem duas áreas principais onde é possível encontrar vários estandes de diferentes empresas e também algumas outras salas de reunião onde as empresas geralmente têm suas áreas VIP com apresentações e demos.</p>\n<p>As duas áreas principais da E3 estão conectadas por uma enorme área aberta ao público, repleta de atividades e jogos exclusivos para serem jogados. Caminhar de uma área principal para a outra pode levar cerca de 10 minutos, por isso era importante marcar horários próximos uns dos outros para não ficar preso na área aberta ao público durante muito tempo.</p>\n<p>Há também uma sala especial para a imprensa, equipada com computadores de alta velocidade para que os jornalistas possam editar seus artigos e vídeos rapidamente e divulgar todas as notícias para o mundo. Além disso, há uma sala de relaxamento especial, onde podemos descansar e até mesmo almoçar de graça por volta do meio-dia. É incrível.</p>\n<p>Durante nosso tempo “livre”, podemos explorar e encontrar coisas interessantes para cobrir. Tenho que admitir que passei a maior parte do meu tempo livre no estande da Nintendo, tentando jogar o máximo de jogos possíveis e colecionar o máximo de brindes possíveis. Ah, sim, uma das outras coisas incríveis da E3 é receber muitos brindes incríveis de graça, como chaveiros, camisetas, etc.</p>\n<h2 id=\"os-brindes\" style=\"position:relative;\"><a href=\"#os-brindes\" aria-label=\"os brindes permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Os brindes</h2>\n<p>Um dos aspectos mais incríveis da E3 são os brindes, não apenas porque são oferecidos de graça, mas também porque consegui-los é uma experiência muito divertida e emocionante, assim como entrar nas conferências.</p>\n<p>Cada estande tem seus próprios brindes e maneiras de obtê-los, que mudam a cada ano. Na minha primeira E3, no estande da Nintendo, cada minijogo que jogávamos no Nintendo Land nos rendia um broche correspondente e o objetivo era colecionar todos eles, o que consegui fazer.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwAEBf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABzOS6uVHR/8QAGxAAAgIDAQAAAAAAAAAAAAAAAQIAAwQQERL/2gAIAQEAAQUCoStpagOsdOIynwTP/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAS/9oACAEDAQE/AZK//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bp//EABwQAAEEAwEAAAAAAAAAAAAAAAABAjFREBEhIv/aAAgBAQAGPwJXKR28bsd6IP/EABkQAAIDAQAAAAAAAAAAAAAAAAERACFBMf/aAAgBAQABPyEoK0UsgOgQVwpWqKOtvIWxiioJ3H//2gAMAwEAAgADAAAAEDT/AP/EABcRAAMBAAAAAAAAAAAAAAAAAAABEUH/2gAIAQMBAT8Q2SKf/8QAFxEBAAMAAAAAAAAAAAAAAAAAARARMf/aAAgBAgEBPxAGXH//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhQTFx0f/aAAgBAQABPxAwQkXUvi7ypHUXDcTuJ7BXcTIg9itRon7j2hs4Ehm1BoN+mf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Broches do Nintendo Land\"\n        title=\"Broches do Nintendo Land\"\n        src=\"/static/bcbc5e01cc243731110599099965072c/63217/nintendo_land_swags.jpg\"\n        srcset=\"/static/bcbc5e01cc243731110599099965072c/db830/nintendo_land_swags.jpg 256w,\n/static/bcbc5e01cc243731110599099965072c/8102f/nintendo_land_swags.jpg 512w,\n/static/bcbc5e01cc243731110599099965072c/63217/nintendo_land_swags.jpg 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Broches do Nintendo Land</figcaption>\n  </figure></p>\n<p>Os brindes da E3 são uma das coisas mais incríveis do evento, não apenas porque são gratuitos, mas porque tentar conseguir os brindes é uma experiência divertida e emocionante, assim como entrar nas conferências. Cada estande tem seus próprios brindes e maneiras de obtê-los, que mudam a cada ano. Em minha primeira E3, no estande da Nintendo, recebíamos um broche para cada mini-jogo que jogávamos no Nintendo Land, e o objetivo era colecionar todos. Alguns brindes exigiam que você jogasse contra outros participantes do evento e os ganhasse, como a camisa do Smash de 2014. Eu sou péssimo no Smash, mas sortudamente meu amigo Danilo, do site Hyrule Legends, jogou e ganhou uma camisa para mim.</p>\n<p>Alguns brindes bastava pedir e eles seriam dados, mas às vezes eles se esgotavam rapidamente e era preciso esperar até o dia seguinte para tentar conseguir um. Para um colecionador como eu, esses brindes são sempre bem-vindos, mas os melhores são os que podemos usar no dia a dia, como mencionei anteriormente, quase toda semana uso uma camiseta diferente que ganhei de graça na E3. A minha favorita é provavelmente a camiseta Lego Dimensions de 2015, que na verdade não era um brinde, mas era a camiseta que o pessoal do estande da Warner estava usando, e de alguma forma consegui convencê-los a me dar uma.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.734375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAUB/8QAFwEAAwEAAAAAAAAAAAAAAAAAAgMEAf/aAAwDAQACEAMQAAABzWojvrQAs1/PiwNq5O3lxKVd0Ts//8QAHRAAAQQCAwAAAAAAAAAAAAAAAgABAxIRIjEyM//aAAgBAQABBQLL5qSciZ6YI2qo4BILbGQGOyflRxkcb9lD4//EABYRAAMAAAAAAAAAAAAAAAAAAAARIP/aAAgBAwEBPwEU/wD/xAAZEQACAwEAAAAAAAAAAAAAAAAAAQIQEjH/2gAIAQIBAT8BNqnKNPp//8QAHRAAAgEEAwAAAAAAAAAAAAAAAAECEBEhMRIiYf/aAAgBAQAGPwKmzseibbyO+jArSsOkWuI6Rwf/xAAdEAACAgIDAQAAAAAAAAAAAAAAAREhMWFBUZGB/9oACAEBAAE/IU7K+yPf0jDstiVibSgUiViS8TsSrsDjfTJZUUYH9hMpCRyP6ElaWD//2gAMAwEAAgADAAAAEK8Aw3vf/8QAGBEBAQEBAQAAAAAAAAAAAAAAAQAxIRH/2gAIAQMBAT8QHl7Y5GbEZf/EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8QTsm5JsBRmHV//8QAHRABAAMAAwEBAQAAAAAAAAAAAQARITFBcVGBsf/aAAgBAQABPxAAW1lqSc6mrVhxjlxg1aV370WX7BVTSulnUGMuICuZfdbWgGy3J3INMk8nCrIWevyIBei/s0IIN1Nt3b8jeyggYwFv2m8s/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"T-shirt Lego Dimensions\"\n        title=\"T-shirt Lego Dimensions\"\n        src=\"/static/74aa085aa80943dabfc4ce90ce0cddea/63217/lego_dimensions_shirt.jpg\"\n        srcset=\"/static/74aa085aa80943dabfc4ce90ce0cddea/db830/lego_dimensions_shirt.jpg 256w,\n/static/74aa085aa80943dabfc4ce90ce0cddea/8102f/lego_dimensions_shirt.jpg 512w,\n/static/74aa085aa80943dabfc4ce90ce0cddea/63217/lego_dimensions_shirt.jpg 1024w,\n/static/74aa085aa80943dabfc4ce90ce0cddea/b37e7/lego_dimensions_shirt.jpg 1080w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">T-shirt Lego Dimensions</figcaption>\n  </figure></p>\n<p>Brindes como essa camiseta são chamados de <em>ultimate swags</em> (pelo menos é assim que eu os chamo), são itens que não estão realmente disponíveis como brindes, mas que você consegue adquiri-los de alguma forma, como tentei fazer com a garrafa de água para o pessoal do estande na E3 de 2012, mas não consegui. No entanto, no ano seguinte, tentei durante todos os três dias da feira e acabei conseguindo uma no último dia.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABTKKVGJZLJ+yzGVOEkT//xAAbEAADAAMBAQAAAAAAAAAAAAABAgMEERIyIf/aAAgBAQABBQJkpqSl2tPT5Tlp4yOK1kHdjwYa6Y/beZeaUbv/xAAWEQADAAAAAAAAAAAAAAAAAAAAECH/2gAIAQMBAT8BK//EABcRAAMBAAAAAAAAAAAAAAAAAAAQESL/2gAIAQIBAT8BplU//8QAHhAAAgIBBQEAAAAAAAAAAAAAAAERIRICEDFCYUH/2gAIAQEABj8C4cLw0xbTLWJguzH1ZLZLvwvl7Jk/R2f/xAAcEAEBAQADAAMAAAAAAAAAAAABEQAhMUFRYaH/2gAIAQEAAT8hEK1KvTKHeGajdPMxtPBXElA9S6ClnxvsLxjaQ91dCNwB2Pe5fuwQHDf/2gAMAwEAAgADAAAAECjFPf/EABgRAAIDAAAAAAAAAAAAAAAAAAABEBEx/9oACAEDAQE/EEWMj//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQIBAT8QbUWNGUf/xAAdEAEAAwEAAwEBAAAAAAAAAAABABEhMUFRYZFx/9oACAEBAAE/EKpKSoe6r/Cc3+6WVpKcYHH9mtsEKAN38gxK3QV/D7caCUG25O7JaXDJpsb645CIHieIMg6cmRaMtB4sA9ZP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Garrafa de água da equipe do estande\"\n        title=\"Garrafa de água da equipe do estande\"\n        src=\"/static/72c94af053f2053c72db23db62ec96e3/63217/nintendo_staff_water_bottle.jpg\"\n        srcset=\"/static/72c94af053f2053c72db23db62ec96e3/db830/nintendo_staff_water_bottle.jpg 256w,\n/static/72c94af053f2053c72db23db62ec96e3/8102f/nintendo_staff_water_bottle.jpg 512w,\n/static/72c94af053f2053c72db23db62ec96e3/63217/nintendo_staff_water_bottle.jpg 1024w,\n/static/72c94af053f2053c72db23db62ec96e3/d58d1/nintendo_staff_water_bottle.jpg 1536w,\n/static/72c94af053f2053c72db23db62ec96e3/09658/nintendo_staff_water_bottle.jpg 2048w,\n/static/72c94af053f2053c72db23db62ec96e3/78fc5/nintendo_staff_water_bottle.jpg 2736w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Garrafa de água da equipe do estande</figcaption>\n  </figure></p>\n<p>No final de cada dia da E3, eu e meus amigos nos reuníamos para um bom jantar e conversávamos sobre todos os brindes que coletamos e como os conseguimos. É claro que também falávamos sobre todos os jogos que jogamos e como foi o dia em geral para nós também.</p>\n<p>Eu geralmente reservava meu último dia quase sem compromissos, para poder andar por aí e tentar pegar todos os brindes que perdi nos outros dias e jogar novamente os jogos que mais gostei. Então, depois do último dia, eu e meus amigos reuníamos todos os nossos brindes e compras relacionadas a jogos em cima da cama do hotel para uma foto épica.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAQDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAv/aAAwDAQACEAMQAAABj0WEvNXLP//EABsQAQACAgMAAAAAAAAAAAAAAAIAAQMREiEy/9oACAEBAAEFAsQWkJ2Ziauhd8n6/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/AcR//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQACEf/aAAgBAgEBPwF1PBv/xAAbEAACAgMBAAAAAAAAAAAAAAAAMQERAhAhUf/aAAgBAQAGPwJMpeFZM7JOv//EABoQAQACAwEAAAAAAAAAAAAAAAEAIRExkWH/2gAIAQEAAT8hWR4RANzSYGRqeTI8jN6lnb2f/9oADAMBAAIAAwAAABBAL//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8QWSmqf//EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPxCA8DP/xAAbEAEBAAIDAQAAAAAAAAAAAAABEQAhMXGhYf/aAAgBAQABPxDaAXLSE8xktcDnrzG4TxCvcQtpK9mKVphtPuHd06NjP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Brindes da E3 2017\"\n        title=\"Brindes da E3 2017\"\n        src=\"/static/cde3a8668d9d6f594f53d323de0fcdf3/63217/e3_swags_2017.jpg\"\n        srcset=\"/static/cde3a8668d9d6f594f53d323de0fcdf3/db830/e3_swags_2017.jpg 256w,\n/static/cde3a8668d9d6f594f53d323de0fcdf3/8102f/e3_swags_2017.jpg 512w,\n/static/cde3a8668d9d6f594f53d323de0fcdf3/63217/e3_swags_2017.jpg 1024w,\n/static/cde3a8668d9d6f594f53d323de0fcdf3/33266/e3_swags_2017.jpg 1440w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Brindes da E3 2017</figcaption>\n  </figure></p>\n<h2 id=\"a-comida\" style=\"position:relative;\"><a href=\"#a-comida\" aria-label=\"a comida permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A comida</h2>\n<p>Na E3, havia várias opções para se alimentar. Se você era da imprensa, poderia conseguir um almoço de graça na sala de imprensa. Caso contrário, poderia optar por pagar valores mais altos em lanchonetes no centro de convenções.</p>\n<p>No entanto, se tivesse sorte, talvez nem precisasse parar para comer, pois alguns estandes ofereciam lanches para os jogadores. Foi assim que eu me alimentei na maior parte da E3 - jogando e comendo lanches. Afinal, por que interromper o jogo para comer quando estava na maior convenção de jogos do mundo?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFA//EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFCgngNYiBP/8QAHBAAAQQDAQAAAAAAAAAAAAAAAgABAxMREiEi/9oACAEBAAEFAo8M4nzdTB5uVpr/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAEDAQE/AVNIf//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAECAQE/AVf/xAAdEAEAAgAHAAAAAAAAAAAAAAABABEQEjFBUWGx/9oACAEBAAY/Akun2G/PWGYjYLNZ/8QAHhAAAgIABwAAAAAAAAAAAAAAAAERQSExUYGRofD/2gAIAQEAAT8hZoZFJxyNlW7EJE6pZjd4sXEHqj//2gAMAwEAAgADAAAAEKc//8QAGBEAAwEBAAAAAAAAAAAAAAAAAAEhEVH/2gAIAQMBAT8QVpBjp//EABcRAAMBAAAAAAAAAAAAAAAAAAEQEUH/2gAIAQIBAT8QNxP/xAAbEAEAAwADAQAAAAAAAAAAAAABABEhMUFR0f/aAAgBAQABPxBwyOJivWHMQDGFbRzDYMxrWooVGY9DuDrmEjAZwdSv6DP/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Snacks da CD Projekt Red\"\n        title=\"Snacks da CD Projekt Red\"\n        src=\"/static/1fa57646e94beba38a37da61486bffb9/63217/e3_booth_food.jpg\"\n        srcset=\"/static/1fa57646e94beba38a37da61486bffb9/db830/e3_booth_food.jpg 256w,\n/static/1fa57646e94beba38a37da61486bffb9/8102f/e3_booth_food.jpg 512w,\n/static/1fa57646e94beba38a37da61486bffb9/63217/e3_booth_food.jpg 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Snacks da CD Projekt Red</figcaption>\n  </figure></p>\n<h2 id=\"conhecendo-seus-herois\" style=\"position:relative;\"><a href=\"#conhecendo-seus-herois\" aria-label=\"conhecendo seus herois permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conhecendo seus heróis</h2>\n<p>Esta é possivelmente uma das melhores coisas da E3, se você for muito sortudo, poderá conhecer as pessoas que fazem os jogos que você ama.</p>\n<p>Há várias maneiras de fazer isso. Se você for parte da imprensa, pode marcar uma entrevista ou uma demonstração de um jogo com eles. Outra opção é simplesmente caminhar pelo evento e encontrá-los por acaso.</p>\n<p>Foi assim que conheci Hideo Kojima e, em outra ocasião, cruzei com Shigeru Miyamoto saindo do banheiro e consegui um autógrafo dele! Desculpe por isso, Miyamoto 😅</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 133.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwH/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAP/2gAMAwEAAhADEAAAAd5FQLpCFvRFrvjmMV//xAAbEAACAgMBAAAAAAAAAAAAAAABAgASAwQQM//aAAgBAQABBQKq5Ay1aazhJmYsbHg84O//xAAYEQACAwAAAAAAAAAAAAAAAAAAARAREv/aAAgBAwEBPwFOjc//xAAYEQACAwAAAAAAAAAAAAAAAAAAEgEQEf/aAAgBAgEBPwFdEm//xAAbEAACAwADAAAAAAAAAAAAAAABAgAQESBBUf/aAAgBAQAGPwLU7mE1jEgRmG5PKbj/AP/EAB4QAQACAQUBAQAAAAAAAAAAAAEAESExQVFhcYGx/9oACAEBAAE/ITKli/kvCXsbnsErWWHHBxA77Jwvghm0o6lKxV1/ImY4aSp//9oADAMBAAIAAwAAABD8+sz/xAAZEQACAwEAAAAAAAAAAAAAAAAAEQEQIVH/2gAIAQMBAT8QSF4Tlf/EABkRAAMAAwAAAAAAAAAAAAAAAAABESFBUf/aAAgBAgEBPxDI9D6CVRD/xAAeEAEAAgICAwEAAAAAAAAAAAABABEhMUFhUXHBgf/aAAgBAQABPxA0F1gWdo9poIFaNu7iQiTze4fVhKr8i32ziymeCsHyA8D4VHTOCu3RHhk3Kqixn9liXca9zJXEPE//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Eu e Kojima\"\n        title=\"Eu e Kojima\"\n        src=\"/static/a303cab53d35091c02dfabe70b84abec/63217/me_and_kojima.jpg\"\n        srcset=\"/static/a303cab53d35091c02dfabe70b84abec/db830/me_and_kojima.jpg 256w,\n/static/a303cab53d35091c02dfabe70b84abec/8102f/me_and_kojima.jpg 512w,\n/static/a303cab53d35091c02dfabe70b84abec/63217/me_and_kojima.jpg 1024w,\n/static/a303cab53d35091c02dfabe70b84abec/d58d1/me_and_kojima.jpg 1536w,\n/static/a303cab53d35091c02dfabe70b84abec/09658/me_and_kojima.jpg 2048w,\n/static/a303cab53d35091c02dfabe70b84abec/b6833/me_and_kojima.jpg 3672w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Eu e Kojima</figcaption>\n  </figure></p>\n<p>Uma das maneiras mais emocionantes de conhecer os criadores de jogos que amamos é esperando na entrada do LACC bem cedo de manhã. É uma oportunidade única de ver todos eles passando por lá, embora muitas vezes eles estejam com pressa devido a suas agendas lotadas e acompanhados por seguranças.</p>\n<p>Mas às vezes eles não estão tão ocupados e têm tempo para dar um pouco de amor a nós, meros mortais. Foi assim que conheci o Miyamoto pela primeira vez e consegui meu 3DS Zelda Edition autografado por ele, que agora é o meu item de colecionador favorito em minha coleção.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABY4SqUYFw/8QAGxABAQABBQAAAAAAAAAAAAAAAQIABBITIzL/2gAIAQEAAQUCdUVB55ayRp297Fw//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAAMAAwEAAAAAAAAAAAAAAAABEQIhkaH/2gAIAQEABj8CnozV6KCjtRHif//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExYVH/2gAIAQEAAT8hYaqVDxl79lngYxSGWfJ1qGzUQGs7P//aAAwDAQACAAMAAAAQzz//xAAXEQADAQAAAAAAAAAAAAAAAAAAASEx/9oACAEDAQE/EGmEP//EABYRAQEBAAAAAAAAAAAAAAAAAAEQYf/aAAgBAgEBPxBxn//EABsQAQEAAwEBAQAAAAAAAAAAAAERACExcWGB/9oACAEBAAE/EDqVtk38wVZIEZIgnPt7nIV1ML+O/cI4Ryp7g0HGtFhT0HEBmWhjW5//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Eu e Miyamoto\"\n        title=\"Eu e Miyamoto\"\n        src=\"/static/a128a6cbf2e50686858bbbd3aaf528ce/63217/me_and_miyamoto.jpg\"\n        srcset=\"/static/a128a6cbf2e50686858bbbd3aaf528ce/db830/me_and_miyamoto.jpg 256w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/8102f/me_and_miyamoto.jpg 512w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/63217/me_and_miyamoto.jpg 1024w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/d58d1/me_and_miyamoto.jpg 1536w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/09658/me_and_miyamoto.jpg 2048w,\n/static/a128a6cbf2e50686858bbbd3aaf528ce/08826/me_and_miyamoto.jpg 3264w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Eu e Miyamoto</figcaption>\n  </figure></p>\n<p>Depois de conseguir o autógrafo do Miyamoto, compartilhei minha experiência com alguns amigos e eles também tentaram nos dias seguintes, conseguindo autógrafos de seus próprios heróis.</p>\n<p>Eles também contaram sobre isso para outros amigos e, ao longo dos anos, um grande grupo de brasileiros, que nem se conheciam, começou a se reunir para esperar pelos heróis durante o evento e tirar fotos e pedir autógrafos.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 820px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.828125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADnklEQVQozwGTA2z8AP////7+/vf39f3+/f///8LTzqO5rmKFc5eipK+w14CDaNbIOYipo06EaJKrn8PC0c3O1drb6Pb28////wD///+5usN3eKfNyqHDvqAudkN7l4w4hlsbTVJLQ8ptam3eyTxginwJdkFkkX9eW8BVW7PDv3nLxVf09v8A////xsLYLj2imJw2v7MFJXAtF19RJW5HIHNDJk6EVH1if6QgNm9BIXJKVIZtREu0rqy+5NoXy8aE////AP///4OymxIuVEZ7N1u1KBaORVylIpCeD5aXEVeWNjmxUwenTRWiRiCfQhmhPxybTFiiRKmgEF6aXbjSwgDC4cwem0BAYzcTn01WtTnC0hablD6KXj+1cEq+iV2knlxZmSk1skQVr1IctFEfukwglkRUYEEyYitjoXEAUrlwHJM8aGhOqsEg//8AlZNMFRqpq5Fnsn9YnWdLVCohai8Xz8gJm8scSK04Iq5IKqlKdG9KHpI8ltGpACOnTi+VObGdLMqUOfPsAEtRh0ZIqbOhZoZmRHg+L3k1KKyaa9rTJP/5AP/xALTLC3p4RmqETBitSdPg1AAZlT4jo0ilxxXKnC/CpSCUmoN4dKiPWjZ7RzWRZkSlk1pzdFy1sDX//gDj6gOKlDaWbU4PljdSr29tZGUAd62GF6lHNaVXlrAfu4gxvak4PEaBY0Rrdk4wb29GTk4vBwkLdHJK0L4MZrkqbHdQboldi5V5PEowCgkLAPj5+JSvlpq8nhCYQXuXMb+DO8K2JX12VV06LwAAAAkIBm9hQXdJMFF1IHV5TGZiN4WFWuGNkp5mR1w/LQCflIlVMCRYTT5CnFgTsDp1kTywb0jMthmZbTZtQzZzUDhrNyg2UyZVfkJMajNvKB+SQTGPVjepakjGh4AAs6ahXkM6dl1P7/TtUa90GqVJXnkvo2ZEsnZQomlLm2BFel0+Z2Y4cIlje7+VuMScdEQ8rINlnW1UmFtGAMzFwjgeEwEAAGlrbbyrl5aljXLAh2yFNZ5nSYteRalvUHtVOneeedjw4////9fc1DFBNURLNWBhSlVJNgDa19SflIsxJR8FAQBmRETh1tf////U5eGie160c1C4elinb0zNubH////LraxzGxt6TD9VPjIyKiFNMiQA////2NHMcFhJ39rX7u3s/////Pz7////u5V/tXFMu31avn1aq2hEwqaV9vT2kjtCjCcimUk7jD0xnmBFH7i1SJv1hZIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Hue Hue BR\"\n        title=\"Hue Hue BR\"\n        src=\"/static/64fd508b9c457acf6fdb28cacade5271/0bbcd/hue_hue_br.png\"\n        srcset=\"/static/64fd508b9c457acf6fdb28cacade5271/e3135/hue_hue_br.png 256w,\n/static/64fd508b9c457acf6fdb28cacade5271/06341/hue_hue_br.png 512w,\n/static/64fd508b9c457acf6fdb28cacade5271/0bbcd/hue_hue_br.png 820w\"\n        sizes=\"(max-width: 820px) 100vw, 820px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Hue Hue BR</figcaption>\n  </figure></p>\n<p>Desde que a E3 foi aberta ao público, todas as pessoas famosas e aquelas que trabalham na feira têm um acesso diferente ao evento, então, infelizmente, não é mais possível usar esse “truque”.</p>\n<h2 id=\"festas-da-e3\" style=\"position:relative;\"><a href=\"#festas-da-e3\" aria-label=\"festas da e3 permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Festas da E3</h2>\n<p>Eu acordava cedo todos os dias da E3, às 6h da manhã, para chegar ao centro de convenções cedo e evitar filas para jogar alguns dos novos títulos. Eu continuava jogando até por volta das 18h, quando o evento encerrava naquele dia. Depois disso, eu precisava reunir meus equipamentos e encontrar meus amigos, então já eram por volta das 20h quando eu finalmente estava pronto para ir para a cama - a menos, é claro, que houvesse uma festa para participar.</p>\n<p>Algumas dessas festas eram exclusivas para a imprensa, outras eram abertas para qualquer entusiasta de jogos em LA. Algumas eram pagas, outras eram gratuitas. Algumas ofereciam comida e bebida grátis, enquanto outras tinham brindes. Havia um tipo de festa para todos e eu sempre ficava feliz em participar.</p>\n<p>A melhor parte dessas festas era poder conhecer novas pessoas e sair com meus amigos, conversar sobre o dia e ficar empolgado com todas as novidades sobre jogos que viriam no próximo ano.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.796875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgME/9oADAMBAAIQAxAAAAHOkti/OFQaP//EABsQAQACAgMAAAAAAAAAAAAAAAIBAwAEERIU/9oACAEBAAEFAgEzBtcZS+mvVHpq5z//xAAYEQACAwAAAAAAAAAAAAAAAAAAAQIDEv/aAAgBAwEBPwF2NSNn/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAECAQE/AZiP/8QAHBABAAICAwEAAAAAAAAAAAAAAQIRAAMQIjEy/9oACAEBAAY/AlDzHp48bZVdVkdklGK/PH//xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhMXGx/9oACAEBAAE/Ibu/okD8MUhXXKZto8fpzGVaU0f/2gAMAwEAAgADAAAAEBj/AP/EABYRAAMAAAAAAAAAAAAAAAAAAAEQUf/aAAgBAwEBPxA8if/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EAsP/8QAHRAAAgIDAAMAAAAAAAAAAAAAAREAITFBUWFxgf/aAAgBAQABPxATegrZbC6VX2GQR5nAZCOxGaAq05WnGGKfoX5jN7jZzecjkLGs9Ln/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"festa do PC Game Show\"\n        title=\"festa do PC Game Show\"\n        src=\"/static/9b7cb544792f5e0a25356d10bd77cf9c/63217/pc_game_show_party.jpg\"\n        srcset=\"/static/9b7cb544792f5e0a25356d10bd77cf9c/db830/pc_game_show_party.jpg 256w,\n/static/9b7cb544792f5e0a25356d10bd77cf9c/8102f/pc_game_show_party.jpg 512w,\n/static/9b7cb544792f5e0a25356d10bd77cf9c/63217/pc_game_show_party.jpg 1024w,\n/static/9b7cb544792f5e0a25356d10bd77cf9c/d58d1/pc_game_show_party.jpg 1536w,\n/static/9b7cb544792f5e0a25356d10bd77cf9c/97b1a/pc_game_show_party.jpg 1576w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">festa do PC Game Show</figcaption>\n  </figure></p>\n<h2 id=\"dias-pos-e3\" style=\"position:relative;\"><a href=\"#dias-pos-e3\" aria-label=\"dias pos e3 permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dias pós E3</h2>\n<p>Na minha primeira E3, não tivemos tempo para explorar tudo o que Los Angeles oferecia, como passear pelo píer de Santa Monica, visitar lojas de jogos retrô, como a Game Dude, conhecer a Universal Studios, a Calçada da Fama em Hollywood e o Hollywood Sinal. Ficamos apenas uma semana lá, o suficiente para participar das conferências, da E3 e um dia extra para fazer compras, mas apenas isso.</p>\n<p>Em todas as minhas outras viagens à E3, fiquei pelo menos duas semanas. O suficiente para participar da E3 e ainda explorar o que mais LA tem a oferecer.</p>\n<p>Então, todo ano, depois que a E3 terminava, eu e meus amigos ainda tínhamos uma semana inteira para fazer coisas, procurar jogos em promoção, comer junk food e fazer outras atividades turísticas. Uma vez até fomos para Las Vegas durante um fim de semana, foi incrível!</p>\n<h2 id=\"voltando-para-casa\" style=\"position:relative;\"><a href=\"#voltando-para-casa\" aria-label=\"voltando para casa permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Voltando para casa</h2>\n<p>A despedida da E3 sempre foi um momento triste, especialmente durante minha primeira viagem a LA, que foi a viagem mais divertida que já tive.</p>\n<p>Voltar para casa sempre foi um pouco triste, mas pelo menos eu sabia que voltaria para Los Angeles no próximo ano para a E3. Ou pelo menos era o que eu pensava até 2019 😅.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAZc5zElsVKj/xAAZEAEBAQEBAQAAAAAAAAAAAAACAQADEhP/2gAIAQEAAQUCXRSlpGrpu59aKfGq7//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEv/aAAgBAwEBPwGSv//EABYRAQEBAAAAAAAAAAAAAAAAAAEDEP/aAAgBAgEBPwEoZ//EABwQAAEEAwEAAAAAAAAAAAAAAAABESGRAjEyof/aAAgBAQAGPwIjFLOUshRpc34f/8QAHBABAAIBBQAAAAAAAAAAAAAAAQARMVGBkaHR/9oACAEBAAE/ISqcRo7yfAwNbBWrmQUBTekS49J//9oADAMBAAIAAwAAABCsz//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPxCrX//EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQIBAT8Q6Rsb/8QAHhABAQABBAMBAAAAAAAAAAAAAREAITFBcVGx0eH/2gAIAQEAAT8QtS7KuNDkMimIE/HBJJTTVxs8vmEPB1iB2RGye8LNyEn0z//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Te vejo na E3 2020\"\n        title=\"Te vejo na E3 2020\"\n        src=\"/static/33c1a52743b117b1d6186b1c79d76504/63217/e3_see_you_next_year.jpg\"\n        srcset=\"/static/33c1a52743b117b1d6186b1c79d76504/db830/e3_see_you_next_year.jpg 256w,\n/static/33c1a52743b117b1d6186b1c79d76504/8102f/e3_see_you_next_year.jpg 512w,\n/static/33c1a52743b117b1d6186b1c79d76504/63217/e3_see_you_next_year.jpg 1024w,\n/static/33c1a52743b117b1d6186b1c79d76504/d58d1/e3_see_you_next_year.jpg 1536w,\n/static/33c1a52743b117b1d6186b1c79d76504/09658/e3_see_you_next_year.jpg 2048w,\n/static/33c1a52743b117b1d6186b1c79d76504/e7f75/e3_see_you_next_year.jpg 2592w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Te vejo na E3 2020</figcaption>\n  </figure></p>\n<p><a href=\"https://www.techtudo.com.br/noticias/2020/03/e3-2020-maior-feira-de-jogos-e-cancelada-por-conta-do-coronavirus.ghtml\" target=\"_blank\" rel=\"noreferrer\">Yeah…</a></p>\n<h2 id=\"a-e3-ainda-e-relevante\" style=\"position:relative;\"><a href=\"#a-e3-ainda-e-relevante\" aria-label=\"a e3 ainda e relevante permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A E3 ainda é relevante?</h2>\n<p>A E3, a grande convenção de jogos, tem sido um evento polêmico nos últimos anos. Alguns defendem que ela é necessária, enquanto outros argumentam que seu valor diminuiu com o tempo. Eu acho que precisamos da E3 de volta, e aqui estão alguns motivos pelos quais concordo com isso.</p>\n<p>Em primeiro lugar, é verdade que a E3 enfrentou sérios desafios nos últimos anos. O evento, que já havia começado a perder relevância, foi finalmente aberto ao público em 2017, mas não estava preparado para receber tantas pessoas. Isso resultou em filas intermináveis para entrar no evento e assistir às apresentações. Além disso, houve um grande vazamento de dados da E3 de 2019, o que prejudicou ainda mais a imagem do evento.</p>\n<p>No entanto, apesar de todos esses problemas, ainda acho que a E3 é importante. Isso se deve ao fato de que ela é uma ferramenta poderosa para criar buzz e aumentar a expectativa em torno dos lançamentos de jogos. Durante a E3, todos os entusiastas de jogos estão de olho no que está acontecendo, e é uma semana em que podemos esperar ansiosamente pelos lançamentos futuros.</p>\n<p>Sem a E3, ficamos sem ter uma ideia do que esperar da indústria de games no ano seguinte. Mesmo sem a E3, a maioria das empresas ainda usou a época da E3 de 2020 para anunciar seus novos jogos, mas sem o grande evento presencial, não foi a mesma coisa. Por exemplo, por que ainda há anúncios de filmes na Comic Con? Por que eles mostram trailers na Comic Con semanas antes de lançarem no YouTube? A expectativa de finalmente assistir ao trailer, sabendo que outras pessoas já o viram, lendo reações e comentários, é a mesma coisa que acontece na E3.</p>\n<p>Eu fui à Gamescom em 2019 e foi um evento incrível, mas quase todos os jogos que estavam lá já tinham sido anunciados e as apresentações eram as mesmas da E3. Então, apesar de ser um evento até três vezes maior do que a E3, não trouxe a mesma hype.</p>\n<h2 id=\"e-agora\" style=\"position:relative;\"><a href=\"#e-agora\" aria-label=\"e agora permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>E agora?</h2>\n<p>Ainda não está claro se o E3 2023 vai acontecer ou não, mas com a pandemia provavelmente chegando ao fim em breve, há uma boa chance de que a Electronic Software Association (ESA) consiga trazer o E3 de volta no próximo ano. Se isso acontecer, conte comigo! Eu sempre aguardo ansiosamente por participar do E3, pois não é só uma oportunidade de jogar jogos incríveis e conhecer novas pessoas, mas também uma chance de ter uma viagem incrível com meus amigos. Pode ser difícil para nós nos reunirmos, já que todos temos agendas cheias e moramos em países diferentes.</p>\n<p>O E3 é um evento especial para a comunidade de jogos, e é uma pena que tenha sido cancelado em 2020 e 2021 devido à pandemia. Mas tenho grandes expectativas de que ele volte em 2023, e estou ansioso para experimentar toda a emoção e hype que vem com ele. Desde os grandes anúncios de jogos até as demonstrações práticas, não há nada como estar no E3 pessoalmente.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHmWjUMyX//xAAaEAEBAQADAQAAAAAAAAAAAAABAgADESEx/9oACAEBAAEFAg9IFJlytbj6nP3/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFH/8QAHBAAAQQDAQAAAAAAAAAAAAAAEQABAhADISJB/9oACAEBAAY/AmKDS8W8grqJr//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExUXH/2gAIAQEAAT8hoAJfsBarOvIHfx1ExvhRAi8ObDSn/9oADAMBAAIAAwAAABBY/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxCq/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EMU//8QAHBABAQADAAMBAAAAAAAAAAAAAREAITFhceHw/9oACAEBAAE/EGA7cUlL2esKCNPOL8yQi8jiGggXn6YF1KFpFxQMN2HDP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Time Nintendo Blast\"\n        title=\"Time Nintendo Blast\"\n        src=\"/static/98cc107e7213fa6b104251307e7d5c8a/63217/nintendo_blast_crew.jpg\"\n        srcset=\"/static/98cc107e7213fa6b104251307e7d5c8a/db830/nintendo_blast_crew.jpg 256w,\n/static/98cc107e7213fa6b104251307e7d5c8a/8102f/nintendo_blast_crew.jpg 512w,\n/static/98cc107e7213fa6b104251307e7d5c8a/63217/nintendo_blast_crew.jpg 1024w,\n/static/98cc107e7213fa6b104251307e7d5c8a/d58d1/nintendo_blast_crew.jpg 1536w,\n/static/98cc107e7213fa6b104251307e7d5c8a/09658/nintendo_blast_crew.jpg 2048w,\n/static/98cc107e7213fa6b104251307e7d5c8a/49580/nintendo_blast_crew.jpg 3648w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Time Nintendo Blast</figcaption>\n  </figure></p>\n<p>Vamos torcer para que a E3 volte em 2023 e nos vemos lá!</p>","fields":{"postHashId":"Z2FtZXN0cnVlbnVsbDIwMjItMDYtMDFUMDA6MDA6MDAuMDAwWg==","slug":"/2022/2022-06-01-aniversario-de-10-anos-da-minha-primeira-e3.pt-br/","path":"/blog/games/aniversario-de-10-anos-da-minha-primeira-e3/","locale":"pt-br"},"rawMarkdownBody":"Eu me lembro da primeira vez que planejei ir para a E3 com alguns amigos, em 2009. Parecia um sonho distante, apenas a ideia de ir para a E3 já era emocionante o suficiente e me deixava super animado. Naquela época, eu ainda não sabia que a E3 era um evento apenas para a imprensa e que eu nunca poderia simplesmente comprar um ingresso e ir. Claro que, eventualmente, consegui ir para a E3, mas como?\r\n\r\nSempre fui apaixonado por videogames, especialmente pelos jogos da Nintendo, então quando o maior blog brasileiro sobre a Nintendo no Brasil, o Nintendo Blast, estava recrutando novos escritores, tive que me inscrever e, para minha surpresa, fui aceito.\r\n\r\nDepois de entrar no blog, comecei a escrever posts e fazer vídeos para o canal do YouTube deles, e alguns anos depois, recebi um e-mail de um dos editores do blog dizendo que estavam procurando pessoas para viajar para Los Angeles para cobrir a E3. Não acreditei que isso estava realmente acontecendo. Apertei o botão de aplicar tão rápido que quase quebrei meu mouse.\r\n\r\nClaro que, como o Nintendo Blast era movido por trabalho voluntário, eu mesmo teria que arcar com todos os custos da viagem, mas eles me ofereceriam o que nenhum dinheiro poderia comprar: um ingresso para a E3!\r\n\r\nPrimeiro, tive que conseguir um visto para entrar nos EUA, o que é um processo bastante burocrático, mas felizmente meu visto foi aprovado, o hotel e as passagens foram reservados e nossos crachás de imprensa foram emitidos, e tudo o que eu tinha que fazer era esperar até o dia da viagem. Estava tão ansioso que tive problemas para dormir por meses.\r\n\r\n## Primeira vez em Los Angeles\r\nIr para a E3 teve um efeito colateral inesperado: me apaixonar por Los Angeles. Sim, eu sei que é super clichê, mas LA não é apenas a casa da E3, mas também de muitos picos famosos de skate que vi em vídeos de skate durante toda a minha vida, e poder visitar esses picos na vida real foi muito emocionante, cheguei até a comprar um deck da Plan B enquanto estava lá, só para saber como era comprar um deck no estado que foi o berço do skate. Praticamente todos os cantos do centro de LA são picos famosos de skate em algum vídeo dos anos 90.\r\n\r\nEssa também foi minha primeira vez nos EUA, então pela primeira vez experimentei refeições extra grandes no McDonald's, fiz compras na Target, recebi as notas gigantes da CVS, fui a uma GameStop, comprei produtos da Old Spice, fui ao White Castle, e como um fã de Forest Gump, finalmente fui a um restaurante Bubba Gump.\r\n\r\nÉramos um grupo de 7 jovens entusiastas prestes a cobrir o maior evento de videogames do mundo e, embora tivéssemos muitas coisas que queríamos fazer em LA, não tínhamos tempo a perder, pois a E3 estava começando 2 dias depois que desembarcamos.\r\n\r\n## Uma ajudinha dos veteranos\r\nÉramos uma equipe pequena, mas felizmente estávamos no mesmo hotel que alguns editores veteranos da Nintendo World, a revista oficial da Nintendo no Brasil.\r\n\r\nEu lia a Nintendo World desde os 10 anos de idade, e estar lá com essas lendas foi surreal. Eles até escolheram alguns de nós para escrever artigos na revista, infelizmente não fui escolhido, mas só a chance de ser escolhido já era uma das maiores conquistas da minha vida até então.\r\n\r\n![Nintendo World #159](../../uploads/blog/2022/06/nintendo_world_159.jpg)\r\n\r\nEm seguida, tivemos algumas rodadas de reuniões sobre como fazer as coisas na E3, o que acabou sendo super útil e usei em todas as outras edições desde então.\r\n\r\n## Espere, quando começa a E3?\r\nAhhh, a confusão. Toda E3 era a mesma coisa, eu via um artigo online dizendo \"E3 começa nesta data X bla bla bla\" e alguns dias antes, boom conferências da Sony/Microsoft/Nintendo, o quê? Por quê? Depois disso, os próximos dias eram cheios de vídeos de hands-on e posts sobre apresentações secretas de jogos que ainda não tinham gameplay mostrado ao público, etc.\r\n\r\nA questão é que as conferências não fazem oficialmente parte da E3, quer dizer, mais ou menos.\r\n\r\nA E3 é um evento organizado pela ESA que reúne comerciantes e imprensa em um enorme centro de convenções onde as empresas de jogos podem mostrar seus produtos ao mundo, e durante esses dias, todo o mundo dos jogos está de olho na E3, e por isso, todas as grandes empres agendam uma grande coletiva de imprensa alguns dias antes da E3, para que todos os comerciantes e imprensa saibam o que esperar do evento.\r\n\r\nPara nós, que assistimos às conferências da E3 em casa, parece que o evento começa quando as conferências começam e termina após a última conferência. No entanto, o que realmente importa são os anúncios de jogos. Foi uma surpresa para mim descobrir que a conferência da Sony estava localizada a muitos quilômetros do LACC.\r\n\r\nEu achei que todas as conferências aconteciam na E3. Eu sei que parece bobagem, mas foi um choque para mim e, nos anos seguintes, vi muitos outros participantes da E3 terem a mesma confusão.\r\n\r\n## As conferências\r\nPara chegar às famosas conferências da E3, você precisa ser convidado, pelo menos de forma convencional. Mesmo que você não tenha sido convidado, muitas pessoas da imprensa ainda iriam ao local da conferência na esperança de que alguns lugares estivessem disponíveis, e em todas as E3 que eu fui, sempre consegui entrar nas conferências. E mesmo se eu não conseguisse, a adrenalina de não saber se eu conseguiria e todos os telefonemas e contatos tentando conseguir um convite de última hora para entrar já faziam valer a pena a aventura. Infelizmente eu não sabia de tudo isso na minha primeira E3, então nem tentei, e foi o último ano que a Nintendo teve uma conferência convencional da E3.\r\n\r\nAs conferências da E3 são normalmente agendadas em horários e locais específicos, para que as pessoas em Los Angeles possam ir de uma conferência para outra e chegar a tempo. Por exemplo, um dos dias de conferências começaria com a Microsoft de manhã cedo, depois a Ubisoft, depois uma pausa para o almoço e, finalmente, a Sony.\r\n\r\nQuase todas as conferências ofereciam algum tipo de brinde aos participantes, como pulseiras, camisetas, action figures, etc. Muitos desses itens podiam ser encontrados por centenas de dólares no eBay no mesmo dia. Eu, é claro, ainda tenho todos eles e ainda uso pelo menos uma camiseta da E3 toda semana.\r\n\r\nOs locais das conferências sempre foram em lugares famosos de Los Angeles, como a conferência da Bethesda de 2015, que foi no mesmo local dos Oscars, na Hollywood Blvd. A Sony e a Microsoft costumam estar sempre no mesmo local, a LA Memorial Sports Arena e o Galen Center, respectivamente.\r\n\r\n## O evento\r\nA E3 geralmente acontece de terça a quinta-feira, com duração de 3 dias no total, e vou te falar, se você quiser ver tudo, 3 dias não é suficiente. Estar lá é ótimo, mas perdemos muitas coisas. O LA Convention Center é enorme e você passará metade do seu tempo andando de um estande para outro.\r\n\r\nDurante a cobertura do evento, dividimos nossa equipe em times de duas a três pessoas, e todos agendamos horários para entrevistas, apresentações, e demos de jogos com várias empresas diferentes, então o nosso objetivo era chegar na feira a tempo de cumprir todos os nossos compromissos. Marcar horários com antecedência é uma ótima maneira de pular as filas, que às vezes podem durar horas, e como mencionei antes, 3 dias não são suficientes para ver tudo, então \"perder\" tempo em filas pode custar não só o seu precioso tempo, mas também impedi-lo de jogar algum jogo.\r\n\r\nNo meu primeiro ano, eu estava um pouco perdido e não sabia exatamente o que fazer, mas ainda assim, joguei muitos jogos de WiiU e PS3, incluindo ZombiU, Nintendo Land, LittleBigPlanet Karting e PlayStation All-Stars Battle Royale, apenas para citar alguns. Meu jogo favorito daquele ano na verdade não era jogável: Dead Space 3. Foi nesse ano que comecei a me interessar por Dead Space e nessa E3 eu ganhei uma toca do Isaac Clarke que eu uso até hoje.\r\n\r\n![Toca do Dead Space](../../uploads/blog/2022/06/dead_space_beenie.jpg)\r\n\r\nO LA Convention Center é enorme, e tem duas áreas principais onde é possível encontrar vários estandes de diferentes empresas e também algumas outras salas de reunião onde as empresas geralmente têm suas áreas VIP com apresentações e demos.\r\n\r\nAs duas áreas principais da E3 estão conectadas por uma enorme área aberta ao público, repleta de atividades e jogos exclusivos para serem jogados. Caminhar de uma área principal para a outra pode levar cerca de 10 minutos, por isso era importante marcar horários próximos uns dos outros para não ficar preso na área aberta ao público durante muito tempo.\r\n\r\nHá também uma sala especial para a imprensa, equipada com computadores de alta velocidade para que os jornalistas possam editar seus artigos e vídeos rapidamente e divulgar todas as notícias para o mundo. Além disso, há uma sala de relaxamento especial, onde podemos descansar e até mesmo almoçar de graça por volta do meio-dia. É incrível.\r\n\r\nDurante nosso tempo \"livre\", podemos explorar e encontrar coisas interessantes para cobrir. Tenho que admitir que passei a maior parte do meu tempo livre no estande da Nintendo, tentando jogar o máximo de jogos possíveis e colecionar o máximo de brindes possíveis. Ah, sim, uma das outras coisas incríveis da E3 é receber muitos brindes incríveis de graça, como chaveiros, camisetas, etc.\r\n\r\n## Os brindes\r\nUm dos aspectos mais incríveis da E3 são os brindes, não apenas porque são oferecidos de graça, mas também porque consegui-los é uma experiência muito divertida e emocionante, assim como entrar nas conferências.\r\n\r\nCada estande tem seus próprios brindes e maneiras de obtê-los, que mudam a cada ano. Na minha primeira E3, no estande da Nintendo, cada minijogo que jogávamos no Nintendo Land nos rendia um broche correspondente e o objetivo era colecionar todos eles, o que consegui fazer.\r\n\r\n![Broches do Nintendo Land](../../uploads/blog/2022/06/nintendo_land_swags.jpg)\r\n\r\nOs brindes da E3 são uma das coisas mais incríveis do evento, não apenas porque são gratuitos, mas porque tentar conseguir os brindes é uma experiência divertida e emocionante, assim como entrar nas conferências. Cada estande tem seus próprios brindes e maneiras de obtê-los, que mudam a cada ano. Em minha primeira E3, no estande da Nintendo, recebíamos um broche para cada mini-jogo que jogávamos no Nintendo Land, e o objetivo era colecionar todos. Alguns brindes exigiam que você jogasse contra outros participantes do evento e os ganhasse, como a camisa do Smash de 2014. Eu sou péssimo no Smash, mas sortudamente meu amigo Danilo, do site Hyrule Legends, jogou e ganhou uma camisa para mim.\r\n\r\nAlguns brindes bastava pedir e eles seriam dados, mas às vezes eles se esgotavam rapidamente e era preciso esperar até o dia seguinte para tentar conseguir um. Para um colecionador como eu, esses brindes são sempre bem-vindos, mas os melhores são os que podemos usar no dia a dia, como mencionei anteriormente, quase toda semana uso uma camiseta diferente que ganhei de graça na E3. A minha favorita é provavelmente a camiseta Lego Dimensions de 2015, que na verdade não era um brinde, mas era a camiseta que o pessoal do estande da Warner estava usando, e de alguma forma consegui convencê-los a me dar uma.\r\n\r\n![T-shirt Lego Dimensions](../../uploads/blog/2022/06/lego_dimensions_shirt.jpg)\r\n\r\nBrindes como essa camiseta são chamados de *ultimate swags* (pelo menos é assim que eu os chamo), são itens que não estão realmente disponíveis como brindes, mas que você consegue adquiri-los de alguma forma, como tentei fazer com a garrafa de água para o pessoal do estande na E3 de 2012, mas não consegui. No entanto, no ano seguinte, tentei durante todos os três dias da feira e acabei conseguindo uma no último dia.\r\n\r\n![Garrafa de água da equipe do estande](../../uploads/blog/2022/06/nintendo_staff_water_bottle.jpg)\r\n\r\nNo final de cada dia da E3, eu e meus amigos nos reuníamos para um bom jantar e conversávamos sobre todos os brindes que coletamos e como os conseguimos. É claro que também falávamos sobre todos os jogos que jogamos e como foi o dia em geral para nós também.\r\n\r\nEu geralmente reservava meu último dia quase sem compromissos, para poder andar por aí e tentar pegar todos os brindes que perdi nos outros dias e jogar novamente os jogos que mais gostei. Então, depois do último dia, eu e meus amigos reuníamos todos os nossos brindes e compras relacionadas a jogos em cima da cama do hotel para uma foto épica.\r\n\r\n![Brindes da E3 2017](../../uploads/blog/2022/06/e3_swags_2017.jpg)\r\n\r\n## A comida\r\nNa E3, havia várias opções para se alimentar. Se você era da imprensa, poderia conseguir um almoço de graça na sala de imprensa. Caso contrário, poderia optar por pagar valores mais altos em lanchonetes no centro de convenções.\r\n\r\nNo entanto, se tivesse sorte, talvez nem precisasse parar para comer, pois alguns estandes ofereciam lanches para os jogadores. Foi assim que eu me alimentei na maior parte da E3 - jogando e comendo lanches. Afinal, por que interromper o jogo para comer quando estava na maior convenção de jogos do mundo?\r\n\r\n![Snacks da CD Projekt Red](../../uploads/blog/2022/06/e3_booth_food.jpg)\r\n\r\n## Conhecendo seus heróis\r\nEsta é possivelmente uma das melhores coisas da E3, se você for muito sortudo, poderá conhecer as pessoas que fazem os jogos que você ama.\r\n\r\nHá várias maneiras de fazer isso. Se você for parte da imprensa, pode marcar uma entrevista ou uma demonstração de um jogo com eles. Outra opção é simplesmente caminhar pelo evento e encontrá-los por acaso.\r\n\r\nFoi assim que conheci Hideo Kojima e, em outra ocasião, cruzei com Shigeru Miyamoto saindo do banheiro e consegui um autógrafo dele! Desculpe por isso, Miyamoto 😅\r\n\r\n![Eu e Kojima](../../uploads/blog/2022/06/me_and_kojima.jpg)\r\n\r\nUma das maneiras mais emocionantes de conhecer os criadores de jogos que amamos é esperando na entrada do LACC bem cedo de manhã. É uma oportunidade única de ver todos eles passando por lá, embora muitas vezes eles estejam com pressa devido a suas agendas lotadas e acompanhados por seguranças.\r\n\r\nMas às vezes eles não estão tão ocupados e têm tempo para dar um pouco de amor a nós, meros mortais. Foi assim que conheci o Miyamoto pela primeira vez e consegui meu 3DS Zelda Edition autografado por ele, que agora é o meu item de colecionador favorito em minha coleção.\r\n\r\n![Eu e Miyamoto](../../uploads/blog/2022/06/me_and_miyamoto.jpg)\r\n\r\nDepois de conseguir o autógrafo do Miyamoto, compartilhei minha experiência com alguns amigos e eles também tentaram nos dias seguintes, conseguindo autógrafos de seus próprios heróis.\r\n\r\nEles também contaram sobre isso para outros amigos e, ao longo dos anos, um grande grupo de brasileiros, que nem se conheciam, começou a se reunir para esperar pelos heróis durante o evento e tirar fotos e pedir autógrafos.\r\n\r\n![Hue Hue BR](../../uploads/blog/2022/06/hue_hue_br.png)\r\n\r\nDesde que a E3 foi aberta ao público, todas as pessoas famosas e aquelas que trabalham na feira têm um acesso diferente ao evento, então, infelizmente, não é mais possível usar esse \"truque\".\r\n\r\n## Festas da E3\r\nEu acordava cedo todos os dias da E3, às 6h da manhã, para chegar ao centro de convenções cedo e evitar filas para jogar alguns dos novos títulos. Eu continuava jogando até por volta das 18h, quando o evento encerrava naquele dia. Depois disso, eu precisava reunir meus equipamentos e encontrar meus amigos, então já eram por volta das 20h quando eu finalmente estava pronto para ir para a cama - a menos, é claro, que houvesse uma festa para participar.\r\n\r\nAlgumas dessas festas eram exclusivas para a imprensa, outras eram abertas para qualquer entusiasta de jogos em LA. Algumas eram pagas, outras eram gratuitas. Algumas ofereciam comida e bebida grátis, enquanto outras tinham brindes. Havia um tipo de festa para todos e eu sempre ficava feliz em participar.\r\n\r\nA melhor parte dessas festas era poder conhecer novas pessoas e sair com meus amigos, conversar sobre o dia e ficar empolgado com todas as novidades sobre jogos que viriam no próximo ano.\r\n\r\n![festa do PC Game Show](../../uploads/blog/2022/06/pc_game_show_party.jpg)\r\n\r\n## Dias pós E3\r\nNa minha primeira E3, não tivemos tempo para explorar tudo o que Los Angeles oferecia, como passear pelo píer de Santa Monica, visitar lojas de jogos retrô, como a Game Dude, conhecer a Universal Studios, a Calçada da Fama em Hollywood e o Hollywood Sinal. Ficamos apenas uma semana lá, o suficiente para participar das conferências, da E3 e um dia extra para fazer compras, mas apenas isso.\r\n\r\nEm todas as minhas outras viagens à E3, fiquei pelo menos duas semanas. O suficiente para participar da E3 e ainda explorar o que mais LA tem a oferecer.\r\n\r\nEntão, todo ano, depois que a E3 terminava, eu e meus amigos ainda tínhamos uma semana inteira para fazer coisas, procurar jogos em promoção, comer junk food e fazer outras atividades turísticas. Uma vez até fomos para Las Vegas durante um fim de semana, foi incrível!\r\n\r\n## Voltando para casa\r\nA despedida da E3 sempre foi um momento triste, especialmente durante minha primeira viagem a LA, que foi a viagem mais divertida que já tive.\r\n\r\nVoltar para casa sempre foi um pouco triste, mas pelo menos eu sabia que voltaria para Los Angeles no próximo ano para a E3. Ou pelo menos era o que eu pensava até 2019 😅.\r\n\r\n![Te vejo na E3 2020](../../uploads/blog/2022/06/e3_see_you_next_year.jpg)\r\n\r\n[Yeah...](https://www.techtudo.com.br/noticias/2020/03/e3-2020-maior-feira-de-jogos-e-cancelada-por-conta-do-coronavirus.ghtml)\r\n\r\n## A E3 ainda é relevante?\r\nA E3, a grande convenção de jogos, tem sido um evento polêmico nos últimos anos. Alguns defendem que ela é necessária, enquanto outros argumentam que seu valor diminuiu com o tempo. Eu acho que precisamos da E3 de volta, e aqui estão alguns motivos pelos quais concordo com isso.\r\n\r\nEm primeiro lugar, é verdade que a E3 enfrentou sérios desafios nos últimos anos. O evento, que já havia começado a perder relevância, foi finalmente aberto ao público em 2017, mas não estava preparado para receber tantas pessoas. Isso resultou em filas intermináveis para entrar no evento e assistir às apresentações. Além disso, houve um grande vazamento de dados da E3 de 2019, o que prejudicou ainda mais a imagem do evento.\r\n\r\nNo entanto, apesar de todos esses problemas, ainda acho que a E3 é importante. Isso se deve ao fato de que ela é uma ferramenta poderosa para criar buzz e aumentar a expectativa em torno dos lançamentos de jogos. Durante a E3, todos os entusiastas de jogos estão de olho no que está acontecendo, e é uma semana em que podemos esperar ansiosamente pelos lançamentos futuros.\r\n\r\nSem a E3, ficamos sem ter uma ideia do que esperar da indústria de games no ano seguinte. Mesmo sem a E3, a maioria das empresas ainda usou a época da E3 de 2020 para anunciar seus novos jogos, mas sem o grande evento presencial, não foi a mesma coisa. Por exemplo, por que ainda há anúncios de filmes na Comic Con? Por que eles mostram trailers na Comic Con semanas antes de lançarem no YouTube? A expectativa de finalmente assistir ao trailer, sabendo que outras pessoas já o viram, lendo reações e comentários, é a mesma coisa que acontece na E3.\r\n\r\nEu fui à Gamescom em 2019 e foi um evento incrível, mas quase todos os jogos que estavam lá já tinham sido anunciados e as apresentações eram as mesmas da E3. Então, apesar de ser um evento até três vezes maior do que a E3, não trouxe a mesma hype.\r\n\r\n## E agora?\r\nAinda não está claro se o E3 2023 vai acontecer ou não, mas com a pandemia provavelmente chegando ao fim em breve, há uma boa chance de que a Electronic Software Association (ESA) consiga trazer o E3 de volta no próximo ano. Se isso acontecer, conte comigo! Eu sempre aguardo ansiosamente por participar do E3, pois não é só uma oportunidade de jogar jogos incríveis e conhecer novas pessoas, mas também uma chance de ter uma viagem incrível com meus amigos. Pode ser difícil para nós nos reunirmos, já que todos temos agendas cheias e moramos em países diferentes.\r\n\r\nO E3 é um evento especial para a comunidade de jogos, e é uma pena que tenha sido cancelado em 2020 e 2021 devido à pandemia. Mas tenho grandes expectativas de que ele volte em 2023, e estou ansioso para experimentar toda a emoção e hype que vem com ele. Desde os grandes anúncios de jogos até as demonstrações práticas, não há nada como estar no E3 pessoalmente.\r\n\r\n![Time Nintendo Blast](../../uploads/blog/2022/06/nintendo_blast_crew.jpg)\r\n\r\nVamos torcer para que a E3 volte em 2023 e nos vemos lá!\r\n","frontmatter":{"tags":["e3","e3 2012","games","los angeles","lacc","convention center","nintendo","sony","microsoft","gameblast","media","jornalismo"],"categories":["games"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-06-01T00:00:00.000Z","id":null,"path":"aniversario-de-10-anos-da-minha-primeira-e3","show":true,"title":"Aniversário de 10 anos da minha primeira E3","hideExcerpt":false,"subtitle":"10 anos atrás eu estava embarcando em uma jornada para minha primeira conferência na E3."}}},{"node":{"excerpt":"I constantly write about code and share code snippets in my…","html":"<p>I constantly write about code and share code snippets in my blog posts and copy-pasting code is an essential skill for software engineers, and since selecting a text then pressing <code class=\"language-text\">CTRL + C</code> then <code class=\"language-text\">CTRL + V</code> is a lot of work, I decided to add a copy button to all my code snippets to facilitate the life of all my fellow software engineers.</p>\n<h2 id=\"possible-solutions\" style=\"position:relative;\"><a href=\"#possible-solutions\" aria-label=\"possible solutions permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Possible solutions</h2>\n<p>The proper way to do this is by creating a plugin to tap into the Gatsby HTML generation process and access the code snippets object in the AST data structure. There is a <a href=\"https://thundermiracle.medium.com/add-copy-button-to-your-gatsbyjs-blogs-code-block-a2711364a229\" target=\"_blank\" rel=\"noreferrer\">very nice tutorial</a> by <a href=\"https://thundermiracle.medium.com/\" target=\"_blank\" rel=\"noreferrer\">@thundermiracle</a> on how to do this.</p>\n<p>Of course, I decided to do it the shitty way, which is by altering the HTML string on the <code class=\"language-text\">createPages</code> function in the <code class=\"language-text\">gatsby-node.js</code> file.</p>\n<h2 id=\"the-code\" style=\"position:relative;\"><a href=\"#the-code\" aria-label=\"the code permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The code</h2>\n<p>Inside the loop that creates the post pages, I added the following code on <code class=\"language-text\">gatsby-node.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> /* some graphQL query */ </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">edge</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> alternativeHtml <span class=\"token operator\">=</span> <span class=\"token function\">generateAlternativeHtml</span><span class=\"token punctuation\">(</span>edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        actions<span class=\"token punctuation\">.</span><span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/PostTemplate.jsx</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> alternativeHtml <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>For the <code class=\"language-text\">generateAlternativeHtml</code> function I will use the <a href=\"https://www.npmjs.com/package/jsdom\" target=\"_blank\" rel=\"noreferrer\">jsdom</a> package to parse the HTML string and convert it to a DOM object and use the <code class=\"language-text\">querySelectorAll</code> method to find all the code snippets and add the copy button to them.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">generateAlternativeHtml</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">html</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> dom <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JSDOM</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> document <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> dom<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> codeSnippets <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.gatsby-highlight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    codeSnippets<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">codeSnippet</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> wrapper <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        wrapper<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'copy-code-block'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// add your own css styles here, css classes, etc.</span>\r\n        <span class=\"token keyword\">const</span> copyButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        copyButton<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Copy'</span><span class=\"token punctuation\">;</span>\r\n        codeSnippet<span class=\"token punctuation\">.</span><span class=\"token function\">insertAdjacentHTML</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">afterend</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> copyButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now all the code snippets will have a copy button, but the button doesn’t do anything. I will add the <code class=\"language-text\">onclick</code> event handler to the copy button to copy the code snippet to the clipboard. That needs to be done in the <code class=\"language-text\">React</code> part of the code with an <code class=\"language-text\">useEffect</code> in the <code class=\"language-text\">PostTemplate.jsx</code> file.</p>\n<p>To copy the code snippet to the clipboard I will use the <a href=\"https://www.npmjs.com/package/clipboard-copy\" target=\"_blank\" rel=\"noreferrer\">clipboard-copy</a> package.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> copy <span class=\"token keyword\">from</span> <span class=\"token string\">'clipboard-copy'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">BlogPostTemplate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> pageContext <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> alternativeHtml <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> pageContext<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> codeSnippets <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.copy-code-block button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        codeSnippets<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">elementWrapper</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n            codeSnippet<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">const</span> codeSnippet <span class=\"token operator\">=</span> elementWrapper<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.gatsby-highlight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> codeSnippet<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>section<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>markdownRemark<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>div dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> alternativeHtml <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>section<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Done! Hacky and gross, but also beautiful in many ways.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>This solution adds a tiny bit of overhead to the Static Site Generator process and some DOM manipulation in the client, but it’s a good solution for the time being. If you’re looking for a quick and easy solution, this is the way to go.</p>\n<p>That’s it for this post. I hope you enjoyed it.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA1LTA1VDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-05-05-adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way.en/","path":"/blog/coding/adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way/","locale":"en"},"rawMarkdownBody":"I constantly write about code and share code snippets in my blog posts and copy-pasting code is an essential skill for software engineers, and since selecting a text then pressing `CTRL + C` then `CTRL + V` is a lot of work, I decided to add a copy button to all my code snippets to facilitate the life of all my fellow software engineers.\r\n\r\n## Possible solutions\r\nThe proper way to do this is by creating a plugin to tap into the Gatsby HTML generation process and access the code snippets object in the AST data structure. There is a [very nice tutorial](https://thundermiracle.medium.com/add-copy-button-to-your-gatsbyjs-blogs-code-block-a2711364a229) by [@thundermiracle](https://thundermiracle.medium.com/) on how to do this.\r\n\r\nOf course, I decided to do it the shitty way, which is by altering the HTML string on the `createPages` function in the `gatsby-node.js` file.\r\n\r\n## The code\r\nInside the loop that creates the post pages, I added the following code on `gatsby-node.js`:\r\n\r\n```javascript\r\nexports.createPages = async function ({ actions, graphql }) {\r\n    const { data } = await graphql(` /* some graphQL query */ `);\r\n    data.allMarkdownRemark.edges.forEach((edge) => {\r\n        const alternativeHtml = generateAlternativeHtml(edge.node.html);\r\n        actions.createPage({\r\n            component: require.resolve(`./src/templates/PostTemplate.jsx`),\r\n            context: { alternativeHtml },\r\n        })\r\n    })\r\n}\r\n```\r\n\r\nFor the `generateAlternativeHtml` function I will use the [jsdom](https://www.npmjs.com/package/jsdom) package to parse the HTML string and convert it to a DOM object and use the `querySelectorAll` method to find all the code snippets and add the copy button to them.\r\n\r\n```javascript\r\nfunction generateAlternativeHtml(html) {\r\n    const dom = new JSDOM(html);\r\n    const { document } = dom.window;\r\n    const codeSnippets = document.querySelectorAll('.gatsby-highlight');\r\n\r\n    codeSnippets.forEach((codeSnippet) => {\r\n        const wrapper = document.createElement('div');\r\n        wrapper.classList.add('copy-code-block');\r\n\r\n        // add your own css styles here, css classes, etc.\r\n        const copyButton = document.createElement('button');\r\n        copyButton.innerHTML = 'Copy';\r\n        codeSnippet.insertAdjacentHTML(`afterend`, copyButton);\r\n    });\r\n\r\n    return document.body.innerHTML;\r\n}\r\n```\r\n\r\nNow all the code snippets will have a copy button, but the button doesn't do anything. I will add the `onclick` event handler to the copy button to copy the code snippet to the clipboard. That needs to be done in the `React` part of the code with an `useEffect` in the `PostTemplate.jsx` file.\r\n\r\nTo copy the code snippet to the clipboard I will use the [clipboard-copy](https://www.npmjs.com/package/clipboard-copy) package.\r\n\r\n```javascript\r\nimport copy from 'clipboard-copy';\r\n\r\nconst BlogPostTemplate = ({ data, pageContext }) => {\r\n    const { alternativeHtml } = pageContext;\r\n\r\n    useEffect(() => {\r\n        const codeSnippets = document.querySelectorAll('.copy-code-block button');\r\n        codeSnippets.forEach((elementWrapper) => {\r\n            codeSnippet.addEventListener('click', () => {\r\n                const codeSnippet = elementWrapper.parentElement.querySelector('.gatsby-highlight');\r\n                const code = codeSnippet.innerHTML;\r\n                copy(code);\r\n            });\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <section>\r\n            <h1>{data.markdownRemark.frontmatter.title}</h1>\r\n            <div dangerouslySetInnerHTML={{ __html: alternativeHtml }} />\r\n        </section>\r\n    );\r\n};\r\n```\r\n\r\nDone! Hacky and gross, but also beautiful in many ways.\r\n\r\n## Conclusion\r\nThis solution adds a tiny bit of overhead to the Static Site Generator process and some DOM manipulation in the client, but it's a good solution for the time being. If you're looking for a quick and easy solution, this is the way to go.\r\n\r\nThat's it for this post. I hope you enjoyed it.\r\n","frontmatter":{"tags":["gatsby","html","code snippets","node","nodejs","javascript","dom","ast"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-05-05T00:00:00.000Z","id":null,"path":"adding-a-copy-button-to-code-snippets-on-gatsby-the-lazy-way","show":true,"title":"Adding a copy button to code snippets on Gatsby: The lazy way","hideExcerpt":false,"subtitle":"Don't feel like creating a Gatsby plugin? Then this blog post is for you."}}},{"node":{"excerpt":"Eu constantemente escrevo sobre programação e compartilho…","html":"<p>Eu constantemente escrevo sobre programação e compartilho trechos de código nos meus posts, e copiar e colar código é uma habilidade essencial para qualquer programador, e como selecionar um texto e pressionar <code class=\"language-text\">CTRL + C</code> então <code class=\"language-text\">CTRL + V</code> é muito trabalhoso, eu decidi adicionar um botão de cópia a todos os meus códigos para facilitar a vida de todos os meus colegas programadores da internet.</p>\n<h2 id=\"possiveis-solucoes\" style=\"position:relative;\"><a href=\"#possiveis-solucoes\" aria-label=\"possiveis solucoes permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Possíveis soluções</h2>\n<p>A maneira correta de fazer isso é criar um plugin para acessar o processo de geração de HTML do Gatsby e acessar o objeto que contém o código na estrutura de dados AST. Existe um <a href=\"https://thundermiracle.medium.com/add-copy-button-to-your-gatsbyjs-blogs-code-block-a2711364a229\" target=\"_blank\" rel=\"noreferrer\">tutorial muito bom</a> feito pelo <a href=\"https://thundermiracle.medium.com/\" target=\"_blank\" rel=\"noreferrer\">@thundermiracle</a> sobre como fazer isso.</p>\n<p>Claro, eu decidi fazer isso do jeito preguiçoso e com gambiarras, que é alterando a string HTML na função <code class=\"language-text\">createPages</code> no arquivo <code class=\"language-text\">gatsby-node.js</code>.</p>\n<h2 id=\"o-codigo\" style=\"position:relative;\"><a href=\"#o-codigo\" aria-label=\"o codigo permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O código</h2>\n<p>Dentro do loop que cria as páginas dos posts, eu adicionei o seguinte código no arquivo <code class=\"language-text\">gatsby-node.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> actions<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"> /* some graphQL query */ </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">edge</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> alternativeHtml <span class=\"token operator\">=</span> <span class=\"token function\">generateAlternativeHtml</span><span class=\"token punctuation\">(</span>edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        actions<span class=\"token punctuation\">.</span><span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/PostTemplate.jsx</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> alternativeHtml <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Para a função <code class=\"language-text\">generateAlternativeHtml</code>, usarei o pacote <a href=\"https://www.npmjs.com/package/jsdom\" target=\"_blank\" rel=\"noreferrer\">jsdom</a> para analisar a string HTML e convertê-la em um objeto DOM e usar o método <code class=\"language-text\">querySelectorAll</code> para encontrar todos os nodes com código no post e adicione o botão de cópia a eles.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">generateAlternativeHtml</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">html</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> dom <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JSDOM</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> document <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> dom<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> codeSnippets <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.gatsby-highlight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    codeSnippets<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">codeSnippet</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> wrapper <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        wrapper<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'copy-code-block'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// add your own css styles here, css classes, etc.</span>\r\n        <span class=\"token keyword\">const</span> copyButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        copyButton<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Copy'</span><span class=\"token punctuation\">;</span>\r\n        codeSnippet<span class=\"token punctuation\">.</span><span class=\"token function\">insertAdjacentHTML</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">afterend</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> copyButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Agora todos os nodes de código terão um botão de cópia, mas o botão não faz nada. Para resolver isso, vou adicionar eventos <code class=\"language-text\">onclick</code> aos botões de cópia para quando o botão for clicado, copiar o código. Isso precisa ser feito na parte <code class=\"language-text\">React</code> do código com um <code class=\"language-text\">useEffect</code> no arquivo <code class=\"language-text\">PostTemplate.jsx</code>.</p>\n<p>Para copiar o código usarei o pacote <a href=\"https://www.npmjs.com/package/clipboard-copy\" target=\"_blank\" rel=\"noreferrer\">clipboard-copy</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> copy <span class=\"token keyword\">from</span> <span class=\"token string\">'clipboard-copy'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">BlogPostTemplate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> pageContext <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> alternativeHtml <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> pageContext<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> codeSnippets <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.copy-code-block button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        codeSnippets<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">elementWrapper</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n            codeSnippet<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">const</span> codeSnippet <span class=\"token operator\">=</span> elementWrapper<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.gatsby-highlight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> codeSnippet<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\r\n                <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>section<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>markdownRemark<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>div dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> alternativeHtml <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>section<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Feito! Super gambiarrado, but hey, it works! :)</p>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Essa solução adiciona um pouco de sobrecarga ao processo Static Site Generator e alguma manipulação de DOM no cliente, mas é uma boa solução por enquanto. Se você está procurando uma solução rápida e fácil, este é o melhor jeito de fazer.</p>\n<p>É isso pessoal, espero que esse post tenha sido útil para você.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA1LTA1VDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-05-05-adicionando-botao-para-copiar-code-snippets-no-gatsby-gambiarra.pt-br/","path":"/blog/coding/adicionando-botao-para-copiar-code-snippets-no-gatsby-gambiarra/","locale":"pt-br"},"rawMarkdownBody":"Eu constantemente escrevo sobre programação e compartilho trechos de código nos meus posts, e copiar e colar código é uma habilidade essencial para qualquer programador, e como selecionar um texto e pressionar `CTRL + C` então `CTRL + V` é muito trabalhoso, eu decidi adicionar um botão de cópia a todos os meus códigos para facilitar a vida de todos os meus colegas programadores da internet.\r\n\r\n## Possíveis soluções\r\nA maneira correta de fazer isso é criar um plugin para acessar o processo de geração de HTML do Gatsby e acessar o objeto que contém o código na estrutura de dados AST. Existe um [tutorial muito bom](https://thundermiracle.medium.com/add-copy-button-to-your-gatsbyjs-blogs-code-block-a2711364a229) feito pelo [@thundermiracle](https://thundermiracle.medium.com/) sobre como fazer isso.\r\n\r\nClaro, eu decidi fazer isso do jeito preguiçoso e com gambiarras, que é alterando a string HTML na função `createPages` no arquivo `gatsby-node.js`.\r\n\r\n## O código\r\nDentro do loop que cria as páginas dos posts, eu adicionei o seguinte código no arquivo `gatsby-node.js`:\r\n\r\n```javascript\r\nexports.createPages = async function ({ actions, graphql }) {\r\n    const { data } = await graphql(` /* some graphQL query */ `);\r\n    data.allMarkdownRemark.edges.forEach((edge) => {\r\n        const alternativeHtml = generateAlternativeHtml(edge.node.html);\r\n        actions.createPage({\r\n            component: require.resolve(`./src/templates/PostTemplate.jsx`),\r\n            context: { alternativeHtml },\r\n        })\r\n    })\r\n}\r\n```\r\n\r\nPara a função `generateAlternativeHtml`, usarei o pacote [jsdom](https://www.npmjs.com/package/jsdom) para analisar a string HTML e convertê-la em um objeto DOM e usar o método `querySelectorAll` para encontrar todos os nodes com código no post e adicione o botão de cópia a eles.\r\n\r\n```javascript\r\nfunction generateAlternativeHtml(html) {\r\n    const dom = new JSDOM(html);\r\n    const { document } = dom.window;\r\n    const codeSnippets = document.querySelectorAll('.gatsby-highlight');\r\n\r\n    codeSnippets.forEach((codeSnippet) => {\r\n        const wrapper = document.createElement('div');\r\n        wrapper.classList.add('copy-code-block');\r\n\r\n        // add your own css styles here, css classes, etc.\r\n        const copyButton = document.createElement('button');\r\n        copyButton.innerHTML = 'Copy';\r\n        codeSnippet.insertAdjacentHTML(`afterend`, copyButton);\r\n    });\r\n\r\n    return document.body.innerHTML;\r\n}\r\n```\r\n\r\nAgora todos os nodes de código terão um botão de cópia, mas o botão não faz nada. Para resolver isso, vou adicionar eventos `onclick` aos botões de cópia para quando o botão for clicado, copiar o código. Isso precisa ser feito na parte `React` do código com um `useEffect` no arquivo `PostTemplate.jsx`.\r\n\r\nPara copiar o código usarei o pacote [clipboard-copy](https://www.npmjs.com/package/clipboard-copy).\r\n\r\n```javascript\r\nimport copy from 'clipboard-copy';\r\n\r\nconst BlogPostTemplate = ({ data, pageContext }) => {\r\n    const { alternativeHtml } = pageContext;\r\n\r\n    useEffect(() => {\r\n        const codeSnippets = document.querySelectorAll('.copy-code-block button');\r\n        codeSnippets.forEach((elementWrapper) => {\r\n            codeSnippet.addEventListener('click', () => {\r\n                const codeSnippet = elementWrapper.parentElement.querySelector('.gatsby-highlight');\r\n                const code = codeSnippet.innerHTML;\r\n                copy(code);\r\n            });\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <section>\r\n            <h1>{data.markdownRemark.frontmatter.title}</h1>\r\n            <div dangerouslySetInnerHTML={{ __html: alternativeHtml }} />\r\n        </section>\r\n    );\r\n};\r\n```\r\n\r\nFeito! Super gambiarrado, but hey, it works! :)\r\n\r\n## Conclusão\r\nEssa solução adiciona um pouco de sobrecarga ao processo Static Site Generator e alguma manipulação de DOM no cliente, mas é uma boa solução por enquanto. Se você está procurando uma solução rápida e fácil, este é o melhor jeito de fazer.\r\n\r\nÉ isso pessoal, espero que esse post tenha sido útil para você.\r\n","frontmatter":{"tags":["gatsby","html","code snippets","node","nodejs","javascript","dom","ast"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-05-05T00:00:00.000Z","id":null,"path":"adicionando-botao-para-copiar-code-snippets-no-gatsby-gambiarra","show":true,"title":"Adicionando botão para copiar code snippets no Gatsby (gambiarra)","hideExcerpt":false,"subtitle":"Não quer criar um plugin para o Gatsby? Então este post é para você."}}},{"node":{"excerpt":"Webpack é o bundler de módulos mais popular para JavaScript…","html":"<p>Webpack é o <em>bundler</em> de módulos mais popular para JavaScript, é uma ferramenta para agrupar módulos em um único arquivo e mais.</p>\n<p>Uma coisa que sempre me deixou curioso foi como ele resolve os <em>imports</em> dinâmicos, quer dizer, eu sabia que não era mágica, mas não sabia como funcionava, e sempre esquecia de pesquisar depois… até agora.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1007px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.67187499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVQY022QXW6DMBCEuU1VAokxxMTBib22sdeGQP7al6oX6Al6/IpQ0aqqNNqX0czufkkBmDVmtdcph5TDaq8X5cLmws7uv0oKiPmhpToWEHJhFyPlQCEc+jtV+Lv0u+sxk8r0RCJzY+3PzA1ZY9aHNmvM5uhYe2ritXbDnEk55MISFTYSqY5EYlL7cdsOFCJzQ+3HpXvnR/fyvvPjsb8T6anCtbCZsKXpiMLKnogKSY0X5oat7anutu60hDme5fBKIZQ6ljoWCol0ubAUIlFh2qwwmbxHkuoouvtqP51dKNy5YR8urD1tbZ81Zj47E3bnRwqR47k0XUIklrZv4o1InIGlHEodK9OV02OeQvgDOeXwxGTKIeF4IQrzxj6QwoJ01ubofmKNea6Plb/ePj7D6xtr+y/liXJ/sFdToQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Mágica?\"\n        title=\"Mágica?\"\n        src=\"/static/e6e021a037da7763c8f6affd02c34110/b82a7/webpack-magic.png\"\n        srcset=\"/static/e6e021a037da7763c8f6affd02c34110/e3135/webpack-magic.png 256w,\n/static/e6e021a037da7763c8f6affd02c34110/06341/webpack-magic.png 512w,\n/static/e6e021a037da7763c8f6affd02c34110/b82a7/webpack-magic.png 1007w\"\n        sizes=\"(max-width: 1007px) 100vw, 1007px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Mágica?</figcaption>\n  </figure></p>\n<h2 id=\"como-funciona-o-import-de-arquivos\" style=\"position:relative;\"><a href=\"#como-funciona-o-import-de-arquivos\" aria-label=\"como funciona o import de arquivos permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Como funciona o import de arquivos</h2>\n<p>Sempre que você importar um arquivo em seu código, o Webpack irá procurá-lo na pasta do projeto e copiá-lo para a pasta de <code class=\"language-text\">build</code> com um novo nome, então o Webpack substituirá o código que importa esse arquivo em seu arquivo JavaScript pelo <em>path</em> para o arquivo recém-copiado.</p>\n<p>Aqui está um exemplo super simplificado:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// import on your app.js file</span>\r\n<span class=\"token keyword\">import</span> utils <span class=\"token keyword\">from</span> <span class=\"token string\">'./helpers/utils.js'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// import on the bundled file</span>\r\n<span class=\"token keyword\">import</span> utils <span class=\"token keyword\">from</span> <span class=\"token string\">'./build/09wdj0wjd.bundle.0.js'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"o-que-e-um-import-dinamico\" style=\"position:relative;\"><a href=\"#o-que-e-um-import-dinamico\" aria-label=\"o que e um import dinamico permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O que é um import dinâmico?</h2>\n<p>Às vezes você não quer que o browser baixe o arquivo imediatamente, você quer carregá-lo apenas quando for necessário, e para isso, você pode usar um <em>import</em> dinâmico.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nbutton<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Click me'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// when the button is clicked, a dynamic import will happen</span>\r\nbutton<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./helpers/utils.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Dynamic import'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>É possível usar <em>import</em> dinâmicos com praticamente qualquer arquivo, por isso é bastante útil para imagens ou arquivos de áudio grandes, por exemplo.</p>\n<p>Mas o que acontece quando você quer importar um arquivo com um <em>path</em> variável?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fileName <span class=\"token operator\">=</span> <span class=\"token string\">'image.jpg'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nbutton<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Click me'</span><span class=\"token punctuation\">;</span>\r\nbutton<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./assets/images/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fileName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Como o Webpack sabe qual arquivo copiar para a pasta <code class=\"language-text\">build</code>? Bem, existe uma maneira de dizer ao Webpack para ignorar o <em>import</em> e deixar o browser resolve-lo como quiser com o comentário <code class=\"language-text\">/* webpackIgnore: true */</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token string\">'assets/images/image.jpg'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// the browser will resolve this import and fail if the file doesn't exist</span>\r\n<span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/*webpackIgnore: true*/</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Isso é bem maneiro, mas de alguma forma também é possível não fazer isso e deixar o Webpack descobrir o <em>path</em> para o arquivo. Mas como?</p>\n<p><img src=\"/6061b99ae0d312b222b91b3f265dbe9e/magic.gif\" alt=\"Magic\"></p>\n<h2 id=\"o-truque-de-magica\" style=\"position:relative;\"><a href=\"#o-truque-de-magica\" aria-label=\"o truque de magica permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O truque de mágica</h2>\n<p>Na verdade, não é tão complicado, mas vem com algumas ressalvas. Por exemplo, se você importar um arquivo com um <em>path</em> variável, pelo menos uma parte desse <em>path</em> precisa ser explícito no código, por exemplo:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// this works</span>\r\n<span class=\"token keyword\">const</span> fileName <span class=\"token operator\">=</span> <span class=\"token string\">'image.jpg'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">let</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./assets/images/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fileName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// this doesn't work</span>\r\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token string\">'./assets/images/image.jpg'</span><span class=\"token punctuation\">;</span>\r\nmodule <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Por que isso? A maneira como o Webpack faz isso é analisando o <em>path</em> da string interpolada durante o processo de compilação, e ele obterá a parte explícita da string, neste exemplo <code class=\"language-text\">assets/images/</code>, e então copiará todos os arquivos dessa pasta para a pasta <code class=\"language-text\">build</code>.</p>\n<p>O Webpack faz isso de uma maneira muito inteligente também, se o <em>import</em> incluir a extensão do arquivo, ele copiará apenas os arquivos com essa extensão, por exemplo <code class=\"language-text\">import(`./assets/images/${fileName}.png`)</code> só copiará arquivos <code class=\"language-text\">PNG</code>.</p>\n<p>Como o Webpack faz isso analisando a string no <em>import</em>, ele não é capaz de saber quais arquivos copiar quando o <em>path</em> inteiro é uma variável sem uma parte explícita.</p>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>O Webpack pode ter uma configuração complicada e, às vezes, pode parecer feitiçaria, mas é uma ferramenta muito poderosa com muitos recursos e, se você se aprofundar o suficiente, descobrirá que sua implementação não é tão complicada.</p>\n<p>Se você quiser saber mais sobre o Webpack, você pode conferir a <a href=\"https://webpack.js.org/\" target=\"_blank\" rel=\"noreferrer\">documentação oficial</a>, e você pode ler mais sobre <a href=\"https://webpack.js.org/api/module-methods/\" target=\"_blank\" rel=\"noreferrer\"><strong>Module Methods</strong> aqui</a> e <a href=\"https://webpack.js.org/guides/code-splitting/#dynamic-imports\" target=\"_blank\" rel=\"noreferrer\"><strong>Dynamic Imports</strong> aqui</a>.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA0LTExVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-04-11-como-o-webpack-resolve-imports-dinamicos-com-paths-variaveis.pt-br/","path":"/blog/coding/como-o-webpack-resolve-imports-dinamicos-com-paths-variaveis/","locale":"pt-br"},"rawMarkdownBody":"Webpack é o _bundler_ de módulos mais popular para JavaScript, é uma ferramenta para agrupar módulos em um único arquivo e mais.\r\n\r\nUma coisa que sempre me deixou curioso foi como ele resolve os _imports_ dinâmicos, quer dizer, eu sabia que não era mágica, mas não sabia como funcionava, e sempre esquecia de pesquisar depois... até agora.\r\n\r\n![Mágica?](../../uploads/blog/2022/04/webpack-magic.png)\r\n\r\n## Como funciona o import de arquivos\r\nSempre que você importar um arquivo em seu código, o Webpack irá procurá-lo na pasta do projeto e copiá-lo para a pasta de `build` com um novo nome, então o Webpack substituirá o código que importa esse arquivo em seu arquivo JavaScript pelo _path_ para o arquivo recém-copiado.\r\n\r\nAqui está um exemplo super simplificado:\r\n\r\n```javascript\r\n// import on your app.js file\r\nimport utils from './helpers/utils.js';\r\n\r\n// import on the bundled file\r\nimport utils from './build/09wdj0wjd.bundle.0.js';\r\n```\r\n\r\n## O que é um import dinâmico?\r\nÀs vezes você não quer que o browser baixe o arquivo imediatamente, você quer carregá-lo apenas quando for necessário, e para isso, você pode usar um _import_ dinâmico.\r\n\r\n```javascript\r\nconst button = document.createElement('button');\r\nbutton.innerHTML = 'Click me';\r\n// when the button is clicked, a dynamic import will happen\r\nbutton.onclick = () => import('./helpers/utils.js').then(() => console.log('Dynamic import'));\r\n```\r\n\r\nÉ possível usar _import_ dinâmicos com praticamente qualquer arquivo, por isso é bastante útil para imagens ou arquivos de áudio grandes, por exemplo.\r\n\r\nMas o que acontece quando você quer importar um arquivo com um _path_ variável?\r\n\r\n```javascript\r\nconst fileName = 'image.jpg';\r\nconst button = document.createElement('button');\r\nbutton.innerHTML = 'Click me';\r\nbutton.onclick = () => import(`./assets/images/${fileName}`);\r\n```\r\n\r\nComo o Webpack sabe qual arquivo copiar para a pasta `build`? Bem, existe uma maneira de dizer ao Webpack para ignorar o _import_ e deixar o browser resolve-lo como quiser com o comentário `/* webpackIgnore: true */`.\r\n\r\n```javascript\r\nconst path = 'assets/images/image.jpg';\r\n// the browser will resolve this import and fail if the file doesn't exist\r\nconst module = await import(/*webpackIgnore: true*/ path);\r\n```\r\n\r\nIsso é bem maneiro, mas de alguma forma também é possível não fazer isso e deixar o Webpack descobrir o _path_ para o arquivo. Mas como?\r\n\r\n![Magic](../../uploads/blog/2022/04/magic.gif)\r\n\r\n## O truque de mágica\r\nNa verdade, não é tão complicado, mas vem com algumas ressalvas. Por exemplo, se você importar um arquivo com um _path_ variável, pelo menos uma parte desse _path_ precisa ser explícito no código, por exemplo:\r\n\r\n```javascript\r\n// this works\r\nconst fileName = 'image.jpg';\r\nlet module = await import(`./assets/images/${fileName}`);\r\n\r\n// this doesn't work\r\nconst path = './assets/images/image.jpg';\r\nmodule = await import(path);\r\n```\r\n\r\nPor que isso? A maneira como o Webpack faz isso é analisando o _path_ da string interpolada durante o processo de compilação, e ele obterá a parte explícita da string, neste exemplo `assets/images/`, e então copiará todos os arquivos dessa pasta para a pasta `build`.\r\n\r\nO Webpack faz isso de uma maneira muito inteligente também, se o _import_ incluir a extensão do arquivo, ele copiará apenas os arquivos com essa extensão, por exemplo ``import(`./assets/images/${fileName}.png`)`` só copiará arquivos `PNG`.\r\n\r\nComo o Webpack faz isso analisando a string no _import_, ele não é capaz de saber quais arquivos copiar quando o _path_ inteiro é uma variável sem uma parte explícita.\r\n\r\n## Conclusão\r\nO Webpack pode ter uma configuração complicada e, às vezes, pode parecer feitiçaria, mas é uma ferramenta muito poderosa com muitos recursos e, se você se aprofundar o suficiente, descobrirá que sua implementação não é tão complicada.\r\n\r\nSe você quiser saber mais sobre o Webpack, você pode conferir a [documentação oficial](https://webpack.js.org/), e você pode ler mais sobre [**Module Methods** aqui](https://webpack.js.org/api/module-methods/) e [**Dynamic Imports** aqui](https://webpack.js.org/guides/code-splitting/#dynamic-imports).\r\n","frontmatter":{"tags":["webpack","esm","javascript","node","nodejs","programação","import dinâmico"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-04-11T00:00:00.000Z","id":null,"path":"como-o-webpack-resolve-imports-dinamicos-com-paths-variaveis","show":true,"title":"Como o Webpack resolve imports dinâmicos com paths variáveis","hideExcerpt":false,"subtitle":"Não é mágica, eu prometo"}}},{"node":{"excerpt":"Webpack is the most popular module bundler for JavaScript…","html":"<p>Webpack is the most popular module bundler for JavaScript, it’s a tool for bundling modules together into a single file and more.</p>\n<p>One thing that always bugged me was how it handles dynamic imports with variable paths, I mean, I knew it was not magic, but I didn’t know how it works, and I always forgot to research it… until now.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1007px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.67187499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVQY022QXW6DMBCEuU1VAokxxMTBib22sdeGQP7al6oX6Al6/IpQ0aqqNNqX0czufkkBmDVmtdcph5TDaq8X5cLmws7uv0oKiPmhpToWEHJhFyPlQCEc+jtV+Lv0u+sxk8r0RCJzY+3PzA1ZY9aHNmvM5uhYe2ritXbDnEk55MISFTYSqY5EYlL7cdsOFCJzQ+3HpXvnR/fyvvPjsb8T6anCtbCZsKXpiMLKnogKSY0X5oat7anutu60hDme5fBKIZQ6ljoWCol0ubAUIlFh2qwwmbxHkuoouvtqP51dKNy5YR8urD1tbZ81Zj47E3bnRwqR47k0XUIklrZv4o1InIGlHEodK9OV02OeQvgDOeXwxGTKIeF4IQrzxj6QwoJ01ubofmKNea6Plb/ePj7D6xtr+y/liXJ/sFdToQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Magic?\"\n        title=\"Magic?\"\n        src=\"/static/e6e021a037da7763c8f6affd02c34110/b82a7/webpack-magic.png\"\n        srcset=\"/static/e6e021a037da7763c8f6affd02c34110/e3135/webpack-magic.png 256w,\n/static/e6e021a037da7763c8f6affd02c34110/06341/webpack-magic.png 512w,\n/static/e6e021a037da7763c8f6affd02c34110/b82a7/webpack-magic.png 1007w\"\n        sizes=\"(max-width: 1007px) 100vw, 1007px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Magic?</figcaption>\n  </figure></p>\n<h2 id=\"how-file-imports-work\" style=\"position:relative;\"><a href=\"#how-file-imports-work\" aria-label=\"how file imports work permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How file imports work</h2>\n<p>Whenever you import a file in your code, Webpack will look for it in the project directory and copy it to the <code class=\"language-text\">build</code> folder with a new name, then Webpack replaces the import code in your bundled JavaScript file with the path to the newly copied file.</p>\n<p>Here is a super simplified example:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// import on your app.js file</span>\r\n<span class=\"token keyword\">import</span> utils <span class=\"token keyword\">from</span> <span class=\"token string\">'./helpers/utils.js'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// import on the bundled file</span>\r\n<span class=\"token keyword\">import</span> utils <span class=\"token keyword\">from</span> <span class=\"token string\">'./build/09wdj0wjd.bundle.0.js'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"what-is-a-dynamic-import\" style=\"position:relative;\"><a href=\"#what-is-a-dynamic-import\" aria-label=\"what is a dynamic import permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is a dynamic import?</h2>\n<p>Sometimes you don’t want the browser to download the file immediately, you want to load it only when it’s needed, and for that, you can use a dynamic import.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nbutton<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Click me'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// when the button is clicked, a dynamic import will happen</span>\r\nbutton<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./helpers/utils.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Dynamic import'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It’s possible to use dynamic imports with pretty much any type of file, so it’s quite useful for large images or audio files, for example.</p>\n<p>But what happens when you want to import a file with a variable path?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fileName <span class=\"token operator\">=</span> <span class=\"token string\">'image.jpg'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nbutton<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token string\">'Click me'</span><span class=\"token punctuation\">;</span>\r\nbutton<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./assets/images/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fileName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>How does Webpack know which file to copy to the <code class=\"language-text\">build</code> folder? Well, there is a way to tell Webpack to ignore the import, and let the browser resolve it as it wants with the comment <code class=\"language-text\">/* webpackIgnore: true */</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token string\">'assets/images/image.jpg'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token comment\">// the browser will resolve this import and fail if the file doesn't exist</span>\r\n<span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/*webpackIgnore: true*/</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s nice, but somehow it’s also possible to not do that and let Webpack figure out the path to the file. But how?</p>\n<p><img src=\"/6061b99ae0d312b222b91b3f265dbe9e/magic.gif\" alt=\"Magic\"></p>\n<h2 id=\"the-magic-trick\" style=\"position:relative;\"><a href=\"#the-magic-trick\" aria-label=\"the magic trick permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The magic trick</h2>\n<p>It’s really not that complicated, but it comes with some caveats. For example, if you import a file with a variable path, at least some part of that path needs to be explicit in the string, for example:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// this works</span>\r\n<span class=\"token keyword\">const</span> fileName <span class=\"token operator\">=</span> <span class=\"token string\">'image.jpg'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">let</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./assets/images/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fileName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// this doesn't work</span>\r\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token string\">'./assets/images/image.jpg'</span><span class=\"token punctuation\">;</span>\r\nmodule <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Why is that? The way Webpack does it is by analyzing the interpolated string path during the build process, then getting the explicit path part from the string, in this example <code class=\"language-text\">assets/images/</code>, and then copy all the files from that folder to the <code class=\"language-text\">build</code> folder.</p>\n<p>Webpack does it in a very smart way too, if the <code class=\"language-text\">import</code> statement includes the file extension, it will only copy the files with that extension, for example <code class=\"language-text\">import(`./assets/images/${fileName}.png`)</code> will only copy <code class=\"language-text\">PNG</code> files.</p>\n<p>Since Webpack does that by analyzing string in the <code class=\"language-text\">import</code> statement, it’s not able to know which files to copy when the whole path is a variable without an explicit string part.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Webpack might have a cumbersome configuration, and sometimes it might seem like dark sorcery, but it’s a very powerful tool with lots of features, and if you dig deep enough, you’ll find that its implementation is really not that complicated.</p>\n<p>If you want to know more about Webpack, you can check out the <a href=\"https://webpack.js.org/\" target=\"_blank\" rel=\"noreferrer\">official <strong>Webpack documentation</strong></a>, and you can read more about <a href=\"https://webpack.js.org/api/module-methods/\" target=\"_blank\" rel=\"noreferrer\"><strong>Module Methods</strong> here</a> and <a href=\"https://webpack.js.org/guides/code-splitting/#dynamic-imports\" target=\"_blank\" rel=\"noreferrer\"><strong>Dynamic Imports</strong> here</a>.</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTA0LTExVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-04-11-how-webpack-handles-dynamic-imports-with-variable-paths.en/","path":"/blog/coding/how-webpack-handles-dynamic-imports-with-variable-paths/","locale":"en"},"rawMarkdownBody":"Webpack is the most popular module bundler for JavaScript, it's a tool for bundling modules together into a single file and more.\r\n\r\nOne thing that always bugged me was how it handles dynamic imports with variable paths, I mean, I knew it was not magic, but I didn't know how it works, and I always forgot to research it... until now.\r\n\r\n![Magic?](../../uploads/blog/2022/04/webpack-magic.png)\r\n\r\n## How file imports work\r\nWhenever you import a file in your code, Webpack will look for it in the project directory and copy it to the `build` folder with a new name, then Webpack replaces the import code in your bundled JavaScript file with the path to the newly copied file.\r\n\r\nHere is a super simplified example:\r\n\r\n```javascript\r\n// import on your app.js file\r\nimport utils from './helpers/utils.js';\r\n\r\n// import on the bundled file\r\nimport utils from './build/09wdj0wjd.bundle.0.js';\r\n```\r\n\r\n## What is a dynamic import?\r\nSometimes you don't want the browser to download the file immediately, you want to load it only when it's needed, and for that, you can use a dynamic import.\r\n\r\n```javascript\r\nconst button = document.createElement('button');\r\nbutton.innerHTML = 'Click me';\r\n// when the button is clicked, a dynamic import will happen\r\nbutton.onclick = () => import('./helpers/utils.js').then(() => console.log('Dynamic import'));\r\n```\r\n\r\nIt's possible to use dynamic imports with pretty much any type of file, so it's quite useful for large images or audio files, for example.\r\n\r\nBut what happens when you want to import a file with a variable path?\r\n\r\n```javascript\r\nconst fileName = 'image.jpg';\r\nconst button = document.createElement('button');\r\nbutton.innerHTML = 'Click me';\r\nbutton.onclick = () => import(`./assets/images/${fileName}`);\r\n```\r\n\r\nHow does Webpack know which file to copy to the `build` folder? Well, there is a way to tell Webpack to ignore the import, and let the browser resolve it as it wants with the comment `/* webpackIgnore: true */`.\r\n\r\n```javascript\r\nconst path = 'assets/images/image.jpg';\r\n// the browser will resolve this import and fail if the file doesn't exist\r\nconst module = await import(/*webpackIgnore: true*/ path);\r\n```\r\n\r\nThat's nice, but somehow it's also possible to not do that and let Webpack figure out the path to the file. But how?\r\n\r\n![Magic](../../uploads/blog/2022/04/magic.gif)\r\n\r\n## The magic trick\r\nIt's really not that complicated, but it comes with some caveats. For example, if you import a file with a variable path, at least some part of that path needs to be explicit in the string, for example:\r\n\r\n```javascript\r\n// this works\r\nconst fileName = 'image.jpg';\r\nlet module = await import(`./assets/images/${fileName}`);\r\n\r\n// this doesn't work\r\nconst path = './assets/images/image.jpg';\r\nmodule = await import(path);\r\n```\r\n\r\nWhy is that? The way Webpack does it is by analyzing the interpolated string path during the build process, then getting the explicit path part from the string, in this example `assets/images/`, and then copy all the files from that folder to the `build` folder.\r\n\r\nWebpack does it in a very smart way too, if the `import` statement includes the file extension, it will only copy the files with that extension, for example ``import(`./assets/images/${fileName}.png`)`` will only copy `PNG` files.\r\n\r\nSince Webpack does that by analyzing string in the `import` statement, it's not able to know which files to copy when the whole path is a variable without an explicit string part.\r\n\r\n## Conclusion\r\nWebpack might have a cumbersome configuration, and sometimes it might seem like dark sorcery, but it's a very powerful tool with lots of features, and if you dig deep enough, you'll find that its implementation is really not that complicated.\r\n\r\nIf you want to know more about Webpack, you can check out the [official **Webpack documentation**](https://webpack.js.org/), and you can read more about [**Module Methods** here](https://webpack.js.org/api/module-methods/) and [**Dynamic Imports** here](https://webpack.js.org/guides/code-splitting/#dynamic-imports).\r\n","frontmatter":{"tags":["webpack","esm","javascript","node","nodejs","coding","dynamic import"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-04-11T00:00:00.000Z","id":null,"path":"how-webpack-handles-dynamic-imports-with-variable-paths","show":true,"title":"How Webpack handles dynamic imports with variable paths","hideExcerpt":false,"subtitle":"It's not magic, I promise"}}},{"node":{"excerpt":"Se você quer alugar ou comprar uma casa na Holanda, é melhor…","html":"<p>Se você quer alugar ou comprar uma casa na Holanda, é melhor se preparar porque não é uma tarefa fácil, especialmente se você estiver procurando em Amsterdam.</p>\n<p>Candidatar-se para alugar ou comprar uma casa é como uma entrevista de emprego ou como obter um visto para outro país. Você precisa fornecer seus contracheques, contrato de trabalho, recomendações de proprietários anteriores e muito mais.</p>\n<p>Não só isso, mas muitas vezes você nem tem a chance de ir ver a casa, porque eles já têm tantos pedidos de pessoas querendo ir ver a casa que eles não precisam aceitar mais. Às vezes, dentro de 2 dias após a casa ser listada no <a href=\"https://funda.nl/\" target=\"_blank\" rel=\"noreferrer\">Funda.nl</a>, eles já não estão agendando visitas.</p>\n<p>Se você pelo menos conseguir marcar uma visita, verá a casa com muitas outras pessoas e <a href=\"https://dutchreview.com/traveling/cities/amsterdam/an-amsterdam-apartment-with-fair-rent-queue-stretches-around-the-block/\" target=\"_blank\" rel=\"noreferrer\">às vezes até fazer fila para isso</a>.</p>\n<p>Por causa disso, eu tive que abrir constantemente o Funda.nl e verificar novas casas, para que assim que uma nova casa estivesse disponível eu pudesse marcar uma visita.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 857px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACSUlEQVQoz2WQ60tTYQDG91f0B4i57Vze97xnO26zmwSGIllqNGGrkPBajlnWpg6ZWE4r0lo3IlIqocgv9VVEKFSUcLqFY+u4tjw7Z5d2ds42bxUZXoLMH8/XH8/Do5BWN6TVDUHOCXIums7IPzefvXiJaKTT6TSIYGigQYBCCEBII5JGJAVJDMN3UPBSjpdygrwWk9ejUi6+su4P8xcbWquqqo8a6MN6pNXSDKPV0oiCJNoOBOSuLMhyPPs7IIzNhRyJ7K+EvBbm2OdDttMV5UUM0iNQqKGL9LQWgS2ZAjS15f9tlteT2c3JYP/4vHpZ3vRLgocfCmbcF1rPH2SOw+JSHCJMrcIw/J/s7lZE4qOplYmpkGns04Hx8FSd60HnLddlR1d9W4epyXbuUnu59QbUHcJUSpwg8L0oQtHr79+Y3o7UeOZrveKTM+Zm56myvlqzvbzkXkvDU2tdk7m2qKZJnZ9HEOT/cjjRPVCv7a3MD0Y6uWTXq5kRa/8d50N3W5/L4b7f0NFrbOkuaekBOAYA3CfHeyZmrvp8jf6A08/aZ1njPN/n5Qe9/CAruXvcjUqmuPDIMUhBktzXnFnLXPOkLZO+pe+iIImBGMunhIScionJVFb8FuPLTlSolQUQAmKbPXLaM3xy9GPz9OLch9eRlDchfY6KXk5c4MSFSNIj/fjyeNiuKsgzMJRGg2hag+Nbb+8crigduG171H7FZbnbX/lu8eZc2PaVs7CcdWk77LJlevFstdGgVBKAIklAAEBCAAGABEH8AX6ULwUbFNkZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"funda scraper\"\n        title=\"funda scraper\"\n        src=\"/static/82fc245c2e60c74dd352f6bb36dfa4f4/87817/funda-scraper.png\"\n        srcset=\"/static/82fc245c2e60c74dd352f6bb36dfa4f4/e3135/funda-scraper.png 256w,\n/static/82fc245c2e60c74dd352f6bb36dfa4f4/06341/funda-scraper.png 512w,\n/static/82fc245c2e60c74dd352f6bb36dfa4f4/87817/funda-scraper.png 857w\"\n        sizes=\"(max-width: 857px) 100vw, 857px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"partiu-automatizar\" style=\"position:relative;\"><a href=\"#partiu-automatizar\" aria-label=\"partiu automatizar permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Partiu automatizar!</h2>\n<p>O bom do Funda.nl é que eles possuem uma grande variedade de filtros para a busca, e esses filtros ficam salvos na URL. Nice!</p>\n<p>Por exemplo, <a href=\"https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/\" target=\"_blank\" rel=\"noreferrer\">este link</a> listará todas as casas publicadas desde 1 dia atrás, com 2 quartos, no mínimo 40m² e no máximo €2000 de aluguel.</p>\n<p>Os resultados nesta página estão listados em um elemento HTML <code class=\"language-text\">li</code> com uma classe <code class=\"language-text\">search-result</code>, com isso dá para obter todos os elementos com o <code class=\"language-text\">document.querySelectorAll('.search-result')</code> e dentro de cada um dos desses elementos, posso obter o link para a casa com <code class=\"language-text\">element.querySelectorAll('a').[0].href</code>.</p>\n<p>Agora com o <code class=\"language-text\">puppeteer.js</code> eu posso automatizar um processo de ir a essa URL e verificar se alguma casa nova apareceu e salvá-la em um arquivo. Como este é um script Node.js, usarei o <code class=\"language-text\">jsdom</code> para trabalhar com os elementos DOM.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> writeFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> puppeteer <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'puppeteer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> jsdom <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jsdom'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runTask</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/'</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">headless</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">waitUntil</span><span class=\"token operator\">:</span> <span class=\"token string\">'domcontentloaded'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> htmlString <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> dom <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">jsdom<span class=\"token punctuation\">.</span>JSDOM</span><span class=\"token punctuation\">(</span>htmlString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> dom<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.search-result'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> urls <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> element <span class=\"token keyword\">of</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    urls<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>element<span class=\"token operator\">?.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'urls.json'</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">runTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Agora eu posso simplesmente executar <code class=\"language-text\">node script.js</code> e terei todas as URLs em um arquivo <code class=\"language-text\">urls.json</code>.</p>\n<h2 id=\"enviando-novas-urls-para-o-telegram\" style=\"position:relative;\"><a href=\"#enviando-novas-urls-para-o-telegram\" aria-label=\"enviando novas urls para o telegram permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enviando novas URLs para o Telegram</h2>\n<p>Em vez de salvar as URLs em um arquivo <code class=\"language-text\">urls.json</code>, quero que essas URLs sejam enviadas para um grupo do Telegram usando um bot, para isso precisarei usar o <code class=\"language-text\">node-fetch</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> nodeFetch <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'node-fetch'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runTask</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> element <span class=\"token keyword\">of</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">nodeFetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://api.telegram.org/bot</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">BOT_API</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/sendMessage</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> element<span class=\"token operator\">?.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>href<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">chat_id</span> <span class=\"token operator\">:</span> <span class=\"token constant\">CHAT_ID</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">parse_mode</span> <span class=\"token operator\">:</span> <span class=\"token string\">'markdown'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">runTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Isso é ótimo, mas não é muito útil porque não quero ter que executar o script manualmente, então partiu corrigir isso.</p>\n<h2 id=\"usando-o-github-actions\" style=\"position:relative;\"><a href=\"#usando-o-github-actions\" aria-label=\"usando o github actions permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usando o GitHub Actions</h2>\n<p>GitHub Actions é ótimo, eu uso o tempo todo para tarefas como testes e builds do meu blog, mas também pode ter <a href=\"https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule\" target=\"_blank\" rel=\"noreferrer\">scripts rodando periódicamente</a> usando <code class=\"language-text\">cron</code>.</p>\n<p>Para este script, preciso usar <a href=\"https://github.com/actions/checkout\" target=\"_blank\" rel=\"noreferrer\">actions/checkout</a> para fazer o checkout do meu código e <a href=\"https://github.com/stefanzweifel/git-auto-commit-action\" target=\"_blank\" rel=\"noreferrer\">stefanzweifel/git-auto-commit-action</a> para persistir uma lista das URLs que já foram enviadas ao Telegram.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run Task\r\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">workflow_dispatch</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*/30 * * * *\"</span>\r\n\r\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">build-and-deploy</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\r\n\r\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2.4.0\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">ref</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.head_ref <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Running\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          npm cache clean --force\r\n          npm install\r\n          npm run task</span>\r\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">CHAT_ID</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.CHAT_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">BOT_API</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.BOT_API <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> stefanzweifel/git<span class=\"token punctuation\">-</span>auto<span class=\"token punctuation\">-</span>commit<span class=\"token punctuation\">-</span>action@v4\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">commit_message</span><span class=\"token punctuation\">:</span> Update db.json\r\n          <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> main</code></pre></div>\n<p>E é isso! Agora, sempre que uma nova casa estiver listada na minha URL, receberei uma mensagem no Telegram 🎉.</p>\n<h2 id=\"bonus\" style=\"position:relative;\"><a href=\"#bonus\" aria-label=\"bonus permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bonus</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEEElEQVQ4y23USWwbVRgH8AjEqXZsOV4SK4snY88be2Y89sy82Tz2jGefccZ2SJyQRApr2SGiRJVoVKgqLkSQYlrRqi1BiAviwAEEHMsBQZWITeWGRBOpwIkThRa4gONEpRV/vcO7/PTpPX3fNxCJRsOhULZQgHW9rNRKkgwAwACGYRgAIJvNopM5dBJDEHTi9gwNDQ1EIpFwOJzNZgVBYPcCIeR6gRBCnueJPEMWIA7oDJJB/pN4PL6PURQVRXHPcDRNQwgFQehXyGT65za5j6PRaCgUomm60+k0Gg3f91utpmVZrutpqkaS5MTEnexOTBCE73me6/qeZ9u2bdm1mqppGsdxCIKgKDp5kP/BFEU2pgLdsEzLUdV6TVWJQiGXzcZisXh8KJlMjIyMjI6OptPpg//K3MIFnJqf9h5a9JYXnMMPdlafX9k41T177kL39Jlu9/T6+qsrK886ltKZneZYii3TZZpMJBI9fCgUIvOlh+ftw4vGXIt5YEl56YVHL54/s7219edff1/d2f32uyvn3nzt6SeWj6w8aZl1RRYUGaZSqf3KeUBN6cJCu+aoZGATjyxWH7vf7W6cvP77Hzdu3Pzx6u7bm28FvtEMfMvUaxUo8n0ciYbCoTwoyixlVai5QJ0N5IZNtqfY+XvFrcuXfvn5p7WjzyzM+romqKrqeoFcUauVWiqZPHhzvlSFRQ3iywvtwK52Wna9VtQq2Im1x4+vHRXYHM8CSRJtr+147VKZF6Xq8PBwHx8qFLiaooiw6Nqmo2vTrXZdN+RqfWZm5r6FJQbKgqKzUFZ13/Q7DFRYTkwmkwORSK8yDkocJ1AUSTM8y3GQF3TTKRbJbvf1Cxc3dct1/GlRMYLZ5YrmjyGgxErJROKgt1ECxzCQQwiSwHCixMm2487OLXx+ZeeTS5clkcdxkpDbgIIIiqfSYwgKEn08OBjOThaKNC1WFNO0JZ73DM2x7dXj61/+8Ov2zm9n3v3QdIJINJYF1CSKxqLhzPj4LYxkcIbhqppp6npNgmpFMAzj5VOb31y7+fXu9Q8++/65FzeaM0tQrALOl402lOuxWOzgw/JlkijQBOboNR5yZYZRasaxV85/+tW1j7d33vnoi9WTbzy1ekLRp8ZzJWX6SEZaHorvdVgkGsmhJGT0IlkCIJfDsFwOA3ieKpY5QS5zAsMJRZohKJousxiWG0MwBAW93h4cHLzn7rvygG4GbdO0TNM0TMOyTMMwTNNwHUfTNFVVe4NmW5qm0jQ9PjaayUz0cCqdZqrVQp4JgsD1eiMZBFO2bXue12w2W62W04vr+w1d10VRhBBKksSybA9jDHvsvfdxoiSJkiiKgiBUKhVBEPfuPM/3br1lRBD9wc71noUBgP+7w/4B5DorbrXMqwIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Agora corre pra marcar uma visita na casa!\"\n        title=\"Agora corre pra marcar uma visita na casa!\"\n        src=\"/static/b167f6a479ff3551a706ec1719572d7d/25257/telegram-funda-message-with-stats.png\"\n        srcset=\"/static/b167f6a479ff3551a706ec1719572d7d/e3135/telegram-funda-message-with-stats.png 256w,\n/static/b167f6a479ff3551a706ec1719572d7d/06341/telegram-funda-message-with-stats.png 512w,\n/static/b167f6a479ff3551a706ec1719572d7d/25257/telegram-funda-message-with-stats.png 547w\"\n        sizes=\"(max-width: 547px) 100vw, 547px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Agora corre pra marcar uma visita na casa!</figcaption>\n  </figure></p>\n<p>Existe uma <a href=\"https://github.com/nikitaindik/funda-neighbourhoods\" target=\"_blank\" rel=\"noreferrer\">extensão para Chrome de código aberto muito boa</a> que adiciona muitos dados novos ao Funda.nl sobre a casa, então copiei algumas partes do código desse projeto para adicione informações extras às casas enviadas para o Telegram.</p>\n<p>Você pode <a href=\"https://github.com/blopa/funda-scraper\" target=\"_blank\" rel=\"noreferrer\">clonar este projeto no GitHub</a>, adicionar sua própria lista de URLs do Funda.nl e o script será executado automaticamente a cada 30 minutos para verificar novas casas e enviá-las para o Telegram.</p>\n<p>Até a próxima, pessoal!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTAzLTEyVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-03-12-usando-nodejs-e-github-action-para-encontrar-uma-casa-no-fundanl.pt-br/","path":"/blog/coding/usando-nodejs-e-github-action-para-encontrar-uma-casa-no-fundanl/","locale":"pt-br"},"rawMarkdownBody":"Se você quer alugar ou comprar uma casa na Holanda, é melhor se preparar porque não é uma tarefa fácil, especialmente se você estiver procurando em Amsterdam.\r\n\r\nCandidatar-se para alugar ou comprar uma casa é como uma entrevista de emprego ou como obter um visto para outro país. Você precisa fornecer seus contracheques, contrato de trabalho, recomendações de proprietários anteriores e muito mais.\r\n\r\nNão só isso, mas muitas vezes você nem tem a chance de ir ver a casa, porque eles já têm tantos pedidos de pessoas querendo ir ver a casa que eles não precisam aceitar mais. Às vezes, dentro de 2 dias após a casa ser listada no [Funda.nl](https://funda.nl/), eles já não estão agendando visitas.\r\n\r\nSe você pelo menos conseguir marcar uma visita, verá a casa com muitas outras pessoas e [às vezes até fazer fila para isso](https://dutchreview.com/traveling/cities/amsterdam/an-amsterdam-apartment-with-fair-rent-queue-stretches-around-the-block/).\r\n\r\nPor causa disso, eu tive que abrir constantemente o Funda.nl e verificar novas casas, para que assim que uma nova casa estivesse disponível eu pudesse marcar uma visita.\r\n\r\n![](../../uploads/blog/2022/03/funda-scraper.png)\r\n\r\n## Partiu automatizar!\r\nO bom do Funda.nl é que eles possuem uma grande variedade de filtros para a busca, e esses filtros ficam salvos na URL. Nice!\r\n\r\nPor exemplo, [este link](https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/) listará todas as casas publicadas desde 1 dia atrás, com 2 quartos, no mínimo 40m² e no máximo €2000 de aluguel.\r\n\r\nOs resultados nesta página estão listados em um elemento HTML `li` com uma classe `search-result`, com isso dá para obter todos os elementos com o `document.querySelectorAll('.search-result')` e dentro de cada um dos desses elementos, posso obter o link para a casa com `element.querySelectorAll('a').[0].href`.\r\n\r\nAgora com o `puppeteer.js` eu posso automatizar um processo de ir a essa URL e verificar se alguma casa nova apareceu e salvá-la em um arquivo. Como este é um script Node.js, usarei o `jsdom` para trabalhar com os elementos DOM.\r\n\r\n```javascript\r\nconst { writeFileSync } = require('fs');\r\nconst puppeteer = require('puppeteer');\r\nconst jsdom = require('jsdom');\r\n\r\nconst runTask = async () => {\r\n  const url = 'https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/';\r\n  const browser = await puppeteer.launch({\r\n    headless: true,\r\n  });\r\n\r\n  const page = await browser.newPage();\r\n  await page.goto(url, { waitUntil: 'domcontentloaded' });\r\n\r\n  const htmlString = await page.content();\r\n  const dom = new jsdom.JSDOM(htmlString);\r\n  const result = dom.window.document.querySelectorAll('.search-result');\r\n\r\n  const urls = [];\r\n  for (const element of result) {\r\n    urls.push(element?.querySelectorAll('a')?.[0]?.href);\r\n  }\r\n\r\n  writeFileSync('urls.json', JSON.stringify(urls));\r\n}\r\n\r\nrunTask();\r\n```\r\n\r\nAgora eu posso simplesmente executar `node script.js` e terei todas as URLs em um arquivo `urls.json`.\r\n\r\n## Enviando novas URLs para o Telegram\r\nEm vez de salvar as URLs em um arquivo `urls.json`, quero que essas URLs sejam enviadas para um grupo do Telegram usando um bot, para isso precisarei usar o `node-fetch`.\r\n\r\n```javascript\r\nconst nodeFetch = require('node-fetch');\r\n\r\nconst runTask = async () => {\r\n  for (const element of result) {\r\n    nodeFetch(`https://api.telegram.org/bot${BOT_API}/sendMessage`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        text: element?.querySelectorAll('a')?.[0]?.href,\r\n        chat_id : CHAT_ID,\r\n        parse_mode : 'markdown',\r\n      }),\r\n    });\r\n  }\r\n}\r\n\r\nrunTask();\r\n```\r\n\r\nIsso é ótimo, mas não é muito útil porque não quero ter que executar o script manualmente, então partiu corrigir isso.\r\n\r\n## Usando o GitHub Actions\r\nGitHub Actions é ótimo, eu uso o tempo todo para tarefas como testes e builds do meu blog, mas também pode ter [scripts rodando periódicamente](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule) usando `cron`.\r\n\r\nPara este script, preciso usar [actions/checkout](https://github.com/actions/checkout) para fazer o checkout do meu código e [stefanzweifel/git-auto-commit-action](https://github.com/stefanzweifel/git-auto-commit-action) para persistir uma lista das URLs que já foram enviadas ao Telegram.\r\n\r\n```yaml\r\nname: Run Task\r\non:\r\n  workflow_dispatch:\r\n  schedule:\r\n    - cron: \"*/30 * * * *\"\r\n\r\njobs:\r\n  build-and-deploy:\r\n    runs-on: ubuntu-latest\r\n\r\n    steps:\r\n      - name: Checkout\r\n        uses: actions/checkout@v2.4.0\r\n        with:\r\n          ref: ${{ github.head_ref }}\r\n\r\n      - name: Running\r\n        run: |\r\n          npm cache clean --force\r\n          npm install\r\n          npm run task\r\n        env:\r\n          CHAT_ID: ${{ secrets.CHAT_ID }}\r\n          BOT_API: ${{ secrets.BOT_API }}\r\n\r\n      - uses: stefanzweifel/git-auto-commit-action@v4\r\n        with:\r\n          commit_message: Update db.json\r\n          branch: main\r\n```\r\n\r\nE é isso! Agora, sempre que uma nova casa estiver listada na minha URL, receberei uma mensagem no Telegram 🎉.\r\n\r\n## Bonus\r\n![Agora corre pra marcar uma visita na casa!](../../uploads/blog/2022/03/telegram-funda-message-with-stats.png)\r\n\r\nExiste uma [extensão para Chrome de código aberto muito boa](https://github.com/nikitaindik/funda-neighbourhoods) que adiciona muitos dados novos ao Funda.nl sobre a casa, então copiei algumas partes do código desse projeto para adicione informações extras às casas enviadas para o Telegram.\r\n\r\nVocê pode [clonar este projeto no GitHub](https://github.com/blopa/funda-scraper), adicionar sua própria lista de URLs do Funda.nl e o script será executado automaticamente a cada 30 minutos para verificar novas casas e enviá-las para o Telegram.\r\n\r\nAté a próxima, pessoal!\r\n","frontmatter":{"tags":["funda","casa","apartamento","node","javascript","github actions","github","cronjob","yml","telegram","puppeteer.js"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-03-12T00:00:00.000Z","id":null,"path":"usando-nodejs-e-github-action-para-encontrar-uma-casa-no-fundanl","show":true,"title":"Usando Node.js e GitHub Action para encontrar uma casa no Funda.nl","hideExcerpt":false,"subtitle":""}}},{"node":{"excerpt":"If you want to rent or buy a house in the Netherlands, you…","html":"<p>If you want to rent or buy a house in the Netherlands, you better brace yourself because it is no easy task, especially if you’re looking in Amsterdam.</p>\n<p>Applying for rent or bidding on a house is like a job interview, or getting a visa for another country. You need to provide your payment slips, work contract, previous landlords’ recommendations, and more.</p>\n<p>Not only that but many times you don’t even have a chance to apply, because they already have so many people applying that they don’t take applications anymore. Sometimes within 2 days after the house is listed on <a href=\"https://funda.nl/\" target=\"_blank\" rel=\"noreferrer\">Funda.nl</a>, they are already not booking viewings.</p>\n<p>If you at least then manage to book a viewing, you will see the house with many other people and <a href=\"https://dutchreview.com/traveling/cities/amsterdam/an-amsterdam-apartment-with-fair-rent-queue-stretches-around-the-block/\" target=\"_blank\" rel=\"noreferrer\">sometimes even queue for it</a>.</p>\n<p>Because of that, I had to constantly open Funda.nl and check for new houses, so as soon as a new house was available I could book a viewing.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 857px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACSUlEQVQoz2WQ60tTYQDG91f0B4i57Vze97xnO26zmwSGIllqNGGrkPBajlnWpg6ZWE4r0lo3IlIqocgv9VVEKFSUcLqFY+u4tjw7Z5d2ds42bxUZXoLMH8/XH8/Do5BWN6TVDUHOCXIums7IPzefvXiJaKTT6TSIYGigQYBCCEBII5JGJAVJDMN3UPBSjpdygrwWk9ejUi6+su4P8xcbWquqqo8a6MN6pNXSDKPV0oiCJNoOBOSuLMhyPPs7IIzNhRyJ7K+EvBbm2OdDttMV5UUM0iNQqKGL9LQWgS2ZAjS15f9tlteT2c3JYP/4vHpZ3vRLgocfCmbcF1rPH2SOw+JSHCJMrcIw/J/s7lZE4qOplYmpkGns04Hx8FSd60HnLddlR1d9W4epyXbuUnu59QbUHcJUSpwg8L0oQtHr79+Y3o7UeOZrveKTM+Zm56myvlqzvbzkXkvDU2tdk7m2qKZJnZ9HEOT/cjjRPVCv7a3MD0Y6uWTXq5kRa/8d50N3W5/L4b7f0NFrbOkuaekBOAYA3CfHeyZmrvp8jf6A08/aZ1njPN/n5Qe9/CAruXvcjUqmuPDIMUhBktzXnFnLXPOkLZO+pe+iIImBGMunhIScionJVFb8FuPLTlSolQUQAmKbPXLaM3xy9GPz9OLch9eRlDchfY6KXk5c4MSFSNIj/fjyeNiuKsgzMJRGg2hag+Nbb+8crigduG171H7FZbnbX/lu8eZc2PaVs7CcdWk77LJlevFstdGgVBKAIklAAEBCAAGABEH8AX6ULwUbFNkZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"funda scraper\"\n        title=\"funda scraper\"\n        src=\"/static/82fc245c2e60c74dd352f6bb36dfa4f4/87817/funda-scraper.png\"\n        srcset=\"/static/82fc245c2e60c74dd352f6bb36dfa4f4/e3135/funda-scraper.png 256w,\n/static/82fc245c2e60c74dd352f6bb36dfa4f4/06341/funda-scraper.png 512w,\n/static/82fc245c2e60c74dd352f6bb36dfa4f4/87817/funda-scraper.png 857w\"\n        sizes=\"(max-width: 857px) 100vw, 857px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"lets-automate-it\" style=\"position:relative;\"><a href=\"#lets-automate-it\" aria-label=\"lets automate it permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’s automate it</h2>\n<p>The good thing about Funda.nl is that they have a vast variety of filters for your search, and those filters are saved in the URL. Hooray!</p>\n<p>For example, <a href=\"https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/\" target=\"_blank\" rel=\"noreferrer\">this link</a> will list all houses that are listed since 1 day ago, with 2 bedrooms, at least 40m², and a maximum of €2000.</p>\n<p>The results on this page are listed in an HTML <code class=\"language-text\">li</code> element with a class <code class=\"language-text\">search-result</code>, so I can get all elements with the query <code class=\"language-text\">document.querySelectorAll('.search-result')</code>, and inside each of these elements, I can get the link for the house with <code class=\"language-text\">element.querySelectorAll('a').[0].href</code>.</p>\n<p>With <code class=\"language-text\">puppeteer.js</code> I can automate the process of going to that URL and checking if any new house showed up and save it to a file. Since this is a Node.js script, I will use <code class=\"language-text\">jsdom</code> to work with the DOM elements.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> writeFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> puppeteer <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'puppeteer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> jsdom <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'jsdom'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runTask</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token string\">'https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/'</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">headless</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">waitUntil</span><span class=\"token operator\">:</span> <span class=\"token string\">'domcontentloaded'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> htmlString <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> dom <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">jsdom<span class=\"token punctuation\">.</span>JSDOM</span><span class=\"token punctuation\">(</span>htmlString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> dom<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.search-result'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">const</span> urls <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> element <span class=\"token keyword\">of</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    urls<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>element<span class=\"token operator\">?.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'urls.json'</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>urls<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">runTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now I can simply run <code class=\"language-text\">node script.js</code> and I will have all URLs on a <code class=\"language-text\">urls.json</code> file.</p>\n<h2 id=\"sending-new-urls-to-telegram\" style=\"position:relative;\"><a href=\"#sending-new-urls-to-telegram\" aria-label=\"sending new urls to telegram permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sending new URLs to Telegram</h2>\n<p>Instead of saving the URLs to a <code class=\"language-text\">urls.json</code> file, I want to have these URLs sent to a Telegram group using a Telegram bot, for that, I will need to use <code class=\"language-text\">node-fetch</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> nodeFetch <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'node-fetch'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runTask</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> element <span class=\"token keyword\">of</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">nodeFetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://api.telegram.org/bot</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">BOT_API</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/sendMessage</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> element<span class=\"token operator\">?.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>href<span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">chat_id</span> <span class=\"token operator\">:</span> <span class=\"token constant\">CHAT_ID</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">parse_mode</span> <span class=\"token operator\">:</span> <span class=\"token string\">'markdown'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token function\">runTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That’s great, but not very useful because I don’t want to have to manually run the script, I will fix that in the next step.</p>\n<h2 id=\"using-github-actions\" style=\"position:relative;\"><a href=\"#using-github-actions\" aria-label=\"using github actions permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using GitHub Actions</h2>\n<p>GitHub Actions is great, I use it all the time for tasks like tests and building my blog, but you can also have <a href=\"https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule\" target=\"_blank\" rel=\"noreferrer\">scripts running on a schedule</a> using <code class=\"language-text\">cron</code>.</p>\n<p>For this script, I need to use <a href=\"https://github.com/actions/checkout\" target=\"_blank\" rel=\"noreferrer\">actions/checkout</a> to checkout to my code, and <a href=\"https://github.com/stefanzweifel/git-auto-commit-action\" target=\"_blank\" rel=\"noreferrer\">stefanzweifel/git-auto-commit-action</a> to persist a list of the URLs that were already sent to Telegram.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run Task\r\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">workflow_dispatch</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*/30 * * * *\"</span>\r\n\r\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">build-and-deploy</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\r\n\r\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2.4.0\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">ref</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.head_ref <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Running\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          npm cache clean --force\r\n          npm install\r\n          npm run task</span>\r\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">CHAT_ID</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.CHAT_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">BOT_API</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.BOT_API <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> stefanzweifel/git<span class=\"token punctuation\">-</span>auto<span class=\"token punctuation\">-</span>commit<span class=\"token punctuation\">-</span>action@v4\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">commit_message</span><span class=\"token punctuation\">:</span> Update db.json\r\n          <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> main</code></pre></div>\n<p>And that’s it! Now whenever a new house is listed in my URL, I will get a message on Telegram 🎉.</p>\n<h2 id=\"bonus\" style=\"position:relative;\"><a href=\"#bonus\" aria-label=\"bonus permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bonus</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEEElEQVQ4y23USWwbVRgH8AjEqXZsOV4SK4snY88be2Y89sy82Tz2jGefccZ2SJyQRApr2SGiRJVoVKgqLkSQYlrRqi1BiAviwAEEHMsBQZWITeWGRBOpwIkThRa4gONEpRV/vcO7/PTpPX3fNxCJRsOhULZQgHW9rNRKkgwAwACGYRgAIJvNopM5dBJDEHTi9gwNDQ1EIpFwOJzNZgVBYPcCIeR6gRBCnueJPEMWIA7oDJJB/pN4PL6PURQVRXHPcDRNQwgFQehXyGT65za5j6PRaCgUomm60+k0Gg3f91utpmVZrutpqkaS5MTEnexOTBCE73me6/qeZ9u2bdm1mqppGsdxCIKgKDp5kP/BFEU2pgLdsEzLUdV6TVWJQiGXzcZisXh8KJlMjIyMjI6OptPpg//K3MIFnJqf9h5a9JYXnMMPdlafX9k41T177kL39Jlu9/T6+qsrK886ltKZneZYii3TZZpMJBI9fCgUIvOlh+ftw4vGXIt5YEl56YVHL54/s7219edff1/d2f32uyvn3nzt6SeWj6w8aZl1RRYUGaZSqf3KeUBN6cJCu+aoZGATjyxWH7vf7W6cvP77Hzdu3Pzx6u7bm28FvtEMfMvUaxUo8n0ciYbCoTwoyixlVai5QJ0N5IZNtqfY+XvFrcuXfvn5p7WjzyzM+romqKrqeoFcUauVWiqZPHhzvlSFRQ3iywvtwK52Wna9VtQq2Im1x4+vHRXYHM8CSRJtr+147VKZF6Xq8PBwHx8qFLiaooiw6Nqmo2vTrXZdN+RqfWZm5r6FJQbKgqKzUFZ13/Q7DFRYTkwmkwORSK8yDkocJ1AUSTM8y3GQF3TTKRbJbvf1Cxc3dct1/GlRMYLZ5YrmjyGgxErJROKgt1ECxzCQQwiSwHCixMm2487OLXx+ZeeTS5clkcdxkpDbgIIIiqfSYwgKEn08OBjOThaKNC1WFNO0JZ73DM2x7dXj61/+8Ov2zm9n3v3QdIJINJYF1CSKxqLhzPj4LYxkcIbhqppp6npNgmpFMAzj5VOb31y7+fXu9Q8++/65FzeaM0tQrALOl402lOuxWOzgw/JlkijQBOboNR5yZYZRasaxV85/+tW1j7d33vnoi9WTbzy1ekLRp8ZzJWX6SEZaHorvdVgkGsmhJGT0IlkCIJfDsFwOA3ieKpY5QS5zAsMJRZohKJousxiWG0MwBAW93h4cHLzn7rvygG4GbdO0TNM0TMOyTMMwTNNwHUfTNFVVe4NmW5qm0jQ9PjaayUz0cCqdZqrVQp4JgsD1eiMZBFO2bXue12w2W62W04vr+w1d10VRhBBKksSybA9jDHvsvfdxoiSJkiiKgiBUKhVBEPfuPM/3br1lRBD9wc71noUBgP+7w/4B5DorbrXMqwIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Now run to book your viewing!\"\n        title=\"Now run to book your viewing!\"\n        src=\"/static/b167f6a479ff3551a706ec1719572d7d/25257/telegram-funda-message-with-stats.png\"\n        srcset=\"/static/b167f6a479ff3551a706ec1719572d7d/e3135/telegram-funda-message-with-stats.png 256w,\n/static/b167f6a479ff3551a706ec1719572d7d/06341/telegram-funda-message-with-stats.png 512w,\n/static/b167f6a479ff3551a706ec1719572d7d/25257/telegram-funda-message-with-stats.png 547w\"\n        sizes=\"(max-width: 547px) 100vw, 547px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Now run to book your viewing!</figcaption>\n  </figure></p>\n<p>There is a very nice <a href=\"https://github.com/nikitaindik/funda-neighbourhoods\" target=\"_blank\" rel=\"noreferrer\">open-source Chrome extension</a> that adds a lot of new data into Funda.nl about the house, so I copied some of its code to add extra info to the houses send to Telegram.</p>\n<p>You can <a href=\"https://github.com/blopa/funda-scraper\" target=\"_blank\" rel=\"noreferrer\">clone this project on GitHub</a>, add your own list of Funda.nl URLs, and the script will automatically run every 30 minutes to check for new houses and send them to Telegram.</p>\n<p>See you in the next one!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTAzLTEyVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-03-12-using-nodejs-and-github-action-to-find-a-house-on-fundanl.en/","path":"/blog/coding/using-nodejs-and-github-action-to-find-a-house-on-fundanl/","locale":"en"},"rawMarkdownBody":"If you want to rent or buy a house in the Netherlands, you better brace yourself because it is no easy task, especially if you're looking in Amsterdam.\r\n\r\nApplying for rent or bidding on a house is like a job interview, or getting a visa for another country. You need to provide your payment slips, work contract, previous landlords' recommendations, and more.\r\n\r\nNot only that but many times you don't even have a chance to apply, because they already have so many people applying that they don't take applications anymore. Sometimes within 2 days after the house is listed on [Funda.nl](https://funda.nl/), they are already not booking viewings.\r\n\r\nIf you at least then manage to book a viewing, you will see the house with many other people and [sometimes even queue for it](https://dutchreview.com/traveling/cities/amsterdam/an-amsterdam-apartment-with-fair-rent-queue-stretches-around-the-block/).\r\n\r\nBecause of that, I had to constantly open Funda.nl and check for new houses, so as soon as a new house was available I could book a viewing.\r\n\r\n![](../../uploads/blog/2022/03/funda-scraper.png)\r\n\r\n## Let's automate it\r\nThe good thing about Funda.nl is that they have a vast variety of filters for your search, and those filters are saved in the URL. Hooray!\r\n\r\nFor example, [this link](https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/) will list all houses that are listed since 1 day ago, with 2 bedrooms, at least 40m², and a maximum of €2000.\r\n\r\nThe results on this page are listed in an HTML `li` element with a class `search-result`, so I can get all elements with the query `document.querySelectorAll('.search-result')`, and inside each of these elements, I can get the link for the house with `element.querySelectorAll('a').[0].href`.\r\n\r\nWith `puppeteer.js` I can automate the process of going to that URL and checking if any new house showed up and save it to a file. Since this is a Node.js script, I will use `jsdom` to work with the DOM elements.\r\n\r\n```javascript\r\nconst { writeFileSync } = require('fs');\r\nconst puppeteer = require('puppeteer');\r\nconst jsdom = require('jsdom');\r\n\r\nconst runTask = async () => {\r\n  const url = 'https://www.funda.nl/en/huur/amsterdam/beschikbaar/0-2000/40+woonopp/2+slaapkamers/1-dag/';\r\n  const browser = await puppeteer.launch({\r\n    headless: true,\r\n  });\r\n\r\n  const page = await browser.newPage();\r\n  await page.goto(url, { waitUntil: 'domcontentloaded' });\r\n\r\n  const htmlString = await page.content();\r\n  const dom = new jsdom.JSDOM(htmlString);\r\n  const result = dom.window.document.querySelectorAll('.search-result');\r\n\r\n  const urls = [];\r\n  for (const element of result) {\r\n    urls.push(element?.querySelectorAll('a')?.[0]?.href);\r\n  }\r\n\r\n  writeFileSync('urls.json', JSON.stringify(urls));\r\n}\r\n\r\nrunTask();\r\n```\r\n\r\nNow I can simply run `node script.js` and I will have all URLs on a `urls.json` file.\r\n\r\n## Sending new URLs to Telegram\r\nInstead of saving the URLs to a `urls.json` file, I want to have these URLs sent to a Telegram group using a Telegram bot, for that, I will need to use `node-fetch`.\r\n\r\n\r\n```javascript\r\nconst nodeFetch = require('node-fetch');\r\n\r\nconst runTask = async () => {\r\n  for (const element of result) {\r\n    nodeFetch(`https://api.telegram.org/bot${BOT_API}/sendMessage`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        text: element?.querySelectorAll('a')?.[0]?.href,\r\n        chat_id : CHAT_ID,\r\n        parse_mode : 'markdown',\r\n      }),\r\n    });\r\n  }\r\n}\r\n\r\nrunTask();\r\n```\r\n\r\nThat's great, but not very useful because I don't want to have to manually run the script, I will fix that in the next step.\r\n\r\n## Using GitHub Actions\r\nGitHub Actions is great, I use it all the time for tasks like tests and building my blog, but you can also have [scripts running on a schedule](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule) using `cron`.\r\n\r\nFor this script, I need to use [actions/checkout](https://github.com/actions/checkout) to checkout to my code, and [stefanzweifel/git-auto-commit-action](https://github.com/stefanzweifel/git-auto-commit-action) to persist a list of the URLs that were already sent to Telegram.\r\n\r\n```yaml\r\nname: Run Task\r\non:\r\n  workflow_dispatch:\r\n  schedule:\r\n    - cron: \"*/30 * * * *\"\r\n\r\njobs:\r\n  build-and-deploy:\r\n    runs-on: ubuntu-latest\r\n\r\n    steps:\r\n      - name: Checkout\r\n        uses: actions/checkout@v2.4.0\r\n        with:\r\n          ref: ${{ github.head_ref }}\r\n\r\n      - name: Running\r\n        run: |\r\n          npm cache clean --force\r\n          npm install\r\n          npm run task\r\n        env:\r\n          CHAT_ID: ${{ secrets.CHAT_ID }}\r\n          BOT_API: ${{ secrets.BOT_API }}\r\n\r\n      - uses: stefanzweifel/git-auto-commit-action@v4\r\n        with:\r\n          commit_message: Update db.json\r\n          branch: main\r\n```\r\n\r\nAnd that's it! Now whenever a new house is listed in my URL, I will get a message on Telegram 🎉.\r\n\r\n## Bonus\r\n![Now run to book your viewing!](../../uploads/blog/2022/03/telegram-funda-message-with-stats.png)\r\n\r\nThere is a very nice [open-source Chrome extension](https://github.com/nikitaindik/funda-neighbourhoods) that adds a lot of new data into Funda.nl about the house, so I copied some of its code to add extra info to the houses send to Telegram.\r\n\r\nYou can [clone this project on GitHub](https://github.com/blopa/funda-scraper), add your own list of Funda.nl URLs, and the script will automatically run every 30 minutes to check for new houses and send them to Telegram.\r\n\r\nSee you in the next one!\r\n","frontmatter":{"tags":["funda","house","apartment","node","javascript","github actions","github","cronjob","yml","telegram","puppeteer.js"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-03-12T00:00:00.000Z","id":null,"path":"using-nodejs-and-github-action-to-find-a-house-on-fundanl","show":true,"title":"Using Node.js and GitHub Action to find a house on Funda.nl","hideExcerpt":false,"subtitle":""}}},{"node":{"excerpt":"EDIT: Isso só funciona para o React 17 ou inferior, para o…","html":"<p><em><strong>EDIT: Isso só funciona para o React 17 ou inferior, <a href=\"/pt-br/blog/coding/como-acessar-o-state-do-redux-de-um-build-de-producao-do-react-18/\">para o React 18 veja esse post</a>.</strong></em></p>\n<p>Às vezes você quer debugar o state do Redux em produção, mas o <a href=\"https://github.com/zalmoxisus/redux-devtools-extension\" target=\"_blank\" rel=\"noreferrer\">redux-devtools</a> só está habilitado para development, o que fazer numa situação dessas?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1012px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC90lEQVQozx2S22tcVRyFz//iq+CTPhT0RR/ESKEq1kSDCSQYlWpjTMZLTbTGIQmReGkSU0GiJrbgWKitaBpKffHSUJRKOzXBmtiZM+fs62/fzz77zJmR6eN6+BYL1hdhjPf29owxnU4HAFSzSRFinGmtpZR3mnGzheMEHTQRYYKBwCm+00hjxOJWEsVxnCRpnocQCu99yIP3ufd5URQcoBWjOKGEcpBaSA1CUAaEcaW11DriAJRSEAKkYpxzDgCCcwihEEIqEEkr+a/RQAhxDkJIY611znuvtY6uXL509dof31/88ezm+vbWxVv1m51O17msKNoAglGWYsKlIIQKIXQPzLLMh6Kw1kT1+o0Ukf2Dg+t/XmM4NgqKoh1CURRt65zWWnCppTHWamO5tJnPTC85rU3UKUsphfd5WXZASmttCIVSSgjp8zyzWVKP092EpBhhRpkC0VtgjDHaRDZ0lS+73W5RtPMQMu/LsgyhMMa0yzIzjtzGNCGMMsaZEEJKrbQ21mbeR+curFXnp5cW319ZXanVvt3Z+bVWO3P1lytb25e3Lm0H79N6klyP8b8YtzAlhHOhlXJKeueiUx9VXhk5OjoyPDg4MDc9sf7Z0oczr5147sGpkSfO1zbzLMe7KdpHnAGlTEmplJJSSsatNtHq6S9PfjD/xfpXb4yPvXlsaGlxfudM9efKfZXH71mrTnQ7neRGTBqYckYZp1wAKMaAcWlcFq1Upz599/jyyYnjY8/3H3nkheH+9068vvn2kbnhQ2vV8dzn+O8UNxCljDJAmBFKWc8FcM5Fny/NLi9Mz89Mnju7fvTJvrfGR2cmXxp66tFvFis/fL1sjMO3UvRPSjDFhGMMGGNyt6AHL8xMvDj8zMdz71z4bmN2cnSkv6/y8rOHH37gk6mh+vnTWZajmy1yG3MKd+1TjDHo3SV78MbqwuDTh6enjv31+0+/bW28Otg3Pjbw0P33Djx2qHZq1jm/v9tMWghTyrngAEJKDsJlXhvzP7EptDiqnUkUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redux state on instagram\"\n        title=\"redux state on instagram\"\n        src=\"/static/7063c62ea526ac52ef9bd28c860aecb6/9d874/redux-state-on-instagram.png\"\n        srcset=\"/static/7063c62ea526ac52ef9bd28c860aecb6/e3135/redux-state-on-instagram.png 256w,\n/static/7063c62ea526ac52ef9bd28c860aecb6/06341/redux-state-on-instagram.png 512w,\n/static/7063c62ea526ac52ef9bd28c860aecb6/9d874/redux-state-on-instagram.png 1012w\"\n        sizes=\"(max-width: 1012px) 100vw, 1012px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL;DR</h2>\n<p>Rode o script abaixo no browser.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> internalRoot <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*[id]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> el<span class=\"token operator\">?.</span>_reactRootContainer<span class=\"token operator\">?.</span>_internalRoot<span class=\"token operator\">?.</span>current<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span>_reactRootContainer<span class=\"token operator\">?.</span>_internalRoot<span class=\"token operator\">?.</span>current<span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>internalRoot<span class=\"token operator\">?.</span>pendingProps<span class=\"token operator\">?.</span>store <span class=\"token operator\">||</span> internalRoot<span class=\"token operator\">?.</span>stateNode<span class=\"token operator\">?.</span>store <span class=\"token operator\">||</span> internalRoot<span class=\"token operator\">?.</span>memoizedState<span class=\"token operator\">?.</span>element<span class=\"token operator\">?.</span>props<span class=\"token operator\">?.</span>store<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span>getState<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"acessando-todos-os-states-do-redux\" style=\"position:relative;\"><a href=\"#acessando-todos-os-states-do-redux\" aria-label=\"acessando todos os states do redux permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Acessando todos os states do Redux</h2>\n<p>Recentemente eu tive que debugar um problema em produção que eu precisava para acessar o state do Redux, então me deparei com <a href=\"https://til-engineering.nulogy.com/Accessing-Redux-Store-Without-Redux-DevTools/\" target=\"_blank\" rel=\"noreferrer\">esta solução</a>, que precisava que a extensão <a href=\"https://github.com/facebook/react-devtools\" target=\"_blank\" rel=\"noreferrer\">React DevTools</a> fosse instalada no browser, eu testei e realmente funcionou, mas depois fiquei pensando como isso poderia ser feito sem o uso de extensões.</p>\n<p>Após pesquisar um pouco, encontrei <a href=\"https://stackoverflow.com/a/57909332/4307769\" target=\"_blank\" rel=\"noreferrer\">esta solução</a> no Stack Overflow, o que me levou a criar o seguinte script:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Traverse a dom element</span>\r\n<span class=\"token keyword\">const</span> stores <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">traverse</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">let</span> store <span class=\"token operator\">=</span>\r\n    element<span class=\"token operator\">?.</span>memoizedState<span class=\"token operator\">?.</span>element<span class=\"token operator\">?.</span>props<span class=\"token operator\">?.</span>store\r\n    <span class=\"token operator\">||</span> element<span class=\"token operator\">?.</span>pendingProps<span class=\"token operator\">?.</span>store\r\n    <span class=\"token operator\">||</span> element<span class=\"token operator\">?.</span>stateNode<span class=\"token operator\">?.</span>store<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    stores<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">traverse</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Find the root element for React</span>\r\n<span class=\"token keyword\">const</span> reactRoot <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*[id]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> el<span class=\"token operator\">?.</span>_reactRootContainer<span class=\"token operator\">?.</span>_internalRoot<span class=\"token operator\">?.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> internalRoot <span class=\"token operator\">=</span> reactRoot<span class=\"token punctuation\">.</span>_reactRootContainer<span class=\"token punctuation\">.</span>_internalRoot<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Traverse the root react element to find all Redux States in the app</span>\r\n<span class=\"token function\">traverse</span><span class=\"token punctuation\">(</span>internalRoot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Após executar este script, todos os states Redux estarão disponíveis na variável <code class=\"language-text\">stores</code>, e você pode acessá-los via <code class=\"language-text\">[...stores].map((store) => store.getState())</code>.</p>\n<p>Nos vemos na próxima, galera!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTAyLTIwVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-02-20-como-acessar-o-estado-do-redux-de-um-production-build-usando-o-console-do-browser.pt-br/","path":"/blog/coding/como-acessar-o-estado-do-redux-de-um-production-build-usando-o-console-do-browser/","locale":"pt-br"},"rawMarkdownBody":"***EDIT: Isso só funciona para o React 17 ou inferior, [para o React 18 veja esse post](/pt-br/blog/coding/como-acessar-o-state-do-redux-de-um-build-de-producao-do-react-18/).***\r\n\r\nÀs vezes você quer debugar o state do Redux em produção, mas o [redux-devtools](https://github.com/zalmoxisus/redux-devtools-extension) só está habilitado para development, o que fazer numa situação dessas?\r\n\r\n![](../../uploads/blog/2022/02/redux-state-on-instagram.png)\r\n\r\n## TL;DR\r\nRode o script abaixo no browser.\r\n\r\n```javascript\r\nconst internalRoot = Array.from(document.querySelectorAll(\"*[id]\")).find((el) => el?._reactRootContainer?._internalRoot?.current)?._reactRootContainer?._internalRoot?.current;\r\nconst state = (internalRoot?.pendingProps?.store || internalRoot?.stateNode?.store || internalRoot?.memoizedState?.element?.props?.store)?.getState?.();\r\n```\r\n\r\n## Acessando todos os states do Redux\r\nRecentemente eu tive que debugar um problema em produção que eu precisava para acessar o state do Redux, então me deparei com [esta solução](https://til-engineering.nulogy.com/Accessing-Redux-Store-Without-Redux-DevTools/), que precisava que a extensão [React DevTools](https://github.com/facebook/react-devtools) fosse instalada no browser, eu testei e realmente funcionou, mas depois fiquei pensando como isso poderia ser feito sem o uso de extensões.\r\n\r\nApós pesquisar um pouco, encontrei [esta solução](https://stackoverflow.com/a/57909332/4307769) no Stack Overflow, o que me levou a criar o seguinte script:\r\n\r\n```javascript\r\n// Traverse a dom element\r\nconst stores = new Set();\r\nconst traverse = (element) => {\r\n  let store =\r\n    element?.memoizedState?.element?.props?.store\r\n    || element?.pendingProps?.store\r\n    || element?.stateNode?.store;\r\n\r\n  if (store) {\r\n    stores.add(store);\r\n  }\r\n\r\n  if (element.child) {\r\n    traverse(element.child);\r\n  }\r\n};\r\n\r\n// Find the root element for React\r\nconst reactRoot = Array.from(document.querySelectorAll(\"*[id]\")).find((el) => el?._reactRootContainer?._internalRoot?.current);\r\n\r\nconst internalRoot = reactRoot._reactRootContainer._internalRoot.current;\r\n\r\n// Traverse the root react element to find all Redux States in the app\r\ntraverse(internalRoot);\r\n```\r\n\r\nApós executar este script, todos os states Redux estarão disponíveis na variável `stores`, e você pode acessá-los via `[...stores].map((store) => store.getState())`.\r\n\r\nNos vemos na próxima, galera!\r\n","frontmatter":{"tags":["redux","react","javascript","browser","console","production build","gambiarra"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-02-20T00:00:00.000Z","id":null,"path":"como-acessar-o-estado-do-redux-de-um-production-build-usando-o-console-do-browser","show":true,"title":"Como acessar o state do Redux em produção usando o console do browser","hideExcerpt":false,"subtitle":""}}},{"node":{"excerpt":"EDIT: This only works for React 17 or lower, for React 1…","html":"<p><em><strong>EDIT: This only works for React 17 or lower, <a href=\"/en/blog/coding/how-to-get-the-redux-state-from-a-react-18-production-build-via-the-browsers-console/\">for React 18 check this blog post</a>.</strong></em></p>\n<p>Sometimes you want to debug the Redux State from your application on production, but you don’t have <a href=\"https://github.com/zalmoxisus/redux-devtools-extension\" target=\"_blank\" rel=\"noreferrer\">redux-devtools</a> enabled for production, so what can you do?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1012px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC90lEQVQozx2S22tcVRyFz//iq+CTPhT0RR/ESKEq1kSDCSQYlWpjTMZLTbTGIQmReGkSU0GiJrbgWKitaBpKffHSUJRKOzXBmtiZM+fs62/fzz77zJmR6eN6+BYL1hdhjPf29owxnU4HAFSzSRFinGmtpZR3mnGzheMEHTQRYYKBwCm+00hjxOJWEsVxnCRpnocQCu99yIP3ufd5URQcoBWjOKGEcpBaSA1CUAaEcaW11DriAJRSEAKkYpxzDgCCcwihEEIqEEkr+a/RQAhxDkJIY611znuvtY6uXL509dof31/88ezm+vbWxVv1m51O17msKNoAglGWYsKlIIQKIXQPzLLMh6Kw1kT1+o0Ukf2Dg+t/XmM4NgqKoh1CURRt65zWWnCppTHWamO5tJnPTC85rU3UKUsphfd5WXZASmttCIVSSgjp8zyzWVKP092EpBhhRpkC0VtgjDHaRDZ0lS+73W5RtPMQMu/LsgyhMMa0yzIzjtzGNCGMMsaZEEJKrbQ21mbeR+curFXnp5cW319ZXanVvt3Z+bVWO3P1lytb25e3Lm0H79N6klyP8b8YtzAlhHOhlXJKeueiUx9VXhk5OjoyPDg4MDc9sf7Z0oczr5147sGpkSfO1zbzLMe7KdpHnAGlTEmplJJSSsatNtHq6S9PfjD/xfpXb4yPvXlsaGlxfudM9efKfZXH71mrTnQ7neRGTBqYckYZp1wAKMaAcWlcFq1Upz599/jyyYnjY8/3H3nkheH+9068vvn2kbnhQ2vV8dzn+O8UNxCljDJAmBFKWc8FcM5Fny/NLi9Mz89Mnju7fvTJvrfGR2cmXxp66tFvFis/fL1sjMO3UvRPSjDFhGMMGGNyt6AHL8xMvDj8zMdz71z4bmN2cnSkv6/y8rOHH37gk6mh+vnTWZajmy1yG3MKd+1TjDHo3SV78MbqwuDTh6enjv31+0+/bW28Otg3Pjbw0P33Djx2qHZq1jm/v9tMWghTyrngAEJKDsJlXhvzP7EptDiqnUkUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redux state on instagram\"\n        title=\"redux state on instagram\"\n        src=\"/static/7063c62ea526ac52ef9bd28c860aecb6/9d874/redux-state-on-instagram.png\"\n        srcset=\"/static/7063c62ea526ac52ef9bd28c860aecb6/e3135/redux-state-on-instagram.png 256w,\n/static/7063c62ea526ac52ef9bd28c860aecb6/06341/redux-state-on-instagram.png 512w,\n/static/7063c62ea526ac52ef9bd28c860aecb6/9d874/redux-state-on-instagram.png 1012w\"\n        sizes=\"(max-width: 1012px) 100vw, 1012px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL;DR</h2>\n<p>Run this on the browser’s console.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> internalRoot <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*[id]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> el<span class=\"token operator\">?.</span>_reactRootContainer<span class=\"token operator\">?.</span>_internalRoot<span class=\"token operator\">?.</span>current<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span>_reactRootContainer<span class=\"token operator\">?.</span>_internalRoot<span class=\"token operator\">?.</span>current<span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>internalRoot<span class=\"token operator\">?.</span>pendingProps<span class=\"token operator\">?.</span>store <span class=\"token operator\">||</span> internalRoot<span class=\"token operator\">?.</span>stateNode<span class=\"token operator\">?.</span>store <span class=\"token operator\">||</span> internalRoot<span class=\"token operator\">?.</span>memoizedState<span class=\"token operator\">?.</span>element<span class=\"token operator\">?.</span>props<span class=\"token operator\">?.</span>store<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span>getState<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"the-long-version\" style=\"position:relative;\"><a href=\"#the-long-version\" aria-label=\"the long version permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The long version</h2>\n<p>Recently I had to debug a problem in production which I needed to access the Redux State, so I came across <a href=\"https://til-engineering.nulogy.com/Accessing-Redux-Store-Without-Redux-DevTools/\" target=\"_blank\" rel=\"noreferrer\">this solution</a>, which needed <a href=\"https://github.com/facebook/react-devtools\" target=\"_blank\" rel=\"noreferrer\">React DevTools</a> to be installed in the browser, and that worked for me, but then I wondered how that could be done without the use of any extensions.</p>\n<p>After a bit of researching I found <a href=\"https://stackoverflow.com/a/57909332/4307769\" target=\"_blank\" rel=\"noreferrer\">this solution</a> on Stack Overflow, which lead me to create the following script:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Traverse a dom element</span>\r\n<span class=\"token keyword\">const</span> stores <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">traverse</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">let</span> store <span class=\"token operator\">=</span>\r\n    element<span class=\"token operator\">?.</span>memoizedState<span class=\"token operator\">?.</span>element<span class=\"token operator\">?.</span>props<span class=\"token operator\">?.</span>store\r\n    <span class=\"token operator\">||</span> element<span class=\"token operator\">?.</span>pendingProps<span class=\"token operator\">?.</span>store\r\n    <span class=\"token operator\">||</span> element<span class=\"token operator\">?.</span>stateNode<span class=\"token operator\">?.</span>store<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    stores<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">traverse</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span>child<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Find the root element for React</span>\r\n<span class=\"token keyword\">const</span> reactRoot <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*[id]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> el<span class=\"token operator\">?.</span>_reactRootContainer<span class=\"token operator\">?.</span>_internalRoot<span class=\"token operator\">?.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> internalRoot <span class=\"token operator\">=</span> reactRoot<span class=\"token punctuation\">.</span>_reactRootContainer<span class=\"token punctuation\">.</span>_internalRoot<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Traverse the root react element to find all Redux States in the app</span>\r\n<span class=\"token function\">traverse</span><span class=\"token punctuation\">(</span>internalRoot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After running this script, all Redux States will be available inside the variable <code class=\"language-text\">stores</code>, and you can access them via <code class=\"language-text\">[...stores].map((store) => store.getState())</code>.</p>\n<p>See you in the next one!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTAyLTIwVDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-02-20-how-to-get-the-redux-state-from-a-production-build-via-the-browsers-console.en/","path":"/blog/coding/how-to-get-the-redux-state-from-a-production-build-via-the-browsers-console/","locale":"en"},"rawMarkdownBody":"***EDIT: This only works for React 17 or lower, [for React 18 check this blog post](/en/blog/coding/how-to-get-the-redux-state-from-a-react-18-production-build-via-the-browsers-console/).***\r\n\r\nSometimes you want to debug the Redux State from your application on production, but you don't have [redux-devtools](https://github.com/zalmoxisus/redux-devtools-extension) enabled for production, so what can you do?\r\n\r\n![](../../uploads/blog/2022/02/redux-state-on-instagram.png)\r\n\r\n## TL;DR\r\nRun this on the browser's console.\r\n\r\n```javascript\r\nconst internalRoot = Array.from(document.querySelectorAll(\"*[id]\")).find((el) => el?._reactRootContainer?._internalRoot?.current)?._reactRootContainer?._internalRoot?.current;\r\nconst state = (internalRoot?.pendingProps?.store || internalRoot?.stateNode?.store || internalRoot?.memoizedState?.element?.props?.store)?.getState?.();\r\n```\r\n\r\n## The long version\r\nRecently I had to debug a problem in production which I needed to access the Redux State, so I came across [this solution](https://til-engineering.nulogy.com/Accessing-Redux-Store-Without-Redux-DevTools/), which needed [React DevTools](https://github.com/facebook/react-devtools) to be installed in the browser, and that worked for me, but then I wondered how that could be done without the use of any extensions.\r\n\r\nAfter a bit of researching I found [this solution](https://stackoverflow.com/a/57909332/4307769) on Stack Overflow, which lead me to create the following script:\r\n\r\n```javascript\r\n// Traverse a dom element\r\nconst stores = new Set();\r\nconst traverse = (element) => {\r\n  let store =\r\n    element?.memoizedState?.element?.props?.store\r\n    || element?.pendingProps?.store\r\n    || element?.stateNode?.store;\r\n\r\n  if (store) {\r\n    stores.add(store);\r\n  }\r\n\r\n  if (element.child) {\r\n    traverse(element.child);\r\n  }\r\n};\r\n\r\n// Find the root element for React\r\nconst reactRoot = Array.from(document.querySelectorAll(\"*[id]\")).find((el) => el?._reactRootContainer?._internalRoot?.current);\r\n\r\nconst internalRoot = reactRoot._reactRootContainer._internalRoot.current;\r\n\r\n// Traverse the root react element to find all Redux States in the app\r\ntraverse(internalRoot);\r\n```\r\n\r\nAfter running this script, all Redux States will be available inside the variable `stores`, and you can access them via `[...stores].map((store) => store.getState())`.\r\n\r\nSee you in the next one!\r\n","frontmatter":{"tags":["redux","react","javascript","browser","console","production build","hack"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-02-20T00:00:00.000Z","id":null,"path":"how-to-get-the-redux-state-from-a-production-build-via-the-browsers-console","show":true,"title":"How to get the Redux State in production via the browser's console","hideExcerpt":false,"subtitle":""}}},{"node":{"excerpt":"When I was working on my Game Devlog videos, I wondered if…","html":"<p>When I was working on my Game Devlog videos, I wondered if there was any way to automatically transform my code snippets into a video, so I could add them to my Devlog, but I couldn’t find any solution for it, so I gave up on this idea.</p>\n<p>Then a couple of weeks ago I was playing around with <a href=\"https://en.wikipedia.org/wiki/Abstract_syntax_tree\" target=\"_blank\" rel=\"noreferrer\">AST</a> and rendering <code class=\"language-text\">React</code> via <code class=\"language-text\">Node.js</code> with <code class=\"language-text\">Babel</code> when I had the idea to use Puppeteer to open a headless browser and record a page with my code snippet.</p>\n<p>The goal is for the result to be like the following GIF.</p>\n<p><img src=\"/63cbac7ef35f31c0b11e205782860106/code-to-video-v1.gif\" alt=\"\"></p>\n<h2 id=\"lets-get-coding\" style=\"position:relative;\"><a href=\"#lets-get-coding\" aria-label=\"lets get coding permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Let’s get coding</h2>\n<p>I will start by creating a <code class=\"language-text\">script.js</code> to be run via terminal using <code class=\"language-text\">node</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@babel/register'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> readFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> puppeteer <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'puppeteer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> PuppeteerScreenRecorder <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'puppeteer-screen-recorder'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Utils</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> generateHtml <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Constants</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SCALE</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateVideo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">filePath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// TODO</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// get node script param</span>\r\n<span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span>\r\n    process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token string\">'./examples/Test.jsx'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token function\">generateVideo</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>My code will use <code class=\"language-text\">ES Modules</code>, so I will install <a href=\"https://www.npmjs.com/package/esm\" target=\"_blank\" rel=\"noreferrer\">esm</a> so I can run my script like <code class=\"language-text\">node -r esm src/script.js my_file.js</code>.</p>\n<p>For the <code class=\"language-text\">generateVideo</code> function, I will follow the <a href=\"https://github.com/puppeteer/puppeteer/blob/v13.0.1/docs/api.md#class-puppeteer\" target=\"_blank\" rel=\"noreferrer\">Puppeteer’s quick-start example</a> to open a headless browser and then start recording it with <a href=\"https://github.com/prasanaworld/puppeteer-screen-recorder#example\" target=\"_blank\" rel=\"noreferrer\">puppeteer-screen-recorder</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateVideo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">filePath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// load file content</span>\r\n    <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> code<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// Puppeteer config</span>\r\n    <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">headless</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">args</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'--window-size=1920,1080'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">defaultViewport</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">1920</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">1080</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// open a new empty page</span>\r\n    <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">followNewTab</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">fps</span><span class=\"token operator\">:</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">ffmpeg_Path</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">videoFrame</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">1920</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">1080</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">aspectRatio</span><span class=\"token operator\">:</span> <span class=\"token string\">'16:9'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">const</span> recorder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PuppeteerScreenRecorder</span><span class=\"token punctuation\">(</span>\r\n        page<span class=\"token punctuation\">,</span>\r\n        config\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// start recording</span>\r\n    <span class=\"token keyword\">await</span> recorder<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./output.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;p>Hello World&lt;/p>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">await</span> recorder<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will open a headless browser tab, set the HTML to <code class=\"language-text\">&lt;p>Hello World&lt;/p></code> and make a 1-second video of it. That’s not what I want, but I will get there.</p>\n<h2 id=\"rendering-a-react-component\" style=\"position:relative;\"><a href=\"#rendering-a-react-component\" aria-label=\"rendering a react component permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rendering a React component</h2>\n<p>Now I will create a function that receives the code snippet as a parameter and then render a beautiful syntax highlighted code in HTML format using <a href=\"https://prismjs.com/\" target=\"_blank\" rel=\"noreferrer\">Prism.js</a>.</p>\n<p>With <code class=\"language-text\">Prism.highlight</code> I can pass a code string and get an HTML with the syntax-highlighted code and <code class=\"language-text\">renderToStaticMarkup</code> to render the <code class=\"language-text\">React</code> component to an HTML string. I don’t need <code class=\"language-text\">React</code> here, but since the whole idea started with <code class=\"language-text\">React</code> and <code class=\"language-text\">Babel</code>, I kept it.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> renderToStaticMarkup <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom/server'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">JSDOM</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'jsdom'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> readFileSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Prism.js</span>\r\n<span class=\"token keyword\">import</span> Prism <span class=\"token keyword\">from</span> <span class=\"token string\">'prismjs'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> loadLanguages <span class=\"token keyword\">from</span> <span class=\"token string\">'prismjs/components/'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// My custom React component</span>\r\n<span class=\"token keyword\">import</span> CodeHighlighter <span class=\"token keyword\">from</span> <span class=\"token string\">'./CodeHighlighter.jsx'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> styling <span class=\"token operator\">=</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'./node_modules/prism-themes/themes/prism-material-dark.css'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span> <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateHtml</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token parameter\">code<span class=\"token punctuation\">,</span>\r\n    currentLine<span class=\"token punctuation\">,</span>\r\n    totalLines<span class=\"token punctuation\">,</span>\r\n    language</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">loadLanguages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>language<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> codeHtml <span class=\"token operator\">=</span> Prism<span class=\"token punctuation\">.</span><span class=\"token function\">highlight</span><span class=\"token punctuation\">(</span>\r\n        code<span class=\"token punctuation\">,</span>\r\n        Prism<span class=\"token punctuation\">.</span>languages<span class=\"token punctuation\">[</span>language<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n        language\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// get HTML string</span>\r\n    <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">renderToStaticMarkup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>CodeHighlighter\r\n            codeHtml<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>codeHtml<span class=\"token punctuation\">}</span>\r\n            totalLines<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>totalLines<span class=\"token punctuation\">}</span>\r\n            currentLine<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentLine<span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> window <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JSDOM</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> document <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> window<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// Add Prism.js styling to the HTML document</span>\r\n    <span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'style'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    style<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> styling<span class=\"token punctuation\">;</span>\r\n    document<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>style<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>outerHTML<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Other than <code class=\"language-text\">code</code>, the <code class=\"language-text\">generateHtml</code> function also receives <code class=\"language-text\">currentLine</code> and <code class=\"language-text\">totalLines</code> as parameters. <code class=\"language-text\">currentLine</code> will be used to highlight the current line of code, and <code class=\"language-text\">totalLines</code> to show the line numbers on the left.</p>\n<h2 id=\"the-react-component\" style=\"position:relative;\"><a href=\"#the-react-component\" aria-label=\"the react component permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The React component</h2>\n<p>The basic implementation of the <code class=\"language-text\">CodeHighlighter</code> I will simply return a <code class=\"language-text\">code</code> tag with the <code class=\"language-text\">dangerouslySetInnerHTML</code> set to the Prism.js HTML.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SCALE</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">CodeHighlighter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\r\n    codeHtml<span class=\"token punctuation\">,</span>\r\n    totalLines<span class=\"token punctuation\">,</span>\r\n    currentLine<span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>html lang<span class=\"token operator\">=</span><span class=\"token string\">\"en\"</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>body\r\n                style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1920</span> <span class=\"token operator\">/</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1080</span> <span class=\"token operator\">/</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'#272822'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">transform</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">scale(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">transformOrigin</span><span class=\"token operator\">:</span> <span class=\"token string\">'0% 0% 0px'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span>div\r\n                    style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                        <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'20px 0 0 2px'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                <span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span>pre\r\n                        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                            <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">></span>\r\n                        <span class=\"token operator\">&lt;</span>code\r\n                            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                                <span class=\"token literal-property property\">fontFamily</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace\"</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                            dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                                <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> codeHtml<span class=\"token punctuation\">,</span>\r\n                            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>pre<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> CodeHighlighter<span class=\"token punctuation\">;</span></code></pre></div>\n<p>The code above is still missing the line highlighter and the line numbers, for that I will use the <code class=\"language-text\">totalLines</code> variable to create the line numbers, and <code class=\"language-text\">currentLine</code> to create a <code class=\"language-text\">div</code> with full width and move it with the <code class=\"language-text\">margin-top</code> CSS property. Check the full code for this <code class=\"language-text\">React</code> component <a href=\"https://github.com/blopa/code-video-creator/blob/fc6836c497d5dd0a13a00f1f779fd2d482ebc611/src/CodeHighlighter.jsx\" target=\"_blank\" rel=\"noreferrer\">on GitHub</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SCALE</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">CodeHighlighter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\r\n    codeHtml<span class=\"token punctuation\">,</span>\r\n    totalLines<span class=\"token punctuation\">,</span>\r\n    currentLine<span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// add the line numbers</span>\r\n    <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>totalLines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>span\r\n            key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span>\r\n            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'16px'</span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">8</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>totalLines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">></span>\r\n            <span class=\"token punctuation\">{</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>html lang<span class=\"token operator\">=</span><span class=\"token string\">\"en\"</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>style\r\n                dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                    <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\r\n                    body { color: white; }\r\n                </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>body\r\n                style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1920</span> <span class=\"token operator\">/</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1080</span> <span class=\"token operator\">/</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'#272822'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">transform</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">scale(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">transformOrigin</span><span class=\"token operator\">:</span> <span class=\"token string\">'0% 0% 0px'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span>div\r\n                    style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                        <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'20px 0 0 2px'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                <span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span>div\r\n                        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'absolute'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">4</span> <span class=\"token operator\">*</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'#44463a'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">zIndex</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">marginTop</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> currentLine<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span>div\r\n                        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                            <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'grid'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'0 5px 0 2px'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token string\">'#DD6'</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">></span>\r\n                        <span class=\"token punctuation\">{</span>lines<span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span>pre\r\n                        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                            <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">></span>\r\n                        <span class=\"token operator\">&lt;</span>code\r\n                            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                                <span class=\"token literal-property property\">fontFamily</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace\"</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                            dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                                <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> codeHtml<span class=\"token punctuation\">,</span>\r\n                            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>pre<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> CodeHighlighter<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now in the script, I can get the syntax highlighted HTML string and set it as the headless browser HTML.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">generateHtml</span><span class=\"token punctuation\">(</span>\r\n    code<span class=\"token punctuation\">,</span>\r\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    lines<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'javascript'</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"showing-code-line-by-line\" style=\"position:relative;\"><a href=\"#showing-code-line-by-line\" aria-label=\"showing code line by line permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Showing code line by line</h2>\n<p>For now, I’m dumping all the code into the <code class=\"language-text\">React</code> component, but ideally, the code should be shown line by line, for that, I will loop through the <code class=\"language-text\">lines</code> array and then add line by line to a new array and pass it to the <code class=\"language-text\">generateHtml</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">let</span> codeToParse <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> scrollThreshold <span class=\"token operator\">=</span> <span class=\"token number\">9</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> line <span class=\"token keyword\">of</span> lines<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    codeToParse<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">generateHtml</span><span class=\"token punctuation\">(</span>\r\n        codeToParse<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n        index<span class=\"token punctuation\">,</span>\r\n        lines<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> scrollThreshold<span class=\"token punctuation\">,</span>\r\n        language\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    index <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This works but the problem is that if the code is too long, then the browser needs to scroll down to follow the new lines, for that I need to use the loop <code class=\"language-text\">index</code> variable to keep track of the current line and use the Puppeteer’s <code class=\"language-text\">page.evaluate()</code> to scroll the page down using the page’s <code class=\"language-text\">window</code> object.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">let</span> prevPosY <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> basePosY <span class=\"token operator\">=</span> <span class=\"token number\">7</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">let</span> codeToParse <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> scrollThreshold <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> line <span class=\"token keyword\">of</span> lines<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    codeToParse<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// get full page HTML</span>\r\n    <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">generateHtml</span><span class=\"token punctuation\">(</span>\r\n        codeToParse<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n        index<span class=\"token punctuation\">,</span>\r\n        lines<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> scrollThreshold<span class=\"token punctuation\">,</span>\r\n        language\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// set page HTML</span>\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">const</span> diff <span class=\"token operator\">=</span> index <span class=\"token operator\">-</span> scrollThreshold<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> posY <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token punctuation\">(</span>basePosY <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> diff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token constant\">SCALE</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token number\">0</span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// scroll down or up if needed</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prevPosY <span class=\"token operator\">!==</span> posY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">posY</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n            window<span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token literal-property property\">top</span><span class=\"token operator\">:</span> posY<span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">behavior</span><span class=\"token operator\">:</span> <span class=\"token string\">'smooth'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> posY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    prevPosY <span class=\"token operator\">=</span> posY<span class=\"token punctuation\">;</span>\r\n    index <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>You can access the full code from this blog post in my GitHub repo in the git hash <a href=\"https://github.com/blopa/code-video-creator/tree/d595cf30cec13021fb857f9acb83a853e26610d7\" target=\"_blank\" rel=\"noreferrer\">d595cf30cec13021fb857f9acb83a853e26610d7</a>.</p>\n<p>The project started with this code, but it has now grown a little, and the current code in the <code class=\"language-text\">main</code> branch of the repo has a typing effect for each letter, which makes it way nicer. Feel free to dive into the code on the <a href=\"https://github.com/blopa/code-video-creator/\" target=\"_blank\" rel=\"noreferrer\">code-video-creator</a> project page.</p>\n<p><img src=\"/7b9e49e1375d50b5c5e0ca29e78a0a62/code-to-video-v2.gif\" alt=\"\"></p>\n<p>I hope this was somehow insightful for you, please leave a comment if you have any questions. See you in the next one!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTAxLTA0VDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-01-04-create-videos-from-code-snippets-with-this-nodejs-script.en/","path":"/blog/coding/create-videos-from-code-snippets-with-this-nodejs-script/","locale":"en"},"rawMarkdownBody":"When I was working on my Game Devlog videos, I wondered if there was any way to automatically transform my code snippets into a video, so I could add them to my Devlog, but I couldn't find any solution for it, so I gave up on this idea.\r\n\r\nThen a couple of weeks ago I was playing around with [AST](https://en.wikipedia.org/wiki/Abstract_syntax_tree) and rendering `React` via `Node.js` with `Babel` when I had the idea to use Puppeteer to open a headless browser and record a page with my code snippet.\r\n\r\nThe goal is for the result to be like the following GIF.\r\n\r\n![](../../uploads/blog/2022/01/code-to-video-v1.gif)\r\n\r\n## Let's get coding\r\nI will start by creating a `script.js` to be run via terminal using `node`.\r\n\r\n```javascript\r\nrequire('@babel/register');\r\n\r\nconst { readFileSync } = require('fs');\r\nconst puppeteer = require('puppeteer');\r\nconst { PuppeteerScreenRecorder } = require('puppeteer-screen-recorder');\r\n\r\n// Utils\r\nconst { generateHtml } = require('./utils');\r\n\r\n// Constants\r\nconst SCALE = 4;\r\n\r\nconst generateVideo = async (filePath) => {\r\n    // TODO\r\n};\r\n\r\n// get node script param\r\nconst filePath =\r\n    process.argv[2] || './examples/Test.jsx';\r\n\r\ngenerateVideo(filePath);\r\n```\r\n\r\nMy code will use `ES Modules`, so I will install [esm](https://www.npmjs.com/package/esm) so I can run my script like `node -r esm src/script.js my_file.js`.\r\n\r\nFor the `generateVideo` function, I will follow the [Puppeteer's quick-start example](https://github.com/puppeteer/puppeteer/blob/v13.0.1/docs/api.md#class-puppeteer) to open a headless browser and then start recording it with [puppeteer-screen-recorder](https://github.com/prasanaworld/puppeteer-screen-recorder#example).\r\n\r\n```javascript\r\nconst generateVideo = async (filePath) => {\r\n    // load file content\r\n    const code = readFileSync(filePath, {\r\n        encoding: 'utf8',\r\n    });\r\n    const lines = code.split('\\n');\r\n\r\n    // Puppeteer config\r\n    const browser = await puppeteer.launch({\r\n        headless: true,\r\n        args: ['--window-size=1920,1080'],\r\n        defaultViewport: {\r\n            width: 1920,\r\n            height: 1080,\r\n        },\r\n    });\r\n\r\n    // open a new empty page\r\n    const page = await browser.newPage();\r\n    const config = {\r\n        followNewTab: false,\r\n        fps: 25,\r\n        ffmpeg_Path: null,\r\n        videoFrame: {\r\n            width: 1920,\r\n            height: 1080,\r\n        },\r\n        aspectRatio: '16:9',\r\n    };\r\n\r\n    const recorder = new PuppeteerScreenRecorder(\r\n        page,\r\n        config\r\n    );\r\n\r\n    // start recording\r\n    await recorder.start('./output.mp4');\r\n    await page.setContent('<p>Hello World</p>');\r\n\r\n    await page.waitForTimeout(1000);\r\n\r\n    await recorder.stop();\r\n    await browser.close();\r\n};\r\n```\r\n\r\nThis will open a headless browser tab, set the HTML to `<p>Hello World</p>` and make a 1-second video of it. That's not what I want, but I will get there.\r\n\r\n## Rendering a React component\r\nNow I will create a function that receives the code snippet as a parameter and then render a beautiful syntax highlighted code in HTML format using [Prism.js](https://prismjs.com/).\r\n\r\nWith `Prism.highlight` I can pass a code string and get an HTML with the syntax-highlighted code and `renderToStaticMarkup` to render the `React` component to an HTML string. I don't need `React` here, but since the whole idea started with `React` and `Babel`, I kept it.\r\n\r\n```javascript\r\nimport React from 'react';\r\nimport { renderToStaticMarkup } from 'react-dom/server';\r\nimport { JSDOM } from 'jsdom';\r\nimport { readFileSync } from 'fs';\r\n\r\n// Prism.js\r\nimport Prism from 'prismjs';\r\nimport loadLanguages from 'prismjs/components/';\r\n\r\n// My custom React component\r\nimport CodeHighlighter from './CodeHighlighter.jsx';\r\n\r\nconst styling = readFileSync(\r\n    './node_modules/prism-themes/themes/prism-material-dark.css',\r\n    { encoding: 'utf8' }\r\n);\r\n\r\nexport const generateHtml = (\r\n    code,\r\n    currentLine,\r\n    totalLines,\r\n    language\r\n) => {\r\n    loadLanguages([language]);\r\n    const codeHtml = Prism.highlight(\r\n        code,\r\n        Prism.languages[language],\r\n        language\r\n    );\r\n\r\n    // get HTML string\r\n    const html = renderToStaticMarkup((\r\n        <CodeHighlighter\r\n            codeHtml={codeHtml}\r\n            totalLines={totalLines}\r\n            currentLine={currentLine}\r\n        />\r\n    ));\r\n\r\n    const { window } = new JSDOM(html);\r\n    const { document } = window;\r\n\r\n    // Add Prism.js styling to the HTML document\r\n    const style = document.createElement('style');\r\n    style.textContent = styling;\r\n    document.head.appendChild(style);\r\n\r\n    return document.getElementsByTagName('html')[0].outerHTML;\r\n};\r\n```\r\n\r\nOther than `code`, the `generateHtml` function also receives `currentLine` and `totalLines` as parameters. `currentLine` will be used to highlight the current line of code, and `totalLines` to show the line numbers on the left.\r\n\r\n## The React component\r\nThe basic implementation of the `CodeHighlighter` I will simply return a `code` tag with the `dangerouslySetInnerHTML` set to the Prism.js HTML.\r\n\r\n```javascript\r\nimport React from 'react';\r\n\r\nconst SCALE = 4;\r\n\r\nfunction CodeHighlighter({\r\n    codeHtml,\r\n    totalLines,\r\n    currentLine,\r\n}) {\r\n    return (\r\n        <html lang=\"en\">\r\n            <body\r\n                style={{\r\n                    width: `${1920 / SCALE}px`,\r\n                    height: `${1080 / SCALE}px`,\r\n                    background: '#272822',\r\n                    transform: `scale(${SCALE})`,\r\n                    transformOrigin: '0% 0% 0px',\r\n                    margin: 0,\r\n                }}\r\n            >\r\n                <div\r\n                    style={{\r\n                        display: 'flex',\r\n                        margin: '20px 0 0 2px',\r\n                    }}\r\n                >\r\n                    <pre\r\n                        style={{\r\n                            margin: 0,\r\n                        }}\r\n                    >\r\n                        <code\r\n                            style={{\r\n                                fontFamily: \"Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace\",\r\n                            }}\r\n                            dangerouslySetInnerHTML={{\r\n                                __html: codeHtml,\r\n                            }}\r\n                        />\r\n                    </pre>\r\n                </div>\r\n            </body>\r\n        </html>\r\n    );\r\n}\r\n\r\nexport default CodeHighlighter;\r\n```\r\n\r\nThe code above is still missing the line highlighter and the line numbers, for that I will use the `totalLines` variable to create the line numbers, and `currentLine` to create a `div` with full width and move it with the `margin-top` CSS property. Check the full code for this `React` component [on GitHub](https://github.com/blopa/code-video-creator/blob/fc6836c497d5dd0a13a00f1f779fd2d482ebc611/src/CodeHighlighter.jsx).\r\n\r\n```javascript\r\nimport React from 'react';\r\n\r\nconst SCALE = 4;\r\n\r\nfunction CodeHighlighter({\r\n    codeHtml,\r\n    totalLines,\r\n    currentLine,\r\n}) {\r\n    // add the line numbers\r\n    const lines = new Array(totalLines).fill(null).map((v, index) => ((\r\n        <span\r\n            key={index}\r\n            style={{\r\n                height: '16px',\r\n                width: `${8 * (totalLines).toString().length}px`,\r\n            }}\r\n        >\r\n            {index + 1}\r\n        </span>\r\n    )));\r\n\r\n    return (\r\n        <html lang=\"en\">\r\n            <style\r\n                dangerouslySetInnerHTML={{\r\n                    __html: `\r\n                    body { color: white; }\r\n                `,\r\n                }}\r\n            />\r\n            <body\r\n                style={{\r\n                    width: `${1920 / SCALE}px`,\r\n                    height: `${1080 / SCALE}px`,\r\n                    background: '#272822',\r\n                    transform: `scale(${SCALE})`,\r\n                    transformOrigin: '0% 0% 0px',\r\n                    margin: 0,\r\n                }}\r\n            >\r\n                <div\r\n                    style={{\r\n                        display: 'flex',\r\n                        margin: '20px 0 0 2px',\r\n                    }}\r\n                >\r\n                    <div\r\n                        style={{\r\n                            width: '100%',\r\n                            position: 'absolute',\r\n                            height: `${4 * SCALE}px`,\r\n                            backgroundColor: '#44463a',\r\n                            zIndex: -1,\r\n                            marginTop: `${16 * currentLine}px`,\r\n                        }}\r\n                    />\r\n                    <div\r\n                        style={{\r\n                            display: 'grid',\r\n                            margin: '0 5px 0 2px',\r\n                            color: '#DD6',\r\n                        }}\r\n                    >\r\n                        {lines}\r\n                    </div>\r\n                    <pre\r\n                        style={{\r\n                            margin: 0,\r\n                        }}\r\n                    >\r\n                        <code\r\n                            style={{\r\n                                fontFamily: \"Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace\",\r\n                            }}\r\n                            dangerouslySetInnerHTML={{\r\n                                __html: codeHtml,\r\n                            }}\r\n                        />\r\n                    </pre>\r\n                </div>\r\n            </body>\r\n        </html>\r\n    );\r\n}\r\n\r\nexport default CodeHighlighter;\r\n```\r\n\r\nNow in the script, I can get the syntax highlighted HTML string and set it as the headless browser HTML.\r\n\r\n```javascript\r\nconst page = await browser.newPage();\r\n\r\nconst html = generateHtml(\r\n    code,\r\n    0,\r\n    lines.length,\r\n    'javascript'\r\n);\r\n\r\nawait page.setContent(html);\r\n```\r\n\r\n## Showing code line by line\r\nFor now, I'm dumping all the code into the `React` component, but ideally, the code should be shown line by line, for that, I will loop through the `lines` array and then add line by line to a new array and pass it to the `generateHtml` function.\r\n\r\n```javascript\r\nconst page = await browser.newPage();\r\n\r\nlet index = 0;\r\nlet codeToParse = [];\r\nconst scrollThreshold = 9;\r\n\r\nfor (const line of lines) {\r\n    codeToParse.push(line);\r\n\r\n    const html = generateHtml(\r\n        codeToParse.join('\\n'),\r\n        index,\r\n        lines.length + scrollThreshold,\r\n        language\r\n    );\r\n\r\n    await page.setContent(html);\r\n\r\n    await page.waitForTimeout(1000);\r\n    index += 1;\r\n}\r\n\r\nawait browser.close();\r\n```\r\n\r\nThis works but the problem is that if the code is too long, then the browser needs to scroll down to follow the new lines, for that I need to use the loop `index` variable to keep track of the current line and use the Puppeteer's `page.evaluate()` to scroll the page down using the page's `window` object.\r\n\r\n```javascript\r\nconst page = await browser.newPage();\r\n\r\nlet index = 0;\r\nlet prevPosY = 0;\r\nconst basePosY = 7;\r\nlet codeToParse = [];\r\nconst scrollThreshold = 8;\r\n\r\nfor (const line of lines) {\r\n    codeToParse.push(line);\r\n\r\n    // get full page HTML\r\n    const html = generateHtml(\r\n        codeToParse.join('\\n'),\r\n        index,\r\n        lines.length + scrollThreshold,\r\n        language\r\n    );\r\n\r\n    // set page HTML\r\n    await page.setContent(html);\r\n\r\n    const diff = index - scrollThreshold;\r\n    const posY = Math.max(\r\n        (basePosY + (16 * diff)) * SCALE,\r\n        0\r\n    );\r\n\r\n    // scroll down or up if needed\r\n    if (prevPosY !== posY) {\r\n        await page.evaluate((posY) => {\r\n            window.scrollTo({\r\n                top: posY,\r\n                behavior: 'smooth',\r\n            });\r\n        }, posY);\r\n    }\r\n\r\n    await page.waitForTimeout(1000);\r\n    prevPosY = posY;\r\n    index += 1;\r\n}\r\n\r\nawait browser.close();\r\n```\r\n\r\n## Conclusion\r\nYou can access the full code from this blog post in my GitHub repo in the git hash [d595cf30cec13021fb857f9acb83a853e26610d7](https://github.com/blopa/code-video-creator/tree/d595cf30cec13021fb857f9acb83a853e26610d7).\r\n\r\nThe project started with this code, but it has now grown a little, and the current code in the `main` branch of the repo has a typing effect for each letter, which makes it way nicer. Feel free to dive into the code on the [code-video-creator](https://github.com/blopa/code-video-creator/) project page.\r\n\r\n![](../../uploads/blog/2022/01/code-to-video-v2.gif)\r\n\r\nI hope this was somehow insightful for you, please leave a comment if you have any questions. See you in the next one!\r\n","frontmatter":{"tags":["node","nodejs","javascript","code snippet","coding","puppeteer"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-01-04T00:00:00.000Z","id":null,"path":"create-videos-from-code-snippets-with-this-nodejs-script","show":true,"title":"Create videos from code snippets with this Node.js script","hideExcerpt":false,"subtitle":""}}},{"node":{"excerpt":"Quando eu estava trabalhando nos videos dos meus Game…","html":"<p>Quando eu estava trabalhando nos videos dos meus Game Devlogs, eu ficava pensando se seria possível criar automaticamente videos dos meus códigos, que dai ficaria bem mais fácil para criar os meus vídeos, mas como não achei nada relacionado a isso na internet, eu meio que desisti dessa idéia.</p>\n<p>Até que algumas semanas atrás eu estava mexendo com <a href=\"https://en.wikipedia.org/wiki/Abstract_syntax_tree\" target=\"_blank\" rel=\"noreferrer\">AST</a> e renderizando componentes em <code class=\"language-text\">React</code> usando <code class=\"language-text\">Node.js</code> e <code class=\"language-text\">Babel</code> e eu percebi que seria possível usar a função <code class=\"language-text\">renderToStaticMarkup</code> para renderizar um HTML com os meus códigos em um headless browser com o Puppeteer e fazer uma gravação dessa página.</p>\n<p>O objetivo é conseguir criar um vídeo como o do GIF abaixo.</p>\n<p><img src=\"/63cbac7ef35f31c0b11e205782860106/code-to-video-v1.gif\" alt=\"\"></p>\n<h2 id=\"partiu-programar\" style=\"position:relative;\"><a href=\"#partiu-programar\" aria-label=\"partiu programar permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Partiu programar</h2>\n<p>Vou começar criando um arquivo <code class=\"language-text\">script.js</code> onde vou executar pela linha de comando.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@babel/register'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> readFileSync <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> puppeteer <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'puppeteer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> PuppeteerScreenRecorder <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'puppeteer-screen-recorder'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Utils</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> generateHtml <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Constants</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SCALE</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateVideo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">filePath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// TODO</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// get node script param</span>\r\n<span class=\"token keyword\">const</span> filePath <span class=\"token operator\">=</span>\r\n    process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token string\">'./examples/Test.jsx'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token function\">generateVideo</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Esse código vai usar <code class=\"language-text\">ES Modules</code>, então eu preciso instalar o pacote <a href=\"https://www.npmjs.com/package/esm\" target=\"_blank\" rel=\"noreferrer\">esm</a> para eu poder rodar o meu script com o comando <code class=\"language-text\">node -r esm src/script.js my_file.js</code>.</p>\n<p>Para a função <code class=\"language-text\">generateVideo</code>, seguirei o <a href=\"https://github.com/puppeteer/puppeteer/blob/v13.0.1/docs/api.md#class-puppeteer\" target=\"_blank\" rel=\"noreferrer\">exemplo de básico do Puppeteer</a> para abrir um headless browser e, em seguida, começar a gravar a sessão com o <a href=\"https://github.com/prasanaworld/puppeteer-screen-recorder#example\" target=\"_blank\" rel=\"noreferrer\">puppeteer-screen-recorder</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateVideo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">filePath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// load file content</span>\r\n    <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> code<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// Puppeteer config</span>\r\n    <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">headless</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">args</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'--window-size=1920,1080'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">defaultViewport</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">1920</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">1080</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// open a new empty page</span>\r\n    <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">followNewTab</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">fps</span><span class=\"token operator\">:</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">ffmpeg_Path</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">videoFrame</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">1920</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">1080</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token literal-property property\">aspectRatio</span><span class=\"token operator\">:</span> <span class=\"token string\">'16:9'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">const</span> recorder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PuppeteerScreenRecorder</span><span class=\"token punctuation\">(</span>\r\n        page<span class=\"token punctuation\">,</span>\r\n        config\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// start recording</span>\r\n    <span class=\"token keyword\">await</span> recorder<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./output.mp4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;p>Hello World&lt;/p>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">await</span> recorder<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Esse código vai abrir uma aba no headless browser, definir o HTML da página para <code class=\"language-text\">&lt;p>Hello World&lt;/p></code> e gravar um vídeo de um segundo. Não é bem isso que eu quero, mas estou chegando lá.</p>\n<h2 id=\"renderizando-um-componente-em-react\" style=\"position:relative;\"><a href=\"#renderizando-um-componente-em-react\" aria-label=\"renderizando um componente em react permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Renderizando um componente em React</h2>\n<p>Agora eu vou criar uma função para renderizar o meu componente em <code class=\"language-text\">React</code>. Essa função vai receber como parâmetro o meu código e retornar um HTML com a sintaxe do código toda colorida pelo <a href=\"https://prismjs.com/\" target=\"_blank\" rel=\"noreferrer\">Prism.js</a>.</p>\n<p>Com a função <code class=\"language-text\">Prism.highlight</code> eu pego o HTML com a sintaxe do código colorida e passo para o meu componente em <code class=\"language-text\">React</code>, que então vai adicionar outras tags de HTML e o CSS. Para renderizar esse componente em <code class=\"language-text\">React</code>, vou usar a função <code class=\"language-text\">renderToStaticMarkup</code>, que vai transformar o componente em uma string de HTML. Na real eu nem precisava usar o <code class=\"language-text\">React</code> para esse projeto, mas como tudo começou com eu mexendo com <code class=\"language-text\">React</code> e <code class=\"language-text\">Babel</code>, eu deixei como está.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> renderToStaticMarkup <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-dom/server'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">JSDOM</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'jsdom'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> readFileSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Prism.js</span>\r\n<span class=\"token keyword\">import</span> Prism <span class=\"token keyword\">from</span> <span class=\"token string\">'prismjs'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> loadLanguages <span class=\"token keyword\">from</span> <span class=\"token string\">'prismjs/components/'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// My custom React component</span>\r\n<span class=\"token keyword\">import</span> CodeHighlighter <span class=\"token keyword\">from</span> <span class=\"token string\">'./CodeHighlighter.jsx'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> styling <span class=\"token operator\">=</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'./node_modules/prism-themes/themes/prism-material-dark.css'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf8'</span> <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateHtml</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token parameter\">code<span class=\"token punctuation\">,</span>\r\n    currentLine<span class=\"token punctuation\">,</span>\r\n    totalLines<span class=\"token punctuation\">,</span>\r\n    language</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">loadLanguages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>language<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> codeHtml <span class=\"token operator\">=</span> Prism<span class=\"token punctuation\">.</span><span class=\"token function\">highlight</span><span class=\"token punctuation\">(</span>\r\n        code<span class=\"token punctuation\">,</span>\r\n        Prism<span class=\"token punctuation\">.</span>languages<span class=\"token punctuation\">[</span>language<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n        language\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// get HTML string</span>\r\n    <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">renderToStaticMarkup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>CodeHighlighter\r\n            codeHtml<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>codeHtml<span class=\"token punctuation\">}</span>\r\n            totalLines<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>totalLines<span class=\"token punctuation\">}</span>\r\n            currentLine<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>currentLine<span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> window <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JSDOM</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> document <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> window<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// Add Prism.js styling to the HTML document</span>\r\n    <span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'style'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    style<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> styling<span class=\"token punctuation\">;</span>\r\n    document<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>style<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>outerHTML<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Além da variável <code class=\"language-text\">code</code>, a função <code class=\"language-text\">generateHtml</code> também recebe <code class=\"language-text\">currentLine</code> e <code class=\"language-text\">totalLines</code> como parâmetros. A variável <code class=\"language-text\">currentLine</code> será usada para destacar a linha de código atual, e <code class=\"language-text\">totalLines</code> para mostrar os números das linhas à esquerda.</p>\n<h2 id=\"o-componente-em-react\" style=\"position:relative;\"><a href=\"#o-componente-em-react\" aria-label=\"o componente em react permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>O componente em React</h2>\n<p>A implementação básica do <code class=\"language-text\">CodeHighlighter</code> eu simplesmente retornarei uma tag <code class=\"language-text\">code</code> com o atributo <code class=\"language-text\">dangerouslySetInnerHTML</code> definido para o HTML do Prism.js.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SCALE</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">CodeHighlighter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\r\n    codeHtml<span class=\"token punctuation\">,</span>\r\n    totalLines<span class=\"token punctuation\">,</span>\r\n    currentLine<span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>html lang<span class=\"token operator\">=</span><span class=\"token string\">\"en\"</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>body\r\n                style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1920</span> <span class=\"token operator\">/</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1080</span> <span class=\"token operator\">/</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'#272822'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">transform</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">scale(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">transformOrigin</span><span class=\"token operator\">:</span> <span class=\"token string\">'0% 0% 0px'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span>div\r\n                    style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                        <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'20px 0 0 2px'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                <span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span>pre\r\n                        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                            <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">></span>\r\n                        <span class=\"token operator\">&lt;</span>code\r\n                            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                                <span class=\"token literal-property property\">fontFamily</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace\"</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                            dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                                <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> codeHtml<span class=\"token punctuation\">,</span>\r\n                            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>pre<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> CodeHighlighter<span class=\"token punctuation\">;</span></code></pre></div>\n<p>O código acima ainda está faltando o destaque da linha de código atual e os números das linhas, para isso usarei a variável <code class=\"language-text\">totalLines</code> para criar os números da linhas, e <code class=\"language-text\">currentLine</code> para criar uma <code class=\"language-text\">div</code> com largura total da página e movê-la para cima ou para baixo com a propriedade <code class=\"language-text\">margem-top</code> do CSS. Verifique o código completo para este componente <a href=\"https://github.com/blopa/code-video-creator/blob/fc6836c497d5dd0a13a00f1f779fd2d482ebc611/src/CodeHighlighter.jsx\" target=\"_blank\" rel=\"noreferrer\">no GitHub</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token constant\">SCALE</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">CodeHighlighter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\r\n    codeHtml<span class=\"token punctuation\">,</span>\r\n    totalLines<span class=\"token punctuation\">,</span>\r\n    currentLine<span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// add the line numbers</span>\r\n    <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span>totalLines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>span\r\n            key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>index<span class=\"token punctuation\">}</span>\r\n            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'16px'</span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">8</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>totalLines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">></span>\r\n            <span class=\"token punctuation\">{</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n        <span class=\"token operator\">&lt;</span>html lang<span class=\"token operator\">=</span><span class=\"token string\">\"en\"</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>style\r\n                dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                    <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\r\n                    body { color: white; }\r\n                </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span>body\r\n                style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1920</span> <span class=\"token operator\">/</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">1080</span> <span class=\"token operator\">/</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">background</span><span class=\"token operator\">:</span> <span class=\"token string\">'#272822'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">transform</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">scale(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">transformOrigin</span><span class=\"token operator\">:</span> <span class=\"token string\">'0% 0% 0px'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n            <span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span>div\r\n                    style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                        <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'flex'</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'20px 0 0 2px'</span><span class=\"token punctuation\">,</span>\r\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                <span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span>div\r\n                        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'100%'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token string\">'absolute'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">4</span> <span class=\"token operator\">*</span> <span class=\"token constant\">SCALE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'#44463a'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">zIndex</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">marginTop</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> currentLine<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span>div\r\n                        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                            <span class=\"token literal-property property\">display</span><span class=\"token operator\">:</span> <span class=\"token string\">'grid'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token string\">'0 5px 0 2px'</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token string\">'#DD6'</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">></span>\r\n                        <span class=\"token punctuation\">{</span>lines<span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span>pre\r\n                        style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                            <span class=\"token literal-property property\">margin</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                    <span class=\"token operator\">></span>\r\n                        <span class=\"token operator\">&lt;</span>code\r\n                            style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                                <span class=\"token literal-property property\">fontFamily</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace\"</span><span class=\"token punctuation\">,</span>\r\n                            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                            dangerouslySetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\r\n                                <span class=\"token literal-property property\">__html</span><span class=\"token operator\">:</span> codeHtml<span class=\"token punctuation\">,</span>\r\n                            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n                        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n                    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>pre<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> CodeHighlighter<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Agora eu posso pegar a string desse HTML, com toda a sintaxe de código colorida e números de linhas, e colocar como o HTML do headless browser pelo Puppeteer.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">generateHtml</span><span class=\"token punctuation\">(</span>\r\n    code<span class=\"token punctuation\">,</span>\r\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n    lines<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'javascript'</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"mostrando-o-codigo-linha-por-linha\" style=\"position:relative;\"><a href=\"#mostrando-o-codigo-linha-por-linha\" aria-label=\"mostrando o codigo linha por linha permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mostrando o código linha por linha</h2>\n<p>Por enquanto, estou colocando todo o código no componente <code class=\"language-text\">React</code> de uma vez só, mas idealmente, o código deve ser mostrado linha por linha, e para isso irei percorrer a array de linhas e, em seguida, adicionar linha por linha a uma nova array e passá-la para a função <code class=\"language-text\">generateHtml</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">let</span> codeToParse <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> scrollThreshold <span class=\"token operator\">=</span> <span class=\"token number\">9</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> line <span class=\"token keyword\">of</span> lines<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    codeToParse<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">generateHtml</span><span class=\"token punctuation\">(</span>\r\n        codeToParse<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n        index<span class=\"token punctuation\">,</span>\r\n        lines<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> scrollThreshold<span class=\"token punctuation\">,</span>\r\n        language\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    index <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Isso funciona, mas o problema é que se o código for muito longo, o browser precisa rolar para baixo para seguir as novas linhas, e para isso eu preciso usar a variável <code class=\"language-text\">index</code> do meu loop para acompanhar a linha atual e usar a função <code class=\"language-text\">page.evaluate()</code> do Puppeteer para rolar a página para baixo usando a função <code class=\"language-text\">window.scrollTo()</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">let</span> prevPosY <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> basePosY <span class=\"token operator\">=</span> <span class=\"token number\">7</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">let</span> codeToParse <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> scrollThreshold <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> line <span class=\"token keyword\">of</span> lines<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    codeToParse<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// get full page HTML</span>\r\n    <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">generateHtml</span><span class=\"token punctuation\">(</span>\r\n        codeToParse<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n        index<span class=\"token punctuation\">,</span>\r\n        lines<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> scrollThreshold<span class=\"token punctuation\">,</span>\r\n        language\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// set page HTML</span>\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">const</span> diff <span class=\"token operator\">=</span> index <span class=\"token operator\">-</span> scrollThreshold<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> posY <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token punctuation\">(</span>basePosY <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> diff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token constant\">SCALE</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token number\">0</span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// scroll down or up if needed</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prevPosY <span class=\"token operator\">!==</span> posY<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">posY</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n            window<span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token literal-property property\">top</span><span class=\"token operator\">:</span> posY<span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">behavior</span><span class=\"token operator\">:</span> <span class=\"token string\">'smooth'</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> posY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    prevPosY <span class=\"token operator\">=</span> posY<span class=\"token punctuation\">;</span>\r\n    index <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"conclusao\" style=\"position:relative;\"><a href=\"#conclusao\" aria-label=\"conclusao permalink\" class=\"post-headers-link before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusão</h2>\n<p>Você pode acessar o código completo desta postagem do blog no meu repositório GitHub na hash <a href=\"https://github.com/blopa/code-video-creator/tree/d595cf30cec13021fb857f9acb83a853e26610d7\" target=\"_blank\" rel=\"noreferrer\">d595cf30cec13021fb857f9acb83a853e26610d7</a> do <code class=\"language-text\">git</code>.</p>\n<p>O projeto começou com o código desse post, mas agora cresceu um pouco mais, e o código atual no branch <code class=\"language-text\">main</code> do repositório tem um efeito de digitação para cada letra, que faz o vídeo ficar bem mais maneiro. Sinta-se à vontade para mergulhar no código fonte na página do projeto <a href=\"https://github.com/blopa/code-video-creator/\" target=\"_blank\" rel=\"noreferrer\">code-video-creator</a>.</p>\n<p><img src=\"/7b9e49e1375d50b5c5e0ca29e78a0a62/code-to-video-v2.gif\" alt=\"\"></p>\n<p>Espero que esse post tenha sido útil para você. Deixe um comentário se tiver alguma dúvida e até a próxima!</p>","fields":{"postHashId":"Y29kaW5ndHJ1ZW51bGwyMDIyLTAxLTA0VDAwOjAwOjAwLjAwMFo=","slug":"/2022/2022-01-04-crie-videos-dos-seus-codigos-de-programacao-com-esse-script-de-nodejs.pt-br/","path":"/blog/coding/crie-videos-dos-seus-codigos-de-programacao-com-esse-script-de-nodejs/","locale":"pt-br"},"rawMarkdownBody":"Quando eu estava trabalhando nos videos dos meus Game Devlogs, eu ficava pensando se seria possível criar automaticamente videos dos meus códigos, que dai ficaria bem mais fácil para criar os meus vídeos, mas como não achei nada relacionado a isso na internet, eu meio que desisti dessa idéia.\r\n\r\nAté que algumas semanas atrás eu estava mexendo com [AST](https://en.wikipedia.org/wiki/Abstract_syntax_tree) e renderizando componentes em `React` usando `Node.js` e `Babel` e eu percebi que seria possível usar a função `renderToStaticMarkup` para renderizar um HTML com os meus códigos em um headless browser com o Puppeteer e fazer uma gravação dessa página.\r\n\r\nO objetivo é conseguir criar um vídeo como o do GIF abaixo.\r\n\r\n![](../../uploads/blog/2022/01/code-to-video-v1.gif)\r\n\r\n## Partiu programar\r\nVou começar criando um arquivo `script.js` onde vou executar pela linha de comando.\r\n\r\n```javascript\r\nrequire('@babel/register');\r\n\r\nconst { readFileSync } = require('fs');\r\nconst puppeteer = require('puppeteer');\r\nconst { PuppeteerScreenRecorder } = require('puppeteer-screen-recorder');\r\n\r\n// Utils\r\nconst { generateHtml } = require('./utils');\r\n\r\n// Constants\r\nconst SCALE = 4;\r\n\r\nconst generateVideo = async (filePath) => {\r\n    // TODO\r\n};\r\n\r\n// get node script param\r\nconst filePath =\r\n    process.argv[2] || './examples/Test.jsx';\r\n\r\ngenerateVideo(filePath);\r\n```\r\n\r\nEsse código vai usar `ES Modules`, então eu preciso instalar o pacote [esm](https://www.npmjs.com/package/esm) para eu poder rodar o meu script com o comando `node -r esm src/script.js my_file.js`.\r\n\r\nPara a função `generateVideo`, seguirei o [exemplo de básico do Puppeteer](https://github.com/puppeteer/puppeteer/blob/v13.0.1/docs/api.md#class-puppeteer) para abrir um headless browser e, em seguida, começar a gravar a sessão com o [puppeteer-screen-recorder](https://github.com/prasanaworld/puppeteer-screen-recorder#example).\r\n\r\n```javascript\r\nconst generateVideo = async (filePath) => {\r\n    // load file content\r\n    const code = readFileSync(filePath, {\r\n        encoding: 'utf8',\r\n    });\r\n    const lines = code.split('\\n');\r\n\r\n    // Puppeteer config\r\n    const browser = await puppeteer.launch({\r\n        headless: true,\r\n        args: ['--window-size=1920,1080'],\r\n        defaultViewport: {\r\n            width: 1920,\r\n            height: 1080,\r\n        },\r\n    });\r\n\r\n    // open a new empty page\r\n    const page = await browser.newPage();\r\n    const config = {\r\n        followNewTab: false,\r\n        fps: 25,\r\n        ffmpeg_Path: null,\r\n        videoFrame: {\r\n            width: 1920,\r\n            height: 1080,\r\n        },\r\n        aspectRatio: '16:9',\r\n    };\r\n\r\n    const recorder = new PuppeteerScreenRecorder(\r\n        page,\r\n        config\r\n    );\r\n\r\n    // start recording\r\n    await recorder.start('./output.mp4');\r\n    await page.setContent('<p>Hello World</p>');\r\n\r\n    await page.waitForTimeout(1000);\r\n\r\n    await recorder.stop();\r\n    await browser.close();\r\n};\r\n```\r\n\r\nEsse código vai abrir uma aba no headless browser, definir o HTML da página para `<p>Hello World</p>` e gravar um vídeo de um segundo. Não é bem isso que eu quero, mas estou chegando lá.\r\n\r\n## Renderizando um componente em React\r\nAgora eu vou criar uma função para renderizar o meu componente em `React`. Essa função vai receber como parâmetro o meu código e retornar um HTML com a sintaxe do código toda colorida pelo [Prism.js](https://prismjs.com/).\r\n\r\nCom a função `Prism.highlight` eu pego o HTML com a sintaxe do código colorida e passo para o meu componente em `React`, que então vai adicionar outras tags de HTML e o CSS. Para renderizar esse componente em `React`, vou usar a função `renderToStaticMarkup`, que vai transformar o componente em uma string de HTML. Na real eu nem precisava usar o `React` para esse projeto, mas como tudo começou com eu mexendo com `React` e `Babel`, eu deixei como está.\r\n\r\n```javascript\r\nimport React from 'react';\r\nimport { renderToStaticMarkup } from 'react-dom/server';\r\nimport { JSDOM } from 'jsdom';\r\nimport { readFileSync } from 'fs';\r\n\r\n// Prism.js\r\nimport Prism from 'prismjs';\r\nimport loadLanguages from 'prismjs/components/';\r\n\r\n// My custom React component\r\nimport CodeHighlighter from './CodeHighlighter.jsx';\r\n\r\nconst styling = readFileSync(\r\n    './node_modules/prism-themes/themes/prism-material-dark.css',\r\n    { encoding: 'utf8' }\r\n);\r\n\r\nexport const generateHtml = (\r\n    code,\r\n    currentLine,\r\n    totalLines,\r\n    language\r\n) => {\r\n    loadLanguages([language]);\r\n    const codeHtml = Prism.highlight(\r\n        code,\r\n        Prism.languages[language],\r\n        language\r\n    );\r\n\r\n    // get HTML string\r\n    const html = renderToStaticMarkup((\r\n        <CodeHighlighter\r\n            codeHtml={codeHtml}\r\n            totalLines={totalLines}\r\n            currentLine={currentLine}\r\n        />\r\n    ));\r\n\r\n    const { window } = new JSDOM(html);\r\n    const { document } = window;\r\n\r\n    // Add Prism.js styling to the HTML document\r\n    const style = document.createElement('style');\r\n    style.textContent = styling;\r\n    document.head.appendChild(style);\r\n\r\n    return document.getElementsByTagName('html')[0].outerHTML;\r\n};\r\n```\r\n\r\nAlém da variável `code`, a função `generateHtml` também recebe `currentLine` e `totalLines` como parâmetros. A variável `currentLine` será usada para destacar a linha de código atual, e `totalLines` para mostrar os números das linhas à esquerda.\r\n\r\n## O componente em React\r\nA implementação básica do `CodeHighlighter` eu simplesmente retornarei uma tag `code` com o atributo `dangerouslySetInnerHTML` definido para o HTML do Prism.js.\r\n\r\n```javascript\r\nimport React from 'react';\r\n\r\nconst SCALE = 4;\r\n\r\nfunction CodeHighlighter({\r\n    codeHtml,\r\n    totalLines,\r\n    currentLine,\r\n}) {\r\n    return (\r\n        <html lang=\"en\">\r\n            <body\r\n                style={{\r\n                    width: `${1920 / SCALE}px`,\r\n                    height: `${1080 / SCALE}px`,\r\n                    background: '#272822',\r\n                    transform: `scale(${SCALE})`,\r\n                    transformOrigin: '0% 0% 0px',\r\n                    margin: 0,\r\n                }}\r\n            >\r\n                <div\r\n                    style={{\r\n                        display: 'flex',\r\n                        margin: '20px 0 0 2px',\r\n                    }}\r\n                >\r\n                    <pre\r\n                        style={{\r\n                            margin: 0,\r\n                        }}\r\n                    >\r\n                        <code\r\n                            style={{\r\n                                fontFamily: \"Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace\",\r\n                            }}\r\n                            dangerouslySetInnerHTML={{\r\n                                __html: codeHtml,\r\n                            }}\r\n                        />\r\n                    </pre>\r\n                </div>\r\n            </body>\r\n        </html>\r\n    );\r\n}\r\n\r\nexport default CodeHighlighter;\r\n```\r\n\r\nO código acima ainda está faltando o destaque da linha de código atual e os números das linhas, para isso usarei a variável `totalLines` para criar os números da linhas, e `currentLine` para criar uma `div` com largura total da página e movê-la para cima ou para baixo com a propriedade `margem-top` do CSS. Verifique o código completo para este componente [no GitHub](https://github.com/blopa/code-video-creator/blob/fc6836c497d5dd0a13a00f1f779fd2d482ebc611/src/CodeHighlighter.jsx).\r\n\r\n```javascript\r\nimport React from 'react';\r\n\r\nconst SCALE = 4;\r\n\r\nfunction CodeHighlighter({\r\n    codeHtml,\r\n    totalLines,\r\n    currentLine,\r\n}) {\r\n    // add the line numbers\r\n    const lines = new Array(totalLines).fill(null).map((v, index) => ((\r\n        <span\r\n            key={index}\r\n            style={{\r\n                height: '16px',\r\n                width: `${8 * (totalLines).toString().length}px`,\r\n            }}\r\n        >\r\n            {index + 1}\r\n        </span>\r\n    )));\r\n\r\n    return (\r\n        <html lang=\"en\">\r\n            <style\r\n                dangerouslySetInnerHTML={{\r\n                    __html: `\r\n                    body { color: white; }\r\n                `,\r\n                }}\r\n            />\r\n            <body\r\n                style={{\r\n                    width: `${1920 / SCALE}px`,\r\n                    height: `${1080 / SCALE}px`,\r\n                    background: '#272822',\r\n                    transform: `scale(${SCALE})`,\r\n                    transformOrigin: '0% 0% 0px',\r\n                    margin: 0,\r\n                }}\r\n            >\r\n                <div\r\n                    style={{\r\n                        display: 'flex',\r\n                        margin: '20px 0 0 2px',\r\n                    }}\r\n                >\r\n                    <div\r\n                        style={{\r\n                            width: '100%',\r\n                            position: 'absolute',\r\n                            height: `${4 * SCALE}px`,\r\n                            backgroundColor: '#44463a',\r\n                            zIndex: -1,\r\n                            marginTop: `${16 * currentLine}px`,\r\n                        }}\r\n                    />\r\n                    <div\r\n                        style={{\r\n                            display: 'grid',\r\n                            margin: '0 5px 0 2px',\r\n                            color: '#DD6',\r\n                        }}\r\n                    >\r\n                        {lines}\r\n                    </div>\r\n                    <pre\r\n                        style={{\r\n                            margin: 0,\r\n                        }}\r\n                    >\r\n                        <code\r\n                            style={{\r\n                                fontFamily: \"Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace\",\r\n                            }}\r\n                            dangerouslySetInnerHTML={{\r\n                                __html: codeHtml,\r\n                            }}\r\n                        />\r\n                    </pre>\r\n                </div>\r\n            </body>\r\n        </html>\r\n    );\r\n}\r\n\r\nexport default CodeHighlighter;\r\n```\r\n\r\nAgora eu posso pegar a string desse HTML, com toda a sintaxe de código colorida e números de linhas, e colocar como o HTML do headless browser pelo Puppeteer.\r\n\r\n```javascript\r\nconst page = await browser.newPage();\r\n\r\nconst html = generateHtml(\r\n    code,\r\n    0,\r\n    lines.length,\r\n    'javascript'\r\n);\r\n\r\nawait page.setContent(html);\r\n```\r\n\r\n## Mostrando o código linha por linha\r\nPor enquanto, estou colocando todo o código no componente `React` de uma vez só, mas idealmente, o código deve ser mostrado linha por linha, e para isso irei percorrer a array de linhas e, em seguida, adicionar linha por linha a uma nova array e passá-la para a função `generateHtml`.\r\n\r\n```javascript\r\nconst page = await browser.newPage();\r\n\r\nlet index = 0;\r\nlet codeToParse = [];\r\nconst scrollThreshold = 9;\r\n\r\nfor (const line of lines) {\r\n    codeToParse.push(line);\r\n\r\n    const html = generateHtml(\r\n        codeToParse.join('\\n'),\r\n        index,\r\n        lines.length + scrollThreshold,\r\n        language\r\n    );\r\n\r\n    await page.setContent(html);\r\n\r\n    await page.waitForTimeout(1000);\r\n    index += 1;\r\n}\r\n\r\nawait browser.close();\r\n```\r\n\r\nIsso funciona, mas o problema é que se o código for muito longo, o browser precisa rolar para baixo para seguir as novas linhas, e para isso eu preciso usar a variável `index` do meu loop para acompanhar a linha atual e usar a função `page.evaluate()` do Puppeteer para rolar a página para baixo usando a função `window.scrollTo()`.\r\n\r\n```javascript\r\nconst page = await browser.newPage();\r\n\r\nlet index = 0;\r\nlet prevPosY = 0;\r\nconst basePosY = 7;\r\nlet codeToParse = [];\r\nconst scrollThreshold = 8;\r\n\r\nfor (const line of lines) {\r\n    codeToParse.push(line);\r\n\r\n    // get full page HTML\r\n    const html = generateHtml(\r\n        codeToParse.join('\\n'),\r\n        index,\r\n        lines.length + scrollThreshold,\r\n        language\r\n    );\r\n\r\n    // set page HTML\r\n    await page.setContent(html);\r\n\r\n    const diff = index - scrollThreshold;\r\n    const posY = Math.max(\r\n        (basePosY + (16 * diff)) * SCALE,\r\n        0\r\n    );\r\n\r\n    // scroll down or up if needed\r\n    if (prevPosY !== posY) {\r\n        await page.evaluate((posY) => {\r\n            window.scrollTo({\r\n                top: posY,\r\n                behavior: 'smooth',\r\n            });\r\n        }, posY);\r\n    }\r\n\r\n    await page.waitForTimeout(1000);\r\n    prevPosY = posY;\r\n    index += 1;\r\n}\r\n\r\nawait browser.close();\r\n```\r\n\r\n## Conclusão\r\nVocê pode acessar o código completo desta postagem do blog no meu repositório GitHub na hash [d595cf30cec13021fb857f9acb83a853e26610d7](https://github.com/blopa/code-video-creator/tree/d595cf30cec13021fb857f9acb83a853e26610d7) do `git`.\r\n\r\nO projeto começou com o código desse post, mas agora cresceu um pouco mais, e o código atual no branch `main` do repositório tem um efeito de digitação para cada letra, que faz o vídeo ficar bem mais maneiro. Sinta-se à vontade para mergulhar no código fonte na página do projeto [code-video-creator](https://github.com/blopa/code-video-creator/).\r\n\r\n![](../../uploads/blog/2022/01/code-to-video-v2.gif)\r\n\r\nEspero que esse post tenha sido útil para você. Deixe um comentário se tiver alguma dúvida e até a próxima!\r\n","frontmatter":{"tags":["node","nodejs","javascript","código","programação","puppeteer"],"categories":["coding"],"allowComments":true,"publishOnMedium":false,"cover":null,"date":"2022-01-04T00:00:00.000Z","id":null,"path":"crie-videos-dos-seus-codigos-de-programacao-com-esse-script-de-nodejs","show":true,"title":"Crie videos dos seus códigos de programação com esse script de Node.js","hideExcerpt":false,"subtitle":""}}}],"language":"en","intl":{"language":"en","languages":["en","pt-br"],"messages":{"site_title":"pablo.gg","title":"Title","author":"@thepiratepablo","search_placeholder":"Search...","about":"About","photos":"Photos","archive":"Archive","contact":"Contact","close":"Close","contact_page":"Contact page","see_more":"See more posts","built_with":"Built with ","buy_me_a_soda":"Buy me a soda","blog":"Blog","blog_posts":"Blog posts","go_to_post":"Go to post","search":"Search","loading":"Loading...","search_results":"Search results","search_results_for":"{quantity} search results for: \"{query}\"","search_for_query":"Search for \"{query}\"","no_results":"No results","home":"Home","description":"Yet another developer personal blog","go_back":"Go back to the homepage","thats_me":"That's me!","got_it":"Got it!","check_it_out":"Check it out!","we_are":"We are","e3":"E3","away_from_next_sgf":"away from Summer Game Fest 2025","away_from_next_gamescom":"away from Gamescom 2024","sgf_countdown":"Summer Game Fest Countdown","gamescom_countdown":"Gamescom Countdown","e3_paragraph_1":"This page once featured a countdown to the next E3 event, a moment that countless gamers and industry professionals looked forward to each year. E3 was not just an event; it was a celebration of our shared passion for video games, a place where dreams were realized, and memories were made.","e3_paragraph_2":"From the electrifying announcements to the hands-on demos, E3 was the heartbeat of the gaming world. It brought together people from all corners of the globe, united by their love for games. For many, it was a chance to meet their heroes, discover new titles, and experience the thrill of the latest innovations in gaming technology.","e3_paragraph_3":"However, as the gaming landscape has evolved, so too has the way we connect and celebrate our passion. While E3 has come to an end, the spirit of excitement and community it fostered lives on. We now look forward to new ways of coming together, sharing our love for games, and creating new memories.","e3_paragraph_4":"Though the countdown is gone, the legacy of E3 will forever remain in our hearts, reminding us of the incredible journeys we've taken and the bonds we've formed along the way.","sec":"Sec","secs":"Secs","min":"Min","mins":"Mins","hour":"Hour","hours":"Hours","day":"Day","days":"Days","month":"Month","months":"Months","year":"Year","years":"Years","recent_posts":"Recent posts","email":"Email","twitter":"Twitter","name":"Name","page":"Page","fill_this_want_reply":"Fill this in if you want me to contact you back","sorry_this_post_unavailable_language":"Sorry, this post is not available in the language you picked","language":"Language","comment":"Comment","comments":"Comments","no_comments":"No comments yet.","post_comment":"Post comment","send_message":"Send message","message":"Message","post_a_comment":"Post a comment","your_comment_submitted":"Your comment has been successfully submitted.","your_message_submitted":"Your message has been successfully submitted.","on":"on","ok":"Ok","copy":"Copy","copied":"Copied","photo_num":"Photo {num}","the_matrix_has_you":"The Matrix has you...","about_paragraph_1":"A technology enthusiast from an early age, I have always been interested in computers and video games.","about_paragraph_2":"I graduated in Information Technology at Estácio de Sá University and always try to find out about new technologies and get involved in new development projects, some of which the code can be found on GitHub.","cookie_banner_consent":"By using this website you agree to our use of cookies to deliver a better experience.","written_in":"Written in ","no_post_this_tag":"No post in English include this tag.","tags":"Tags","tag_colon":"Tag: ","tags_colon":"Tags: ","posts_tagged":"Posts tagged with ","categories":"Categories","category":"Category","category_colon":"Category: ","posts_on_category":"Posts on category ","related_posts":"Related posts","read_time":"🕒 {time} min. read","create_post":"Create Post","show":"Show","date":"Date","download":"Download","add_tag":"Add Tag","hide_excerpt":"Hide Excerpt","publish_on_medium":"Publish on Medium","allow_comments":"Allow Comments","subtitle":"Subtitle","you_must_be_truly_desperate":"You must be truly desperate to come to me for help","game.game_title":"pablo.gg - The Game","game.next":"Next","game.ok":"Ok","game.loading_asset_colon":"Loading asset:","game.loading":"Loading...","game.characters.npc_01":"Frost","game.characters.npc_02":"Gavin","game.characters.npc_03":"Giles","game.characters.npc_04":"Godfrey","game.characters.npc_05":"Hugh","game.characters.npc_06":"Ivar","game.characters.npc_07":"Leopold","game.characters.npc_08":"Lucian","game.characters.npc_09":"Gumercindo","game.characters.npc_10":"Mr. Flower","game.characters.npc_11":"Maxim","game.characters.npc_12":"Milo","game.characters.npc_13":"Otto","game.characters.npc_14":"Palmer","game.characters.npc_15":"Quentin","game.characters.npc_16":"Sebastian","game.characters.npc_17":"Neville","game.characters.npc_18":"Cassian","game.characters.npc_19":"Balthasar","game.characters.sign_01":"Sign","game.characters.book_01":"Book","game.characters.home_page_city_sign":"Sign","game.characters.coding_category_city_sign_01":"Sign","game.characters.coding_category_city_sign_02":"Sign","game.characters.events_category_city_sign":"Sign","game.characters.funny_category_city_sign":"Sign","game.characters.gadgets_category_city_sign_01":"Sign","game.characters.gadgets_category_city_sign_02":"Sign","game.characters.games_category_city_sign":"Sign","game.characters.general_category_city_sign":"Sign","game.characters.tips_category_city_sign":"Sign","game.characters.toys_category_city_sign":"Sign","game.characters.sword":"Info","game.characters.push":"Info","game.gamepad.a_button":"A Button","game.gamepad.b_button":"B Button","game.gamepad.d_pad_left":"D-Pad Left","game.gamepad.d_pad_up":"D-Pad Up","game.gamepad.d_pad_right":"D-Pad Right","game.gamepad.d_pad_down":"D-Pad Down","game.gamepad.start_button":"Start Button","game.menu.start":"Start","game.menu.exit":"Exit","game.menu.settings":"Settings","game.game_over.game_over":"Game Over","game.game_over.retry":"Retry","game.game_over.exit":"Exit","game.start_menu.save_game":"Save Game","game.start_menu.exit":"Exit","game.browse_posts.choose_a_post":"Choose a Post to read","game.dialogs.npc_01.01":"Hey, you're finally awake!","game.dialogs.npc_01.02":"What, you don't know where you are?","game.dialogs.npc_01.03":"Don't be silly, you're at the Home Page City, remember?","game.dialogs.npc_01.04":"This city was founded by Pablo Montenegro to be the start of your journey","game.dialogs.npc_01.05":"Go explore the world and find other cities where you can read the accumulated knowledge of our civilization...","game.dialogs.npc_01.06":"... some people call it \"Blog Posts\", I don't know why...","game.dialogs.npc_02.01":"Be careful with the Slimes that live in the wild.","game.dialogs.npc_02.02":"Press SPACE to use your sword","game.dialogs.npc_02.03":"What is SPACE? I have no idea.","game.dialogs.npc_03.01":"Hello, welcome to our library","game.dialogs.npc_03.02":"We only have one book, which contains all of this city category publications.","game.dialogs.npc_03.03":"Go check it out!","game.dialogs.npc_04.01":"I like snails","game.dialogs.npc_05.01":"Incomplete sentences may cause some","game.dialogs.npc_06.01":"Red is greener than purple, for sure.","game.dialogs.npc_07.01":"Having a beard is the new not having a beard","game.dialogs.npc_08.01":"Sup","game.dialogs.npc_09.01":"\" - Cooper, what are you doing?\"\n\" - Docking.\"","game.dialogs.npc_10.01":"I should buy a boat","game.dialogs.npc_11.01":"Have you heard the me neither joke? Me neither.","game.dialogs.npc_12.01":"I clean toilet and rescue princesses, good life, yes?","game.dialogs.npc_13.01":"We want the airwaves back","game.dialogs.npc_14.01":"Save the cheerleader, save the world","game.dialogs.npc_15.01":"Hello, how are you?","game.dialogs.npc_15.02":"Ok bye!","game.dialogs.npc_16.01":"A kangaroo is really just a rabbit on steroids","game.dialogs.npc_17.01":"For the 216th time, he said he would quit drinking soda after this last Coke","game.dialogs.npc_18.01":"Nothing and everything is possimpible","game.dialogs.npc_19.01":"For a city called \"Events\", there isn't much going on...","game.dialogs.sign_01.01":"Congrats, you can read this!","game.dialogs.book_01.01":"Hey, thanks for trying out this very weird way to access my website","game.dialogs.book_01.02":"This project wouldn't be possible without the awesome open-source work of many people, like:","game.dialogs.book_01.03":"ArMM1998 - For the characters sprites and tilesets","game.dialogs.book_01.04":"PixElthen - For the slime sprites","game.dialogs.book_01.05":"pixelartm - For the pirate hat sprites","game.dialogs.book_01.06":"jkjkke - For the Game Over screen background","game.dialogs.book_01.07":"KnoblePersona - For the Main Menu screen background","game.dialogs.book_01.08":"Min - For the open book sprite","game.dialogs.book_01.09":"And of course, Richard Davey for making Phaser.io!","game.dialogs.home_page_city_sign":"City of Home Page","game.dialogs.coding_category_city_sign.01":"City of Coding Category","game.dialogs.coding_category_city_sign.02":"City of Coding Category","game.dialogs.events_category_city_sign":"City of Events Category","game.dialogs.funny_category_city_sign":"City of Funny Category","game.dialogs.gadgets_category_city_sign.01":"City of Gadgets Category","game.dialogs.gadgets_category_city_sign.02":"City of Gadgets Category","game.dialogs.games_category_city_sign":"City of Games Category","game.dialogs.general_category_city_sign":"City of General Category","game.dialogs.tips_category_city_sign":"City of Tips Category","game.dialogs.toys_category_city_sign":"City of Toys Category","game.dialogs.sword_item_description":"You can now attack, press SPACE to use your sword.","game.dialogs.push_item_description":"Now you can push some objects, press SPACE in front of a object to use push it.","zelda_timeline.title":"Zelda Timeline","zelda_timeline.timeline_split":"Timeline Split","zelda_timeline.timeline_unification":"Timeline Unification","zelda_timeline.icons_from":"The icons used on this page are from zeldauniverse.net and game-icons.net","zelda_timeline.creation":"Creation","zelda_timeline.creation_of_land_sky":"The Creation of the Land and Sky","zelda_timeline.goddess_hylia_and_sky_era":"Goddess Hylia and Sky Era","zelda_timeline.skyward_sword":"Skyward Sword","zelda_timeline.the_ancient_battle":"The Ancient Battle and the reincarnation of the Goddess Hylia","zelda_timeline.return_to_surface":"Return to the surface","zelda_timeline.era_of_chaos":"Era of Chaos","zelda_timeline.sacred_realm_sealed":"The Sacred Realm is Sealed","zelda_timeline.era_of_prosperity":"Era of Prosperity","zelda_timeline.establishment_of_hyrule":"The Hyrule Kingdom is established","zelda_timeline.force_era":"Force Era","zelda_timeline.the_minish_cap":"The Minish Cap","zelda_timeline.rise_of_evil_vaati":"The Rise of the Evil Vaati","zelda_timeline.four_swords":"Four Swords","zelda_timeline.resurrection_of_vaati":"The Resurrection of Vaati","zelda_timeline.era_of_the_hero_of_time":"Era of the Hero of Time","zelda_timeline.hyrulean_civil_war":"Hyrulean Civil War","zelda_timeline.ocarina_of_time":"Ocarina of Time","zelda_timeline.sacred_realm_becomes_dark_world":"The Sacred Realm Becomes the Dark World","zelda_timeline.ganondorf_becomes_ganon":"Ganondorf becomes Ganon","zelda_timeline.hero_is_defeated":"Hero is defeated","zelda_timeline.decline_of_last_hero":"The Decline of Hyrule and the Last Hero","zelda_timeline.the_imprisoning_war":"The Imprisoning War","zelda_timeline.era_of_dark_and_light":"Era of Light and Dark","zelda_timeline.a_link_to_the_past":"A Link to the Past","zelda_timeline.resurrection_of_ganon":"The Resurrection of Ganon","zelda_timeline.resurrection_of_ganon_is_prevented":"The Resurrection of Ganon is prevented","zelda_timeline.links_awakening":"Link's Awakening","zelda_timeline.oracle_of_ages_and_seasons":"Oracle of Ages and Oracle of Seasons","zelda_timeline.a_link_between_worlds":"A Link Between Worlds","zelda_timeline.tri_force_heroes":"Tri Force Heroes","zelda_timeline.the_gold_era":"The Gold Era","zelda_timeline.monarchs_of_hyrule_use_triforce":"The Monarchs of Hyrule Use the Triforce","zelda_timeline.era_of_decline":"The Era of Decline","zelda_timeline.tragedy_of_princess_zelda_1":"The Tragedy of Princess Zelda I","zelda_timeline.the_legend_of_zelda":"The Legend of Zelda","zelda_timeline.adventure_of_link":"Adventure of Link","zelda_timeline.hero_defeated":"Hero Defeated","zelda_timeline.child_era":"Child Era","zelda_timeline.adult_era":"Adult Era","zelda_timeline.sacred_realm_protected":"The Sacred Realm Remains Protected","zelda_timeline.twilight_realm_and_legacy_of_hero":"The Twilight Realm and the Legacy of the Hero","zelda_timeline.majoras_mask":"Majora's Mask","zelda_timeline.prince_of_thieves_is_executed":"The Demon Thief, Ganondorf, Is Executed","zelda_timeline.twilight_era":"The Twilight Era","zelda_timeline.twilight_princess":"Twilight Princess","zelda_timeline.shadow_invasion":"The Shadow Invasion","zelda_timeline.shadow_era":"The Shadow Era","zelda_timeline.four_swords_adventures":"Four Swords Adventures","zelda_timeline.reincarnation_of_ganondorf":"The Reincarnation of Ganondorf","zelda_timeline.ganondorf_is_sealed":"Ganondorf is sealed","zelda_timeline.hero_of_wind_and_new_world":"The Hero of Wind and a New World","zelda_timeline.era_without_a_hero":"The Era without a Hero","zelda_timeline.ganondorf_is_resurrected":"Ganondorf is Resurrected","zelda_timeline.hyrule_is_sealed_and_flooded":"Hyrule is sealed and then flooded","zelda_timeline.era_of_the_great_sea":"The Era of the Great Sea","zelda_timeline.the_wind_waker":"The Wind Waker","zelda_timeline.era_of_the_great_voyage":"The Era of the Great Voyage","zelda_timeline.phantom_hourglass":"Phantom Hourglass","zelda_timeline.era_of_hyrule_rebirth":"The Era of Hyrule's Rebirth","zelda_timeline.new_continent_discovered":"New Continent Discovered","zelda_timeline.new_hyrule_is_founded":"A New Hyrule Kingdom is founded","zelda_timeline.spirit_tracks":"Spirit Tracks","zelda_timeline.evil_king_malladus_is_resurrected":"The Evil King Malladus is Resurrected","zelda_timeline.age_of_calamity":"Age of Calamity","zelda_timeline.breath_of_the_wild":"Breath of the Wild","zelda_timeline.era_of_the_wilds":"Era of the Wilds","zelda_timeline.calamity_ganon_is_sealed":"Calamity Ganon is Sealed. Technology is banned, leading some Sheikah to form the Yiga Clan","zelda_timeline.divine_beasts_are_cleansed":"The Divine Beasts are cleansed and Calamity Ganon is Sealed","zelda_timeline.tears_of_the_kingdom":"Tears of the Kingdom","zelda_timeline.hyrule_kingdom_is_teared_apart":"Ganondorf is Resurrected (I think?)","blog_categories.games":"Games","blog_categories.general":"General","blog_categories.tips":"Tips","blog_categories.events":"Events","blog_categories.coding":"Coding","blog_categories.funny":"Funny","blog_categories.toys":"Toys","blog_categories.gadgets":"Gadgets","forty_two_page.title":"Forty Two","forty_two_page.description":"So long and thanks for all the fish!","projects_page.title":"Projects","projects_page.description":"Here is a list of some of my favorites personal projects.","projects_page.gatsbyMaterialUiBlogDescription":"A simple Gatsby Blog Starter with Material UI.","projects_page.contractBuilderDescription":"Contract Builder is a free open-source project that allows anyone to easily maintain and build any kind of contract (legal documents, lawsuit, rent, agreements, construction and so on) using Google Spreadsheets. This was develop as a personal project to help a friend who was struggling spending up to an hour to make a custom contract, now she is able to do it in less than 5 minutes. Hooray!","projects_page.resumeBuilderDescription":"Resume Builder is a free open-source project that allows anyone to easily maintain and build any kind of resume using Google Spreadsheets. This was develop as a personal project to help a friend who was struggling spending up to an hour to make a custom resumes.","projects_page.magentoChatbotDescription":"With this module you can fully integrate your Magento store with the most popular chat apps in the market. This means that by simply installing this module and a few clicks you can have a new way to show and sell your products to your clients. Very easy to use! Try now, it's FREE.","projects_page.jamStackSortenerDescription":"This is a basic URL shortener POC build with Gatsby.","projects_page.gotinhaDescription":"It was always my dream to make my own game, and after trying Unity a couple years ago, I decided to try it again with something I'm more familiar with: Javascript. As a frontend developer, Javascript is already the language that I write most of my code at work and also in my personal projects, and after a quick search I was able to find the amazing PhaserJS Framework for building 2D web games.","e3_2012_photos.title":"E3 2012","e3_2012_photos.description":"On June 2012 I attended E3 as a media press for a full coverage for Nintendo Blast.","e3_2013_photos.title":"E3 2013","e3_2013_photos.description":"On June 2013 I attended E3 as a media press for a full coverage for Game Blast.","e3_2014_photos.title":"E3 2014","e3_2014_photos.description":"On June 2014 I attended E3 as a media press for a full coverage for Game Blast.","e3_2015_photos.title":"E3 2015","e3_2015_photos.description":"On June 2015 I attended E3 as a media press for a full coverage for Game Blast and Game Over TV.","e3_2017_photos.title":"E3 2017","e3_2017_photos.description":"On June 2012 I attended E3 as a media press for a full coverage for PlayReplay and Game Over TV.","e3_2019_photos.title":"E3 2019","e3_2019_photos.description":"On June 2019 I attended E3 as a media press for a full coverage for PlayReplay.","gamescom_2019_photos.title":"Gamescom 2019","gamescom_2019_photos.description":"On August 2019 I attended Gamescom as a media press for a full coverage for PlayReplay.","san_francisco_2019_photos.title":"San Francisco 2019","san_francisco_2019_photos.description":"On September 2019 I've traveled to San Francisco for the Metallica S&M2 concert.","notfound.title":"404: Not found","notfound.header":"404 NOT FOUND","notfound.description":"Sorry, this page doesn't seem to exist. Perhaps the archives are incomplete?","seo_keywords.developer":"developer","seo_keywords.development":"development","seo_keywords.javascript":"javascript","seo_keywords.es6":"es6","seo_keywords.e3":"e3","seo_keywords.sgf":"sgf","seo_keywords.gamescom":"gamescom","seo_keywords.countdown":"countdown","seo_keywords.archive":"archive","seo_keywords.about_me":"about me","seo_keywords.personal_blog":"personal blog","seo_keywords.personal_projects":"personal projects","seo_keywords.travels":"travels","seo_keywords.tips":"tips","seo_keywords.lifehacks":"lifehacks","seo_keywords.reviews":"reviews","seo_keywords.games":"games","seo_keywords.timeline":"timeline","seo_keywords.photos":"photos","cookie_law.we_use_cookies":"We use cookies to ensure you get the best experience on our website. By using our website you agree to our ","cookie_law.title":"Cookie policy","cookie_law.what_are_cookies":"What are cookies?","cookie_law.what_are_cookies_text":"As is common practice with almost all professional websites this site uses cookies, which are tiny files that are downloaded to your computer, to improve your experience. This page describes what information they gather, how we use it and why we sometimes need to store these cookies. We will also share how you can prevent these cookies from being stored however this may downgrade or 'break' certain elements of the sites functionality. For more general information on cookies, please read ","cookie_law.what_are_cookies_more_info_url":"https://en.wikipedia.org/wiki/HTTP_cookie","cookie_law.how_we_use_cookies":"How we use cookies","cookie_law.how_we_use_cookies_text":"We use cookies for a variety of reasons detailed below. Unfortunately in most cases there are no industry standard options for disabling cookies without completely disabling the functionality and features they add to this site. It is recommended that you leave on all cookies if you are not sure whether you need them or not in case they are used to provide a service that you use.","cookie_law.disabling_cookies":"Disabling cookies","cookie_law.disabling_cookies_text":"You can prevent the setting of cookies by adjusting the settings on your browser (see your browser Help for how to do this). Be aware that disabling cookies will affect the functionality of this and many other websites that you visit. Disabling cookies will usually result in also disabling certain functionality and features of the this site. Therefore it is recommended that you do not disable cookies.","cookie_law.the_cookies_we_set":"The cookies we set","cookie_law.site_preferences_cookie":"Site preferences cookies","cookie_law.site_preferences_cookie_text":"In order to provide you with a great experience on this site we provide the functionality to set your preferences for how this site runs when you use it. In order to remember your preferences we need to set cookies so that this information can be called whenever you interact with a page is affected by your preferences.","cookie_law.third_party_cookies":"Third party cookies","cookie_law.third_party_cookies_text":"In some special cases we also use cookies provided by trusted third parties. The following section details which third party cookies you might encounter through this site.","cookie_law.third_party_cookies_item_1":"This site uses Google Analytics which is one of the most widespread and trusted analytics solution on the web for helping us to understand how you use the site and ways that we can improve your experience. These cookies may track things such as how long you spend on the site and the pages that you visit so we can continue to produce engaging content. For more information on Google Analytics cookies, see the official Google Analytics page.","cookie_law.third_party_cookies_item_2":"From time to time we test new features and make subtle changes to the way that the site is delivered. When we are still testing new features these cookies may be used to ensure that you receive a consistent experience whilst on the site whilst ensuring we understand which optimisations our users appreciate the most.","cookie_law.more_information":"More information","cookie_law.more_information_text":"Hopefully that has clarified things for you and as was previously mentioned if there is something that you aren't sure whether you need or not it's usually safer to leave cookies enabled in case it does interact with one of the features you use on our site. However if you are still looking for more information then you can contact us through our "},"routed":false,"originalPath":"/archive/1","redirect":true,"redirectDefaultLanguageToRoot":false,"defaultLanguage":"en","fallbackLanguage":"","ignoredPaths":[]},"locale":"en"}},
    "staticQueryHashes": ["1156153307","1355482417","1591365477","1628619374","2127381735","2288279559","26159077","3566410298","3649515864","3847325417","3982724423","928834867"]}